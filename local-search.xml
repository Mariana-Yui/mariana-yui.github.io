<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>webpackæºç åˆ†æ</title>
    <link href="/2023/09/12/2023-09-12/"/>
    <url>/2023/09/12/2023-09-12/</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202309121127705.png" alt="" /></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
      <tag>å·¥ç¨‹åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠJavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="/2023/09/10/2023-09-10-javascript-design-mode-and-practice-record/"/>
    <url>/2023/09/10/2023-09-10-javascript-design-mode-and-practice-record/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¹‹å‰ä¸€ç›´å¯¹è®¾è®¡æ¨¡å¼æ–¹é¢çš„çŸ¥è¯†æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ , ç§ä»¥ä¸ºå¯¹å¸¸è§è®¾è®¡æ¨¡å¼å’Œç¼–ç¨‹èŒƒå‹çš„æŒæ¡å¯¹æå‡æ¶æ„æ€ç»´å’Œä»£ç é‡æ„èƒ½åŠ›æ˜¯å¾ˆæœ‰å¸®åŠ©çš„. æœ¬æ–‡ä¸ºé˜…è¯»ã€ŠJavaScript è®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹è¿‡ç¨‹ä¸­çš„éšç¬”, åŒ…æ‹¬ JavaScript é—æ¼çš„åŸºç¡€çŸ¥è¯†çš„å®Œå–„ä»¥åŠå¸¸è§è®¾è®¡æ¨¡å¼è®°å½•.</p></blockquote><p><em>ä¸å®šæœŸæ›´æ–° å¹³å¸¸ä¸Šç­æ‘¸é±¼çš„æ—¶å€™ä¹Ÿæ˜¯åœ¨çœ‹ webpack æºç â€¦æ¯•ç«Ÿä¸èƒ½æ˜ç›®å¼ èƒ†çš„ææœ¬ä¹¦å‡ºæ¥(éšç¬”å®Œç»“åè¯¥æ®µåˆ é™¤)</em></p><h1 id="ç¬¬ä¸€éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€éƒ¨åˆ†"></a> ç¬¬ä¸€éƒ¨åˆ†</h1><p><strong>JavaScript éƒ¨åˆ†åŸºç¡€çŸ¥è¯†éš¾ç‚¹</strong></p><h3 id="å·¥å‚å‡½æ•°"><a class="markdownIt-Anchor" href="#å·¥å‚å‡½æ•°"></a> å·¥å‚å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> objectFactory = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>  <span class="hljs-title class_">Constructor</span> = [].<span class="hljs-property">shift</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);<br>  obj.<span class="hljs-property">__proto__</span> = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;<br>  <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, <span class="hljs-variable language_">arguments</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> ret === <span class="hljs-string">&quot;object&quot;</span> ? ret : obj;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="åŸå‹é“¾"><a class="markdownIt-Anchor" href="#åŸå‹é“¾"></a> åŸå‹é“¾</h3><p>åº•å±‚å¯¹è±¡å±‚å±‚å‘ä¸ŠæŸ¥æ‰¾å§”æ‰˜ç»™å½“å‰å¯¹è±¡çš„<strong>æ„é€ å™¨</strong>çš„åŸå‹ä¸‹çš„å¯¹åº”å±æ€§/æ–¹æ³•.<br />ä¾‹å¦‚ C -&gt; B -&gt; A, æŸ¥æ‰¾é¡ºåºä¸º:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1694348789862_8851.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="bind-å‡½æ•°"><a class="markdownIt-Anchor" href="#bind-å‡½æ•°"></a> bind å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bind</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;<br>  context = [].<span class="hljs-property">shift</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);<br>  <span class="hljs-keyword">const</span> args = [].<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">apply</span>(context, [].<span class="hljs-property">concat</span>.<span class="hljs-title function_">call</span>(args, [].<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>)));<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="å¼•ç”¨åŸæ–‡"><a class="markdownIt-Anchor" href="#å¼•ç”¨åŸæ–‡"></a> å¼•ç”¨åŸæ–‡</h3><blockquote><p>å¦‚æœåœ¨ä¸€ä¸ªå¤§å‡½æ•°ä¸­æœ‰ä¸€äº›ä»£ç å—èƒ½å¤Ÿç‹¬ç«‹å‡ºæ¥ï¼Œæˆ‘ä»¬å¸¸å¸¸æŠŠè¿™äº›ä»£ç å—å°è£…åœ¨ç‹¬ç«‹çš„å°å‡½æ•°é‡Œé¢ã€‚ç‹¬ç«‹å‡ºæ¥çš„å°å‡½æ•°æœ‰åŠ©äºä»£ç å¤ç”¨ï¼Œå¦‚æœè¿™äº›å°å‡½æ•°æœ‰ä¸€ä¸ªè‰¯å¥½çš„å‘½åï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿèµ·åˆ°äº†æ³¨é‡Šçš„ä½œç”¨ã€‚å¦‚æœè¿™äº›å°å‡½æ•°ä¸éœ€è¦åœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œæœ€å¥½æ˜¯æŠŠå®ƒä»¬ç”¨é—­åŒ…å°é—­èµ·æ¥ã€‚</p></blockquote><p>ç¬”è€…å®Œå…¨è®¤åŒååŠå¥: <strong>å¦‚æœè¿™äº›å°å‡½æ•°ä¸éœ€è¦åœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹ä½¿ç”¨, æœ€å¥½æ˜¯æŠŠå®ƒä»¬ç”¨é—­åŒ…å°é—­èµ·æ¥</strong> ; å‰åŠå¥åœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸­å…¶å®æ‰€è°“çš„å¤ç”¨æ›´å¤šçš„åªæ˜¯å¯¹äºè‡ªèº«æ¥è¯´, å¯¹äºå…¶ä»–åŒäº‹å¤šåŠæ˜¯æ— å…³ç—›ç—’çš„, éœ€è¦é¿å… <strong>è¿‡æ¸¡å°è£…</strong>.</p><h3 id="aop"><a class="markdownIt-Anchor" href="#aop"></a> AOP</h3><p>AOP (é¢å‘åˆ‡é¢ç¼–ç¨‹)çš„ä¸»è¦ä½œç”¨æ˜¯æŠŠä¸€äº›è·Ÿæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ¨¡å—æ— å…³çš„åŠŸèƒ½æŠ½ç¦»å‡ºæ¥, è¿™äº›è·Ÿä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½é€šå¸¸åŒ…æ‹¬æ—¥å¿—ç»Ÿè®¡ã€å®‰å…¨æ§åˆ¶ã€å¼‚å¸¸å¤„ç†ç­‰.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">before</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">beforefn</span>) &#123;<br>  <span class="hljs-keyword">const</span> _self = <span class="hljs-variable language_">this</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    beforefn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>    <span class="hljs-keyword">return</span> _self.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>  &#125;;<br>&#125;;<br><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">after</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">afterfn</span>) &#123;<br>  <span class="hljs-keyword">const</span> _self = <span class="hljs-variable language_">this</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> ret = _self.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>    afterfn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>    <span class="hljs-keyword">return</span> ret;<br>  &#125;;<br>&#125;;<br><br><span class="hljs-keyword">let</span> func = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);<br>&#125;;<br><br>func = func<br>  .<span class="hljs-title function_">before</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);<br>  &#125;)<br>  .<span class="hljs-title function_">after</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);<br>  &#125;);<br><br><span class="hljs-title function_">func</span>();<br></code></pre></td></tr></table></figure><h3 id="currying-æŸ¯é‡ŒåŒ–"><a class="markdownIt-Anchor" href="#currying-æŸ¯é‡ŒåŒ–"></a> Currying æŸ¯é‡ŒåŒ–</h3><p><code>currying</code> åˆç§°ä¸ºéƒ¨åˆ†æ±‚å€¼, ä¸€ä¸ª<code>currying</code>çš„å‡½æ•°é¦–å…ˆä¼šæ¥å—ä¸€äº›å‚æ•°, æ¥å—äº†è¿™äº›å‚æ•°ä¹‹å, è¯¥å‡½æ•°å¹¶ä¸ä¼šç«‹å³æ±‚å€¼, è€Œæ˜¯ç»§ç»­è¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°, åˆšæ‰ä¼ å…¥çš„å‚æ•°åœ¨å‡½æ•°å½¢æˆçš„é—­åŒ…ä¸­è¢«ä¿å­˜èµ·æ¥. å¾…åˆ°å‡½æ•°è¢«çœŸæ­£éœ€è¦æ±‚å€¼çš„æ—¶å€™, ä¹‹å‰ä¼ å…¥çš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«ä¸€æ¬¡æ€§ç”¨äºæ±‚å€¼.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// æŠ½è±¡çš„æŸ¯é‡ŒåŒ–å‡½æ•°</span><br><span class="hljs-keyword">var</span> currying = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) &#123;<br><span class="hljs-keyword">var</span> args = [];<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>[].<span class="hljs-property">push</span>.<span class="hljs-title function_">apply</span>(args, <span class="hljs-variable language_">arguments</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">var</span> cost = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> money = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, l=<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>; i&lt;l; i++) &#123;<br>money +=<span class="hljs-variable language_">arguments</span>[i];<br>&#125;<br><span class="hljs-keyword">return</span> money;<br>&#125;<br>&#125;)();<br><br><span class="hljs-keyword">var</span> cost = <span class="hljs-title function_">currying</span>(cost);<br><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">100</span>);<br><span class="hljs-title function_">cost</span>(<span class="hljs-number">200</span>);<br><span class="hljs-title function_">cost</span>(<span class="hljs-number">300</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">cost</span>()); <span class="hljs-comment">// è®¡ç®—</span><br></code></pre></td></tr></table></figure><p><strong>arguments.callee</strong></p><blockquote><p>TheÂ <strong><code>arguments.callee</code></strong>Â data property contains the currently executing function that the arguments belong to.</p></blockquote><p>å¯¹äºä¸Šé¢çš„ä¾‹å­, <code>arguments.callee</code>å³æŸ¯é‡ŒåŒ–åçš„å‡½æ•° <strong>cost()</strong> , æ‰€ä»¥é—­åŒ…éƒ¨åˆ†äº¦å¯ä»¥å†™æˆ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">cost</span>(<span class="hljs-number">100</span>)(<span class="hljs-number">200</span>)(<span class="hljs-number">300</span>);<br></code></pre></td></tr></table></figure><h3 id="é¸­å­ç±»å‹"><a class="markdownIt-Anchor" href="#é¸­å­ç±»å‹"></a> é¸­å­ç±»å‹</h3><p>é¸­å­ç±»å‹æ€æƒ³å³åªè¦ä¸€åªåŠ¨ç‰©é•¿å¾—åƒé¸­å­, å£°éŸ³åƒé¸­å­, é‚£å®ƒå°±æ˜¯ ğŸ¦†. ç±»æ¯”åˆ° JavaScript ä¸­, å½“æˆ‘ä»¬è°ƒç”¨å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ—¶, ä¸ç”¨å…³å¿ƒè¯¥å¯¹è±¡åŸæœ¬æ˜¯å¦è¢«è®¾è®¡æˆæ‹¥æœ‰è¿™ä¸ªæ–¹æ³•, è¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§.<br />JavaScript ä¸­çš„ <strong>call()</strong>ã€ <strong>apply()</strong> éƒ½å¯ä»¥æ»¡è¶³è¿™æ ·çš„éœ€æ±‚.</p><h3 id="uncurrying"><a class="markdownIt-Anchor" href="#uncurrying"></a> uncurrying</h3><p>ä»¥ Array æ–¹æ³•ä¸ºä¾‹, é€šè¿‡<code>uncurrying</code>çš„æ–¹å¼, <code>Array.prototype.push</code>å˜æˆé€šç”¨çš„<strong>push</strong>å‡½æ•°.<br /><code>uncurrying</code>çš„ä¸¤ç§å®ç°:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1.</span><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">uncurrying</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">shift</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);<br><span class="hljs-keyword">return</span> self.<span class="hljs-title function_">apply</span>(obj, <span class="hljs-variable language_">arguments</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// 2.</span><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">uncurrying</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> self = thisl<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">call</span>.<span class="hljs-title function_">apply</span>(self, <span class="hljs-variable language_">arguments</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒç§ä¸å¤ªå¥½ç†è§£ä¸€ç‚¹, ä»¥ <strong>push(obj, 1)</strong> å‡½æ•°ä¸ºä¾‹, 2.æœ€åå¯ä»¥ç†è§£æˆ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">call</span>.<span class="hljs-title function_">apply</span>(push, [obj, <span class="hljs-number">1</span>]);<br><span class="hljs-comment">// å³</span><br>push.<span class="hljs-title function_">call</span>(obj, <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><h3 id="æƒ°æ€§åŠ è½½å‡½æ•°"><a class="markdownIt-Anchor" href="#æƒ°æ€§åŠ è½½å‡½æ•°"></a> æƒ°æ€§åŠ è½½å‡½æ•°</h3><p>ç”¨å›¾è¡¨ç”»å‡ºæ¥æ›´ç›´è§‚ä¸€ç‚¹â€¦<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1694368984825_2012.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h1 id="ç¬¬äºŒéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#ç¬¬äºŒéƒ¨åˆ†"></a> ç¬¬äºŒéƒ¨åˆ†</h1><p><strong>è®¾è®¡æ¨¡å¼</strong></p>]]></content>
    
    
    <categories>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>standard-versionæºç åˆ†æ</title>
    <link href="/2023/05/08/2023-05-08-standard-version-source-code-analysis/"/>
    <url>/2023/05/08/2023-05-08-standard-version-source-code-analysis/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>æœ€è¿‘åˆè¦æä¸ªç³»ç»Ÿå¹³å°, åç»­å¤§å°è¿­ä»£é€šè¿‡ç‰ˆæœ¬å·æ ‡è¯†, å¾ˆè‡ªç„¶åœ°æƒ³åˆ°<strong><a href="http://CHANGELOG.md">CHANGELOG.md</a></strong>, è°ƒç ”åå‘ç°</p><h1 id="ä½¿ç”¨æ•™ç¨‹"><a class="markdownIt-Anchor" href="#ä½¿ç”¨æ•™ç¨‹"></a> ä½¿ç”¨æ•™ç¨‹</h1><p>å®Œæ•´çš„é…ç½®å‚è€ƒ<a href="https://segmentfault.com/a/1190000039813329">è‡ªåŠ¨äº§å‡º changelog-ç¬¬äºŒèŠ‚ï¼šè‡ªåŠ¨äº§å‡º</a></p><p>ç®€å•è¯´ä¸‹åœ¨è‡ªå·±é¡¹ç›®ä¸­ç”¨åˆ°çš„é…ç½®:</p><h2 id="versionrc"><a class="markdownIt-Anchor" href="#versionrc"></a> .versionrc</h2><p>é…ç½® CHANGELOG çš„å±•ç¤º format</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;header&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;# æ›´æ–°å†å² \n\n&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;feat&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;âœ¨ Features | æ–°åŠŸèƒ½&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;fix&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ› Bug Fixes | Bug ä¿®å¤&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;perf&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;âš¡ Performance Improvements | æ€§èƒ½ä¼˜åŒ–&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;revert&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;âª Reverts | å›é€€&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chore&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ“¦ Chores | å…¶ä»–æ›´æ–°&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docs&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ“ Documentation | æ–‡æ¡£&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;style&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ’„ Styles | é£æ ¼&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refactor&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;â™» Code Refactoring | ä»£ç é‡æ„&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;âœ… Tests | æµ‹è¯•&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;build&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ‘·â€ Build System | æ„å»º&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ci&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;section&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ğŸ”§ Continuous Integration | CI é…ç½®&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span>```<br><br>## package.json<br>é…ç½®skip<span class="hljs-punctuation">,</span> bump<span class="hljs-punctuation">:</span> å‡çº§ç‰ˆæœ¬å·<span class="hljs-punctuation">,</span> commit<span class="hljs-punctuation">:</span> æäº¤ä»£ç <span class="hljs-punctuation">,</span> tag<span class="hljs-punctuation">:</span> æ‰“tag<br>```json<br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;standard-version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;skip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;bump&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;commit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="å‘½ä»¤"><a class="markdownIt-Anchor" href="#å‘½ä»¤"></a> å‘½ä»¤</h2><p>æŒ‡å®š<code>--release-as</code>ä¸º patch, æ¯æ¬¡å‡çº§é€’å¢å°ç‰ˆæœ¬å·(1.2.3 ä¾æ¬¡ä¸ºå¤§ä¸­å°ç‰ˆæœ¬å·); <code>--tag-prefix</code>ä¸º wework-bot@ æŒ‡å®š tag çš„å‰ç¼€, ä¸åŠ å‰ç¼€é»˜è®¤ä¸º v, å› ä¸ºè¯¥é¡¹ç›®ä¼šæ‰“åŒ…ä¸º docker é•œåƒ, tag ä¼šä½œä¸ºé•œåƒç‰ˆæœ¬, æ‰€ä»¥è¿™é‡Œéœ€è¦åŠ ä¸Šå‰ç¼€, ä¸€èˆ¬æƒ…å†µä¸éœ€è¦åŠ .</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">standard-version <span class="hljs-params">--release-as</span> <span class="hljs-keyword">patch</span> <span class="hljs-params">--tag-prefix</span> wework-bot@<br></code></pre></td></tr></table></figure><h2 id="è¾“å‡ºå†…å®¹"><a class="markdownIt-Anchor" href="#è¾“å‡ºå†…å®¹"></a> è¾“å‡ºå†…å®¹</h2><p>æŒ‰ç…§ä»¥ä¸Šé…ç½®æ‰§è¡Œå‘½ä»¤åæ ¹æ®ç»ˆç«¯è¾“å‡ºå¯ä»¥å‘ç°å‘ç”Ÿäº†ä»¥ä¸‹è¡Œä¸º:</p><ol><li>å‡çº§ package.json ç‰ˆæœ¬å·(å¦‚æœæ²¡æœ‰æŒ‡å®š<code>--first-release</code>ç¬¬ä¸€æ¬¡æ‰§è¡Œ)</li><li>ç”Ÿæˆ <a href="http://CHANGELOG.md">CHANGELOG.md</a>(å¦‚æœæ²¡æœ‰), åœ¨å¼€å¤´åŠ ä¸Šè·ç¦»ä¸Šä¸ª tag ä¹‹åçš„æ‰€æœ‰æäº¤è®°å½•(ç¬¦åˆæäº¤è§„èŒƒçš„æäº¤ä¿¡æ¯)</li><li>æäº¤æœ¬åœ°ä¸Šé¢æ¶‰åŠåˆ°çš„æ‰€æœ‰æ”¹åŠ¨æ–‡ä»¶åˆ°è¿œç«¯</li><li>æ‰“ tag å¹¶æäº¤è¿œç«¯</li></ol><h1 id="æºç åˆ†æ"><a class="markdownIt-Anchor" href="#æºç åˆ†æ"></a> æºç åˆ†æ</h1><p>æ˜ç¡®äº†ä¸Šè¿°çš„é…ç½®ä»¥åŠå‘½ä»¤è¾“å‡ºå†…å®¹, å°±å¯ä»¥åˆ°æºç ä¸­æŸ¥çœ‹å…·ä½“å®ç°äº†, æˆ‘çš„å»ºè®®æ˜¯æœ‰ç›®çš„æ€§çš„å»çœ‹æºç , å› ä¸º<strong>standard-version</strong>è¿™ä¸ªå·¥å…·ä¸­å¾ˆå¤šçš„åŠŸèƒ½ä¾‹å¦‚é¡¹ç›®ä¸­å®é™…ä¸Šæ ¹æœ¬æ²¡ç”¨åˆ°, ä¹Ÿå°±æ²¡æœ‰ç«‹åˆ»ç†è§£çš„å¿…è¦, çœ‹æºç çš„æ—¶å€™ç›´æ¥è·³è¿‡å°±å¥½.</p><p>é¦–å…ˆåœ¨ package.json ä¸­æŸ¥çœ‹å…¥å£æ–‡ä»¶é€»è¾‘: <strong>bin/cli.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> standardVersion = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../index&quot;</span>);<br><span class="hljs-keyword">const</span> cmdParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../command&quot;</span>);<br><span class="hljs-title function_">standardVersion</span>(cmdParser.<span class="hljs-property">argv</span>);<br></code></pre></td></tr></table></figure><p><strong>./command.js</strong></p><p>yargs æŒ‡å®šçš„ä¸€ç³»åˆ—å‚æ•°, ä¼šç»“åˆ<a href="https://github.com/conventional-changelog/conventional-changelog-config-spec/blob/master/versions/2.2.0/README.md#conventional-changelog-configuration-spec-v210">conventional-changelog-config-spec</a>é¢„ç½®çš„å‚æ•°åŒæ„ä½œä¸º<strong>standard-version</strong>çš„å¯é€‰å‚æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> spec = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;conventional-changelog-config-spec&quot;</span>);<br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>)<br>  .<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;release-as&quot;</span>, &#123;<br>    <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;r&quot;</span>,<br>    <span class="hljs-attr">describe</span>:<br>      <span class="hljs-string">&quot;Specify the release type manually (like npm version &lt;major|minor|patch&gt;)&quot;</span>,<br>    <span class="hljs-attr">requiresArg</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">string</span>: <span class="hljs-literal">true</span>,<br>  &#125;)<br>  <span class="hljs-comment">//...</span><br>  .<span class="hljs-title function_">config</span>(<span class="hljs-title function_">getConfiguration</span>())<br>  .<span class="hljs-title function_">pkgConf</span>(<span class="hljs-string">&quot;standard-version&quot;</span>);<br><span class="hljs-comment">//...</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(spec.<span class="hljs-property">properties</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">propertyKey</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> property = spec.<span class="hljs-property">properties</span>[propertyKey];<br>  yargs.<span class="hljs-title function_">option</span>(propertyKey, &#123;<br>    <span class="hljs-comment">//...</span><br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p><code>--release-as</code>, <code>--tag-prefix</code>ç­‰å‚æ•°å°±æ˜¯è¿™é‡Œæ³¨å†Œçš„.<br />yargs.config(getConfiguration())æ³¨å…¥äº† <strong>./lib/configuration.js</strong> çš„é…ç½®, æ–‡ä»¶ä¸­æŒ‡å®šäº†é»˜è®¤çš„é…ç½®æ–‡ä»¶å, è¡¨æ˜ yargs åˆå§‹åŒ–æ—¶ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾è¿™äº›æ–‡ä»¶, æ³¨å†Œç»™ yargs.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIGURATION_FILES</span> = [<br>  <span class="hljs-string">&quot;.versionrc&quot;</span>,<br>  <span class="hljs-string">&quot;.versionrc.cjs&quot;</span>,<br>  <span class="hljs-string">&quot;.versionrc.json&quot;</span>,<br>  <span class="hljs-string">&quot;.versionrc.js&quot;</span>,<br>];<br></code></pre></td></tr></table></figure><p><strong>.config()</strong></p><blockquote><p>Tells the parser that if the option specified byÂ <code>key</code>Â is passed in, it should be interpreted as a path to a JSON config file. The file is loaded and parsed, and its properties are set as arguments. Because the file is loaded using Nodeâ€™s require(), the filename MUST end inÂ <code>.json</code>Â to be interpreted correctly.</p></blockquote><p>æ ¹æ® yargs å®˜ç½‘å¯¹<strong>config(object)</strong> api çš„æè¿°, å‚æ•°æ˜¯ json å¯¹è±¡, ä¸”å¯¹è±¡ key éƒ½ä¼šä½œä¸º yargs çš„ key; ä¸Šè¿° <strong>.versionrc</strong> ä¸­é…ç½®çš„<strong>header</strong>, <strong>type</strong> ç­‰éƒ½å¯ä»¥é€šè¿‡ <code>yargs.header</code>, <code>yargs.type</code> è·å–.</p><p>åŒæ—¶ yargs.pkgConf(â€˜standard-versionâ€™)ä½œç”¨å’Œ.config()ç±»ä¼¼ä¼šåœ¨<strong>package.json</strong>ä¸­æŸ¥è¯¢é”®åä¸º standard-version çš„é…ç½®, ä¸Šè¿°<strong>package,json</strong>ä¸­é…ç½®çš„ skip ä¹Ÿå¯ä»¥é€šè¿‡<code>yargs.skip.bump</code>, <code>yargs.skip.commit</code>, <code>yargs.skip.tag</code>è·å–.</p><p><strong>.pkg(key, [cwd])</strong></p><blockquote><p>Similar toÂ <a href="https://github.com/yargs/yargs/blob/main/docs/api.md#config"><code>config()</code></a>, indicates that yargs should interpret the object from the specified key in package.json as a configuration object.<br /><code>cwd</code>Â can optionally be provided, the package.json will be read from this location.</p></blockquote><p><strong>./index.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">standardVersion</span>(<span class="hljs-params">argv</span>) &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">// 1. step1</span><br>  <span class="hljs-keyword">const</span> args = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, defaults, argv);<br>  <span class="hljs-keyword">let</span> pkg;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> packageFile <span class="hljs-keyword">of</span> args.<span class="hljs-property">packageFiles</span>) &#123;<br>    <span class="hljs-keyword">const</span> updater = <span class="hljs-title function_">resolveUpdaterObjectFromArgument</span>(packageFile);<br>    <span class="hljs-keyword">if</span> (!updater) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">const</span> pkgPath = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), updater.<span class="hljs-property">filename</span>);<br>    <span class="hljs-keyword">const</span> contents = fs.<span class="hljs-title function_">readFileSync</span>(pkgPath, <span class="hljs-string">&quot;utf8&quot;</span>);<br>    pkg = &#123;<br>      <span class="hljs-attr">version</span>: updater.<span class="hljs-property">updater</span>.<span class="hljs-title function_">readVersion</span>(contents),<br>      <span class="hljs-attr">private</span>:<br>        <span class="hljs-keyword">typeof</span> updater.<span class="hljs-property">updater</span>.<span class="hljs-property">isPrivate</span> === <span class="hljs-string">&quot;function&quot;</span><br>          ? updater.<span class="hljs-property">updater</span>.<span class="hljs-title function_">isPrivate</span>(contents)<br>          : <span class="hljs-literal">false</span>,<br>    &#125;;<br>    <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-comment">// 2. step2</span><br>  <span class="hljs-keyword">let</span> version;<br>  <span class="hljs-keyword">if</span> (pkg) &#123;<br>    version = pkg.<span class="hljs-property">version</span>;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args.<span class="hljs-property">gitTagFallback</span>) &#123;<br>    version = <span class="hljs-keyword">await</span> <span class="hljs-title function_">latestSemverTag</span>(args.<span class="hljs-property">tagPrefix</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;no package file found&quot;</span>);<br>  &#125;<br>  <span class="hljs-comment">// æ ¸å¿ƒé€»è¾‘</span><br>  <span class="hljs-keyword">const</span> newVersion = <span class="hljs-keyword">await</span> <span class="hljs-title function_">bump</span>(args, version);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">changelog</span>(args, newVersion);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">commit</span>(args, newVersion);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">tag</span>(newVersion, pkg ? pkg.<span class="hljs-property">private</span> : <span class="hljs-literal">false</span>, args);<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿è¡Œå‘½ä»¤æ—¶é™„å¸¦çš„å‚æ•°ä»¥åŠ <strong>.config()</strong>. <strong>.pkgConf()</strong> é…ç½®çš„å‚æ•°éƒ½ä¼šä½œä¸ºå‡½æ•°çš„å‚æ•°.<br /><strong>./index.js</strong> å‡½æ•°é™¤å»ä¸€äº›æ ¡éªŒé€»è¾‘, ä¸»è¦åšäº†ä¸¤ä»¶äº‹:</p><ol><li><p>ç»“åˆ argv å’Œé»˜è®¤é…ç½®(ä½äº <strong>./default.js</strong>), ç„¶åæ£€ç´¢é»˜è®¤é…ç½®çš„<strong>packageFiles</strong>, è¿™é‡Œä¸»è¦å°±æ˜¯è·å–<strong>package.json</strong>ä¸­çš„ version ä½œä¸ºå½“å‰ç‰ˆæœ¬å·. å¯ä»¥çœ‹åˆ°éå†ä¸­å­˜åœ¨ break, æ‰¾åˆ°æ–‡ä»¶å°±ä¸ä¼šç»§ç»­æŸ¥è¯¢äº†.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">defaults.<span class="hljs-property">packageFiles</span> = [<span class="hljs-string">&quot;package.json&quot;</span>, <span class="hljs-string">&quot;bower.json&quot;</span>, <span class="hljs-string">&quot;manifest.json&quot;</span>];<br></code></pre></td></tr></table></figure></li><li><p>æ ¸å¿ƒé€»è¾‘</p></li></ol><h2 id="æ ¸å¿ƒé€»è¾‘"><a class="markdownIt-Anchor" href="#æ ¸å¿ƒé€»è¾‘"></a> æ ¸å¿ƒé€»è¾‘</h2><h3 id="21-æ›´æ–°ç‰ˆæœ¬å·"><a class="markdownIt-Anchor" href="#21-æ›´æ–°ç‰ˆæœ¬å·"></a> 2.1 æ›´æ–°ç‰ˆæœ¬å·</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> newVersion = <span class="hljs-keyword">await</span> <span class="hljs-title function_">bump</span>(args, version);<br></code></pre></td></tr></table></figure><p><strong>./lifecycles/bump.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (!args.<span class="hljs-property">firstRelease</span>) &#123;<br>  <span class="hljs-keyword">const</span> releaseType = <span class="hljs-title function_">getReleaseType</span>(<br>    args.<span class="hljs-property">prerelease</span>,<br>    release.<span class="hljs-property">releaseType</span>,<br>    version<br>  );<br>  newVersion =<br>    semver.<span class="hljs-title function_">valid</span>(releaseType) ||<br>    semver.<span class="hljs-title function_">inc</span>(version, releaseType, args.<span class="hljs-property">prerelease</span>);<br>  <span class="hljs-title function_">updateConfigs</span>(args, newVersion);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€å…³é”®çš„å°±ä¸Šé¢è¿™æ®µé€»è¾‘, å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‘å¸ƒ(<code>--first-release</code>), å°±ä¸æ›´æ–°ç‰ˆæœ¬å·, å¦åˆ™æ ¹æ®<code>--release-as</code>æ›´æ–°, è¿™é‡Œç”¨åˆ°äº†<strong>semver</strong>ç¬¬ä¸‰æ–¹åº“, å¯ä»¥åˆ¤æ–­<code>--release-as</code>æ˜¯å¦åˆæ³•(<strong>.valid()</strong>), æ ¹æ®<code>--release-as</code>è‡ªåŠ¨åˆ¤æ–­ç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·(<strong>.inc()</strong>), å®Œæ•´ä½¿ç”¨å‚è€ƒ<a href="https://www.npmjs.com/package/semver">npm semver</a>. æœ€åè¿”å›æ–°çš„ç‰ˆæœ¬å·.</p><h3 id="22-ç”Ÿæˆ-changelog"><a class="markdownIt-Anchor" href="#22-ç”Ÿæˆ-changelog"></a> 2.2 ç”Ÿæˆ CHANGELOG</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">changelog</span>(args, newVersion);<br></code></pre></td></tr></table></figure><p><strong>./lifecycles/changelog.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">START_OF_LAST_RELEASE_PATTERN</span> = <span class="hljs-regexp">/(^#+ \[?[0-9]+\.[0-9]+\.[0-9]+|&lt;a name=)/m</span><br><br><span class="hljs-title function_">createIfMissing</span>(args)<br>    <span class="hljs-keyword">const</span> header = args.<span class="hljs-property">header</span><br><br>    <span class="hljs-keyword">let</span> oldContent = args.<span class="hljs-property">dryRun</span> ? <span class="hljs-string">&#x27;&#x27;</span> : fs.<span class="hljs-title function_">readFileSync</span>(args.<span class="hljs-property">infile</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">const</span> oldContentStart = oldContent.<span class="hljs-title function_">search</span>(<span class="hljs-variable constant_">START_OF_LAST_RELEASE_PATTERN</span>)<br>    <span class="hljs-keyword">if</span> (oldContentStart !== -<span class="hljs-number">1</span>) &#123;<br>      oldContent = oldContent.<span class="hljs-title function_">substring</span>(oldContentStart)<br>    &#125;<br>    <span class="hljs-keyword">let</span> content = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">const</span> context = &#123; <span class="hljs-attr">version</span>: newVersion &#125;<br>    <span class="hljs-keyword">const</span> changelogStream = <span class="hljs-title function_">conventionalChangelog</span>(&#123;<br>      <span class="hljs-attr">debug</span>: args.<span class="hljs-property">verbose</span> &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-property">info</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>, <span class="hljs-string">&#x27;conventional-changelog&#x27;</span>),<br>      <span class="hljs-attr">preset</span>: <span class="hljs-title function_">presetLoader</span>(args),<br>      <span class="hljs-attr">tagPrefix</span>: args.<span class="hljs-property">tagPrefix</span><br>    &#125;, context, &#123; <span class="hljs-attr">merges</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">path</span>: args.<span class="hljs-property">path</span> &#125;)<br>      .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err)<br>      &#125;)<br><br>    changelogStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">buffer</span>) &#123;<br>      content += buffer.<span class="hljs-title function_">toString</span>()<br>    &#125;)<br><br>    changelogStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">checkpoint</span>(args, <span class="hljs-string">&#x27;outputting changes to %s&#x27;</span>, [args.<span class="hljs-property">infile</span>])<br>      <span class="hljs-title function_">writeFile</span>(args, args.<span class="hljs-property">infile</span>, header + <span class="hljs-string">&#x27;\n&#x27;</span> + (content + oldContent).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n+$/</span>, <span class="hljs-string">&#x27;\n&#x27;</span>))<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>()<br>    &#125;)<br>  &#125;)<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å…³é”®é€»è¾‘, å¦‚æœ<strong><a href="http://CHANGELOG.md">CHANGELOG.md</a></strong>ä¸å­˜åœ¨åˆ™åˆ›å»º, è¯»å–<strong><a href="http://CHANGELOG.md">CHANGELOG.md</a></strong>, æ ¹æ®<strong>START_OF_LAST_RELEASE_PATTERN</strong>æ­£åˆ™åŒ¹é… log å†…å®¹çš„å¼€å¤´çš„<code>### [x.x.x]</code>, ä»è€Œè·å–æ—§çš„å†å²æäº¤å†…å®¹; ç„¶åä½¿ç”¨<strong>conventional-changelog</strong>ç¬¬ä¸‰æ–¹åº“è·å–ä¸Šä¸€æ¬¡ tag ä¹‹åçš„æ‰€æœ‰æäº¤, å¹¶æŒ‰ç…§ <strong>.versionrc</strong> ä¸­é…ç½®çš„ type åˆ†ç±»è¿”å›æ–°çš„ CHANGELOG å†…å®¹, è¿™ä¸ªåº“æä¾›çš„å‡½æ•°è¿”å› stream, éœ€è¦ç›‘å¬æ•°æ®æµäº‹ä»¶, å‚è€ƒ<a href="https://www.npmjs.com/package/conventional-changelog">npm conventional-changelog</a>. åœ¨<code>end</code>äº‹ä»¶å›è°ƒä¸­å°† yargs.header, æ–°å†…å®¹, æ­£åˆ™åŒ¹é…åˆ°çš„å°±å†…å®¹æ‹¼æ¥é‡æ–°å†™å…¥<strong><a href="http://CHANGELOG.md">CHANGELOG.md</a></strong><br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1683808772259_563.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /><br />å›¾: <a href="http://CHANGELOG.md">CHANGELOG.md</a> çš„å†…å®¹æ ¼å¼</p><h3 id="23-æäº¤ä»£ç "><a class="markdownIt-Anchor" href="#23-æäº¤ä»£ç "></a> 2.3 æäº¤ä»£ç </h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">commit</span>(args, newVersion);<br></code></pre></td></tr></table></figure><p><strong>./commit</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (!args.<span class="hljs-property">skip</span>.<span class="hljs-property">changelog</span>) &#123;<br>  toAdd.<span class="hljs-title function_">push</span>(args.<span class="hljs-property">infile</span>);<br>&#125;<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(bump.<span class="hljs-title function_">getUpdatedConfigs</span>()).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) &#123;<br>  toAdd.<span class="hljs-title function_">push</span>(path.<span class="hljs-title function_">relative</span>(process.<span class="hljs-title function_">cwd</span>(), p));<br>&#125;);<br><span class="hljs-keyword">await</span> <span class="hljs-title function_">runExecFile</span>(args, <span class="hljs-string">&quot;git&quot;</span>, [<span class="hljs-string">&quot;add&quot;</span>].<span class="hljs-title function_">concat</span>(toAdd));<br><span class="hljs-keyword">await</span> <span class="hljs-title function_">runExecFile</span>(<br>  args,<br>  <span class="hljs-string">&quot;git&quot;</span>,<br>  [<span class="hljs-string">&quot;commit&quot;</span>].<span class="hljs-title function_">concat</span>(verify, sign, args.<span class="hljs-property">commitAll</span> ? [] : toAdd, [<br>    <span class="hljs-string">&quot;-m&quot;</span>,<br>    <span class="hljs-string">`<span class="hljs-subst">$&#123;formatCommitMessage(args.releaseCommitMessageFormat, newVersion)&#125;</span>`</span>,<br>  ])<br>);<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å…³é”®é€»è¾‘, å…ˆè·å–ä¸Šé¢ä¸¤æ­¥ä¿®æ”¹çš„<strong>package.json</strong>(<code>bump.getUploadedConfigs()</code>), <strong><a href="http://CHANGELOG.md">CHANGELOG.md</a>*</strong>(<code>args.infile</code>), ç„¶åå°±æ˜¯æ‰§è¡Œ<strong>git add</strong>å’Œ<strong>git commit -m --no-verify</strong>åŸºæœ¬æ“ä½œ.<br />å½“æ—¶æ¯”è¾ƒå›°æƒ‘çš„æ˜¯ formatCommitMessage å“ªæ¥çš„, ä½ ä¼šå‘ç°æŸ¥æ‰¾æºç å¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå‡½æ•°åˆ›å»ºçš„åœ°æ–¹, è¿™å°±è¦å›åˆ°ä¹‹å‰è¯´çš„ <strong>./command.js</strong>æœ€åå°†<strong>conventional-changelog-config-spec</strong>é¢„ç½®çš„å±æ€§åˆå¹¶åˆ° args,<br />å®˜æ–¹ api ä¸­å°±èƒ½æ‰¾åˆ°è¿™ä¸ªå±æ€§</p><h4 id="releasecommitmessageformat-string"><a class="markdownIt-Anchor" href="#releasecommitmessageformat-string"></a> releaseCommitMessageFormat (<code>string</code>)</h4><blockquote><p>A string to be used to format the auto-generated release commit message.</p></blockquote><p>é»˜è®¤å€¼å°±æ˜¯:</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">chore(release): </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">currentTag</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><strong>./lib/format-commit-message.js</strong>ä¸­ä¼šå°†<code>&#123;&#123;currentTag&#125;&#125;</code>æ›¿æ¢ä¸ºæ–°çš„ç‰ˆæœ¬å·</p><p>åœ¨ git log ä¸­ä¹Ÿèƒ½å¤Ÿçœ‹åˆ°è¿™æ¡ commit message:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1683877044866_1759.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="æ ‡è®°-tag"><a class="markdownIt-Anchor" href="#æ ‡è®°-tag"></a> æ ‡è®° tag</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">tag</span>(newVersion, pkg ? pkg.<span class="hljs-property">private</span> : <span class="hljs-literal">false</span>, args);<br></code></pre></td></tr></table></figure><p><strong>./lib/lifecycles/tag.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">runExecFile</span>(args, <span class="hljs-string">&quot;git&quot;</span>, [<br>  <span class="hljs-string">&quot;tag&quot;</span>,<br>  tagOption,<br>  args.<span class="hljs-property">tagPrefix</span> + newVersion,<br>  <span class="hljs-string">&quot;-m&quot;</span>,<br>  <span class="hljs-string">`<span class="hljs-subst">$&#123;formatCommitMessage(args.releaseCommitMessageFormat, newVersion)&#125;</span>`</span>,<br>]);<br><span class="hljs-keyword">const</span> currentBranch = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runExecFile</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;git&quot;</span>, [<br>  <span class="hljs-string">&quot;rev-parse&quot;</span>,<br>  <span class="hljs-string">&quot;--abbrev-ref&quot;</span>,<br>  <span class="hljs-string">&quot;HEAD&quot;</span>,<br>]);<br><span class="hljs-keyword">let</span> message = <span class="hljs-string">&quot;git push --follow-tags origin &quot;</span> + currentBranch.<span class="hljs-title function_">trim</span>();<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å…³é”®é€»è¾‘, å¯ä»¥çœ‹åˆ°<code>--tag-prefix</code>é…ç½®æ­¤æ—¶å°±ä¼šä½œä¸º<strong>git tag</strong>çš„å‰ç¼€, ç„¶å<strong>git push --follow-tags origin branch</strong>æäº¤è¿œç«¯.<br />è¿™é‡Œä¹Ÿæ”¶è·ä¸€ä¸ªå° tips: <strong>git rev-parse --abbrev-ref HEAD</strong> è·å–å½“å‰åˆ†æ”¯å</p><h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1><p><strong>standard-version</strong> æºç æ€»ä½“ä¸å¤æ‚, ä½†æ˜¯è¿˜æ˜¯èƒ½å­¦ä¹ åˆ°<strong>yargs</strong>, <strong>semver</strong>, <strong>conventional-changelog</strong>åº“çš„ä½¿ç”¨ä»¥åŠå·¥ç¨‹åŒ–çš„æ“ä½œ, ğŸ® çš„ä¸è¡Œ.</p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://segmentfault.com/a/1190000039813329">è‡ªåŠ¨äº§å‡º changelog-ç¬¬äºŒèŠ‚ï¼šè‡ªåŠ¨äº§å‡º</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog-config-spec/blob/master/versions/2.2.0/README.md#releasecommitmessageformat-string">Conventional Changelog Configuration Spec (v2.1.0)</a></li><li><a href="https://github.com/yargs/yargs/blob/main/docs/api.md">yargs api</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥ç¨‹åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç åˆ†æ</tag>
      
      <tag>standard-version</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nestjså¼€å‘åŠæµæ°´çº¿ç›¸å…³é—®é¢˜è®°å½•</title>
    <link href="/2023/04/20/2023-04-20-server-via-nestjs-summary/"/>
    <url>/2023/04/20/2023-04-20-server-via-nestjs-summary/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>å‰æ®µæ—¶é—´è´Ÿè´£å°†ç»„å†…é¡¹ç›®æ¥å…¥è‡ªåŠ¨åŒ–æµæ°´çº¿, ç£•ç£•ç»Šç»Šæœ€åä¹Ÿç®—æŠŠå…¨æµç¨‹èµ°é€šå¹¶ä¸”åœ¨çº¿ä¸Šç¨³å®šè¿è¡Œäº†, æŠŠè¿‡ç¨‹ä¸­é‡åˆ°åˆ°çš„é—®é¢˜å’ŒçŸ¥è¯†ç‚¹ä½œç”¨åšä¸ªè®°å½•æ€»ç»“.</p><h1 id="nestjs"><a class="markdownIt-Anchor" href="#nestjs"></a> nestjs</h1><p>è¿™é‡Œä¸ä¼šä»‹ç» controller, provider æ˜¯å•¥, åº”è¯¥æ€ä¹ˆä½¿ç”¨, è¿™äº›ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£å°±èƒ½ç†è§£äº†, åªä¼šè®°å½•ä½¿ç”¨ nestjs ä¸­çš„é—®é¢˜çš„è§£å†³è¿‡ç¨‹, å®˜æ–¹æ–‡æ¡£æ¨¡æ£±ä¸¤å¯çš„æè¿°ä»¥åŠåº•å±‚åŸç†çš„æ€è€ƒ.</p><h2 id="1-eslint-wrong-error-is-defined-but-never-used"><a class="markdownIt-Anchor" href="#1-eslint-wrong-error-is-defined-but-never-used"></a> 1. eslint wrong error â€œis defined but never usedâ€</h2><p>åˆå§‹åŒ–é¡¹ç›®æ—¶é‡åˆ° import æ‰€æœ‰è£…é¥°å™¨ä¾‹å¦‚<code>@Injectable()</code>, <code>@Get()</code>, å¹¶ä¸”åœ¨å¯¹åº”æ–‡ä»¶ä¸­ä½¿ç”¨äº†, eslint è¿˜æ˜¯ä¼šæç¤º**â€œis defined but never usedâ€**.<br />éœ€è¦æŠŠ<code>@typescript-eslint/*</code>åŒ…å‡çº§åˆ° 5.35.1 ä»¥ä¸Š</p><h2 id="2-åŠæ—¶æ›´æ–°nestjscli-è„šæ‰‹æ¶"><a class="markdownIt-Anchor" href="#2-åŠæ—¶æ›´æ–°nestjscli-è„šæ‰‹æ¶"></a> 2. åŠæ—¶æ›´æ–°@nestjs/cli è„šæ‰‹æ¶</h2><p>ä½¿ç”¨è„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®æ—¶, å½“å¼•å…¥ç¬¬ä¸‰æ–¹ Module æ—¶å‡ºç°äº†å„ç§å„æ ·çš„é—®é¢˜, æœ€åå‘ç°è„šæ‰‹æ¶<code>@nestjs/cli</code>ä¹‹å‰å®‰è£…çš„ç‰ˆæœ¬æ˜¯ v7, è€Œç°åœ¨æœ€æ–°å¤§ç‰ˆæœ¬å·²ç»è¿­ä»£åˆ° v9 äº†, å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ç‰ˆæœ¬éƒ½å·²ç»ä¸å…¼å®¹æ—§çš„è„šæ‰‹æ¶æ–°å»ºçš„é¡¹ç›®, å‡çº§åˆ° v9 åé‡æ–°åˆå§‹åŒ–é¡¹ç›®ç¬¬ä¸‰æ–¹ Module å¼•å…¥é—®é¢˜æ¶ˆå¤±.</p><h2 id="3-cachemodule"><a class="markdownIt-Anchor" href="#3-cachemodule"></a> 3. CacheModule</h2><p>è¿™é‡Œé¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ redis, ä»¥æ­¤ä¸ºä¾‹:<br />åœ¨ä¸åŒæ¨¡å—ä¸­å¼•å…¥ CacheModule çš„æ–¹å¼:</p><ol><li>app.module.ts ä¸­è®¾ç½®<code>isGlobal: true</code></li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-title class_">CacheModule</span>.<span class="hljs-property">register</span>&lt;<span class="hljs-title class_">RedisClientOptions</span>&gt;(&#123;<br>  <span class="hljs-attr">isGlobal</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">store</span>: redisStore,<br>  ...config.<span class="hljs-property">redis</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="2"><li>åœ¨æ¯ä¸ª module ä¸­å•ç‹¬å¼•å…¥, å‚æ•°éƒ½è¦å¸¦ä¸Š, å¦åˆ™ä¼šä½¿ç”¨é»˜è®¤çš„å†…å­˜ç¼“å­˜.</li></ol><h2 id="4-forroutes"><a class="markdownIt-Anchor" href="#4-forroutes"></a> 4. forRoutes</h2><p>æŒ‡å®šä¸­é—´ä»¶ä½œç”¨è·¯ç”±æ—¶, ä¸éœ€è¦åŠ ä¸Šè®¾ç½®çš„ prefixPath, å¦‚æœæƒ³ä½œç”¨è·¯ç”±ä¸‹æ‰€æœ‰æ¥å£ä½¿ç”¨<code>/*</code></p><h1 id="linux"><a class="markdownIt-Anchor" href="#linux"></a> linux</h1><p>æµæ°´çº¿ä¸­éš¾å…ä¼šæœ‰é¢‘ç¹çš„ linux æ“ä½œ, è®°å½•ç”¨åˆ°çš„å‘½ä»¤</p><h2 id="rsync"><a class="markdownIt-Anchor" href="#rsync"></a> rsync</h2><p>åŒæ­¥æ–‡ä»¶, å’Œ<code>cp</code>ç±»ä¼¼, ä½†æ˜¯å¯ä»¥é€šè¿‡å‚æ•°è¿‡æ»¤ä¸å¤åˆ¶çš„æ–‡ä»¶.<br />å¸¸ç”¨çš„å‚æ•°:</p><p><code>-a, --archive</code>: å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§<br /><code>--exclude-from</code>: è¿™æ˜¯é€‰æ‹©<code>rsync</code>è€Œä¸æ˜¯<code>cp</code>çš„æœ€å¤§åŸå› , è¯¥é…ç½®èƒ½å¤Ÿåœ¨å¤åˆ¶æ–‡ä»¶æ—¶æŒ‡å®šè¿‡æ»¤çš„æ–‡ä»¶.<br /><code>--exclude</code>: æŒ‡å®šæ’é™¤ä¸éœ€è¦ä¼ è¾“çš„æ–‡ä»¶æ¨¡å¼, ä¾‹å¦‚<code>--exclude=exclude.list</code>, å°±å¯ä»¥åœ¨ç›®å½•ä¸‹åˆ›å»º exclude.list, å†…å®¹ä¸ºè¿‡æ»¤çš„æ–‡ä»¶æ¨¡å¼, ä¾‹å¦‚:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">log/<br>Dockerfile<br><span class="hljs-string">.eslintrc.js</span><br><span class="hljs-string">.gitignore</span><br><span class="hljs-string">.prettierrc</span><br>*<span class="hljs-string">.log</span><br></code></pre></td></tr></table></figure><h1 id="redis"><a class="markdownIt-Anchor" href="#redis"></a> redis</h1><p>å¸¸ç”¨å‘½ä»¤:</p><ol><li><code>flushdb</code>: åˆ é™¤ db ä¸­æ‰€æœ‰æ•°æ®</li><li><code>ttl key</code>: å‰©ä½™è¿‡æœŸæ—¶é—´</li><li><code>get key</code>: æŸ¥è¯¢ key å€¼</li><li>redis çš„å€¼å¦‚æœæ˜¯ number, ä¼šæ˜¾ç¤ºç±»ä¼¼&quot;1234&quot;; å¦‚æœæ˜¯ string, ä¼šæ˜¾ç¤º&quot;\â€œ1234\â€&quot;</li><li>redis connect refuse è§£å†³æ–¹æ³•:<br />redis.conf ä¸­å°† protect mode yes æ”¹ä¸º no<br />bind 127.0.0.1 æ³¨é‡Š#</li></ol><h1 id="docker"><a class="markdownIt-Anchor" href="#docker"></a> docker</h1><p>å¸¸ç”¨å‘½ä»¤:</p><ol><li><code>docker run -dit --rm imageId bash</code>: åˆ›å»ºå®¹å™¨å¹¶åœ¨å®¹å™¨å¯åŠ¨ bash äº¤äº’, é€€å‡ºåè‡ªåŠ¨åˆ é™¤å®¹å™¨</li><li><code>docker run -dit imageId</code>: åˆ›å»ºå®¹å™¨</li><li><code>docker exec -it id bash</code>: åœ¨è¿è¡Œçš„å®¹å™¨ä¸­å¯åŠ¨ bash ä¸å…¶äº¤äº’</li><li><code>docker history imageId</code>: é€šè¿‡é•œåƒ id æŸ¥çœ‹ä¸Šå±‚ layer çš„ Dockerfile</li><li><code>docker logs containerId</code>: è¾“å‡ºå®¹å™¨æ—¥å¿—</li><li><code>docker run -d -p 127.0.0.1:80:80 nginx:alpine</code> è¿è¡Œæ—¶æŒ‡å®šç«¯å£æ˜ å°„, éœ€è¦æ³¨æ„çš„æ˜¯ Dockerfile ä¸­çš„<strong>EXPOSE</strong>å…³é”®å­—åªæ˜¯æè¿°ç«¯å£å·, æ²¡æœ‰å®é™…ä½œç”¨</li><li><code>docker build -t v0.0.1 --ulimit nofile=100002:100002 packages/wework-bot</code>: å¯ä»¥æŒ‡å®šä¸Šä¸‹æ–‡, å¦‚æœåœ¨ Dockerfile ä¸­é…ç½®<strong>COPY . .</strong> ä¼šå°† packages/wework-bot å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ°å®¹å™¨çš„<strong>WORKSPACE</strong>ä¸‹</li></ol><h1 id="git"><a class="markdownIt-Anchor" href="#git"></a> git</h1><ol><li><code>git rev-parse HEAD</code>: æœ€è¿‘çš„ä¸€æ¬¡ commit id</li><li><code>git merge --no-edit</code>: ä¸è§¦å‘äº¤äº’ä¿®æ”¹ä¿¡æ¯, ç”¨äºä»£ç ä¸­è°ƒç”¨</li><li><code>git revert commitId</code>: å›é€€æŒ‡å®š commit, æ–°å¢ä¸€æ¡ commit è®°å½•, æ¯”å¦‚æƒ³å›é€€ HEAD æœ€æ–°æäº¤, åˆ™<code>git revert HEAD</code>, æ“ä½œæ˜¯å¯é€†çš„.</li><li><code>git reset commitId</code>: å›é€€æŒ‡å®š commit, æ¸…é™¤ commit ä¹‹åæ‰€æœ‰è®°å½•, æ¯”å¦‚æƒ³å›é€€ HEAD æœ€æ–°æäº¤, åˆ™<code>git reset --hard HEAD^</code>, æ“ä½œä¸å¯é€†.</li><li><code>git pull --rebase</code>: pull é»˜è®¤ä¼šç”Ÿæˆä¸€æ¡ merge è®°å½•, --rebase æŒ‡å®šä¸ç”Ÿæˆ merge è®°å½•</li></ol><h1 id="å…¶ä»–"><a class="markdownIt-Anchor" href="#å…¶ä»–"></a> å…¶ä»–</h1><h2 id="pm2"><a class="markdownIt-Anchor" href="#pm2"></a> pm2</h2><p>ç”±äºæœåŠ¡éƒ¨ç½²åœ¨çº¿ä¸Šç¯å¢ƒçš„ docker ä¸­, <code>pm2 start</code>ä¸æ”¯æŒå®¹å™¨ä¸­å¯åŠ¨, è¿™å°±å¯¼è‡´ Dockerfile ä¸­é€»è¾‘æ‰§è¡Œå®Œå®¹å™¨ç›´æ¥ Exit. å®˜æ–¹æä¾›<code>pm2-runtime</code>ç”¨äº docker åœºæ™¯, è¿è¡ŒæœåŠ¡å‘½ä»¤<code>pm2-runtime start ecosystem.config.js</code>, å’Œ pm2 ä¸åŒ, pm2-runtime ä¸æ”¯æŒ restart.</p><h2 id="å¤šç¯å¢ƒ-git"><a class="markdownIt-Anchor" href="#å¤šç¯å¢ƒ-git"></a> å¤šç¯å¢ƒ git</h2><p>ç”±äºæ—¥å¸¸éƒ½æ˜¯åœ¨å†…ç½‘çš„ linux å¼€å‘æœºä¸ŠåŠå…¬(é€šè¿‡ vscode ssh-remote), ssh çš„å†…å®¹å°±æ¶‰åŠåˆ°äº†å¤šç¯å¢ƒ, åŒ…æ‹¬æœ¬åœ°ä¸å¼€å‘æœºè¿æ¥, å†…ç½‘ git æ“ä½œ, github æ“ä½œ, å‚è€ƒè¿™ç¯‡æ–‡ç« : <a href="https://www.zhihu.com/question/21402411">å¤šç¯å¢ƒ git é…ç½®</a></p><h2 id="xml-è¯·æ±‚ä½“"><a class="markdownIt-Anchor" href="#xml-è¯·æ±‚ä½“"></a> xml è¯·æ±‚ä½“</h2><p>body-parser åªæ”¯æŒå¤„ç† Content-Type ä¸º <code>application/x-www-form-urlencoded</code>, <code>multiple/form-data</code>, <code>application/json</code>çš„è¯·æ±‚ä½“; å¾®ä¿¡å®¢æœå·è¿™ç§è¯·æ±‚ä½“æ˜¯ xml æ ¼å¼çš„ body-parser å¤„ç†ä¸äº†, req.body è¾“å‡ºä¹Ÿæ˜¯{}.<br />éœ€è¦ç»“åˆ<strong>body-parser-xml</strong>åº“å¯¹ body-parser åšå°è£…:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> bodyParser <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;body-parser&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> bodyParserXml <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;body-parser-xml&quot;</span>;<br><br><span class="hljs-title function_">bodyParserXml</span>(bodyParser);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">XmlMiddleware</span> = bodyParser.<span class="hljs-title function_">xml</span>(&#123;<br>  <span class="hljs-attr">xmlParseOptions</span>: &#123;<br>    <span class="hljs-attr">explicitArray</span>: <span class="hljs-literal">false</span>,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="formdata"><a class="markdownIt-Anchor" href="#formdata"></a> formData</h2><p>åœ¨ node ä¸­ formData çš„ä½¿ç”¨å’Œæµè§ˆå™¨ä¸­ä¸€è‡´, å½“ formData append çš„å€¼æ˜¯æ–‡ä»¶å¯è¯»æµæ—¶, æ–‡ä»¶çš„åŸºæœ¬å±æ€§å°±ä¼šä¸¢å¤±, MIME å˜æˆ<strong>oct-stream</strong>, filename å˜æˆä¸€ä¸² MD5 ç , å¯ä»¥é€šè¿‡ options ä¸­é…ç½®æŒ‡å®šæ–‡ä»¶åŸºç¡€ä¿¡æ¯</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript">formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;file&#x27;</span>, &lt;å¯è¯»æµ&gt;, &#123; <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;dist.zip&#x27;</span> &#125;);<br></code></pre></td></tr></table></figure><h2 id="centos7"><a class="markdownIt-Anchor" href="#centos7"></a> centos7</h2><ol><li><a href="https://ximouzhao.com/index.php/2022/06/17/centos7%e5%ae%89%e8%a3%85%e6%9c%80%e6%96%b0%e7%89%88%e6%9c%acgit/">centos7 å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ git(ä¸ç”¨æ‰‹åŠ¨ç¼–è¯‘)</a></li><li>yum æºçš„ç›®å½•: /etc/yum.repos.d/</li><li>Transaction check error: å®‰è£…åŒ…å†²çª <code>rpm -e å†²çªåŒ…å --nodeps</code></li></ol><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://stackoverflow.com/questions/73591752/eslint-error-is-defined-but-never-used-warning-in-nestjs-for-all-decorators">Eslint error <code>is defined but never used</code> warning in NestJs for all decorators</a></li><li><a href="https://stackoverflow.com/questions/53862615/how-to-merge-into-branch-without-commit">how to merge into branch without commit</a></li><li><a href="https://stackoverflow.com/questions/53962776/whats-the-difference-between-pm2-and-pm2-runtime">https://stackoverflow.com/questions/53962776/whats-the-difference-between-pm2-and-pm2-runtime</a></li><li><a href="https://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/">https://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/</a></li><li><a href="https://www.zhihu.com/question/21402411">å¤šç¯å¢ƒ git é…ç½®</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>nestjs</tag>
      
      <tag>nodejs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯å·¥ä½œæ—¥å¸¸é—®é¢˜å’Œæ˜“å¿˜ç‚¹è®°å½•</title>
    <link href="/2022/11/24/2022-11-24-daily-record-from-oct-to-dec/"/>
    <url>/2022/11/24/2022-11-24-daily-record-from-oct-to-dec/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>è®°å½•ä¸‹æ—¥å¸¸é‡åˆ°çš„é—®é¢˜å’Œç®€ä¾¿æ“ä½œ</p><h1 id="å­¦åˆ°äº†"><a class="markdownIt-Anchor" href="#å­¦åˆ°äº†"></a> å­¦åˆ°äº†</h1><h2 id="1-ant-design-ä¸­çš„å›¾æ ‡åº”ç”¨"><a class="markdownIt-Anchor" href="#1-ant-design-ä¸­çš„å›¾æ ‡åº”ç”¨"></a> 1. ant-design ä¸­çš„å›¾æ ‡åº”ç”¨</h2><p><strong>@ant-design/icons-vue</strong>æä¾›äº†å¾ˆå¤š<a href="https://2x.antdv.com/components/icon/#Icon">å›¾æ ‡ç»„ä»¶</a><br />åœ¨ vue ç»„ä»¶ä¸­ä½¿ç”¨å¯ä»¥ç›´æ¥é€šè¿‡:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">StepBackwardOutlined</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@ant-design/icons-vue&quot;</span>;<br><br><span class="hljs-comment">// ä½¿ç”¨</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">StepBackwardOutlined</span> /&gt;</span></span>;<br></code></pre></td></tr></table></figure><p>ä½†åœ¨æŸäº›æƒ…å†µä¸‹, æ¯”å¦‚èœå•ç»„ä»¶, ä¾§è¾¹æ ç»„ä»¶, æƒ³è¦ç›´æ¥é€šè¿‡<code>className</code>æ¥è·å–å›¾æ ‡å°±å¯ä»¥å‚è€ƒæ–‡æ¡£ä¸­<strong>Custom Font Icon</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; createFromIconfontCN &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@ant-design/icons-vue&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; defineComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyIcon</span> = <span class="hljs-title function_">createFromIconfontCN</span>(&#123;<br><span class="hljs-attr">scriptUrl</span>: <span class="hljs-string">&#x27;//at.alicdn.com/t/font_8d5l8fzk5b87iudi.js&#x27;</span>, <span class="hljs-comment">// generated by iconfont.cn</span><br>&#125;);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br><span class="hljs-attr">props</span>: &#123;<br><span class="hljs-attr">className</span>: <span class="hljs-title class_">String</span>,<br>&#125;;<br><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyIcon</span> <span class="hljs-attr">:type</span>=<span class="hljs-string">&quot;className&quot;</span> /&gt;</span></span>;<br>&#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><p>å®˜æ–¹æä¾›äº†è¿™æ ·çš„ç»„ä»¶, å…¶ä¸­<code>type</code>å±æ€§å³ç±»å. <strong>createFromIconfontCN</strong>çš„<code>scriptUrl</code>å‚æ•°å¯ä»¥åœ¨<a href="https://www.iconfont.cn/">iconfont.cn</a>sh è·å–è‡ªå®šä¹‰çš„ js é“¾æ¥.<br />ä¹Ÿå¯ä»¥ä¸ä¼ å…¥<code>scriptUrl</code>, ç›´æ¥åœ¨å…¥å£ html æ–‡ä»¶ä¸­å…¨å±€å¼•å…¥, åœ¨åšä¸»é¡¹ç›®ä¸­ä¾¿æ˜¯è¿™æ ·è®¾ç½®çš„.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyIcon</span> = <span class="hljs-title function_">createFromIconfontCN</span>(&#123;<br>  <span class="hljs-attr">scriptUrl</span>: <span class="hljs-string">&quot;&quot;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= BASE_URL %&gt;iconfont.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®è·¯ç”±ç”Ÿæˆç®€å•èœå•æ çš„ç®€å•è·¯ç”±ç¤ºä¾‹, å…¶ä¸­é€šè¿‡è®¾ç½®<strong>meta</strong>çš„<code>icon</code>å±æ€§ä½œä¸ºå›¾æ ‡çš„<code>className</code>:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RouteRecordRaw</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">ROUTES</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/content/management&quot;</span>,<br>    <span class="hljs-attr">name</span>: routeName,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span><br>      <span class="hljs-title function_">import</span>(<br>        <span class="hljs-comment">/* webpackMode: &quot;lazy&quot; */</span> <span class="hljs-comment">/* webpackPrefetch: true */</span> <span class="hljs-comment">/* webpackChunkName: &quot;prom-material&quot; */</span> <span class="hljs-string">&quot;@/views/list.vue&quot;</span><br>      ),<br>    <span class="hljs-attr">meta</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>,<br>      <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;icon-folder-fill&quot;</span>,<br>    &#125;,<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure><h2 id="2-éƒ¨ç½²-vue-é¡¹ç›®åå¯¹-nginx-çš„è¿›ä¸€æ­¥äº†è§£"><a class="markdownIt-Anchor" href="#2-éƒ¨ç½²-vue-é¡¹ç›®åå¯¹-nginx-çš„è¿›ä¸€æ­¥äº†è§£"></a> 2. éƒ¨ç½² vue é¡¹ç›®åå¯¹ nginx çš„è¿›ä¸€æ­¥äº†è§£</h2><p>é¦–å…ˆéœ€è¦ææ¸…æ¥š<strong>nginx</strong>ä¸­çš„<code>root</code>å’Œ<code>alias</code>, åŒºåˆ«åœ¨äº:</p><ol><li>å¯¹äº<strong>location</strong>åé¢çš„ uri çš„è§£æ<br /><code>root</code>çš„å¤„ç†ç»“æœä¸º root è·¯å¾„+è¯·æ±‚çš„ uri è·¯å¾„<br /><code>alias</code>çš„å¤„ç†ç»“æœä¸º alias è·¯å¾„è¦†ç›– location è·¯å¾„+è¯·æ±‚ uri å‰©ä½™çš„è·¯å¾„</li><li><code>alias</code>ç»“å°¾å¿…é¡»è¦å¸¦ä¸Š<code>/</code>, <code>root</code>ç»“å°¾åˆ™å¯æœ‰å¯æ— .</li></ol><p>å¯¹äºä»¥ä¸‹ nginx é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">root</span> /www/data/dist/;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¯·æ±‚ URI ä¸º<code>/editor/abc</code>, æœ€ç»ˆ nginx æŸ¥æ‰¾çš„è·¯å¾„ä¸º<code>/www/data/dist/editor/abc</code>.</p><p>å¯¹äºä»¥ä¸‹ nginx é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¯·æ±‚ URI ä¸º<code>/editor/abc</code>, æœ€ç»ˆ nginx æŸ¥æ‰¾çš„è·¯å¾„ä¸º<code>/www/data/dist/abc</code>.</p><p>nginx ä¸­çš„<code>index</code>, nginx åœ¨ä¸Šè¿°çš„ç§ç§è·¯å¾„ä¸­æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶, é»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨åé¢åŠ ä¸Šä¸ª<code>/index</code>ç»§ç»­æ‰¾<code>/www/data/dist/abc/index</code>, å¯ä»¥é€šè¿‡é…ç½®<code>index</code>å‘Šè¯‰ nginx index çš„å«ä¹‰.</p><p>å¯¹äºä»¥ä¸‹ nginx é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br><span class="hljs-attribute">index</span> index.html index.shtml;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ±‚ uri ä¸º<code>/editor/abc</code>, nginx åœ¨<code>/www/data/dist/abc</code>è·¯å¾„æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶, ä¼šç»§ç»­æ‰¾<code>/www/data/dist/abc/index.html</code>åŠ<code>/www/data/dist/abc/index.shtml</code>, è¿˜æ˜¯æ‰¾ä¸åˆ°åˆ™è¿”å›<strong>404</strong>.</p><p>nginx ä¸­çš„<code>autoindex</code>, æ˜¯å¦å…è®¸æŸ¥çœ‹æ–‡ä»¶å¤¹, é»˜è®¤æ˜¯<code>off</code>.</p><p>å¯¹äºä»¥ä¸‹ nginx é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br><span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ±‚ uri ä¸º<code>/editor/abc</code>, nginx å¦‚æœå‘ç°<code>/www/data/dist/abc</code>æ˜¯ä¸ªæ–‡ä»¶å¤¹, æµè§ˆå™¨ä¼šè¿”å›ç›®å½•ç»“æ„ç±»ä¼¼ä¸‹å›¾:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1669723364169_608.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>æœ€åå°±æ˜¯è®°å½•ä½¿ç”¨<strong>history</strong>æ¨¡å¼ vue-router çš„ vue é¡¹ç›®<code>npm run build</code>åçš„æ„å»ºäº§ç‰©å‘å¸ƒåˆ°çº¿ä¸Šæœºå™¨åçš„ nginx é…ç½®.<br />é¦–å…ˆæˆ‘ä»¬çŸ¥é“é»˜è®¤æƒ…å†µä¸‹ vue æ˜¯ SPA å•é¡µé¢åº”ç”¨, å…¶ä¸­çš„è·¯ç”±è·³è½¬éƒ½æ˜¯é€šè¿‡ H5 æä¾›çš„<code>history.pushState()</code>è¿›è¡Œè·³è½¬. å‡è®¾æ„å»ºäº§ç‰©ç°åœ¨å‘å¸ƒåœ¨<code>/www/data/dist</code>ç›®å½•, ç›®å½•ç»“æ„:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dist<br>â”œâ”€â”€ css<br>â”œâ”€â”€ favicon<span class="hljs-selector-class">.ico</span><br>â”œâ”€â”€ iconfont<span class="hljs-selector-class">.js</span><br>â”œâ”€â”€ <span class="hljs-selector-tag">img</span><br>â”œâ”€â”€ index<span class="hljs-selector-class">.html</span><br>â””â”€â”€ js<br></code></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸‹è·¯ç”±:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-attr">ROUTES</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/dashboard/list&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;&quot;</span>),<br>  &#125;,<br>];<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),<br>  <span class="hljs-attr">routes</span>: <span class="hljs-variable constant_">ROUTES</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ ¹è·¯å¾„ä¸‹çš„ nginx é…ç½®, ç½‘ä¸Šéƒ½æ˜¯æ•™ä½ è¿™ä¹ˆé…çš„:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br><span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ±‚ uri ä¸º<code>/dashboard/list</code>, æˆ‘æ›¾ç»ä»¥ä¸ºçš„ nginx è§£æé€»è¾‘æ˜¯:</p><ol><li>åŒ¹é…åˆ°<code>/</code>, æŸ¥æ‰¾<code>/www/data/dist/dashboard/list</code></li><li>æ²¡æ‰¾åˆ°å¯¹åº”æ–‡ä»¶, åé¢åŠ ä¸Š<code>/index</code>æ‰¾, è¿˜æ˜¯æ²¡æ‰¾ç€</li><li>é€šè¿‡<strong>try_file</strong>ä¸€æ¬¡æŸ¥æ‰¾<code>/www/data/dist/</code>, <code>/www/data/dist/index.html</code></li><li>æ‰¾åˆ°å¯¹åº”æ–‡ä»¶è¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨é€šè¿‡ html å¼•å…¥çš„ js ä¸­çš„è·¯ç”±è§„åˆ™è·³è½¬åˆ°<code>/dashboard/list</code></li></ol><p>äºæ˜¯åœ¨æ–°é¡¹ç›®ä»¥ä¸‹è·¯ç”±ä¹Ÿä½¿ç”¨ç”¨äº†å¯¹åº” nginx é…ç½®:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-string">&quot;/editor&quot;</span>),<br>  <span class="hljs-attr">routes</span>: <span class="hljs-variable constant_">ROUTES</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><p>éè·Ÿè·¯å¾„çš„ nginx é…ç½®:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br><span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>&#125;<br></code></pre></td></tr></table></figure><p>äº‹å®æ˜¯è¿™æ ·é…ç½®ç›´æ¥è®¿é—® uri ä¸º<code>/editor/dashboard/list</code>æ—¶ä¼šè¿”å›<strong>404</strong>, åŸå› æ˜¯ nginx çš„<code>try_file</code>å±æ€§çš„ N ä¸ªå€¼ä¸­, å‰é¢ N-1 ä¸ªå€¼çš„æœç´¢é€»è¾‘å’Œä¸Šè¿°ç¬¬ 3 ç‚¹ä¸€è‡´, ä½†æ˜¯å¯¹äºç¬¬ N ä¸ªå€¼, nginx ä¼šè¿›è¡Œ<strong>å†…éƒ¨é‡å®šå‘</strong>, ä¾‹å­ä¸­å³ä¼šå¯¹<code>/index.html</code>é‡æ–°è¿›è¡ŒåŒ¹é…, ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹<strong>location / {}</strong> çš„é…ç½®, æ‰€ä»¥å¾—åˆ° 404 ç»“æœ.</p><p>æ­£ç¡®çš„ nginx é…ç½®ç±»ä¼¼:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs diff">location /editor/ &#123;<br>alias /www/data/dist/;<br><span class="hljs-deletion">-   try_files $uri/ /index.html;</span><br><span class="hljs-addition">+   try_files $uri/ /editor/index.html;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„åˆ†æ, æˆ‘ä»¬çŸ¥é“ nginx çš„<code>try_files</code>å¯¹<code>/editor/index.html</code>å†…éƒ¨é‡å®šå‘, é‡æ–°åŒ¹é…<strong>location /editor/ {}</strong> æ‹¿åˆ°<strong>index.html</strong>, è¿”å›ç»™æµè§ˆå™¨, é€šè¿‡ vue-router æ­£å¸¸è·¯ç”±è·³è½¬.</p><p>æŸ¥æ‰¾ StackOverflow æ—¶å‘ç°ä¸€ç§å†™æ³•, ä¹Ÿæ˜¯å¥½ä½¿çš„, ä¸æ¸…æ¥šå†…éƒ¨åŸå› , å¸Œæœ›æœ‰äº†è§£çš„åŒå­¦èƒ½è§£é‡Šä¸€ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /editor/ &#123;<br><span class="hljs-attribute">alias</span> /www/data/dist/;<br><span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span>/ /index.html <span class="hljs-literal">last</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-tar-å‘½ä»¤"><a class="markdownIt-Anchor" href="#3-tar-å‘½ä»¤"></a> 3. tar å‘½ä»¤</h2><ul><li>é¡¹ç›®å‘å¸ƒä¸Šçº¿éœ€è¦ç¼–å†™æ‰“åŒ…çš„ shell è„šæœ¬ç»™å®¹å™¨æ‰§è¡Œ, å‘ç°äº†ä¸ª tar çš„å‚æ•°<code>--remove-files</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar --zcvf node_modules.tar.gz node_modules --remove-files<br></code></pre></td></tr></table></figure><p>ä¼šåœ¨å‹ç¼©æˆ tar.gz åŒ…åå°†æºæ–‡ä»¶å¤¹åˆ é™¤, å°±ä¸ç”¨ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar --zcvf node_modules.tar.gz node_modules<br><span class="hljs-built_in">rm</span> -rf xxx<br></code></pre></td></tr></table></figure><ul><li>è¿è¡Œä»¥ä¸‹è§£å‹å‘½ä»¤æ—¶æŠ¥é”™ tar: write err</li><li></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxvf node_module.tar.gz node_modules<br></code></pre></td></tr></table></figure><p>tar ä¸­<code>-v</code>æ˜¯è¾“å‡ºæ‰“åŒ…å†…å®¹, å¦‚æœå†…å®¹è¿‡é•¿, åœ¨æŸäº›æœºå™¨ä¸Šä¼šæŠ¥ tar: write err, æ‰€ä»¥å»ºè®®ä¸åŠ ä¸Šè¿™ä¸ªå‚æ•°</p><h2 id="4-du-sh"><a class="markdownIt-Anchor" href="#4-du-sh"></a> 4. du -sh</h2><p><code>ls -lh</code> å¯ä»¥æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹ä¸‹å„æ–‡ä»¶å¤§å°, ä½†æ˜¯æ˜¾ç¤ºæ–‡ä»¶å¤¹å¤§å°å¹¶æ²¡æœ‰åŒ…å«æ–‡ä»¶å¤¹å†…éƒ¨æ–‡ä»¶å¤§å°<br /><code>du -sh</code>ç”¨äºæ˜¾ç¤ºæ–‡ä»¶å¤¹åŠå†…éƒ¨æ–‡ä»¶çš„æ€»å¤§å°<br /><code>-s</code>åªæ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å¤§å°, ä¸æ˜¾ç¤ºæ–‡ä»¶å¤¹å†…éƒ¨æ–‡ä»¶å¤¹å¤§å°;<br /><code>-h</code>ä»¥ <strong>K</strong>, <strong>M</strong>, <strong>G</strong> è¿™ç±»å®¹æ˜“ç†è§£çš„å•ä½æ˜¾ç¤ºå¤§å°</p><h2 id="5-multiple-commit-message-in-windows"><a class="markdownIt-Anchor" href="#5-multiple-commit-message-in-windows"></a> 5. multiple commit message in windows</h2><p>windows ç³»ç»Ÿä¸‹é»˜è®¤ä¸æ”¯æŒä»¥ä¸‹æ–¹å¼ commit å¤šè¡Œä¿¡æ¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs node">execSync(`git commit -m &quot;$&#123;commitMessage&#125;&quot;`);<br></code></pre></td></tr></table></figure><p><code>commitMessage</code>å¦‚æœä¸ºå¤šè¡Œ, linux/macos ä¸‹èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ, windows ä¸‹ä¼šå°†é™¤ç¬¬ä¸€è¡Œå¤–å†…å®¹æˆªæ–­.</p><p>ä½†æ˜¯ç»è¿‡æµ‹è¯•æ‰€æœ‰ç³»ç»Ÿä¸‹éƒ½æ”¯æŒä¸€ä¸‹æ–¹å¼ commit å¤šè¡Œä¿¡æ¯, <code>commitMessage</code>ä¸ºå•è¡Œä¿¡æ¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs node">execSync(`git commit -m &quot;$&#123;commitMessage&#125;&quot; -m &quot;$&#123;commitMessage&#125;&quot;`);<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°çš„<code>&quot;$&#123;commitMessage&#125;&quot;</code>ä¸¤è¾¹å¿…é¡»åŠ ä¸Š quote.</p><h2 id="6-env"><a class="markdownIt-Anchor" href="#6-env"></a> 6. .env</h2><p>npm åº“<strong>dot-env</strong>æ”¯æŒåœ¨æœ¬åœ°é…ç½®<code>.env</code>æ–‡ä»¶, å¹¶å°†é”®å€¼æŒ‚è½½åˆ°<code>process.env</code>ä¸Š, ä½†æ˜¯å¯¹äºæŸäº›ç¬¦å·å­—ç¬¦, é»˜è®¤ä¼šè¢«æˆªæ–­å¯¼è‡´è¯»å–é…ç½®æ—¶å‡ºé”™.<br />ä¾‹å¦‚ä»¥ä¸‹é…ç½®:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">NODE_CONFIG_DIR</span>=./env<br><span class="hljs-attr">NODE_ENV</span>=development<br><span class="hljs-attr">SIGN</span>=P2E<span class="hljs-comment">#xWehFZc</span><br></code></pre></td></tr></table></figure><p>è¯»å–<strong>SIGN</strong>æ—¶ä¼šå°†#åé¢çš„é˜¶æ®µ, å¯¼è‡´<strong>SIGN</strong>çš„å€¼å˜ä¸º<code>P2</code>, è¿™ç§æƒ…å†µåœ¨ä¸¤è¾¹åŠ ä¸Š quote å³å¯è§£å†³:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">SIGN</span>=<span class="hljs-string">&#x27;P2E#xWehFZc&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="iframe"><a class="markdownIt-Anchor" href="#iframe"></a> iframe</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// çˆ¶é¡µé¢ -&gt; å­é¡µé¢, iframeä¸ºiframe DOMèŠ‚ç‚¹</span><br>iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(data, &#123;&#125;);<br><span class="hljs-comment">// å­é¡µé¢ -&gt; çˆ¶é¡µé¢</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">postMessage</span>(data, &#123;&#125;);<br></code></pre></td></tr></table></figure><h1 id="é—®é¢˜"><a class="markdownIt-Anchor" href="#é—®é¢˜"></a> é—®é¢˜</h1><h2 id="1-cannot-find-module-pm2libprocesscontainerforkjs"><a class="markdownIt-Anchor" href="#1-cannot-find-module-pm2libprocesscontainerforkjs"></a> 1. cannot find module pm2/lib/ProcessContainerFork.js</h2><p><code>rm -rf ~/.pm2</code></p><h2 id="2-æµè§ˆå™¨-img-è¯·æ±‚å›¾ç‰‡æ—¶-403"><a class="markdownIt-Anchor" href="#2-æµè§ˆå™¨-img-è¯·æ±‚å›¾ç‰‡æ—¶-403"></a> 2. æµè§ˆå™¨ img è¯·æ±‚å›¾ç‰‡æ—¶ 403</h2><p>html æ–‡ä»¶<code>&lt;head&gt;</code>åŠ ä¸Š<code>&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;</code>, å› ä¸ºæŸäº›æœåŠ¡å™¨ä¼šæ£€æµ‹è¯·æ±‚å¤´çš„<strong>referer</strong>, æ‰€ä»¥éœ€è¦è®¾ç½®è¯·æ±‚æ—¶ä¸å¸¦ä¸Š<strong>referer</strong>.</p><h2 id="3-less-ä¸æ”¯æŒ-additionaldata"><a class="markdownIt-Anchor" href="#3-less-ä¸æ”¯æŒ-additionaldata"></a> 3. <strong>less</strong> ä¸æ”¯æŒ <code>additionalData</code></h2><p><strong>less</strong> v4, <strong>less-loader</strong> v11 ä¸æ”¯æŒ<code>additionalData</code>, <strong>less</strong> v5, <strong>less-loader</strong> v12 ä¹‹åæ–°å¢ breaking change, æ‰æ”¯æŒ<code>additionalData</code>, æ‰å¯ä»¥åƒ<strong>sass-loader</strong>ä¸€æ ·åœ¨ css æ–‡ä»¶å¼€å¤´æ’å…¥å­—ç¬¦ä¸².<br />vue.config.js ä¸­é…ç½®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">loaderOptions</span>: &#123;<br>      <span class="hljs-attr">less</span>: &#123;<br>        <span class="hljs-attr">addtionalData</span>: <span class="hljs-string">`@import &#x27;@/style/global.less&#x27;`</span>,<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://www.cnblogs.com/fengff/p/12015858.html">nginx çš„ locationã€rootã€alias æŒ‡ä»¤ç”¨æ³•å’ŒåŒºåˆ«</a></li><li><a href="https://stackoverflow.com/questions/49072584/vue-router-nginx-and-direct-link">vue-router, nginx and direct link</a></li><li><a href="https://blog.51cto.com/u_10546390/1754757">Nginx çš„ try_files å‚æ•°ä¿è¯èƒ½æ‡‚çš„è®²è§£</a></li><li><a href="https://github.com/Unitech/pm2/issues/1943">cannot find module pm2/lib/ProcessContainerFork.js</a></li><li><a href="https://stackoverflow.com/questions/15075783/add-line-break-to-git-commit-m-from-command-line-on-windows">Add line break to git commit -m from command line on Windows</a></li><li><a href="https://stackoverflow.com/questions/55703950/export-env-with-special-characters">Export .env with special characters</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥ä½œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å·¥ä½œ</tag>
      
      <tag>é—®é¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(10)</title>
    <link href="/2022/10/23/2022-10-23-study-webpack-day10/"/>
    <url>/2022/10/23/2022-10-23-study-webpack-day10/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="tree-shaking"><a class="markdownIt-Anchor" href="#tree-shaking"></a> Tree shaking</h2><p>tree shaking åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºæ¶ˆé™¤æ­»ä»£ç (dead code).<br />JavaScript çš„ Tree shaking æºè‡ªäº rollup, ä¾èµ– ES Module çš„é™æ€è¯­æ³•åˆ†æ.<br />webpack4 æ­£å¼æ‰©å±•äº†è¿™ä¸ªèƒ½åŠ›, åˆ†ä¸º<code>usedExports</code>å’Œ<code>sideEffects</code>ä¸¤ç§:</p><h3 id="usedexports"><a class="markdownIt-Anchor" href="#usedexports"></a> usedExports</h3><p><code>optimization.usedExports</code>, <strong>production</strong>æ¨¡å¼ä¸‹é»˜è®¤ä¸º true. è¯¥é…ç½®ä¼šé…åˆ<strong>TerserPlugin</strong>ä½¿ç”¨, æ–¹ä¾¿æ¼”ç¤º, ä»¥ä¸‹é»˜è®¤<code>mode</code>ä¸º<strong>development</strong>.</p><p>ç¤ºä¾‹å…¥å£æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; sum &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./math&quot;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum);<br></code></pre></td></tr></table></figure><p>æ¨¡å—æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">num1, num2</span>) &#123;<br>  <span class="hljs-keyword">return</span> num1 + num2;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">num1, num2</span>) &#123;<br>  <span class="hljs-keyword">return</span> num1 * num2;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆå¼€å¯<code>optimization.usedExports</code>, å…³é—­<strong>TerserPlugin</strong>æ’ä»¶, æŸ¥çœ‹æ‰“åŒ…äº§ç‰©:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665914627139_3858.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°å¯¹äºæ²¡æœ‰å¼•ç”¨çš„å‡½æ•°, <code>usedExports</code>ä¼šåœ¨ä¸Šæ–¹æ ‡æ˜æ³¨é‡Š, æä¾›ç»™<strong>TerserPlugin</strong>è¿›è¡ŒåŠ å·¥åˆ é™¤.</p><p>ç°åœ¨å¼€å¯<strong>TerserPlugin</strong>æ’ä»¶, æŸ¥çœ‹æ‰“åŒ…äº§ç‰©:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665914691599_6111.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>ä¼šå‘ç°æ‰“åŒ…äº§ç‰©ä¸­<strong>mul</strong>å‡½æ•°æ²¡æœ‰è¢«æ‰“åŒ…è¿›å».</p><p>æ­¤æ—¶å¦‚æœå†å°†ä½œç”¨åŸŸæå‡<strong>webpack.optimize.ModuleConcatenationPlugin</strong>æ’ä»¶æ‰“å¼€, æ‰“åŒ…äº§ç‰©å°±ä¼šåªæ˜¾ç¤º sum å‡½æ•°, è¿å¼•å…¥æ ‡è¯†, IIFE ç­‰ä¿¡æ¯ä¸€å¹¶åˆ é™¤, å°±æƒ³ä¸Šä¸€ç¯‡æœ«å°¾æåˆ°çš„é‚£æ ·.</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665914791948_4934.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="sideeffects"><a class="markdownIt-Anchor" href="#sideeffects"></a> sideEffects</h3><p><code>sideEffects</code>ä¸»è¦ç”¨äºç¬¬ä¸‰æ–¹åº“æ–‡ä»¶, åœ¨ npm åŒ…çš„<strong>package.json</strong>ä¸­é…ç½®<strong>sideEffects</strong>, ç”¨äºå‘ŠçŸ¥ webpack compiler å“ªäº›æ¨¡å—æ˜¯æœ‰å‰¯ä½œç”¨çš„.</p><p>ä»€ä¹ˆæ˜¯<strong>å‰¯ä½œç”¨</strong>? å³æ¨¡å—å†…å¯èƒ½å­˜åœ¨å½±å“åˆ°å…¨å±€ç¯å¢ƒçš„é€»è¾‘; æ¯”å¦‚è¯´æŸä¸ªæ¨¡å—å¹¶ä¸æ˜¯åªå«æœ‰çº¯å‡½æ•°, è€Œæ˜¯å­˜åœ¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">app</span> = <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„é€»è¾‘, è¿™å°±è¡¨ç¤ºè¯¥æ¨¡å—æ˜¯æœ‰å‰¯ä½œç”¨çš„, éšæ„åˆ é™¤æ¨¡å—ä»£ç å¯èƒ½ä¼šå½±å“è¿è¡Œ.<br />æ‰€ä»¥<code>sideEffects</code>é»˜è®¤ä¸º true. ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹, ç›´æ¥ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./math&quot;</span>;<br></code></pre></td></tr></table></figure><p>webpack æ˜¯ä¸ä¼šå°† math æ¨¡å—çš„ä»£ç åˆ é™¤çš„.<br />å¯ä»¥é…ç½®æ•°ç»„, æŒ‡å®šæ¨¡å—ä¸­é‚£äº›æ–‡ä»¶æ˜¯å«æœ‰å‰¯ä½œç”¨çš„; å½“ç„¶æ¨èç¼–å†™ä¸å«æœ‰å‰¯ä½œç”¨çš„æ¨¡å—, ä½†æ˜¯å¯¹äº css æ–‡ä»¶è€Œè¨€, ä¸€å®šæ˜¯æœ‰å‰¯ä½œç”¨çš„, æ‰€ä»¥å¦‚æœé¡¹ç›®ä¸­å¼•å…¥äº†æ¨¡å—ä¸­çš„ css æ–‡ä»¶, æœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹å¼:</p><ol><li><code>sideEffects</code>ä¸­æ·»åŠ  css æ–‡ä»¶, å¦‚<code>&quot;sideEffects&quot;: [&quot;**/*.css&quot;]</code></li><li>åœ¨<code>module.rules</code>å¯¹å¤„ç† css æ–‡ä»¶æ—¶é…ç½®<code>sideEffects</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/i</span>,<br>  <span class="hljs-attr">use</span>: [<span class="hljs-string">&#x27;style-loader&#x27;</span>, <span class="hljs-string">&#x27;css-loader&#x27;</span>],<br>  <span class="hljs-attr">sideEffects</span>: <span class="hljs-literal">true</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä¹Ÿä¸¾ä¸ªç®€å•ä¾‹å­, æœ¬åœ°åˆ›å»ºä¸ª npm åŒ…, åŒ…å«ä¸¤ä¸ªæ–‡ä»¶:</p><p><strong>index.js</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">app</span> = <span class="hljs-string">&quot;abc&quot;</span>;<br></code></pre></td></tr></table></figure><p><strong>style.css</strong>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>yarn link</code>åœ¨ demo ä¸­å¼•å…¥, demo å…¥å£æ–‡ä»¶æ·»åŠ ä»¥ä¸‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;webpack-npm/lib/style.css&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;webpack-npm/lib/index.js&quot;</span>;<br><br><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);<br>element.<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">app</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(element);<br></code></pre></td></tr></table></figure><p>ç°å°† npm åŒ…ä¸­<code>sideEffects</code>ç½®ä¸º false, æ‰“åŒ…é¡µé¢æµè§ˆå™¨æ‰“å¼€:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1666540416154_2096.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°<strong>color</strong>æ ·å¼æ²¡æœ‰ç”Ÿæ•ˆ, <strong>window.app</strong>ä¹Ÿæ²¡æœ‰èµ‹å€¼.</p><p>ç„¶åå°†<code>sideEffects</code>é…ç½®ä¸º**[â€œ**/*.cssâ€]**æˆ–è€…é…ç½®<code>rules.sideEffects</code> éƒ½å¯ä»¥; æ‰“åŒ…é¡µé¢æ‰“å¼€æµè§ˆå™¨:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1666540559057_9057.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>è¯´æ˜ css æ–‡ä»¶å‚ä¸æ‰“åŒ…, js æ–‡ä»¶è¢«åˆ é™¤äº†.<br />æœ€åå°†<code>sideEffects</code>ç½®ä¸º true, å¯ä»¥çœ‹åˆ°æœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶éƒ½å‚ä¸æ‰“åŒ….</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1666540638739_5879.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p><strong>æ€»ç»“ä¸€ä¸‹</strong><br />å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒå¯¹ JavaScript ä»£ç è¿›è¡Œ tree shaking å‘¢?</p><ol><li>è®¾ç½®<code>optimization.usedExports</code>ä¸º true, å¸®åŠ©<strong>TerserPlugin</strong>è¿›è¡Œä¼˜åŒ–</li><li><strong>package.json</strong>ä¸­é…ç½®<code>sideEffects</code>, ç›´æ¥å¯¹æ¨¡å—è¿›è¡Œä¼˜åŒ–.</li></ol><h3 id="tree-shaking-in-css"><a class="markdownIt-Anchor" href="#tree-shaking-in-css"></a> Tree-shaking in Css</h3><p>æ—©æœŸ webpack ä½¿ç”¨<strong>purifyCss</strong>æ’ä»¶å¯¹ css æ–‡ä»¶è¿›è¡Œ tree shaking, ä½†æ˜¯è¯¥åº“å·²ä¸å†ç»´æŠ¤, æœ€æ–°çš„æäº¤ä¹Ÿæ˜¯ 4 å¹´å‰, ç›®å‰ä½¿ç”¨<strong>purgeCss</strong>æ¥å®Œæˆ css çš„ tree shaking.</p><p>å®‰è£…: <code>yarn add -D purgecss-webpack-plugin</code></p><p>å¦‚æœæƒ³è¦æ­£å¸¸ä½¿ç”¨<strong>purgeCss</strong>è¿˜éœ€è¦å®‰è£…<strong>mini-css-extract-plugin</strong>ç”Ÿæˆå•ç‹¬ css æ–‡ä»¶æ’ä»¶, å¦‚æœä¹‹å‰æ²¡å®‰è£…è¿‡ä¹Ÿéœ€è¦å®‰è£….</p><p>ä½¿ç”¨ç¤ºä¾‹, <strong>purgeCss</strong>ç‰ˆæœ¬æ›´æ–°åéœ€è¦è§£æ„å¼•å…¥:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mini-css-extract-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">PurgeCSSPlugin</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;purgecss-webpack-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;glob&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">CleanWebpackPlugin</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;clean-webpack-plugin&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// mode: &#x27;production&#x27;,</span><br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./build&quot;</span>),<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;bundle.js&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/i</span>,<br>        <span class="hljs-attr">use</span>: [<span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-string">&quot;css-loader&quot;</span>],<br>      &#125;,<br>    ],<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>      <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;./index.html&quot;</span>,<br>    &#125;),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>(&#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].css&quot;</span>,<br>    &#125;),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PurgeCSSPlugin</span>(&#123;<br>      <span class="hljs-attr">paths</span>: glob.<span class="hljs-title function_">sync</span>(<span class="hljs-string">&quot;./**/*&quot;</span>, &#123; <span class="hljs-attr">nodir</span>: <span class="hljs-literal">true</span> &#125;),<br>    &#125;),<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>purgeCss</strong>ä¼šè¯†åˆ« html å’Œ js ä¸­ç”¨åˆ°çš„ class æˆ– className ç­‰, ç»æµ‹è¯•:</p><ol><li>å³ä½¿ js ä¸­æ³¨é‡Š className é€»è¾‘, æ‰“åŒ…äº§ç‰©ä»ç„¶ä¼šå­˜åœ¨å¯¹åº”ç±»å</li><li>ä¸ä¼šå»é™¤å¯¹ body, html æ ‡ç­¾è®¾ç½®çš„ css</li><li>æœ‰å¯èƒ½ä¼šé¢å¤–åˆ é™¤ ä»£ç ä¸­å®é™…ä¼šç”¨åˆ°çš„ css, å¯¼è‡´æ ·å¼é”™ä¹±(åœ¨åšä¸» Vue é¡¹ç›®ä¸­æœ‰å‡ºç°è¿‡)</li></ol><p>æŠ›å¼€ä¸Šè¿°é—®é¢˜, <strong>purgeCss</strong>æ‰“åŒ…æ•ˆæœæ˜¯éå¸¸ä¼˜ç§€çš„. ç¬¬ä¸‰ç‚¹å¯ä»¥é€šè¿‡é…ç½®<strong>safeList</strong>è§£å†³</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">collectSafelist</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">standard</span>: [<span class="hljs-string">&quot;safelisted&quot;</span>, <span class="hljs-regexp">/^safelisted-/</span>],<br>    <span class="hljs-attr">deep</span>: [<span class="hljs-regexp">/^safelisted-deep-/</span>],<br>    <span class="hljs-attr">greedy</span>: [<span class="hljs-regexp">/^safelisted-greedy/</span>],<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// In the webpack configuration</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">PurgeCSSPlugin</span>(&#123;<br>  <span class="hljs-attr">safelist</span>: collectSafelist,<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="compress"><a class="markdownIt-Anchor" href="#compress"></a> Compress</h3><p>è¿™ä¸ªå±äºäº†è§£çŸ¥è¯†. ä¸€èˆ¬æ€§èƒ½ä¼˜åŒ–ä¹Ÿä¸ä¼šåˆ°è¿™ç§åœ°æ­¥(ç¬‘)</p><h4 id="http-å‹ç¼©"><a class="markdownIt-Anchor" href="#http-å‹ç¼©"></a> Http å‹ç¼©</h4><p>å¦‚ä»Šç»å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒ Http å‹ç¼©, æ”¯æŒçš„æµè§ˆå™¨åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶, ä¼šå‘ŠçŸ¥æœåŠ¡å™¨è‡ªå·±æ”¯æŒå“ªäº›å‹ç¼©æ ¼å¼, ä¾‹å¦‚<code>Accept: Encoding: gzip, deflate</code>, æœåŠ¡å™¨ä¸­å¦‚æœå­˜åœ¨æµè§ˆå™¨æ”¯æŒå‹ç¼©æ ¼å¼çš„å‹ç¼©æ–‡ä»¶å°±ä¼š, å°±ä¼šç›´æ¥è¿”å›å¯¹åº”çš„å‹ç¼©åæ–‡ä»¶, å¹¶åœ¨å“åº”å¤´é‡å‘ŠçŸ¥æµè§ˆå™¨, ä¾‹å¦‚<code>Content-Encoding: gzip</code>, æµè§ˆå™¨ä¼šå®Œæˆè§£å‹æ“ä½œ, æ— éœ€æˆ‘ä»¬å…³æ³¨.</p><p>webpack ä¸­ä¾èµ–<code>compression-webpack-plugin</code>æ’ä»¶æ¥æŒ‡å®šæ‰“åŒ…äº§ç‰©ç”Ÿæˆå¯¹åº”çš„å‹ç¼©æ–‡ä»¶.</p><p>webpack é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">CompressionPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;compression-webpack-plugin&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionPlugin</span>(&#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(css|js)$/i</span>, <span class="hljs-comment">// æŒ‡å®šéœ€è¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹</span><br>      <span class="hljs-attr">threshold</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// éœ€è¦å‹ç¼©çš„æ–‡ä»¶å¤§å°é˜ˆå€¼</span><br>      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&quot;gzip&quot;</span>, <span class="hljs-comment">// å‹ç¼©ç®—æ³•, å’ŒConten-Encodingå¯¹åº”</span><br>    &#125;),<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯, threshold å³ä½¿è®¾ç½®çš„å¾ˆå°æˆ– 0, <strong>CompressionPlugin</strong>ä¹Ÿä¸æ˜¯ä¼šå¯¹æ‰€æœ‰åŒ¹é…åˆ°çš„æ–‡ä»¶éƒ½è¿›è¡Œå‹ç¼©çš„, æ’ä»¶å†…éƒ¨è®¾ç½®äº†æœ€å°çš„é˜ˆå€¼.<br />æ‰€ä»¥è¿™é‡Œå®ä¾‹ä»£ç ä¸­å¼•å…¥äº†<strong>lodash</strong>åŒ…, å¯ä»¥çœ‹åˆ°æ‰“åŒ…äº§ç‰©å­˜åœ¨ js å’Œå‹ç¼©åçš„ gz æ–‡ä»¶</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1668618792046_8806.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h4 id="html-å‹ç¼©"><a class="markdownIt-Anchor" href="#html-å‹ç¼©"></a> Html å‹ç¼©</h4><p><strong>html-webpack-plugin</strong>é™¤äº†è®¾ç½® html æ¨¡æ¿åŒæ—¶é»˜è®¤ä¹Ÿå‹ç¼©äº† html ä»£ç , <code>minify: 'auto'</code>è¡¨ç¤ºé»˜è®¤é…ç½®, ä¹Ÿå¯ä»¥è‡ªå·±é…ç½®.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;./index.html&quot;</span>,<br>  <span class="hljs-attr">inject</span>: <span class="hljs-string">&quot;head&quot;</span>, <span class="hljs-comment">// é»˜è®¤ä¸ºhead, å¯è®¾ç½®boolean, head, body, trueå’Œheadå«ä¹‰ç›¸åŒ</span><br>  <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">minify</span>: isProduction<br>    ? &#123;<br>        <span class="hljs-attr">removeComments</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç§»é™¤æ³¨é‡Š</span><br>        <span class="hljs-attr">resolveRedundantAttributes</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç§»é™¤å¤šä½™å±æ€§</span><br>        <span class="hljs-attr">removeEmptyAttributes</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç§»é™¤ç©ºå±æ€§</span><br>        <span class="hljs-attr">collapseWhitespace</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç§»é™¤æ¢è¡Œå’Œç©ºæ ¼</span><br>        <span class="hljs-attr">minifyCss</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å‹ç¼©å†…è”æ ·å¼è¡¨css</span><br>        <span class="hljs-attr">minifyJS</span>: &#123;<br>          <span class="hljs-comment">// å‹ç¼©å†…è”js</span><br>          <span class="hljs-attr">mangle</span>: <span class="hljs-literal">true</span>,<br>        &#125;,<br>      &#125;<br>    : <span class="hljs-string">&quot;auto&quot;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="inlinechunkhtmlplugin"><a class="markdownIt-Anchor" href="#inlinechunkhtmlplugin"></a> InlineChunkHtmlPlugin</h3><p>è¿™æ˜¯<strong>react-dev-utils</strong>æä¾›çš„ä¸€ä¸ªæ’ä»¶ç”¨äºå…³è”<strong>HtmlWebpackPlugin</strong>, å°†åŒ¹é…åˆ°çš„æ–‡ä»¶æ’å…¥ html æ–‡ä»¶å†…è” js å½¢å¼æ‰§è¡Œ, å‡å°‘æ‰“åŒ…äº§ç‰©çš„æ–‡ä»¶æ•°é‡.è¾¾åˆ°<strong>æ–‡ä»¶ä½“ç§¯</strong>å’Œ<strong>Http è¯·æ±‚æ•°</strong>çš„å¹³è¡¡.</p><p>å®‰è£…: <code>yarn add -D react-dev-utils</code></p><p>é…ç½®, è¿™é‡Œä»¥åŠ¨æ€å¯¼å…¥ç”Ÿæˆçš„ runtime æ–‡ä»¶ä¸¾ä¾‹å­, å°† runtime é€»è¾‘ inline åˆ° html ä¸­:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">InlineChunkHtmlPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-dev-utils/InlineChunkHtmlPlugin&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">CleanWebpackPlugin</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;clean-webpack-plugin&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&quot;./&quot;</span>,<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./build&quot;</span>),<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].[hash:6].bundle.js&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InlineChunkHtmlPlugin</span>(<span class="hljs-title class_">HtmlWebpackPlugin</span>, [<span class="hljs-regexp">/runtime.*\.js/</span>]),<br>  ],<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° runtime æ–‡ä»¶çš„ä»£ç è¢« inline åˆ° html ä¸­äº†, æˆªå–äº†éƒ¨åˆ†ä»£ç , å®Œæ•´ä¾‹å­å¯ä»¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç  p4.</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1668701277710_2858.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªé—®é¢˜:</p><ol><li><strong>InlineChunkHtmlPlugin</strong>ä¸ä¼šåˆ é™¤ inline åçš„æ–‡ä»¶, éœ€è¦æ‰‹åŠ¨åˆ é™¤</li></ol><h3 id="npm-package-using-webpack"><a class="markdownIt-Anchor" href="#npm-package-using-webpack"></a> npm package using webpack</h3><p>webpack åŒæ ·å¯ä»¥ç”¨äºæ‰“åŒ…ä»£ç ä½œä¸ºç¬¬ä¸‰æ–¹åº“æ–‡ä»¶, åªéœ€è¦å¯¹æ·»åŠ å°‘é‡é…ç½®. <s>è™½ç„¶ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ rollup æ‰“åŒ…</s></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./lib/index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./dist&quot;</span>),<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;bundle.js&quot;</span>,<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&quot;umd&quot;</span>,<br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&quot;math&quot;</span>,<br>    <span class="hljs-attr">globalObject</span>: <span class="hljs-string">&quot;this&quot;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªæ˜¯å¯¹<strong>output</strong>å¢åŠ äº†ä¸‰ä¸ªå±æ€§:</p><ul><li><strong>libraryTarget</strong>: æ‰“åŒ…äº§ç‰©éµå®ˆå“ªç§æ¨¡å—å¯¼å…¥è§„åˆ™, ä¸€èˆ¬éƒ½æ˜¯<code>umd</code>, å³<strong>universal module defination</strong>æ”¯æŒ<code>esm | amd | cmd | commonjs</code>æ‰€æœ‰è§„åˆ™å¯¼å…¥.</li><li><strong>library</strong>: æŒ‚è½½åœ¨å…¨å±€å¯¹è±¡çš„å¯¹è±¡å, è¿™é‡Œä¸¾ä¾‹ math, æµè§ˆå™¨ä¸­å°±å¯é€šè¿‡<code>window.math</code>è®¿é—®.</li><li><code>globalObject</code>: ä¸€èˆ¬éƒ½ç”¨<code>this</code>, this é»˜è®¤æ ¹æ®ä¸åŒç¯å¢ƒè¡¨ç¤ºä¸åŒçš„å…¨å±€å˜é‡ window æˆ– global, ä¹Ÿå¯ä»¥è®¾ç½®æˆ document.</li></ul><p>è¿™é‡Œç®€å•å°†ä¸¤ä¸ªå‡½æ•°æ‰“åŒ…ä¸º npm åŒ…:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num1, num2</span>) &#123;<br>  <span class="hljs-keyword">return</span> num1 + num2;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">minus</span>(<span class="hljs-params">num1, num2</span>) &#123;<br>  <span class="hljs-keyword">return</span> num1 - num2;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ä¸º umd æ–‡ä»¶å, å„ç§ç¯å¢ƒä¸‹ä¸åŒè§„åˆ™å¼•ç”¨çš„å…è®¸æƒ…å†µ:</p><p>æµè§ˆå™¨:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1668872875364_7197.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>commonjs:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1668872961970_6136.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>esm:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1668873018807_3447.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°éƒ½èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ.</p><p>æœ€åçœ‹ä¸‹ umd å½¢å¼æ‰“åŒ…äº§ç‰©æ˜¯å¦‚ä½•é€‚é…ä¸åŒæ¨¡å—å¯¼å…¥è§„åˆ™çš„; æ–‡ä»¶å¼€å¤´å°±èƒ½çœ‹åˆ°ä¼šé€šè¿‡åˆ¤æ–­ä¸åŒæ¨¡å—è§„åˆ™ä¸­ç‰¹æœ‰çš„æ ‡é‡å¦‚<code>module</code>, <code>define</code>ç­‰æ¥åˆ¤æ–­æ˜¯å“ªç§å¯¼å…¥è§„åˆ™, ä»è€Œå°†å…¥å£æ–‡ä»¶æŒ‚è½½åˆ°å¯¹åº”çš„å¯¹è±¡ä¸Š.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-keyword">function</span> (<span class="hljs-params">e, t</span>) &#123;<br>  <span class="hljs-string">&quot;object&quot;</span> == <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">exports</span> &amp;&amp; <span class="hljs-string">&quot;object&quot;</span> == <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">module</span><br>    ? (<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">t</span>())<br>    : <span class="hljs-string">&quot;function&quot;</span> == <span class="hljs-keyword">typeof</span> define &amp;&amp; define.<span class="hljs-property">amd</span><br>    ? <span class="hljs-title function_">define</span>([], t)<br>    : <span class="hljs-string">&quot;object&quot;</span> == <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">exports</span><br>    ? (<span class="hljs-built_in">exports</span>.<span class="hljs-property">math</span> = <span class="hljs-title function_">t</span>())<br>    : (e.<span class="hljs-property">math</span> = <span class="hljs-title function_">t</span>());<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day10">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day10</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://purgecss.com/plugins/webpack.html">purgecss in webpack</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(9)</title>
    <link href="/2022/10/09/2022-10-09-study-webpack-day9/"/>
    <url>/2022/10/09/2022-10-09-study-webpack-day9/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="prefetch-preload"><a class="markdownIt-Anchor" href="#prefetch-preload"></a> prefetch &amp; preload</h2><p>é¢„è·å–(prefetch)çš„å«ä¹‰æ˜¯åœ¨å½“å‰è·¯ç”±ä¸‹åŠ è½½å°†æ¥å…¶ä»–è·¯ç”±å¯èƒ½éœ€è¦çš„èµ„æº, åœ¨<strong>vue-router</strong>ä¸­å°±ç»å¸¸è§åˆ°, æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦åŠ è½½æ‰€æœ‰çš„è·¯ç”±èµ„æº, åªéœ€è¦åŠ è½½å½“å‰è·¯ç”±éœ€è¦çš„èµ„æº; é…ç½®<strong>prefetch</strong>å¯ä»¥åœ¨åŠ è½½å®Œå½“å‰è·¯ç”±æ‰€éœ€èµ„æºå, ç”±æµè§ˆå™¨å†³å®šä½•æ—¶åŠ è½½è®¾ç½® prefetch çš„èµ„æº, ä»è€Œå®ç°è·¯ç”±æ‡’åŠ è½½.</p><p>webpack ä¸­å¯¹åŠ¨æ€ import çš„èµ„æºæ·»åŠ  prefetch:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">import</span>(<br>  <span class="hljs-comment">/* webpackPrefetch: true */</span> <span class="hljs-comment">/* webpackChunkName: &#x27;foo&#x27; */</span> <span class="hljs-string">&quot;./foo.js&quot;</span><br>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);<br>&#125;);<br></code></pre></td></tr></table></figure><p>èµ„æºåŠ è½½é¡ºåº:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665386744854_4322.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>é€šè¿‡é€šè¿‡æµè§ˆå™¨ network å¯ä»¥çœ‹åˆ°åœ¨åŠ è½½å®Œå½“å‰æ‰€éœ€èµ„æºåæ‰ä¼šå»åŠ è½½<strong>foo.js</strong>.</p><p>é¢„åŠ è½½(preload)ä¼šåœ¨å½“å‰è·¯ç”±ä¸‹åŠ è½½<strong>å½“å‰è·¯ç”±</strong>å¯èƒ½éœ€è¦çš„èµ„æº, è¿™ç‚¹å¯èƒ½ä¸å¥½ç†è§£, å¯ä»¥å‚è€ƒ<a href="http://www.alloyteam.com/2016/05/preload-what-is-it-good-for-part1/">è¿™ç¯‡æ–‡ç« </a>ä¸­ä¸¾å‡ºçš„æ¡ˆä¾‹, ä¸»è¦ç”¨äºæ€§èƒ½ä¼˜åŒ–, å°†å½“å‰è·¯ç”±è¦åŠ è½½çš„èµ„æºè®¾ç½®<strong>preload</strong>æå‰åŠ è½½.</p><p>webpack ä¹Ÿæ˜¯é€šè¿‡ magic comment çš„æ–¹å¼é…ç½® preload:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">import</span>(<br>  <span class="hljs-comment">/* webpackPreload: true */</span> <span class="hljs-comment">/* webpackChunkName: &#x27;foo&#x27; */</span> <span class="hljs-string">&quot;./foo.js&quot;</span><br>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);<br>&#125;);<br></code></pre></td></tr></table></figure><p>preload å’Œ prefetch é•¿å¾—å¾ˆåƒ, å«ä¹‰å´å®Œå…¨ä¸ä¸€æ ·, webpack å¯¹ä¸¤è€…åšå‡ºä»¥ä¸‹æ€»ç»“:</p><ul><li>preload chunk ä¼šåœ¨çˆ¶ chunk æ¶å­å•Šæ—¶, ä»¥å¹¶è¡Œæ–¹å¼å¼€å§‹åŠ è½½; prefetch chunk ä¼šåœ¨çˆ¶ chunk åŠ è½½ç»“æŸåå¼€å§‹åŠ è½½.</li><li>preload chunk å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§, å¹¶ç«‹å³ä¸‹è½½; prefetch chunk åœ¨æµè§ˆå™¨é—²ç½®æ—¶ä¸‹è½½.</li><li>preload chunk ç”¨äºå½“ä¸‹æ—¶åˆ»; prefetch chunk ç”¨äºæœªæ¥æŸä¸ªæ—¶åˆ».</li><li>æµè§ˆå™¨æ”¯æŒç¨‹åº¦ä¸åŒ.</li></ul><h2 id="runtimechunk"><a class="markdownIt-Anchor" href="#runtimechunk"></a> runtimeChunk</h2><p>type: <code>boolean | string | object</code><br />é»˜è®¤æƒ…å†µä¸‹ webpack ä¼šå°† runtime ç›¸å…³çš„ä»£ç æ‰“åŒ…åˆ°ä¸»æ¨¡å—ä¸­, å¯ä»¥é€šè¿‡é…ç½®<code>optimization.runtimeChunk</code>å°† runtime ç›¸å…³ä»£ç æŠ½ç¦»åˆ°å•ç‹¬çš„ chunk ä¸­.</p><p>ä»€ä¹ˆæ˜¯ runtime ä»£ç ?<br />runtime ç›¸å…³çš„ä»£ç å€¼çš„æ˜¯åœ¨è¿è¡Œç¯å¢ƒä¸­å¯¹æ¨¡å—è¿›è¡Œè§£æ, åŠ è½½æ¨¡å—ä¿¡æ¯ç›¸å…³çš„ä»£ç ; ä¸å¦‚<code>import()</code>å‡½æ•°å¼‚æ­¥åŠ è½½æ¨¡å—ä»£ç å°±æ˜¯é€šè¿‡ runtime ä»£ç å®Œæˆçš„.</p><p>webpack é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>webpack ä¸­é…ç½® runtimeChunk ä¸º<code>true</code>å’Œ<code>'multiple'</code>æ˜¯ä¸€æ ·çš„, éƒ½ä¼šæ ¹æ®å…¥å£æ–‡ä»¶ç”Ÿæˆå¯¹åº”ä¸ªæ•°çš„ runtime æ–‡ä»¶.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">build<br>â”œâ”€â”€ foo.07cb3e.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.07cb3e.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â”œâ”€â”€ main.07cb3e.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ runtime~index.07cb3e.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â””â”€â”€ runtime~main.07cb3e.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç”Ÿæˆä¸¤ä¸ª runtime æ–‡ä»¶.<br />å¦‚æœåªæƒ³ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶, é…ç½® runtimeChunk ä¸º<code>'single'</code>å³å¯.<br />runtimeChunk çš„å€¼è¿˜èƒ½å¤Ÿé…ç½®ä¸ºå¯¹è±¡, å…·ä½“å‚è€ƒå®˜ç½‘.</p><h2 id="externals"><a class="markdownIt-Anchor" href="#externals"></a> externals</h2><p>çœŸå®å¼€å‘ä¸­, ä¼šå¼•ç”¨éå¸¸å¤šçš„ç¬¬ä¸‰æ–¹åº“, åœ¨æ‰“åŒ…æ—¶è¿™äº›åº“ä»£ç ä¹Ÿä¼šæ‰“åŒ…æˆäº§ç‰©, æœ€åå°†æ‰“åŒ…äº§ç‰©ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­; ä¸ºäº†ä¼˜åŒ–æ€§èƒ½, æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ webpack ä¸­é…ç½®<code>externals</code>æŒ‡å®šæŸäº› npm åŒ…ä¸å‚ä¸æ‰“åŒ…, è€Œæ˜¯é€šè¿‡ cdn é“¾æ¥çš„æ–¹å¼å¼•å…¥, ä»è€ŒåŠ å¿«æ‰“åŒ…æ•ˆç‡ä»¥åŠè®¿é—®é¡µé¢é€Ÿç‡.</p><p>éšä¾¿å¼•å…¥ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash&quot;</span>;<br><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;moment&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;lodash:&quot;</span>, _.<span class="hljs-title function_">join</span>([<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>], <span class="hljs-string">&quot; &quot;</span>));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;moment:&quot;</span>, <span class="hljs-title function_">moment</span>().<span class="hljs-title function_">format</span>());<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹æ²¡æœ‰é…ç½®æ²¡æœ‰é…ç½® externals, é…ç½®<code>optimization.splitChunks</code>çš„é»˜è®¤æƒ…å†µä¸‹æ‰“åŒ…ç»“æœ:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665390968154_8441.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°åº“æºç æ‰“åŒ…æˆ bundle, æ€»ç”¨æ—¶<strong>webpack 5.74.0 compiled with 3 warnings in 4301 ms</strong></p><p>é…ç½® externals:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">externals</span>: &#123;<br>    <span class="hljs-attr">lodash</span>: <span class="hljs-string">&quot;_&quot;</span>,<br>    <span class="hljs-attr">moment</span>: <span class="hljs-string">&quot;moment&quot;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ key ä¸ºåŒ…åä¸éš¾ç†è§£, <strong>å€¼éœ€è¦æ˜¯ CDN é“¾æ¥ä¸­æš´éœ²ç»™ window çš„å˜é‡å</strong>, è¿™æ„å‘³ç€é¡¹ç›®é¡¹ç›®ä»£ç ä¸­ä¸èƒ½éšæ„å®šä¹‰ import çš„å˜é‡å.</p><p>å…¥å£æ–‡ä»¶, è¿™é‡Œè§£æ„å¼•å…¥ä¹Ÿæ˜¯å¯ä»¥çš„, æ‰“åŒ…ä¹‹åçš„ä»£ç å®é™…ä¸Šå’Œæ˜¯å¦è§£æ„å¼•å…¥å…³ç³»ä¸å¤§:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash&quot;</span>;<br><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;moment&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;lodash:&quot;</span>, _.<span class="hljs-title function_">join</span>([<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>], <span class="hljs-string">&quot; &quot;</span>));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;moment:&quot;</span>, <span class="hljs-title function_">moment</span>().<span class="hljs-title function_">format</span>());<br></code></pre></td></tr></table></figure><p>é…ç½® externals çš„æ‰“åŒ…ç»“æœ:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">build<br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â””â”€â”€ main.<span class="hljs-property">af547e</span>.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åº“æºç æ²¡æœ‰å†è¿›è¡Œæ‰“åŒ…äº†, æ€»ç”¨æ—¶<strong>webpack 5.74.0 compiled successfully in 334 ms</strong>.</p><p>ç”±äºåº“ä»£ç æ²¡æœ‰è¢«æ‰“åŒ…, æ­¤æ—¶é¡µé¢è‚¯å®šæ˜¯ä¸èƒ½æ­£å¸¸è¿è¡Œçš„, éœ€è¦åœ¨ html æ–‡ä»¶ä¸­æ’å…¥å¯¹åº”çš„ cdn é“¾æ¥, å¯ä»¥åœ¨<a href="https://www.jsdelivr.com/">jsdelivr</a>sh ä¸Šæœç´¢, å…³äºæš´éœ²ç»™ window çš„å˜é‡, é€šè¿‡å¯¹åº”å®˜ç½‘æŸ¥è¯¢æˆ–æŸ¥è¯¢æœªå‹ç¼©çš„æºç .</p><p>é…ç½® cdn é“¾æ¥:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Webpack App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width,initial-scale=1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span>=<span class="hljs-string">&quot;defer&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;main.af547e.bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665401524177_2227.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="shimming"><a class="markdownIt-Anchor" href="#shimming"></a> shimming</h2><p>å«ç‰‡, æ¯”å¦‚ç°åœ¨ä¾èµ–ä¸€ä¸ªåº“, å¯ä»¥ä¸é€šè¿‡ import æˆ– require å¼•å…¥, ç›´æ¥é€šè¿‡<code>ProvidePlugin</code>é…ç½® shimming æ¥ç›´æ¥ä½¿ç”¨, å…·ä½“å‚è€ƒ<a href="https://www.webpackjs.com/plugins/provide-plugin/">å®˜ç½‘</a><br />å½“ç„¶ webpack å¹¶ä¸æ¨èéšæ„ä½¿ç”¨ shimming, webpack ç†å¿µæ˜¯ä½¿å‰ç«¯æ›´åŠ æ¨¡å—åŒ–, ä¹Ÿå°±æ˜¯ç¼–å†™å…·æœ‰å°é—­æ€§çš„, ä¸å­˜åœ¨éšå«ä¾èµ–(æ¯”å¦‚å…¨å±€å˜é‡çš„)çš„å½¼æ­¤éš”ç¦»çš„æ¨¡å—.</p><p>webpack å†…ç½®<strong>ProvidePlugin</strong>æ’ä»¶, æ— éœ€é¢å¤–å®‰è£…. ä½¿ç”¨<strong>ProvidePlugin</strong>å°±ä¸éœ€è¦åˆ°å¤„<code>import</code>ç›¸åŒæ¨¡å—.</p><p>é…ç½®, è¿˜å¯ä»¥ç›´æ¥å•ç‹¬é…ç½®å‡½æ•°:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProvidePlugin</span>(&#123;<br>      <span class="hljs-attr">_</span>: <span class="hljs-string">&quot;lodash&quot;</span>,<br>      <span class="hljs-attr">moment</span>: <span class="hljs-string">&quot;moment&quot;</span>,<br>      <span class="hljs-attr">_map</span>: [<span class="hljs-string">&quot;lodash&quot;</span>, <span class="hljs-string">&quot;map&quot;</span>],<br>    &#125;),<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…¥å£æ–‡ä»¶, æ²¡æœ‰<code>import</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;lodash:&quot;</span>, _.<span class="hljs-title function_">join</span>([<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>], <span class="hljs-string">&quot; &quot;</span>));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;moment:&quot;</span>, <span class="hljs-title function_">moment</span>().<span class="hljs-title function_">format</span>());<br><span class="hljs-title function_">_map</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…äº§ç‰©ä¼šåŒ…å«<strong>ProvidePlugin</strong>ä¸­é…ç½®çš„åº“æ–‡ä»¶, æŸ¥çœ‹æ§åˆ¶å°æ‰“å°æ­£å¸¸:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665420147423_5358.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="minicssextractplugin"><a class="markdownIt-Anchor" href="#minicssextractplugin"></a> MiniCssExtractPlugin</h2><p>å°† css å•ç‹¬æ‰“åŒ…æ–‡ä»¶.<br />ä¹‹å‰æˆ‘ä»¬è§£æ css æ–‡ä»¶æœ€åéƒ½æ˜¯ä½¿ç”¨ <strong>style-loader</strong> é€šè¿‡<code>&lt;style&gt;</code>æ ‡ç­¾æ’å…¥ header, ç”Ÿäº§ç¯å¢ƒä¸‹æ›´è¶‹å‘äºå•ç‹¬æ‰“åŒ… css èµ„æº; éœ€è¦ä¾èµ–<strong>MiniCssExtractPlugin</strong>æ’ä»¶</p><p>å®‰è£…:</p><p><code>yarn add -D mini-css-extract-plugin</code></p><p>åœ¨ webpack ä¸­é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-attr">module</span>: &#123;<br>      <span class="hljs-attr">rules</span>: [<br>        &#123;<br>          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>          <span class="hljs-attr">use</span>: [<span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-string">&quot;css-loader&quot;</span>],<br>        &#125;,<br>      ],<br>    &#125;,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-comment">//...</span><br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>(&#123;<br>        <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].[contenthash:6].css&quot;</span>,<br>      &#125;),<br>    ],<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ›´å¤šçš„æˆ‘ä»¬å¸Œæœ›åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨<strong>style-loader</strong>, ç”Ÿäº§ç¯å¢ƒä½¿ç”¨<strong>MiniCssExtractPlugin.loader</strong>, å¯ä»¥é€šè¿‡ env åŒºåˆ†:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs diff">module.exports = (env) =&gt; &#123;<br><span class="hljs-addition">+ const isDevelopment = !env.production;</span><br>  return &#123;<br>    //...<br>    module: &#123;<br>      rules: [<br>        &#123;<br>          test: /\.css$/,<br>          use: [<br><span class="hljs-deletion">-           MiniCssExtractPlugin.loader,</span><br><span class="hljs-addition">+           isDevelopment ? &#x27;style-loader&#x27; : MiniCssExtractPlugin.loader,</span><br>            &#x27;css-loader&#x27;,<br>          ],<br>        &#125;<br>      ]<br>    &#125;,<br>    plugins: [<br>  //...<br>      new MiniCssExtractPlugin(&#123;<br>        filename: &#x27;[name].[contenthash:6].css&#x27;<br>      &#125;),<br>    ],<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="hash"><a class="markdownIt-Anchor" href="#hash"></a> hash</h2><p>è®¾ç½® filename æ—¶, webpack æä¾›äº†<strong>hash</strong>, <strong>chunkhash</strong>, <strong>contenthash</strong>ä¸‰ç§å“ˆå¸Œå€¼, å…·ä½“å«ä¹‰å‚è€ƒ<a href="https://www.cnblogs.com/skychx/p/webpack-hash-chunkhash-contenthash.html">webpack ä¸­ï¼Œhashã€chunkhashã€contenthash çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a> è¿™ç¯‡æ–‡ç« å·²ç»å†™çš„å¾ˆè¯¦ç»†äº†, æ€»ç»“æ¥è¯´: å…¥å£æ–‡ä»¶åç”¨<strong>chunkhash</strong>, æ¨¡å—æ–‡ä»¶åç”¨<strong>contenthash</strong>.</p><h2 id="dll-è‡ªå¸¦-cache"><a class="markdownIt-Anchor" href="#dll-è‡ªå¸¦-cache"></a> DLL -&gt; è‡ªå¸¦ cache</h2><p>Dynamic Link Library, åŠ¨æ€é“¾æ¥åº“, è¿™æ˜¯ wiki ä¸Šçš„å«ä¹‰. åœ¨ webpack ä¸­æŒ‡å°†ä¸å¸¸ç”¨çš„ä»£ç æ‰“åŒ…æˆåº“æ–‡ä»¶, å¯å…±äº«ç”¨äºåˆ«çš„é¡¹ç›®ä»£ç ä¸­. <strong>webpack4 ä¹‹å React/Vue éƒ½ä¸å†ä½¿ç”¨ DLL, å› ä¸º webpack çš„æ€§èƒ½è¶³å¤Ÿä¼˜ç§€, ä¸éœ€è¦å†ä½¿ç”¨ DLL æ–‡ä»¶</strong>, è¿™é‡Œåšäº†è§£å³å¯. å¦‚æœå®é™…å¼€å‘ä¸­çœŸçš„è¦ç”¨åˆ°ä¹Ÿå»ºè®®ä½¿ç”¨<code>autodll-webpack-plugin</code>.</p><p>å®é™…ä¸Š webpack4 ä¸­å­˜åœ¨<code>hard-source-webpack-plugin</code>åº“åšç¼“å­˜, ç¬¬ä¸€æ¬¡è¿è¡Œæ„å»ºæ—¶é—´æ…¢, åç»­æ„å»ºå°±å¾ˆå¿«äº†.<br />webpack5 å†…ç½®äº†<strong>cache</strong>é…ç½®åšç¼“å­˜ä¼˜åŒ–æ„å»ºæ—¶é—´, åŒæ ·ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ„å»ºæ—¶é—´è¾ƒæ…¢, åç»­å¿«.<br />ç¼“å­˜<strong>module</strong>å’Œ<strong>chunk</strong>ç›®å½•é»˜è®¤ä¸º<code>node_modules/.cache/webpack/default-production**</code>, å¯ä»¥é€šè¿‡ä¿®æ”¹<strong>name</strong>æ›´æ¢ç›®å½•å</p><p>é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">cache</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;filesystem&quot;</span>,<br>    <span class="hljs-attr">allowCollectingMemory</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="terser"><a class="markdownIt-Anchor" href="#terser"></a> Terser</h2><p>webpack4 ä½¿ç”¨<code>uglify-js</code>(<strong>uglifyjs-webpack-plugin</strong>)æ¥å‹ç¼©, ä¸‘åŒ–ä»£ç , ç›®å‰è¯¥åº“å·²ä¸å†ç»´æŠ¤.<br />webpack5 ä½¿ç”¨<code>terser</code>(<strong>terser-webpack-plugin</strong>)æ¥å¯¹ä»£ç è¿›è¡Œå‹ç¼©ä¸‘åŒ–; <code>terser</code>æœ¬å°±æ˜¯ç”±<code>uglify-js</code>fork è€Œæ¥, æ‰€ä»¥ä¿ç•™äº†<code>uglify-js</code>å¤§éƒ¨åˆ†çš„ API ç”¨æ³•.</p><p><code>terser</code>å¯ä»¥åœ¨ç»ˆç«¯å•ç‹¬ä½¿ç”¨, é¦–å…ˆå®‰è£…:</p><p><code>yarn add -D terser</code></p><p>æ‰§è¡Œ</p><p><code>npx terser input.js -o output.js -c -m</code></p><p>é»˜è®¤<code>terser</code>çš„è¾“å‡ºæ–‡ä»¶åªä¼šå°†å¤šä½™ç©ºæ ¼å³æ¢è¡Œå»é™¤, å¦‚æœéœ€è¦è¿›è¡Œå‹ç¼©, ä¸‘åŒ–, ä¿ç•™å‡½æ•°å, ä¿ç•™ç±»å, å»é™¤åƒµå°¸ä»£ç ç­‰, å¯ä»¥å‚è€ƒ<a href="https://github.com/terser/terser">å®˜ç½‘</a>å¯¹åº”é…ç½®</p><p>æ¥ä¸‹æ¥çœ‹ä¸‹ webpack ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨<code>terser</code>çš„:<br />webpack å†…ç½®äº†<strong>terser-webpack-plugin</strong>æ’ä»¶è¿›è¡Œä¸Šè¿°æ“ä½œ.<br />äº‹å®ä¸Š, åœ¨çœŸå®å¼€å‘ä¸­ä¸ª, åœ¨ production ä¸‹, é»˜è®¤ä¼šå¼€å¯ terser æ’ä»¶å¤„ç†ä»£ç ;<br />å¦‚æœå¯¹é»˜è®¤çš„é…ç½®ä¸æ»¡æ„, å¯ä»¥åœ¨<code>optimization.minimizer</code>ä¸­é…ç½®, è¿™é‡Œåˆ—å‡º webpack å®˜ç½‘çš„é…ç½®ç¤ºä¾‹, å…¶ä¸­<strong>deprecate</strong>çš„æŒªåˆ° compress å¯¹è±¡ä¸­é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">minimizer</span>: [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>        <span class="hljs-attr">terserOptions</span>: &#123;<br>          <span class="hljs-attr">ecma</span>: <span class="hljs-literal">undefined</span>,<br>          <span class="hljs-attr">parse</span>: &#123;&#125;,<br>          <span class="hljs-attr">compress</span>: &#123;&#125;,<br>          <span class="hljs-attr">mangle</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Note `mangle.properties` is `false` by default.</span><br>          <span class="hljs-attr">module</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-comment">// Deprecated</span><br>          <span class="hljs-attr">output</span>: <span class="hljs-literal">null</span>,<br>          <span class="hljs-attr">format</span>: <span class="hljs-literal">null</span>,<br>          <span class="hljs-attr">toplevel</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-attr">nameCache</span>: <span class="hljs-literal">null</span>,<br>          <span class="hljs-attr">ie8</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-attr">keep_classnames</span>: <span class="hljs-literal">undefined</span>,<br>          <span class="hljs-attr">keep_fnames</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-attr">safari10</span>: <span class="hljs-literal">false</span>,<br>        &#125;,<br>      &#125;),<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…·ä½“å­—æ®µå«ä¹‰å’Œ<code>terser</code>å‚æ•°ä¸€è‡´, å‚è€ƒ<a href="https://github.com/terser/terser">å®˜ç½‘</a>.<br />è¿™é‡Œåªä»‹ç»ä¸€ä¸ªå¯¹åšä¸»å®é™…å·¥ä½œä¸­å¾ˆæœ‰ç”¨çš„é…ç½®<strong>dead_code</strong>, è¯¥é…ç½®å«ä¹‰æ˜¯ remove unreachable code, å³åˆ é™¤æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„é€»è¾‘, é»˜è®¤å€¼ä¸º<code>true</code>, ä¸ç”¨æ‰‹åŠ¨è®¾ç½®.<br />ä¸¾ä¸ªå®é™…æ¡ˆä¾‹, å¦‚æœæœ‰æ®µé€»è¾‘, éœ€è¦åœ¨æ­£å¼ç¯å¢ƒæ‰§è¡Œ, ä¸æƒ³åœ¨å¼€å‘ç¯å¢ƒæ‰§è¡Œ, å¹¶ä¸”ä¸æƒ³ç”Ÿæˆ dead_code, å¯ä»¥æ€ä¹ˆåšå‘¢?</p><p>åœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥è¯¥é€»è¾‘:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;can reach here!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>webpack ä¸­é…ç½®<strong>DefinePlugin</strong>å’Œ<strong>TerserPlugin</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;production&quot;</span>,<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefinePlugin</span>(&#123;<br>      <span class="hljs-string">&quot;process.env.NODE_ENV&quot;</span>: <span class="hljs-string">&#x27;&quot;production&quot;&#x27;</span>,<br>    &#125;),<br>  ],<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimizer</span>: [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>        <span class="hljs-comment">//...</span><br>      &#125;),<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ç»“æœå¯ä»¥çœ‹åˆ°å¯¹åº”ä»£ç æœ‰å‚ä¸æ‰“åŒ…:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665717927158_90.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>æŠŠç¯å¢ƒæ”¹ä¸ºå¼€å‘ç¯å¢ƒ:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs diff">module.exports = &#123;<br><span class="hljs-deletion">-  mode: &#x27;production&#x27;,</span><br><span class="hljs-addition">+  mode: &#x27;development&#x27;,</span><br>  //...<br>  plugins: [<br>    //...<br>    new DefinePlugin(&#123;<br><span class="hljs-deletion">-      &#x27;process.env.NODE_ENV&#x27;: &#x27;&quot;production&quot;&#x27;,</span><br><span class="hljs-addition">+      &#x27;process.env.NODE_ENV&#x27;: &#x27;&quot;development&quot;&#x27;,</span><br>    &#125;),<br>  ],<br>  optimization: &#123;<br>    minimizer: [<br>      new TerserPlugin(&#123;<br>        //...<br>      &#125;)<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹åº”ä»£ç .</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665718100334_3984.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="css-compress"><a class="markdownIt-Anchor" href="#css-compress"></a> Css Compress</h2><p>é™¤äº† js å‹ç¼©å¤–, å¦å¤–ä¸€ç§æœ€å¸¸è§çš„ä»£ç å‹ç¼©æ˜¯ css; css å‹ç¼©é€šå¸¸æ˜¯å»é™¤æ— ç”¨çš„ç©ºæ ¼, æ— æ³•åšä¸‘åŒ–, å› ä¸ºå¾ˆéš¾ä¿®æ”¹é€‰æ‹©å™¨, å±æ€§åç§°ç­‰.<br />css å‹ç¼©ä½¿ç”¨<code>css-minimizer-webpack-plugin</code>æ’ä»¶, å’Œ<code>mini-css-extract-plguin</code>å•ç‹¬ç”Ÿæˆ css æ–‡ä»¶ä¸€èµ·ä½¿ç”¨.</p><h2 id="scope-hoisting"><a class="markdownIt-Anchor" href="#scope-hoisting"></a> Scope Hoisting</h2><p>ä½œç”¨åŸŸæå‡. æœ€æ™®éçš„ä¾‹å­å°±æ˜¯å¯¼å…¥çš„æ¨¡å—ç”Ÿæˆæ‰“åŒ…äº§ç‰©ä¼šç”Ÿæˆå¤§é‡ IIFE å‡½æ•°å¦‚[[2022-09-15-study-webpack-day5#CommonJS æ¨¡å—åŒ–å®ç°åŸç†]]ä¸­çš„<code>__webpack_exports__</code>, ä½œç”¨åŸŸæå‡ç”¨äºåˆ é™¤æ— ç”¨çš„ IIFE å‡½æ•°åŒ…è£¹, è¿›ä¸€æ­¥å‡å°‘ä»£ç é‡, æå‡è¿è¡Œé€Ÿåº¦. ç”Ÿäº§ç¯å¢ƒä¸‹é»˜è®¤å¼€å¯, å¼€å‘ç¯å¢ƒå¼€å¯éœ€è¦æ‰‹åŠ¨é…ç½®.</p><p>webpack é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">plugins</span>: [webpack.<span class="hljs-property">optimization</span>.<span class="hljs-title class_">ModuleConcatenationPlugin</span>()];<br></code></pre></td></tr></table></figure><p>è¯¥æ’ä»¶å†…éƒ¨ä¾èµ– ESM é™æ€åˆ†æ, æ‰€ä»¥å¯¼å…¥æ¨¡å—æ—¶æœ€å¥½éƒ½ä½¿ç”¨ ESM import.</p><p>å¼€å¯å‰:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1666526652002_3241.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¼€å¯å:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1666526769317_1254.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°å¼€å¯ä½œç”¨åŸŸå‰åçš„äº§ç‰©å¤§å°æå‡è¿˜æ˜¯éå¸¸å¤§çš„</p><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day9">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day9</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://www.cnblogs.com/skychx/p/webpack-hash-chunkhash-contenthash.html">webpack ä¸­ï¼Œhashã€chunkhashã€contenthash çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="https://juejin.cn/post/6844903952140468232">è¾›è¾›è‹¦è‹¦å­¦ä¼šçš„ webpack dll é…ç½®ï¼Œå¯èƒ½å·²ç»è¿‡æ—¶äº†</a></li><li><a href="https://webpack.js.org/configuration/cache/#cache">webpack5 ä¸­çš„ cache é…ç½®æ›¿ä»£ hard-source-webpack-plugin</a></li><li><a href="https://github.com/terser/terser">terser å‚æ•°é…ç½®</a></li><li><a href="https://zhuanlan.zhihu.com/p/348612482">Webpack5 æ–°ç‰¹æ€§ä¸šåŠ¡è½åœ°å®æˆ˜</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(8)</title>
    <link href="/2022/10/05/2022-10-05-study-webpack-day8/"/>
    <url>/2022/10/05/2022-10-05-study-webpack-day8/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="é…ç½®åŒºåˆ†ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#é…ç½®åŒºåˆ†ç¯å¢ƒ"></a> é…ç½®åŒºåˆ†ç¯å¢ƒ</h2><p>é’ˆå¯¹å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ, å¯ä»¥æŠ½ç¦»ä¸åŒç¯å¢ƒç‰¹å®šçš„é…ç½®å’Œå…¬å…±é…ç½®, é’ˆå¯¹ä¼ å…¥çš„ç¯å¢ƒå‚æ•°ç”Ÿæˆä¸åŒçš„é…ç½®.</p><p>é¦–å…ˆåœ¨<strong>config</strong>ç›®å½•ä¸‹æ–°å»ºé€šç”¨é…ç½®æ–‡ä»¶, ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶, å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶. ç°å°†åŸå…ˆ<strong>webpack.config.js</strong>çš„å†…å®¹å¤åˆ¶åˆ°<strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">config<br>â”œâ”€â”€ webpack.<span class="hljs-property">common</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ webpack.<span class="hljs-property">dev</span>.<span class="hljs-property">js</span><br>â””â”€â”€ webpack.<span class="hljs-property">prod</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p>webpack é€šè¿‡<code>--config</code>æŒ‡å®šé…ç½®æ–‡ä»¶, é€šè¿‡<code>--env</code>æŒ‡å®šç¯å¢ƒå˜é‡.</p><p>ä¹‹å‰çš„<code>webpack.config.js</code> æ˜¯å¯¼å‡ºä¸€ä¸ªå¯¹è±¡:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡åå¯¼å‡ºå€¼éœ€è¦å˜ä¸ºå‡½æ•°:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">env</span>) &#123;<br>  <span class="hljs-comment">//...</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œ<code>webpack --config ./config/webpack.common.js --env production</code>, å¯ä»¥çœ‹åˆ°ç»ˆç«¯æ‰“å°<code>env</code>è¾“å‡º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123; <span class="hljs-attr">WEBPACK_BUNDLE</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">WEBPACK_BUILD</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">production</span>: <span class="hljs-literal">true</span> &#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå°†å‚æ•°èµ‹å€¼ç»™<code>process.env.NODE_ENV</code>, é€šè¿‡è¿™ç§æ–¹å¼åŒºåˆ†å½“å‰ç¯å¢ƒ, è¿™æ ·<strong>babel.config.js</strong>, <strong>postcss.config.js</strong>ç­‰æ–‡ä»¶ä¹Ÿèƒ½è¿‡è¯»å–ç¯å¢ƒå˜é‡.</p><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯, <code>process.env</code>è®¾ç½®çš„å±æ€§éƒ½ä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸², <code>true</code>-&gt; <code>'true'</code>, <code>undefined</code> -&gt; <code>'undefined'</code>, ä¸èƒ½ç®€å•é€šè¿‡<code>!</code>å…³é”®å­—åˆ¤æ–­, è¿™æ˜¯å®¹æ˜“å¼„é”™çš„åœ°æ–¹.</p><p>ç„¶åå°±æ˜¯æŠ½ç¦»é€šç”¨é…ç½®, å¼€å‘ç¯å¢ƒä½¿ç”¨çš„é…ç½®, ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„é…ç½®, è¿™é‡Œä»¥ä¹‹å‰[[2022-09-30-study-webpack-day7#ç¤ºä¾‹ä»£ç ]]ä¸¾ä¾‹:</p><h2 id="code-splitting"><a class="markdownIt-Anchor" href="#code-splitting"></a> Code splitting</h2><p>ä»£ç æ‹†åˆ†(code splitting)æ˜¯ webpack ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§.<br />ä¸»è¦ç›®çš„æ˜¯å°†ä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­, ä¹‹åæˆ‘ä»¬å¯ä»¥æŒ‰éœ€åŠ è½½, æˆ–è€…å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶; æ¯”å¦‚é»˜è®¤æƒ…å†µä¸‹, æ‰€æœ‰çš„ JavaScript ä»£ç (ä¸šåŠ¡ä»£ç , ç¬¬ä¸‰æ–¹ä»¥æ¥, æš‚æ—¶æ²¡æœ‰ç”¨åˆ°çš„æ¨¡å—) åœ¨é¦–é¡µå…¨éƒ¨åŠ è½½å°±ä¼šå½±å“é¦–é¡µåŠ è½½é€Ÿåº¦;ä»£ç åˆ†ç¦»å¯ä»¥åˆ†å‡ºæ›´å°çš„ bundle, ä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§, æä¾›ä»£ç çš„åŠ è½½æ€§èƒ½</p><p>å…ˆçœ‹ä¸‹æ²¡æœ‰åšä»»ä½•å¤„ç†çš„æ‰“åŒ…ç»“æœ, éšä¾¿å¼•å…¥å‡ ä¸ªç¬¬ä¸‰æ–¹åº“:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;moment&quot;</span>;<br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;moment:&quot;</span>, <span class="hljs-title function_">moment</span>());<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">join</span>([<span class="hljs-string">&quot;mariana&quot;</span>, <span class="hljs-string">&quot;yui&quot;</span>]));<br></code></pre></td></tr></table></figure><p>å¼•å…¥ç¬¬ä¸‰æ–¹åº“æ‰“åŒ…é»˜è®¤ä¼šç”Ÿæˆ LICENSE.txt æ–‡ä»¶, å¯ä»¥å…ˆå¿½ç•¥.<br />å¯ä»¥çœ‹åˆ°æ‰“åŒ…ç»“æœ, ç¬¬ä¸‰æ–¹åº“æºç ä¹Ÿè¢«æ‰“åŒ…è¿›äº†å…¥å£æ–‡ä»¶ä¸­.</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665042596061_6532.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä»£ç åˆ†ç¦»æ¥è¿›è¡Œä¼˜åŒ–,<br />Webpack å¸¸è§çš„ä»£ç åˆ†ç¦»æœ‰ä¸‰ç§:</p><ul><li>å…¥å£èµ·ç‚¹: ä½¿ç”¨ entry é…ç½®æ‰‹åŠ¨åˆ†ç¦»ä»£ç </li><li>é˜²æ­¢é‡å¤: ä½¿ç”¨ Entry Dependencies æˆ–è€… SplitChunksPlugin å»é‡å’Œåˆ†ç¦»ä»£ç </li><li>åŠ¨æ€å¯¼å…¥: é€šè¿‡æ¨¡å—å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç </li></ul><h3 id="å…¥å£èµ·ç‚¹"><a class="markdownIt-Anchor" href="#å…¥å£èµ·ç‚¹"></a> å…¥å£èµ·ç‚¹</h3><p>å½“å•å…¥å£æ–‡ä»¶ä¸­å­˜åœ¨æ²¡æœ‰è€¦åˆå…³ç³»çš„ä»£ç æ—¶, å¯ä»¥é€šè¿‡é…ç½®å¤šä¸ªå…¥å£æ–‡ä»¶æ¥å‡å°å•ä¸ªæ–‡ä»¶çš„ä½“ç§¯.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// index.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello index&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello main&quot;</span>);<br></code></pre></td></tr></table></figure><p>æ‹†åˆ†ä¸º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// index.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello index&quot;</span>);<br><span class="hljs-comment">// main.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello main&quot;</span>);<br></code></pre></td></tr></table></figure><p>é…ç½® entry:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: &#123;<br>    <span class="hljs-attr">index</span>: <span class="hljs-string">&quot;./index.js&quot;</span>,<br>    <span class="hljs-attr">main</span>: <span class="hljs-string">&quot;./main.js&quot;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¸€èˆ¬æƒ…å†µä¸‹ React/Vue æ¡†æ¶çš„ SPA é¡µé¢éƒ½æ˜¯å•å…¥å£æ–‡ä»¶, åœ¨å¤šé¡µé¢æ‰“åŒ…æ—¶æ‰ä¼šä½¿ç”¨è¿™ç§æ–¹æ¡ˆ.</p><h3 id="é˜²æ­¢é‡å¤"><a class="markdownIt-Anchor" href="#é˜²æ­¢é‡å¤"></a> é˜²æ­¢é‡å¤</h3><p>å­˜åœ¨ Enty Dependencies å’Œ SplitChunksPlugin ä¸¤ç§æ–¹æ¡ˆæ¥è¿›è¡Œä»£ç åˆ†ç¦», å…¶ä¸­ç»å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ä½¿ç”¨ SplitChunksPlugin, Entry Dependencies å®˜æ–¹<strong>å¹¶ä¸æ¨è</strong>.</p><h4 id="entry-dependuncies"><a class="markdownIt-Anchor" href="#entry-dependuncies"></a> Entry Dependuncies</h4><p>å¯¹äºå¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“, entry ä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºå…¥å£æ–‡ä»¶, å€¼å¯ä»¥æ˜¯ string æˆ– Array. å¼•ç”¨ç¬¬ä¸‰æ–¹åº“çš„å…¥å£æ–‡ä»¶é…ç½®å’Œä¹‹å‰æœ‰æ‰€å˜åŒ–.</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs diff">module.exports = &#123;<br>  entry: &#123;<br><span class="hljs-deletion">-   index: &#x27;./index.js&#x27;,</span><br><span class="hljs-addition">+   &#x27;index&#x27;: &#123; import: &#x27;./index.js&#x27;, dependOn: &#x27;shared&#x27; &#125;,</span><br>    main: &#x27;./main.js&#x27;,<br><span class="hljs-addition">+   shared: [&#x27;lodash&#x27;, &#x27;moment&#x27;],</span><br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ç»“æœå¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ–¹åº“ä»£ç è¢«å•ç‹¬æ‰“åŒ…äº†.</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1665149736641_3749.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h4 id="splitchunksplugin"><a class="markdownIt-Anchor" href="#splitchunksplugin"></a> SplitChunksPlugin</h4><p>webpack å®˜æ–¹æ¨èé€šè¿‡è¿™ä¸ªæ’ä»¶é…ç½®, é€šè¿‡<strong>optimization.splitChunks</strong>é…ç½®, å®˜æ–¹çš„é…ç½®æ ·ä¾‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">splitChunks</span>: &#123;<br>      <span class="hljs-attr">chunks</span>: <span class="hljs-string">&quot;async&quot;</span>,<br>      <span class="hljs-attr">minSize</span>: <span class="hljs-number">20000</span>,<br>      <span class="hljs-attr">minRemainingSize</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">minChunks</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">30</span>,<br>      <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">30</span>,<br>      <span class="hljs-attr">enforceSizeThreshold</span>: <span class="hljs-number">50000</span>,<br>      <span class="hljs-attr">cacheGroups</span>: &#123;<br>        <span class="hljs-attr">defaultVendors</span>: &#123;<br>          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,<br>          <span class="hljs-attr">priority</span>: -<span class="hljs-number">10</span>,<br>          <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,<br>        &#125;,<br>        <span class="hljs-attr">default</span>: &#123;<br>          <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>,<br>          <span class="hljs-attr">priority</span>: -<span class="hljs-number">20</span>,<br>          <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,<br>        &#125;,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä»‹ç»å…¶ä¸­å¸¸ç”¨çš„é…ç½®å­—æ®µ, å…¶ä½™çš„ä½¿ç”¨é»˜è®¤é…ç½®å³å¯.</p><ul><li><code>chunks</code>: <code>async | initial | all</code>, é»˜è®¤ä¸º<strong>async</strong>, åªé’ˆå¯¹å¼‚æ­¥(<strong>import()</strong> æˆ– <strong>require.ensure</strong> )å¯¼å…¥çš„æ¨¡å—è¿›è¡Œä»£ç åˆ†ç¦»; <strong>initial</strong>åªé’ˆå¯¹åŒæ­¥å¯¼å…¥æ¨¡å—ä»£ç åˆ†ç¦»; <strong>all</strong>å¯¹åŒæ­¥å’Œå¼‚æ­¥å¯¼å…¥çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œä»£ç åˆ†ç¦», ä¸€èˆ¬éƒ½è®¾ç½®ä¸º<strong>all</strong>.</li><li><code>minSize</code>: æ–‡ä»¶å¤§å°(åŒ…æ‹¬å¼•å…¥çš„åŒ…)è¾¾åˆ°<strong>minSize</strong>æ‰ä¼šæ‹†åˆ†</li><li><code>maxSize</code>: å°†å¤§äº<strong>maxSize</strong>çš„æ–‡ä»¶æ‹†åˆ†ä¸ºä¸å°äº<strong>minSize</strong>å¤§å°çš„æ–‡ä»¶, ä¸€èˆ¬ç”¨äºäºŒæ¬¡æ‹†åˆ†ä¿è¯æ¯ä¸ªåŒ…æ–‡ä»¶ä¸ä¼šè¿‡å¤§, ä¸€èˆ¬æƒ…å†µä¸‹<strong>minSize</strong>å’Œ<strong>maxSize</strong>ä½¿ç”¨é»˜è®¤å€¼å³å¯, å³ä½¿æ‰‹åŠ¨è®¾ç½®ä¹Ÿæœ€å¥½ä¿æŒä¸¤è€…ä¸€ç›´. BTW, <strong>minSize</strong>ä¼˜å…ˆçº§å¤§äº<strong>maxSize</strong>, å³ä½¿é…ç½®<strong>maxSize</strong>å°äº<strong>minSize</strong>, å½“ç„¶è¿™æ ·é…ç½®æ˜¯ç»å¯¹é”™è¯¯çš„.</li><li><code>minChunks</code>: é»˜è®¤ä¸º<strong>1</strong>, æ¨¡å—è¢«<strong>minChunks</strong>ä¸ªå…¥å£æ–‡ä»¶å¼•ç”¨æ—¶æ‰ä¼šæ‹†åˆ†, ä¸€èˆ¬éƒ½æ˜¯å•å…¥å£æ–‡ä»¶, ç”¨é»˜è®¤å€¼å³å¯</li><li><code>cacheGroups</code>: é’ˆå¯¹ä¸åŒçš„æ–‡ä»¶å¤¹ä¸‹çš„åŒ…æ–‡ä»¶è¿›è¡Œæ›´ç»†è‡´çš„æ‰“åŒ…é…ç½®, <strong>chunks</strong>, <strong>minChunks</strong>ä¹Ÿå¯åœ¨<strong>cacheGroup</strong>ä¸­ä½¿ç”¨<ul><li><code>test</code>: æ­£åˆ™åŒ¹é…æ–‡ä»¶å¤¹</li><li><code>filename</code>: æ‰“åŒ…çš„æ–‡ä»¶å, é…ç½®å’Œ<code>output.filename</code>ä¸€è‡´</li><li><code>priority</code>: ä¼˜å…ˆçº§, å½“å¤šä¸ª cacheGroup åŒ¹é…ä¸Šæ—¶, ä½¿ç”¨ä¼˜å…ˆçº§æœ€é«˜çš„</li><li><code>reuseExistingChunk</code>: å¦‚æœå½“å‰åŒ…æ–‡ä»¶å·²ç»è¢«æ‰“åŒ…, ç›´æ¥ä½¿ç”¨æ‰“åŒ…æ–‡ä»¶</li></ul></li><li><code>chunkIds</code>: <code>natural | named | deterministic</code>, é»˜è®¤ä¸º<strong>deterministic</strong>, webpack ç”Ÿæˆçš„å”¯ä¸€ id ä½œä¸º filename æˆ– chunkFilename çš„<code>[name]</code>, å¦‚æœæ–‡ä»¶å†…å®¹ä¸å˜, ç”Ÿæˆçš„ id ä¹Ÿä¸ä¼šæ”¹å˜; <code>natural</code> ä½¿ç”¨æ­£æ•´æ•°ä½œä¸º<code>[name]</code>, ä¸åˆ©äºæµè§ˆå™¨ç¼“å­˜, ä¸æ¨è; <code>named</code>, ä½¿ç”¨æ–‡ä»¶çš„è·¯å¾„+æ–‡ä»¶åä½œä¸º<code>[name]</code>, å¼€å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨, è§åçŸ¥æ„.<br />å¯ä»¥çœ‹åˆ°ä½¿ç”¨ä¸åŒ<strong>chunkIds</strong>å€¼æ‰“åŒ…åçš„è¾“å‡º:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// natural</span><br>build<br>â”œâ”€â”€ <span class="hljs-number">2.</span>vendor.<span class="hljs-property">js</span><br>â”œâ”€â”€ <span class="hljs-number">3.098650</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ <span class="hljs-number">4.098650</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â””â”€â”€ main.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br><span class="hljs-comment">// named</span><br>build<br>â”œâ”€â”€ bar1_js.<span class="hljs-property">b89f72</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ bar2_js.<span class="hljs-property">b89f72</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â”œâ”€â”€ main.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â””â”€â”€ vendor-node_modules_lodash_lodash_js-node_modules_moment_locale_af_js-node_modules_moment_loc-65a2e8.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br><span class="hljs-comment">// deterministic</span><br>build<br>â”œâ”€â”€ <span class="hljs-number">351.</span>18c68f.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ <span class="hljs-number">482.</span>vendor.<span class="hljs-property">js</span><br>â”œâ”€â”€ <span class="hljs-number">611.</span>18c68f.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â””â”€â”€ main.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­, å¼‚æ­¥å¯¼å…¥çš„æ–‡ä»¶æ‰“åŒ…æ˜¯ç‰¹æ®Šçš„. æ— è®º<code>chunks</code>é…ç½®ä»€ä¹ˆ, å¼‚æ­¥å¯¼å…¥çš„åŒ…éƒ½ä¼šè¿›è¡Œæ‰“åŒ…, å¹¶ä¸”<code>cacheGroups</code>æ— æ³•è¿›è¡Œé…ç½®, éœ€è¦åœ¨<code>output.chunkFilename</code>é…ç½®.<br />webpack å®˜ç½‘å¯¹<code>output.chunkFilename</code>çš„å®šä¹‰å³:</p><blockquote><p>This option determines the name of non-initial chunk files.</p></blockquote><p><s>æ€ä¹ˆæ ·, ä½  kun å“¥å¼”ä¸å¼”, ä½ å¹²å˜›å“å“Ÿ</s>~<br />ä¸Šè¿°è¾“å‡ºæ˜¯å¯¹<strong>chunkFilename</strong>é…ç½®<code>[name].[hash:6].vendor.js</code>çš„ç»“æœ.</p><h5 id="magic-comment"><a class="markdownIt-Anchor" href="#magic-comment"></a> Magic Comment</h5><p>é™¤äº†<strong>chunkIds</strong>é…ç½®<code>[name]</code>å¤–, webpack æä¾›äº†é­”æ³•æ³¨é‡Š(Magic Comment)è®¾ç½®é¢å¼‚æ­¥å¯¼å…¥æ–‡ä»¶æ‰“åŒ…åçš„<code>[name]</code>, å¹¶ä¸”é­”æ³•æ³¨é‡Šçš„ä¼˜å…ˆçº§æ˜¯<strong>æœ€é«˜çš„</strong>.</p><p>ä¿®æ”¹å…¥å£æ–‡ä»¶å†…å®¹, æ·»åŠ é­”æ³•æ³¨é‡Š:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;foo1&quot; */</span> <span class="hljs-string">&quot;./bar1&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);<br>&#125;);<br><br><span class="hljs-title function_">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;foo2&quot; */</span> <span class="hljs-string">&quot;./bar2&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰“åŒ…ç»“æœ:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">build<br>â”œâ”€â”€ <span class="hljs-number">482.</span>vendor.<span class="hljs-property">js</span><br>â”œâ”€â”€ foo1.<span class="hljs-property">b1a757</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ foo2.<span class="hljs-property">b1a757</span>.<span class="hljs-property">vendor</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br>â”œâ”€â”€ index.<span class="hljs-property">html</span><br>â””â”€â”€ main.<span class="hljs-property">bundle</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p>æœ€åæƒ³è¯´, å…³äº code splitting, å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨å®˜æ–¹é»˜è®¤é…ç½®å³å¯, å³ä½¿æ˜¯ React/Vue æ¡†æ¶æ¤°æ±å¯¹å°éƒ¨åˆ†è¿›è¡Œäº†ä¿®æ”¹:<br /><strong>Vue</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">splitChunks</span>: &#123;<br>    <span class="hljs-attr">vendors</span>: &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;chunk-vendors&#x27;</span>,<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,<br>      <span class="hljs-attr">priority</span>: -<span class="hljs-number">10</span>,<br>      <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;initial&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-attr">common</span>: &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;chunk-common&#x27;</span>,<br>      <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">priority</span>: -<span class="hljs-number">20</span>,<br>      <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;initial&#x27;</span>,<br>      <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>React</strong>æ›´éšä¾¿:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">splitChunks</span>: &#123;<br>    <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day8">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day8</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://webpack.js.org/configuration/output/#outputchunkfilename">webpack å®˜ç½‘å¯¹ chunkFilenam è§£é‡Š</a></li><li><a href="https://juejin.cn/post/7074895794406424583">webpack çš„ MagicCommentsï¼ˆé­”æ³•æ³¨é‡Šï¼‰</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(7)</title>
    <link href="/2022/09/30/2022-09-30-study-webpack-day7/"/>
    <url>/2022/09/30/2022-09-30-study-webpack-day7/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="watch"><a class="markdownIt-Anchor" href="#watch"></a> watch</h2><p>æœ¬èŠ‚ä¹‹å‰å¦‚æœè¦è¿è¡Œæ‰“åŒ…äº§ç‰©, åšä¸»éƒ½éœ€è¦æ‰§è¡Œä¸¤æ­¥:</p><ol><li><code>webpack</code> æ‰“åŒ…ä»£ç </li><li>ä½¿ç”¨ VSCode æ’ä»¶ <a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">live-server</a> æ‰“å¼€ 5500 ç«¯å£æŸ¥çœ‹ç½‘é¡µ</li></ol><p>webpack æä¾›äº†<code>watch</code>å‚æ•°ç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨æ‰§è¡Œæ‰“åŒ…å‘½ä»¤, å¯ä»¥é€šè¿‡:</p><p><code>webpack --watch</code></p><p>æˆ–è€…åœ¨ webpack.config.js ä¸­é…ç½®</p><p><code>watch: true</code></p><p>å³ä½¿è¿™æ ·åšä¾æ—§å­˜åœ¨å‡ ä¸ªé—®é¢˜:</p><ol><li>æ¯æ¬¡å˜æ›´æ—¶éƒ½æ˜¯å…¨éƒ¨æ–‡ä»¶æ‰“åŒ…, æ²¡æœ‰å˜æ›´çš„æ–‡ä»¶ä¹Ÿä¼šé‡æ–°æ‰“åŒ…</li><li>æ‰“åŒ…ç»“æœä¼šå†™å…¥æ–‡ä»¶ç³»ç»Ÿå³æœ¬åœ°ç£ç›˜, è¯»å–æ–‡ä»¶ç³»ç»Ÿé€Ÿç‡ç›¸å¯¹è¾ƒæ…¢</li><li>live-server æ’ä»¶åªèƒ½åœ¨ vscode ä¸­ä½¿ç”¨</li><li>æ¯æ¬¡éƒ½ä¼šåˆ·æ–°æ•´ä¸ªé¡µé¢, æ— æ³•ä¿ç•™é¡µé¢å½“å‰çŠ¶æ€</li></ol><p>é‚£å­˜åœ¨ä¸Šè¿°è¿™äº›é—®é¢˜, æœ‰æ²¡æœ‰å·¥å…·èƒ½å¤Ÿè§£å†³å‘¢? æœ‰çš„.</p><h2 id="webpack-dev-server"><a class="markdownIt-Anchor" href="#webpack-dev-server"></a> webpack-dev-server</h2><p>webpack æä¾›äº†<code>webpack-dev-server</code>å·¥å…·æ¥è§£å†³ä¸Šè¿°é—®é¢˜, æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªé˜è¿°.</p><p>å®‰è£…:</p><p><code>yarn add -D webpack-dev-server</code></p><p>å®‰è£…å®Œ<code>webpack-dev-server</code>åå°±ä¸éœ€è¦å®‰è£…<code>live-server</code>æ’ä»¶, ä¹Ÿä¸éœ€è¦æ‰§è¡Œä¸Šè¿°ä¸¤æ­¥äº†, ç›´æ¥è¿è¡Œ:</p><p><code>webpack serve</code></p><p><code>web-pack-dev-server</code>å†…ç½®äº† express æœåŠ¡ç›‘å¬æ–‡ä»¶å˜æ›´, å¹¶ä¸”åªä¼šæ‰“åŒ…å˜æ›´æ–‡ä»¶, å¹¶é€šè¿‡ websocket é€šçŸ¥æµè§ˆå™¨åˆ·æ–°é¡µé¢, è¿™æ ·å°±è§£å†³ä¸Šè¿°<strong>é—®é¢˜ 1</strong> å’Œ <strong>é—®é¢˜ 3</strong>.</p><p>å¹¶ä¸”, <code>webpack-dev-server</code>ä½¿ç”¨<a href="https://www.npmjs.com/package/memfs">memfs</a>å°†æ‰“åŒ…äº§ç‰©èµ‹å€¼ç»™å˜é‡ç›´æ¥å†™å…¥å†…å­˜ä¸­, æå‡äº†è¯»å–æ•ˆç‡, è§£å†³<strong>é—®é¢˜ 2</strong>.</p><h3 id="customize-webpack-dev-server"><a class="markdownIt-Anchor" href="#customize-webpack-dev-server"></a> customize webpack-dev-server</h3><p><code>webpack-dev-server</code>é»˜è®¤ä½¿ç”¨ express æœ¬åœ°å¯åŠ¨ä¸€ä¸ªæœåŠ¡, ~~å¦‚æœä½ æƒ³çš„è¯, ~~ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæœåŠ¡. <strong>å½“ç„¶åœ¨é¡¹ç›®ä¸­ä¸å»ºè®®è¿™ä¹ˆåš, å› ä¸ºé»˜è®¤çš„æœåŠ¡ä¸­è¿˜å­˜åœ¨ HMR ç­‰é‡è¦ç‰¹æ€§, ä½¿ç”¨é»˜è®¤æœåŠ¡å³å¯.</strong> è¿™é‡Œä¸¾ä¸ªè‡ªå®šä¹‰çš„ç®€å•ä¾‹å­.</p><p>å®‰è£…å¿…è¦åŒ…:</p><p><code>yarn add -D express webpack-dev-middleware</code></p><p>ç„¶åæ·»åŠ ä»¥ä¸‹é€»è¾‘, å°†<strong>webpack</strong>ç”Ÿæˆçš„<strong>compiler</strong>äº¤ç”±<strong>webpackDevMiddleware</strong>å¤„ç†:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// server,js</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">const</span> webpackDevMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-dev-middleware&quot;</span>);<br><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>);<br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./webpack.config&quot;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> compiler = <span class="hljs-title function_">webpack</span>(config);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">webpackDevMiddleware</span>(compiler));<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server is running on port 8080&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œ<code>node server.js</code>, è®¿é—® 8080 ç«¯å£å³å¯çœ‹åˆ°é¡µé¢.</p><p>äº‹å®ä¸Š, <code>webpack-dev-server</code>å†…ç½®äº†<code>webpack-dev-middleware</code>, ä¹Ÿæ˜¯é€šè¿‡ä¸Šè¿°çš„æ–¹å¼å°†<strong>compiler</strong>äº¤ç”±ä¸­é—´ä»¶æ‰˜ç®¡, åªä¸è¿‡å®ç°ä¸Šæ›´å¤æ‚.</p><h2 id="hmr"><a class="markdownIt-Anchor" href="#hmr"></a> HMR</h2><p>å…¨ç¨‹<strong>Hot Module Replacement</strong>, <code>webpack-dev-server</code>åŒæ ·å†…ç½®äº†è¯¥ç‰¹æ€§æ—¨åœ¨è§£å†³<strong>é—®é¢˜ 4</strong>.</p><p><code>webpack-dev-server</code>é»˜è®¤æ²¡æœ‰å¯åŠ¨ HMR, éœ€è¦æ‰‹åŠ¨é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>é…ç½®å®Œéœ€è¦åœ¨å…¥å£æ–‡ä»¶åº•éƒ¨æ’å…¥ HMR é€»è¾‘, é€šçŸ¥<code>webpack-dev-server</code>å“ªäº›æ–‡ä»¶å˜æ›´éœ€è¦è§¦å‘çƒ­æ›´æ–°, ä¸è¦ç”¨ optional chain</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>) &#123;<br>  <span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>([<span class="hljs-string">&quot;./math.js&quot;</span>], <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hmr executed.&quot;</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>HMR çš„å®ç°åŸç†è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„, è¿™é‡Œæ¨èé˜…è¯»<a href="https://zhuanlan.zhihu.com/p/30669007">HMR åŸç†è§£æ</a>, æ·±åˆ»æè¿°äº† HMR åœ¨<code>webpack-dev-server</code>ä¸­çš„å®ç°åŸç†.<s>æ¯”æˆ‘å­å­å­è®²å¼ºå¤šäº†</s></p><h2 id="åœ¨æ¡†æ¶ä¸­ä½¿ç”¨-hmr"><a class="markdownIt-Anchor" href="#åœ¨æ¡†æ¶ä¸­ä½¿ç”¨-hmr"></a> åœ¨æ¡†æ¶ä¸­ä½¿ç”¨ HMR</h2><p>åœ¨å®è·µè¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜, è¿™é‡Œå¼ºè°ƒä¸€ä¸‹.<br />jsx æ–‡ä»¶æˆ–è€…æ˜¯ vue æ–‡ä»¶, éœ€è¦åœ¨æ–‡ä»¶å†…æ¨¡å—å¯¼å‡º, ç„¶ååœ¨å…¥å£æ–‡ä»¶å¯¼å…¥æ¨¡å—å¹¶ä½¿ç”¨<code>import Cmp from 'cmp.xxx'</code>; è€Œä¸æ˜¯ç›´æ¥åœ¨æ¨¡å—ä¸­æ‰§è¡Œå®Œæ‰€æœ‰é€»è¾‘, åœ¨å…¥å£æ–‡ä»¶ç®€å•<code>import 'cmp.xxx';</code>, è¿™æ ·åš<strong>HMR</strong>ä¸ä¼šç”Ÿæ•ˆ, åªä¼šç›´æ¥ location.reload().</p><h3 id="hmr-in-react"><a class="markdownIt-Anchor" href="#hmr-in-react"></a> HMR in React</h3><p>å®‰è£… HMR éœ€è¦çš„åŒ…:</p><p><code>yarn add -D @pmmmwh/react-refresh-webpack-plugin react-refresh</code></p><p>React çƒ­æ›´æ–°çš„è¿™äº›æ’ä»¶åªèƒ½åœ¨å¼€å‘ç¯å¢ƒ(development)ä½¿ç”¨, ç”Ÿäº§ç¯å¢ƒ(production)æ‰“åŒ…æ—¶éœ€è¦ä¼šæŠ¥é”™, æ‰€ä»¥è¿™é‡Œé€šè¿‡<code>process.env.NODE_ENV</code>åˆ¤æ–­ç¯å¢ƒåŠ¨æ€æ·»åŠ æ’ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ReactRefreshWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@pmmmwh/react-refresh-webpack-plugin&quot;</span>);<br><br><span class="hljs-keyword">const</span> isDevelopment = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">&quot;production&quot;</span>;<br><br><span class="hljs-keyword">const</span> plugins = [<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(),<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>    <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;./index.html&quot;</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Day7 p2&quot;</span>,<br>  &#125;),<br>];<br>isDevelopment &amp;&amp; plugins.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactRefreshWebpackPlugin</span>());<br><br><span class="hljs-keyword">const</span> babelPlugins = [];<br>isDevelopment &amp;&amp; babelPlugins.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;react-refresh/babel&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.jsx?$/i</span>,<br>        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;babel-loader&quot;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">plugins</span>: babelPlugins,<br>            &#125;,<br>          &#125;,<br>        ],<br>      &#125;,<br>      <span class="hljs-comment">//...</span><br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="hmr-in-vue"><a class="markdownIt-Anchor" href="#hmr-in-vue"></a> HMR in Vue</h3><p>å®‰è£… HMR ä¾èµ–çš„åŒ…:</p><p><code>yarn add -D vue-loader</code></p><p>Vue çƒ­æ›´æ–°ä¾èµ–çš„æ’ä»¶æ²¡æœ‰ç¯å¢ƒçš„é—®é¢˜, ç›´æ¥åœ¨é…ç½®ä¸­æ·»åŠ å³å¯:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs diff">//...<br>const ReactRefreshWebpackPlugin = require(&#x27;@pmmmwh/react-refresh-webpack-plugin&#x27;);<br><span class="hljs-addition">+ const &#123; VueLoaderPlugin &#125; = require(&#x27;vue-loader&#x27;);</span><br><br>const isDevelopment = process.env.NODE_ENV !== &#x27;production&#x27;;<br><br>const plugins = [<br>  new CleanWebpackPlugin(),<br>  new HtmlWebpackPlugin(&#123;<br>    template: &#x27;./index.html&#x27;,<br>    title: &#x27;Day7 p2&#x27;,<br>    filename: &#x27;page/index.html&#x27;,<br>  &#125;),<br><span class="hljs-addition">+ new VueLoaderPlugin(),</span><br>];<br>isDevelopment &amp;&amp; plugins.push(new ReactRefreshWebpackPlugin());<br><br>const babelPlugins = [];<br>isDevelopment &amp;&amp; babelPlugins.push(&#x27;react-refresh/babel&#x27;);<br><br>module.exports = &#123;<br>  //...<br>  module: &#123;<br>    rules: [<br>      &#123;<br>        test: /\.jsx?$/i,<br>        exclude: /node_modules/,<br>        use: [<br>          &#123;<br>            loader: &#x27;babel-loader&#x27;,<br>            options: &#123;<br>              plugins: babelPlugins,<br>            &#125;,<br>          &#125;,<br><span class="hljs-addition">+         &#123;</span><br><span class="hljs-addition">+        test: /\.vue$/i,</span><br><span class="hljs-addition">+        use: &#x27;vue-loader&#x27;,</span><br><span class="hljs-addition">+      &#125;,</span><br>        ],<br>      &#125;,<br>      //...<br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…·ä½“ React/Vue ç»„ä»¶é€»è¾‘åŠå…¥å£æ–‡ä»¶å¼•ç”¨é€»è¾‘æŸ¥çœ‹ç¤ºä¾‹ä»£ç .</p><h2 id="publicpath-path-contentbase-in-webpack5"><a class="markdownIt-Anchor" href="#publicpath-path-contentbase-in-webpack5"></a> publicPath, path, contentBase in webpack5</h2><p>webpack5 ä¹‹å‰å¯¹è¿™äº›é…ç½®çš„ä»‹ç»å¯ä»¥å‚è€ƒ: [[2021-06-25-path-publicPath-contentBase]]</p><h3 id="publicpath"><a class="markdownIt-Anchor" href="#publicpath"></a> publicPath</h3><p>publicPath åœ¨ output å’Œ devServer ä¸­é…ç½®çš„å«ä¹‰å®Œå…¨ä¸åŒ.</p><h4 id="in-output"><a class="markdownIt-Anchor" href="#in-output"></a> in output</h4><p>åœ¨ output ä¸­, publicPath è¡¨ç¤º html ä¸­å¼•å…¥æ–‡ä»¶è·¯å¾„çš„å‰ç¼€, å¹¶ä»¥<code>$&#123;publicPath&#125;$&#123;æ–‡ä»¶å&#125;</code>çš„å­—ç¬¦ä¸²å†™å…¥ html ä¸­, publicPath é»˜è®¤å€¼ä¸º<code>''</code>.</p><p>åœ¨å¼€å‘ç¯å¢ƒä¸­, é€šè¿‡<code>webpack-dev-server</code>å¯åŠ¨çš„æœåŠ¡ä½¿å¾—èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­é€šè¿‡ http è®¿é—® html æ–‡ä»¶.<br />æ­¤æ—¶å¯ä»¥é…ç½®ç»å¯¹è·¯å¾„(äº‹å®ä¸Šä¹Ÿæ›´æ¨èé…ç½®ç»å¯¹è·¯å¾„), ä¾‹å¦‚:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span>,<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./build&#x27;</span>),<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/page&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>devServer æ— ç›¸åº”é…ç½®, devServer ä¸­çš„ publicPath é»˜è®¤ä¼šä½¿ç”¨ output çš„ publicPath.</p><p>æ­¤æ—¶è¿è¡Œ<code>webpack server</code>, å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ°æ‹¼æ¥çš„æ–‡ä»¶è·¯å¾„, html æ­£å¸¸å±•ç¤º</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664697147057_929.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>ä½¿ç”¨ç›¸å¯¹è·¯å¾„, çœŸæ­£æ‰“åŒ…åˆ°æ–‡ä»¶ç³»ç»Ÿæ—¶æ‰å»ºè®®ä½¿ç”¨ç›¸å¯¹è·¯å¾„, å› ä¸ºæ‰“åŒ…åˆ°æ–‡ä»¶ç³»ç»Ÿåæµè§ˆå™¨æ‰“å¼€æ˜¯<code>file://</code>åè®®, å¦‚æœä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„æ‹¼æ¥åå°±å˜æˆ<code>file:///bundle.js</code>, æ‰¾ä¸åˆ°å¯¹åº”æ–‡ä»¶.<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664422677000_2677.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å®é™…ä¸Š, ç”Ÿäº§ç¯å¢ƒä¸‹æ›´å¤šçš„ä¹Ÿä¹Ÿæ˜¯ä½¿ç”¨ CDN åŸŸåå‰ç¼€, è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„.</p><p>å¼€å‘ç¯å¢ƒä¸‹è¦ç”¨ç›¸å¯¹è·¯å¾„ä¹Ÿå¯ä»¥ç”¨, åªæ˜¯ä¼šå¾’å¢å¿ƒæ™ºè´Ÿæ‹….<br />output ä¸­ publicPath ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ—¶, <strong>devServer ä¸­å¿…é¡»é…ç½®ç»å¯¹è·¯å¾„</strong>, åŸå› åç»­è§£é‡Š, å…ˆçœ‹ä¸‹ä¸è¿™æ ·åšçš„åæœ, å…ˆå°† devServer æ³¨é‡Šæ‰:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span>,<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./build&#x27;</span>),<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;./&#x27;</span>,<br>&#125;,<br><span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">devMiddleware</span>: &#123;<br>      <span class="hljs-comment">// publicPath: &#x27;/&#x27;</span><br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œ<code>webpack serve</code>, æµè§ˆå™¨æ˜¾ç¤º:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664697803627_9616.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å°† devServer çš„ publicPath æ”¾å¼€:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs diff">output: &#123;<br>    filename: &#x27;bundle.js&#x27;,<br>    path: path.resolve(__dirname, &#x27;./build&#x27;),<br>    publicPath: &#x27;./&#x27;,<br>&#125;,<br>devServer: &#123;<br>    hot: true,<br>    devMiddleware: &#123;<br><span class="hljs-deletion">-      // publicPath: &#x27;/&#x27;</span><br><span class="hljs-addition">+      publicPath: &#x27;/&#x27;</span><br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>webpack serve</code>, æ­¤æ—¶æµè§ˆå™¨æ˜¾ç¤ºæ­£å¸¸:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664697915112_1455.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h4 id="in-devserver"><a class="markdownIt-Anchor" href="#in-devserver"></a> in devServer</h4><p>webpack5 ä¸­åœ¨ devServe é…ç½® publicPath å’Œ webpack4 çš„åŒºåˆ«:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs diff">devServer: &#123;<br>  hot: true,<br><span class="hljs-deletion">- publicPath: &#x27;/&#x27;,</span><br><span class="hljs-addition">+ // webpack5</span><br><span class="hljs-addition">+ devMiddleware: &#123;</span><br><span class="hljs-addition">+   publicPath: &#x27;/&#x27;</span><br><span class="hljs-addition">+ &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢è¯´è¿‡, devServer é€šè¿‡<code>memfs</code>åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ç±»ä¼¼é™æ€æ–‡ä»¶æœåŠ¡, ä½¿å†…å­˜ä¸­çš„æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸é€šè¿‡ http è®¿é—®, æ‰€ä»¥ devServer ä¸­çš„ publicPath ç›¸å½“äº http è¯·æ±‚è·å–é™æ€æ–‡ä»¶æ‰€éœ€çš„å‰ç¼€, è¿™å°±è§£é‡Šäº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜:</p><ul><li>devServer çš„ publicPath ä¸ºä»€ä¹ˆæœ€å¥½å’Œ output çš„ publicPath ä¿æŒä¸€è‡´? å¦‚æœé™æ€æ–‡ä»¶æœåŠ¡ä¸­æ–‡ä»¶è·¯å¾„ä¸º<code>/asset/bundle.js</code>, è€Œ html ä¸­è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ä¸º<code>/bundle.js</code>, è‡ªç„¶è¯·æ±‚ä¸åˆ°å¯¹åº”æ–‡ä»¶</li><li>devServer çš„ publicPath ä¸ºä»€ä¹ˆä¸èƒ½ä¸ºç›¸å¯¹è·¯å¾„? http è¯·æ±‚é“¾æ¥çš„å‰ç¼€åˆæ€ä¹ˆèƒ½æ˜¯ç›¸å¯¹è·¯å¾„å‘¢?</li><li>ä¸ºä»€ä¹ˆ devServer çš„ publicPath å¼€å¤´ç»“å°¾éƒ½éœ€è¦å¸¦ä¸Š<code>/</code>, æˆ‘ç†è§£æ˜¯ä¸ºäº†ç›¸å¯¹è·¯å¾„æœåŠ¡çš„(å¦‚æœæœ‰é”™è¯·å¿½ç•¥), å¦‚æœ devServer çš„ publicPath é…ç½®çš„æ˜¯<code>/asset</code>, output çš„ publicPath é…ç½®<code>./</code>, è¯·æ±‚ä¼šå˜ä¸º<code>/bundle.js</code>, åªæœ‰é…ç½®ä¸º<code>/asset/</code>æ—¶, è¯·æ±‚æ‰æ˜¯<code>/asset/bundle.js</code>æ­£å¸¸è¿”å›.</li></ul><p>å½“ç„¶, å¯¹äº<code>HtmlWebpackPlugin</code>æ’ä»¶, <code>filename</code>é€‰é¡¹ä¹Ÿå¯ä»¥é…ç½®è·¯å¾„+æ–‡ä»¶, é…åˆ publicPath çš„ç›¸å¯¹è·¯å¾„ç†è§£èµ·æ¥å°±æ›´ç¹çäº†.</p><h4 id="æ€»ç»“ä¸€ä¸‹-publicpath"><a class="markdownIt-Anchor" href="#æ€»ç»“ä¸€ä¸‹-publicpath"></a> æ€»ç»“ä¸€ä¸‹ publicPath</h4><p>ä½¿ç”¨ publicPath éµå¾ªä»¥ä¸‹å‡ ç‚¹:</p><ol><li>devServer çš„ publicPath å’Œ output çš„ publicPath æ¨èä¿æŒä¸€è‡´, æˆ–è€…ä¸é…ç½® devServer çš„ publicPath</li><li>å¼€å‘ç¯å¢ƒé…ç½® publicPath æœ€å¥½å¼€å¤´ç»“å°¾éƒ½å¸¦ä¸Š<code>/</code>, å¹¶ä¸”æµè§ˆå™¨è®¿é—®æ—¶ä¹Ÿè¦ç»“å°¾ä¹Ÿè¦å¸¦ä¸Š</li><li>å¼€å‘ç¯å¢ƒä¸‹æœ€å¥½ä¸è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„</li><li>å¦‚æœæ‰“åŒ…äº§ç‰©æ ¹æ®æ–‡ä»¶ç±»å‹éœ€è¦ä¸æä¾›æ–‡ä»¶å¤¹åŒºåˆ†, å¯ä»¥ç›´æ¥é…ç½®å¯¹åº”çš„ filename</li><li><s>é…ç½® webpack.config.js çš„æ—¶å€™ä½ æœ€å¥½çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ</s></li></ol><h3 id="contentbase"><a class="markdownIt-Anchor" href="#contentbase"></a> ContentBase</h3><p>ç…§ä¾‹ä»‹ç»ä¸‹ webpack5 å¯¹ ContentBase çš„ breaking change:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff">devServer: &#123;<br><span class="hljs-deletion">-  contentBase: path.resolve(__dirname, &#x27;.yui&#x27;),</span><br><span class="hljs-addition">+  static: &#123;</span><br><span class="hljs-addition">+    directory: path.resolve(__dirname, &#x27;./yui&#x27;),</span><br><span class="hljs-addition">+  &#125;</span><br>&#125;,<br></code></pre></td></tr></table></figure><p>contentBase æ¯”è¾ƒå¥½ç†è§£, ä¸æ˜¯ç›´æ¥é€šè¿‡å…¥å£æ–‡ä»¶å¼•å…¥çš„æ–‡ä»¶, æˆ–è€…æ˜¯å…¥å£æ–‡ä»¶å…³è”æ–‡ä»¶ä¸­åˆå…³è”çš„æ–‡ä»¶, devServer å°±ä¼šåˆ° ContentBase é…ç½®çš„æ–‡ä»¶ç›®å½•ä¸‹å¯»æ‰¾. ä¸¾ä¸ªä¾‹å­:</p><p>åœ¨ html æ–‡ä»¶ä¸­å¼•å…¥ js æ–‡ä»¶,è¯¥æ–‡ä»¶å’Œå…¥å£æ–‡ä»¶æ²¡æœ‰ç›´æ¥å…³ç³», è¿™é‡Œè¦ä½¿ç”¨ç»å¯¹è·¯å¾„, å¦åˆ™ä¼šé€šè¿‡ publicPath æŸ¥æ‰¾:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff">&lt;body&gt;<br>  &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;<br>  &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;<br><br><span class="hljs-addition">+ &lt;script src=&quot;/test.js&quot;&gt;&lt;/script&gt;</span><br>&lt;/body&gt;<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”æ–°å»º<code>yui/test.js</code>æ–‡ä»¶, æ·»åŠ è¾“å‡º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è¿™æ˜¯ä¸ªTestæ–‡ä»¶&quot;</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ³¨é‡Šæ‰ contentBase, <strong>contentBase ä¸èƒ½é…ç½®ä¸º&quot;&quot;</strong>, è¿è¡Œ<code>webpack serve</code>:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664701555781_1130.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°é»˜è®¤ contentBase æœç´¢çš„æ–‡ä»¶å¤¹æ˜¯ public, æµè§ˆå™¨æ˜¾ç¤º:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664701719247_6132.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>ç„¶åå°† contentBase æ”¾å¼€, è¿è¡Œ<code>webpack serve</code>:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664701782697_3793.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºæ­£å¸¸äº†.</p><h2 id="devserver-å…¶ä»–çš„å¸¸ç”¨é…ç½®"><a class="markdownIt-Anchor" href="#devserver-å…¶ä»–çš„å¸¸ç”¨é…ç½®"></a> devServer å…¶ä»–çš„å¸¸ç”¨é…ç½®</h2><h3 id="hotonly"><a class="markdownIt-Anchor" href="#hotonly"></a> hotOnly</h3><p>çƒ­æ›´æ–°æ—¶æ¨¡å—ä»£ç æŠ¥é”™, ä¿®å¤åé»˜è®¤ä¼šåˆ·æ–°é¡µé¢; hotOnly ä¿è¯æŠ¥é”™ä¿®å¤ä»ç„¶æ˜¯çƒ­æ›´æ–°.</p><p><strong>Breaking change</strong> webpack4 -&gt; webpack5:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-  hotOnly: true,</span><br><span class="hljs-addition">+  hot: &#x27;only&#x27;, // hot: true</span><br></code></pre></td></tr></table></figure><h3 id="compress"><a class="markdownIt-Anchor" href="#compress"></a> compress</h3><p>è¯·æ±‚çš„æ–‡ä»¶ä»¥ gzip å½¢å¼å‹ç¼©åè¿”å›</p><h3 id="host"><a class="markdownIt-Anchor" href="#host"></a> host</h3><p>é»˜è®¤å€¼ä¸º<code>localhost(127.0.0.1)</code>, å¦‚æœå¸Œæœ›å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥è®¿é—®, å¯ä»¥è®¾ç½®ä¸º<code>0.0.0.0</code></p><h3 id="open"><a class="markdownIt-Anchor" href="#open"></a> open</h3><p>å¯ä»¥é…ç½®æŒ‡å®šæµè§ˆå™¨æ‰“å¼€æŒ‡å®šé¡µé¢.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">open</span>: &#123;<br>  <span class="hljs-attr">target</span>: [<span class="hljs-string">&#x27;/asset/page/&#x27;</span>], <span class="hljs-comment">// open multiple pages</span><br>  <span class="hljs-attr">app</span>: &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;google-chrome&#x27;</span>,<br>  &#125;<br>&#125;,<br><span class="hljs-comment">// or</span><br><span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,<br></code></pre></td></tr></table></figure><h3 id="historyapifallback"><a class="markdownIt-Anchor" href="#historyapifallback"></a> historyApiFallback</h3><p>è¿™ä¸ªæ¯”è¾ƒé‡è¦, åœ¨ React/Vue è¿™ç±»ç”Ÿæˆ SPA é¡µé¢çš„æ¡†æ¶ä¸­éå¸¸å¸¸è§, ä¸»è¦ä½œç”¨æ˜¯è§£å†³ SPA é¡µé¢åœ¨è·¯ç”±è·³è½¬ä¹‹å, è¿›è¡Œé¡µé¢åˆ·æ–°æ—¶, è¿”å› 404 é”™è¯¯çš„é—®é¢˜.<br /><strong>ç”Ÿäº§ç¯å¢ƒä¸‹é€šè¿‡ nginx é…ç½®, historyApiFallback ç›¸å½“äºå¹²äº†å¼€å‘æ—¶ nginx çš„æ´»</strong></p><p>å’Œ open ä¸€æ ·æœ‰ä¸¤ç§æ–¹å¼é…ç½®, <code>boolean|object</code>.<br />boolean å€¼é»˜è®¤ä¸º<code>false</code>, <code>true</code>é¡µé¢åˆ·æ–° 404 æ—¶è·³è½¬<code>/index.html</code>,<br />object å€¼å¯ä»¥é…ç½® rewrites, æ ¹æ® 404 åŒ¹é…çš„è·¯ç”±è·³è½¬ä¸åŒè·¯å¾„</p><p>ä¸¾ä¸ªä¾‹å­, å…·ä½“æºç æŸ¥çœ‹[[#å®ä¾‹ä»£ç ]].</p><p>å…ˆä¸é…<code>historyApiFallback</code>, æŸ¥çœ‹ react è·¯ç”±çš„è·³è½¬:</p><p>å½“å‰è·¯å¾„: <code>127.0.0.1/me</code></p><p>å±•ç¤ºå†…å®¹:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664726548640_9042.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>åˆ·æ–°å 404, å› ä¸ºå¹¶æ²¡æœ‰å¯¹åº”çš„è·¯å¾„æˆ–æ–‡ä»¶åŒ¹é…<code>/me</code></p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664726704031_2224.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>é…ç½®<code>historyApiFallback</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">historyApiFallback</span>: &#123;<br>  <span class="hljs-attr">rewrites</span>: [&#123; <span class="hljs-attr">from</span>: <span class="hljs-regexp">/about|me/</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;/asset/page/&#x27;</span> &#125;],<br>&#125;,<br></code></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œ<code>webpack serve</code>, å†æ¬¡åˆ·æ–°å½“å‰è·¯ç”±, åˆ·æ–°ä¹Ÿèƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤º:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664726866345_7520.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="proxy"><a class="markdownIt-Anchor" href="#proxy"></a> proxy</h3><p>è¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šäº†, å…·ä½“é…ç½®å¯ä»¥æŸ¥é˜…<a href="https://webpack.js.org/configuration/dev-server/#devserverproxy">å®˜ç½‘</a>. ä½œç”¨ä¸»è¦è¿˜æ˜¯ç”¨äºè§£å†³è·¨åŸŸé—®é¢˜, ä¸è€ƒè™‘æœåŠ¡ç«¯å·²ç»å¯¹ resHeader åšäº†è·¨åŸŸå¤„ç†. è¿™é‡Œåˆ—å‡ºå¸¸ç”¨çš„é…ç½®, ä½¿ç”¨å¯ä»¥å‚è€ƒ[[#ç¤ºä¾‹ä»£ç ]]:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">devServer</span>: &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">proxy</span>: &#123;<br>    <span class="hljs-string">&quot;/api&quot;</span>: &#123;<br>      <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;http://localhost:8888&quot;</span>,<br>      <span class="hljs-attr">pathRewrite</span>: &#123;<br>        <span class="hljs-string">&quot;^/api&quot;</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// æ­£åˆ™æ›¿æ¢, replace(/^api/, &#x27;&#x27;);</span><br>      &#125;,<br>      <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¿½ç•¥httpséªŒè¯</span><br>      <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//ä¿®æ”¹Originä¸ºlocalhost:8888</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœªé…ç½® proxy å‰, æµè§ˆå™¨åœ¨<code>http://localhost:8080/asset/page/</code>å‘èµ·è·¨åŸŸè¯·æ±‚:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8888/name&quot;</span>);<br></code></pre></td></tr></table></figure><p>æ¯«æ— æ„å¤–æµè§ˆå™¨ä¼šæ‹¦æˆª:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664977295429_8174.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>é…ç½® proxy å, ä¿®æ”¹è¯·æ±‚ä¸º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/name&quot;</span>);<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨å¯ä»¥æ­£å¸¸è¿”å›æ•°æ®:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664977379895_4155.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¦‚æœå¯¹ nginx æœ‰æ‰€äº†è§£å°±ä¼šå‘ç°, devServer çš„ proxy å’Œ historyApiFallback å…¶å®å°±æ˜¯å……å½“äº†ç”Ÿäº§ç¯å¢ƒä¸‹çš„ nginx é…ç½®.</p><h2 id="resolve"><a class="markdownIt-Anchor" href="#resolve"></a> resolve</h2><p>resolve ä¸»è¦æ˜¯å¯¹ import from çš„è·¯å¾„åšå¤„ç†, ä»‹ç»ä¸‹ resolve å¯¹è±¡ä¸­å¸¸ç”¨çš„å‡ ä¸ªå±æ€§.</p><h3 id="modules"><a class="markdownIt-Anchor" href="#modules"></a> modules</h3><p>é»˜è®¤å€¼: <code>node_modules</code><br />å¼•å…¥æ¨¡å—çš„è·¯å¾„åˆ†ä¸ºç»å¯¹è·¯å¾„, ç›¸å¯¹è·¯å¾„, æ¨¡å—è·¯å¾„; ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„å®¹æ˜“ç†è§£, å°±æ˜¯æ ¹æ®æ–‡ä»¶ç³»ç»Ÿæˆ–ä¸Šä¸‹æ–‡ç›®å½•æŸ¥æ‰¾; æ¨¡å—è·¯å¾„åˆ™æ˜¯åªæŒ‡å®šäº†åŒ…å, webpack ä¼šé€šè¿‡<code>resolve.modules</code>æŒ‡å®šçš„ç›®å½•å»æŸ¥æ‰¾æ–‡ä»¶, webpack æ˜¯é€šè¿‡<strong>enhanced-resolve</strong>åº“æ¥è¿›è¡Œæ¨¡å—è·¯å¾„æŸ¥æ‰¾.</p><h3 id="extensions"><a class="markdownIt-Anchor" href="#extensions"></a> extensions</h3><p>é»˜è®¤å€¼: <code>['.js', '.json', '.wasm']</code><br />å½“ webpack å‘ç°å½“å‰è·¯å¾„æ˜¯æ–‡ä»¶å¹¶ä¸”æ²¡æœ‰åç¼€åæ—¶, ä¼šä½¿ç”¨<code>resolve.extensions</code>åŒ¹é…, æ‰€ä»¥å¯¹äº React/Vue è¿™ç±»æ–‡ä»¶åç¼€ä¸º.jsx/.vue çš„è·¯å¾„, å¦‚æœä¸å¸¦ä¸Šåç¼€é»˜è®¤æ˜¯ä¼šè§£æå¤±è´¥çš„, éœ€è¦é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">resolve</span>: &#123;<br>  <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.js&quot;</span>, <span class="hljs-string">&quot;.json&quot;</span>, <span class="hljs-string">&quot;.wasm&quot;</span>, <span class="hljs-string">&quot;.jsx&quot;</span>, <span class="hljs-string">&quot;.vue&quot;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="mainfiles"><a class="markdownIt-Anchor" href="#mainfiles"></a> mainFiles</h3><p>é»˜è®¤å€¼: <code>index</code><br />å½“ webpack å‘ç°å½“å‰è·¯å¾„æ˜¯æ–‡ä»¶å¤¹æ—¶, ä¼šå°†<strong>resolve.mainFiles</strong>è¡¥å……åœ¨è·¯å¾„åé¢, ç„¶åé€šè¿‡<strong>resolve.extensions</strong>åŒ¹é…æ–‡ä»¶.</p><h3 id="alias"><a class="markdownIt-Anchor" href="#alias"></a> alias</h3><p>type: <code>object</code><br />å½“è·¯å¾„ä½¿ç”¨é¢‘ç‡é«˜å¹¶ä¸”é•¿æ—¶, å¯ä»¥é…ç½®<code>resolve.alias</code>ç®€åŒ–è¾“å…¥, Vue è„šæ‰‹æ¶å°±å°†<code>@</code>ä½œä¸º<code>path.resolve(__dirname, './src')</code>çš„åˆ«å.</p><h1 id="å®ä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#å®ä¾‹ä»£ç "></a> å®ä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day7">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day7</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://zhuanlan.zhihu.com/p/30669007">Webpack HMR åŸç†è§£æ</a></li><li><a href="https://github.com/facebook/react/issues/16604">How should we set up apps for HMR now that Fast Refresh replaces react-hot-loader?</a></li><li><a href="https://github.com/pmmmwh/react-refresh-webpack-plugin">React çƒ­æ›´æ–°ä¾èµ–</a></li><li><a href="https://blog.csdn.net/qq_43048301/article/details/121554459">Webpack5 ä¸­ devServer é…ç½® contentBase æŠ¥é”™çš„é—®é¢˜</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pm2çº¿ä¸Šé—®é¢˜å¤„ç†è®°å½•</title>
    <link href="/2022/09/27/2022-09-27-pm2-online-issue-record/"/>
    <url>/2022/09/27/2022-09-27-pm2-online-issue-record/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>çº¿ä¸Šæœºå™¨å­˜åœ¨ä¸¤ä¸ª pm2 éƒ¨ç½²çš„ç³»ç»ŸæœåŠ¡, ç”±äº pm2 é»˜è®¤è¾“å‡ºåˆ°<code>pm2-out.log</code>æ–‡ä»¶ä¸­, ç³»ç»Ÿè¿è¡Œäº†ä¸€å¹´å¤šè¿™ä¸ªæ–‡ä»¶å·²ç»å‡ å G äº†, æŸ¥è¯¢æ—¥å¿—å®šä½é—®é¢˜æ—¶ grep é€Ÿåº¦ææ…¢â€¦æ‰€ä»¥æƒ³æ³•æ˜¯ä¿®æ”¹è¾“å‡ºæ—¥å¿—æ–‡ä»¶åˆ°æ–°æ–‡ä»¶ä¸­, å¹¶å¯¹å…¶åšæ—¥å¿—åˆ‡å‰².</p><h1 id="å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#å…·ä½“å®ç°"></a> å…·ä½“å®ç°</h1><h2 id="æ›´æ¢æ—¥å¿—è¾“å‡ºæ–‡ä»¶"><a class="markdownIt-Anchor" href="#æ›´æ¢æ—¥å¿—è¾“å‡ºæ–‡ä»¶"></a> æ›´æ¢æ—¥å¿—è¾“å‡ºæ–‡ä»¶</h2><p>pm2 é»˜è®¤é€šè¿‡<code>ecosystem.config.json</code>è¿›è¡Œå„ç§é…ç½®, è¿™é‡Œå¯¹è¾“å‡ºçš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">apps</span>: [<br>    &#123;<br>      <span class="hljs-comment">// ...other configs</span><br>      <span class="hljs-attr">error_file</span>: <span class="hljs-string">&quot;../logs/pm2-error-new.log&quot;</span>,<br>      <span class="hljs-attr">out_file</span>: <span class="hljs-string">&quot;../logs/pm2-out-new.log&quot;</span>,<br>      <span class="hljs-attr">log_file</span>: <span class="hljs-string">&quot;../logs/pm2-app-new.log&quot;</span>,<br>    &#125;,<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ€æ­»å½“å‰æœåŠ¡çš„è¿›ç¨‹</p><p><code>pm2 delete &lt;id|name&gt;</code></p><p>ä¸èƒ½åªæ˜¯<code>stop</code>, æ›´æ–°çš„é…ç½®ä¸ä¼šç”Ÿæ•ˆ, ç„¶å</p><p><code>pm2 start ecosystem.config.js</code></p><p>logs ä¸‹æ–°æ–‡ä»¶æˆåŠŸç”Ÿæˆäº†<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664263425495_9764.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="æ—¥å¿—åˆ‡å‰²"><a class="markdownIt-Anchor" href="#æ—¥å¿—åˆ‡å‰²"></a> æ—¥å¿—åˆ‡å‰²</h2><p>è¿™é‡Œä½¿ç”¨ pm2 æä¾›çš„æ—¥å¿—åˆ‡å‰²æ’ä»¶<code>pm2-logrotate</code>, å¯ä»¥è®¾ç½®é»˜è®¤çš„æ—¥å¿—å¤§å°é˜ˆå€¼, æ—¥å¿—æ–‡ä»¶æ—¥æœŸæ ¼å¼, è¿›ç¨‹è½®è¯¢æ—¥å¿—å¤§å°æ—¶é—´é—´éš”, cron å®šæ—¶ä»»åŠ¡ç­‰.</p><p>å®‰è£…: <code>pm2 install pm2-logrotate</code></p><p>ä¿®æ”¹é…ç½®: <code>pm2 set pm2-logrotate:&lt;paramName&gt; &lt;value&gt;</code></p><p>æŸ¥çœ‹æ’ä»¶é…ç½®: <code>pm2 conf pm2-logrotate</code></p><p>ä»¥ä¸‹ä¸ºæˆ‘è®¾ç½®çš„<code>pm2-logrotate</code>é…ç½®:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664263834486_4617.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="çº¿ä¸Šå¤„ç†"><a class="markdownIt-Anchor" href="#çº¿ä¸Šå¤„ç†"></a> çº¿ä¸Šå¤„ç†</h2><p>åœ¨å¼€å‘æœº devServer ä¸ŠéªŒè¯æ—¶ç•…é€šæ— é˜», ä½†åœ¨çº¿ä¸Šæœºå™¨æµ‹è¯•æ—¶åˆæ˜¯ä¸€ç•ªæ³¢æŠ˜.</p><ul><li>Q: çº¿ä¸Šæœºå™¨æ‰§è¡Œ<code>pm2 list</code>æ—¶æ²¡æœ‰è¾“å‡º</li></ul><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664264213113_3713.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><ul><li>A: æœ€å¼€å§‹éƒ¨ç½²æœåŠ¡ä»¥åŠå‘ç‰ˆæœ¬é‡å¯æœåŠ¡æ—¶éƒ½æ˜¯ä»¥ root æƒé™æ‰§è¡Œçš„<code>pm2 start</code>, è¿™å¯¼è‡´ç”³è¯·æ™®é€šæƒé™çš„æˆ‘å¹¶æ²¡æœ‰æŸ¥çœ‹ root ç”¨æˆ·è¿›ç¨‹çš„æƒé™; åœ¨ç”³è¯· root æƒé™å¹¶æ‰§è¡Œ<code>sudo su</code>åå¯ä»¥æ­£å¸¸è¾“å‡º</li></ul><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664264308893_9536.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><ul><li>Q: çº¿ä¸Šæœºå™¨ pm2 éƒ¨ç½²äº†ä¸¤ä¸ªæœåŠ¡, ä½†æ˜¯<code>pm2 list</code>åªè¾“å‡ºä¸€ä¸ª</li><li>A: æŸ¥çœ‹ä¸¤ä¸ªæœåŠ¡çš„é‡å¯è„šæœ¬æ–‡ä»¶å, å‘ç°<code>PM2_HOME</code>ç¯å¢ƒå˜é‡, ç”¨äºåœ¨åŒä¸€å°æœºå™¨ä¸Šç”Ÿæˆå¤šä¸ª pm2 å®ä¾‹, ç±»ä¼¼äºå‘½åç©ºé—´,ä¸åŒå®ä¾‹ä¹‹é—´ç›¸äº’éš”ç¦», é»˜è®¤ä½¿ç”¨ç›¸åŒçš„<code>PM2_HOME</code></li></ul><p>è®¾ç½®<code>PM2_HOME</code>å¯åŠ¨:</p><p><code>pm2 start PM2_HOME=$(pwd)/_pm2</code></p><p>æˆ–å…ˆæš´éœ²ç¯å¢ƒå˜é‡, ç„¶åå†å¯åŠ¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> PM2_HOME=$(<span class="hljs-built_in">pwd</span>)/_pm2<br>pm2 start<br><span class="hljs-built_in">export</span> PM2_HOME=<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment"># æ¸…é™¤å˜é‡</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸åŒ<code>PM2_HOME</code>ä¸‹éƒ½èƒ½å¤Ÿçœ‹åˆ° pm2 å¯¹åº”çš„æœåŠ¡äº†<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1664264837766_3422.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p><strong>å‚è€ƒèµ„æ–™ no.4 æ·±å…¥ä»‹ç»äº† copytruncate æœºåˆ¶çš„ pm2-logrotate å’Œ sign æœºåˆ¶çš„ egg-logrotator, æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹~</strong></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://pm2.keymetrics.io/docs/usage/specifics/">Multiple PM2 on the save server</a></li><li><a href="https://www.cnblogs.com/daner1257/p/10763888.html">pm2 æ—¥å¿—ç®¡ç† pm2-logrotate ä»‹ç»</a></li><li><a href="https://github.com/keymetrics/pm2-logrotate">pm2-logrotate</a></li><li><a href="https://juejin.cn/post/6844904151588012039">Node.js åº”ç”¨æ—¥å¿—åˆ‡å‰²åŸç†ä¸è¸©å‘å®è·µ</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nodejs</tag>
      
      <tag>pm2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(6)</title>
    <link href="/2022/09/23/2022-09-23-study-webpack-day6/"/>
    <url>/2022/09/23/2022-09-23-study-webpack-day6/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="babel"><a class="markdownIt-Anchor" href="#babel"></a> babel</h2><p>ES6+æ–°å‡ºç°çš„è¯­æ³•, æ•°æ®ç±»å‹, ç±», API ç­‰, å¯¹äºä¸æ”¯æŒ ES6 çš„æ—§æµè§ˆå™¨, å°±éœ€è¦ babel å°†ä»£ç ç¼–è¯‘æˆ ES5 ä»£ç .</p><p>ä¸ç®¡åœ¨ä»€ä¹ˆå·¥å…·ä¸‹ä½¿ç”¨ babel éƒ½å¿…é¡»å®‰è£… core åŒ…æ–‡ä»¶:</p><p><code>yarn add @babel-core</code></p><p>åœ¨ç»ˆç«¯ä½¿ç”¨ babel, å°† src æ–‡ä»¶å¤¹ä¸‹çš„æºæ–‡ä»¶ç¼–è¯‘è¾“å‡ºåˆ° result æ–‡ä»¶å¤¹ä¸‹:</p><p><code>npx babel src --out-dir result</code></p><p>ä¸ä½¿ç”¨ä»»ä½•æ’ä»¶çš„æƒ…å†µä¸‹ babel ä»€ä¹ˆéƒ½ä¸ä¼šåš, ä¸‹é¢ä½¿ç”¨æ’ä»¶ä¸¾ä¾‹:</p><p>å®‰è£…å¤„ç†ç®­å¤´å‡½æ•°æ’ä»¶: <code>yarn add -D @babel/plugin-transform-arrow-functions</code>,</p><p>å®‰è£…å¤„ç† const,let æ’ä»¶: <code>yarn add -D @babel/plugin-transform-block-scoping</code>,</p><p><code>npx babel src --out-dir result --plugins=@babel/plugin-transform-arrow-functions,@babel/plugin-transform-block-scoping</code></p><p>ç¼–è¯‘ç»“æœ:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&quot;use strict&quot;</span>;<br><span class="hljs-keyword">var</span> message = <span class="hljs-string">&quot;Hello world&quot;</span>;<br><span class="hljs-keyword">var</span> foo = <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name);<br>&#125;;<br><br><span class="hljs-title function_">foo</span>(message);<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨å…¶ä»–æ’ä»¶å¯ä»¥åœ¨â€“plugins åæ·»åŠ <br />ä¸€ä¸ªä¸€ä¸ªå®‰è£…æ’ä»¶çš„æ–¹å¼ä¸æ˜¯å¾ˆæ–¹ä¾¿, babel æä¾›äº†äº†<code>@babel/preset-env</code>åŒ…é¢„è®¾äº†ä¼šä½¿ç”¨çš„ plugins, å®‰è£…:</p><p><code>yarn add -D @babel/preset-env</code></p><p>ä½¿ç”¨: <code>npx babel src --out-dir --presets=@babel/preset-env</code></p><h2 id="babel-åŸç†"><a class="markdownIt-Anchor" href="#babel-åŸç†"></a> babel åŸç†</h2><p>ä¸€å¼ å›¾ä»‹ç» babel çš„åº•å±‚åŸç†, å¯ä»¥é€šè¿‡[åœ¨çº¿å·¥å…·(<a href="https://esprima.org/demo/parse.html">https://esprima.org/demo/parse.html</a>)æŸ¥çœ‹è½¬æ¢ç»“æœ</p><pre><code class=" mermaid">graph TBA[ES6+æºä»£ç ] --&gt; B[è¯æ³•åˆ†æ&lt;br&gt;Lexical Analysis]B --&gt; C[ç”Ÿæˆtokenæ•°ç»„]C --&gt; D[è¯­æ³•åˆ†æ&lt;br&gt;Syntactic Analysis]D --&gt; E[ç”ŸæˆASTæŠ½è±¡è¯­æ³•æ ‘]E --&gt; F[Traversaléå†]F --&gt; G[Visitorè®¿é—®è€…]G --&gt; H[Pluginsåº”ç”¨æ’ä»¶]H --&gt; I[new AST]I --&gt; J[ç›®æ ‡ä»£ç ]</code></pre><h2 id="babel-in-webpack"><a class="markdownIt-Anchor" href="#babel-in-webpack"></a> babel in webpack</h2><p><s>æ­£å¸¸å¼€å‘ä¹Ÿä¸å¯èƒ½åœ¨å‘½ä»¤è¡Œä½¿ç”¨ babel</s><br />å®‰è£…<code>babel-loader</code>: <code>yarn add -D babel-loader</code><br /><code>babel-loader</code>å’Œ<code>@babel/cli</code>ä¸€æ ·éƒ½æ˜¯ç‰¹å®šå·¥å…·ä¸‹ä½¿ç”¨æ—¶éœ€è¦å®‰è£…çš„åŒ…æ–‡ä»¶.<br />babel åœ¨ webpack.config.js ä¸­é…ç½®, <strong>è¿™é‡Œæ³¨æ„<code>exclude: /node_modules/</code>, å¦‚æœ babel å¤„ç† node_modules ä¸­çš„æ–‡ä»¶å¾ˆæœ‰å¯èƒ½æŠ¥é”™</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/i</span>,<br>        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,<br>        <span class="hljs-attr">use</span>: &#123;<br>          <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>          <span class="hljs-attr">options</span>: &#123;<br>            <span class="hljs-comment">// plugins: [&#x27;@babel/plugin-transform-arrow-functions&#x27;, &#x27;@babel/plugin-transform-block-scoping&#x27;],</span><br>            <span class="hljs-attr">presets</span>: [<br>              [<span class="hljs-string">&#x27;@babel/preset-env&#x27;</span>, &#123;<br>                <span class="hljs-comment">// targets: [&quot;chrome 88&quot;],</span><br>                <span class="hljs-comment">// enmodules: true,</span><br>              &#125;]<br>            ]<br>          &#125;,<br>        &#125;,<br>      &#125;,<br>    ],<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å’Œå‘½ä»¤è¡Œä½¿ç”¨éå¸¸ç±»ä¼¼, ä¸è¿‡æ˜¯ä½¿ç”¨äº† js å¯¹è±¡, è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨é¢„è®¾<code>@babel/preset-env</code>, è¿™é‡Œä¸æ¨èåœ¨ presets ä¸­é…ç½® target, å»ºè®®å’Œ postcss ç­‰å·¥å…·ä¸€èµ·é€šè¿‡<code>.browserslistrc</code>é…ç½®å…¼å®¹çš„æµè§ˆå™¨èŒƒå›´.</p><p>ç°åœ¨ babel æœ€æ–°ç‰ˆæœ¬ä¸º 7.x, å¦‚æœæ—§é¡¹ç›®ä½¿ç”¨çš„æ˜¯ babel7 ä¹‹å‰çš„å¤§ç‰ˆæœ¬, ç»å¸¸ä¼šçœ‹åˆ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">presets</span>: [[<span class="hljs-string">&quot;es2015&quot;</span>], [<span class="hljs-string">&quot;react&quot;</span>], [<span class="hljs-string">&quot;stage-1&quot;</span>]];<br></code></pre></td></tr></table></figure><p>babel7 å¼€å§‹å·²ç»ä¸å»ºè®®ä½¿ç”¨, stage-x, es20xx å·²åºŸå¼ƒ, æ›¿æ¢ä¸º<code>@babel/preset-env</code>; react æ›¿æ¢ä¸º<code>@babel/preset-react</code></p><p>åƒ postcss å¯ä»¥å•ç‹¬é…ç½® postcss.config.js æ–‡ä»¶ä¸€æ ·, babel ä¹Ÿå¯ä»¥å•ç‹¬é…ç½®, æ–‡ä»¶å‘½å: <code>babel.config.[json|js|cjs|mjs] | .babelrc[.json|.js|.cjs|mjs</code>, åç»­éƒ½ä¼šåœ¨ babel.config.js ä¸­ä¿®æ”¹.</p><p>é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// plugins: [],</span><br>  <span class="hljs-attr">presets</span>: [[<span class="hljs-string">&quot;@babel/preset-env&quot;</span>]],<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="polyfill"><a class="markdownIt-Anchor" href="#polyfill"></a> polyfill</h3><p>babel é»˜è®¤åªå¤„ç†è¯­æ³•ç›¸å…³, å½“æˆ‘ä»¬ä½¿ç”¨æ–°ç‰¹æ€§, æ•°æ®ç±»å‹, ç±»æˆ–è€… API(ä¾‹å¦‚ Promise, Generator, Symbol, API å¦‚ Array.prototype.includes), å°±éœ€è¦ä½¿ç”¨ polyfill</p><p>åœ¨ babel7.4 ä¹‹åå°±ä¸å»ºè®®ä½¿ç”¨<code>@babel-polyfill</code>, æ¨èä½¿ç”¨<code>core-js</code>å’Œ<code>regenerator-runtime</code>, å®‰è£…:<br /><code>yarn add core-js regenerator-runtime</code></p><p>ç„¶ååœ¨ babel.config.js ä¸­é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">presets</span>: [<br>    [<br>      <span class="hljs-string">&quot;@babel/preset-env&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">useBuiltIns</span>: <span class="hljs-string">&quot;usage&quot;</span>,<br>        <span class="hljs-attr">corejs</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// å¿…é¡»å¡«é»˜è®¤corejs: 2ä¼šæŠ¥é”™</span><br>      &#125;,<br>    ],<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p>useBuiltIns:</p><ul><li>é»˜è®¤ä¸º<code>false</code>, ä¸å¼•å…¥ä»»ä½• polyfill é€»è¾‘, å³è¿˜æ˜¯åªå¤„ç†è¯­æ³•;</li><li><code>'usage'</code>, åˆ†ææºä»£ç ä¸­éœ€è¦çš„ polyfill ä»¥åŠ<code>.browserslistrc</code>æ¶‰åŠçš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯¥ polyfill æŒ‰éœ€å¼•å…¥</li><li><code>'entry'</code>, éœ€è¦æ‰‹åŠ¨åœ¨å…¥å£æ–‡ä»¶é¡¶éƒ¨å¼•å…¥ä»¥ä¸‹åŒ…, ç„¶åæ ¹æ®<code>.browserslistrc</code>å¼•å…¥å‰©ä½™ä¸æ”¯æŒçš„æ‰€æœ‰ polyfill, å› ä¸ºå¼•å…¥çš„æ‰€æœ‰çš„åŒ…, å“åº”çš„æ‰“åŒ…ä½“ç§¯ä¼šå˜å¤§.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;core-js/stable&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;regenerator-runtime/runtime&quot;</span>;<br></code></pre></td></tr></table></figure><p>corejs:<br />babel é»˜è®¤ä½¿ç”¨ corejs ä¸º<code>2</code>, ä½†æ˜¯å®‰è£…çš„æœ€æ–°<code>@babel/core</code>ç‰ˆæœ¬ä¸º 3.x, æ‰€ä»¥éœ€è¦ä¿®æ”¹ corejs ä¸º<code>3</code>, ä¹Ÿå¯ä»¥å…·ä½“åˆ°å°ç‰ˆæœ¬<code>3.8</code>.</p><h4 id="babelplugin-transform-runtime"><a class="markdownIt-Anchor" href="#babelplugin-transform-runtime"></a> @babel/plugin-transform-runtime</h4><p>polyfill é»˜è®¤æƒ…å†µä¸‹æ·»åŠ çš„æ‰€æœ‰ç‰¹æ€§éƒ½æ˜¯å…¨å±€çš„, å¦‚æœç¼–å†™ç¬¬ä¸‰æ–¹åº“éœ€è¦ä½¿ç”¨ polyfill å°±æœ‰å¯èƒ½æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å®‰è£…<code>@babel/plugin-transform-runtime</code>æ¥æ·»åŠ  polyfill.</p><p>å…³äº<code>useBuiltIns</code>å’Œ<code>@babel/plugin-transform-runtime</code>çš„åŒºåˆ«, babel å¼€å‘äººå‘˜åšå‡ºäº†å›ç­”<a href="https://github.com/babel/babel/issues/10271">https://github.com/babel/babel/issues/10271</a>:</p><blockquote><p>useBuiltIns and @babel/plugin-transform-runtime are mutually exclusive. Both are used to add polyfills: the first adds them globally, the second one adds them without attatching them to the global scope.<br />You should decide which behavior you want and stick with it.</p></blockquote><p>æ ¹æ®è‡ªå·±çš„åœºæ™¯ä½¿ç”¨<code>useBuiltIns</code>è¿˜æ˜¯<code>@babel/plugin-transform-runtime</code>.</p><h3 id="babel-with-react"><a class="markdownIt-Anchor" href="#babel-with-react"></a> babel with react</h3><p>react è„šæ‰‹æ¶å°±æ˜¯é€šè¿‡<code>@babel/preset-react</code>æ¥è§£æ JSX æ–‡ä»¶çš„, ç”¨ä¸€ä¸ªç®€å•çš„ demo ä»‹ç»ä¸‹ babel åœ¨ react ä¸­çš„ä½¿ç”¨.</p><p><code>babel.config.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">presets</span>: [<br>    [<br>      <span class="hljs-string">&quot;@babel/preset-env&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">useBuiltIns</span>: <span class="hljs-string">&quot;usage&quot;</span>,<br>        <span class="hljs-attr">corejs</span>: <span class="hljs-number">3</span>,<br>      &#125;,<br>    ],<br>    [<span class="hljs-string">&quot;@babel/preset-react&quot;</span>],<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p><code>index.jsx</code>:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;app&quot;</span>));<br></code></pre></td></tr></table></figure><p><code>template.html</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Day6 p2<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ç»“æœ:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663921580712_5592.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°æ­£å¸¸å±•ç¤ºäº†.</p><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day6">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day6</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><p><a href="https://esprima.org/demo/parse.html#">babel åœ¨çº¿è¯æ³•åˆ†æ/è¯­æ³•åˆ†æ</a><br /><a href="https://juejin.cn/post/6844903992762318855">å‰ç«¯ Javascript: Babel æ€ä¹ˆæŠŠå­—ç¬¦ä¸²è§£ææˆ ASTï¼Œæ˜¯æ€ä¹ˆè¿›è¡Œè¯æ³•/è¯­æ³•åˆ†æçš„ï¼Ÿ</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(5)</title>
    <link href="/2022/09/15/2022-09-15-study-webpack-day5/"/>
    <url>/2022/09/15/2022-09-15-study-webpack-day5/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="mode-in-webpack-config"><a class="markdownIt-Anchor" href="#mode-in-webpack-config"></a> mode in webpack config</h2><p>ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;development&quot;</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç®€å•çœ‹ä¸‹ webpack å®˜ç½‘å¯¹<code>mode</code>çš„æè¿°:</p><table><thead><tr><th>option</th><th>description</th></tr></thead><tbody><tr><td><code>development</code></td><td>SetsÂ <code>process.env.NODE_ENV</code>Â onÂ <code>DefinePlugin</code>Â to valueÂ <code>development</code>.<br> Enables useful names for modules and chunks.</td></tr><tr><td><code>production</code></td><td>SetsÂ <code>process.env.NODE_ENV</code>Â onÂ <code>DefinePlugin</code>Â to valueÂ <code>production</code>.<br> Enables deterministic mangled names for modules and chunks,<br>Â <code>FlagDependencyUsagePlugin</code>,Â <code>FlagIncludedChunksPlugin</code>,<br>Â <code>ModuleConcatenationPlugin</code>,Â <code>NoEmitOnErrorsPlugin</code>Â andÂ <code>TerserPlugin</code>.</td></tr><tr><td><code>none</code></td><td>Opts out of any default optimization options</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°<code>mode</code>å¯ä»¥è®¾ç½®ä¸º<code>development</code>, <code>production</code>, <code>none</code>, å¹¶ä¸”<code>development</code>å’Œ<code>production</code> å­˜åœ¨ webpack é¢„è®¾çš„ä¸€äº›é»˜è®¤é…ç½®. åé¢ä¾‹å­ä¸ºç‰¹æ®Šè¯´æ˜<code>mode</code>éƒ½ä¸º<code>development</code></p><h2 id="webpack-æ¨¡å—åŒ–åŸç†"><a class="markdownIt-Anchor" href="#webpack-æ¨¡å—åŒ–åŸç†"></a> webpack æ¨¡å—åŒ–åŸç†</h2><p>ä¹‹å‰æåˆ°æµè§ˆå™¨ç›®å‰åªèƒ½è§£æ ESM æ¨¡å—(æŸäº›æµè§ˆå™¨ç”šè‡³æ— æ³•è§£ææ¨¡å—), éœ€è¦æ·»åŠ <code>&lt;script type=&quot;module&quot;&gt;</code>, ä½†æ˜¯é€šè¿‡ webpack æ‰“åŒ…çš„ä»£ç , å…è®¸ ä½¿ç”¨å„ç§å„æ ·çš„æ¨¡å—åŒ–, AMD, CMD, CommonJS, ESModule ç­‰, å®ƒæ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬å®ç°ä»£ç ä¸­æ”¯æŒæ¨¡å—åŒ–çš„å‘¢? è¿™é‡Œä»¥æœ€å¸¸ç”¨çš„ CommonJS å’Œ ESModule ä¸¾ä¾‹, ä¾æ¬¡ä»‹ç» webpack ä¸­:</p><ul><li>CommonJS æ¨¡å—åŒ–å®ç°åŸç†</li><li>ES Module æ¨¡å—åŒ–å®ç°åŸç†</li><li>CommonJS åŠ è½½ ES Module åŸç†</li><li>ES Module åŠ è½½ CommonJS åŸç†</li></ul><p>æ¯ç§æƒ…å†µéƒ½ä¼šä»¥ç®€å•æ¡ˆä¾‹è®²è§£, å¼€å§‹ä¹‹å‰<code>webpack.config.js</code>å…ˆé…ç½®<code>devtool: &quot;source-map&quot;</code>, å› ä¸º<code>development</code>æ¨¡å¼ä¸‹æ‰“åŒ…é»˜è®¤ä½¿ç”¨<code>eval</code>, ä¸æ–¹ä¾¿é˜…è¯»æ‰“åŒ…äº§ç‰©ä»£ç , å…·ä½“å«ä¹‰åç»­ä»‹ç».</p><h3 id="iife-ç«‹å³æ‰§è¡Œå‡½æ•°"><a class="markdownIt-Anchor" href="#iife-ç«‹å³æ‰§è¡Œå‡½æ•°"></a> IIFE ç«‹å³æ‰§è¡Œå‡½æ•°</h3><p>äº§ç‰©ä¸­ä¼šå‡ºç°å¤§é‡ç«‹å³æ‰§è¡Œå‡½æ•°, å­˜åœ¨å¤šç§å†™æ³•, å¯ä»¥å…ˆé˜…è¯»<a href="https://segmentfault.com/a/1190000003902899">JavaScript ä¸­çš„ç«‹å³æ‰§è¡Œå‡½æ•°</a></p><h3 id="commonjs-æ¨¡å—åŒ–å®ç°åŸç†"><a class="markdownIt-Anchor" href="#commonjs-æ¨¡å—åŒ–å®ç°åŸç†"></a> CommonJS æ¨¡å—åŒ–å®ç°åŸç†</h3><p>å…¥å£æ–‡ä»¶<code>index.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; dateFormat, prizeFormat &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./util/format&quot;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">dateFormat</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">prizeFormat</span>(<span class="hljs-number">100</span>));<br></code></pre></td></tr></table></figure><p>å¼•å…¥æ¨¡å—æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dateFormat</span>(<span class="hljs-params">date</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2022-09-14&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">prizeFormat</span>(<span class="hljs-params">prize</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;100.00&quot;</span>;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  dateFormat,<br>  prizeFormat,<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…åçš„æ–‡ä»¶<code>bundle.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ç«‹å³æ‰§è¡Œå‡½æ•°å»ºç«‹ä½œç”¨åŸŸ, é¿å…å˜é‡æ±¡æŸ“</span><br>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// å®šä¹‰å½“å‰ä½œç”¨åŸŸä¸‹å…¨å±€å¯¹è±¡, åŒ…å«æ‰€æœ‰requireå¼•ç”¨çš„æ¨¡å—</span><br>  <span class="hljs-keyword">var</span> __webpack_modules__ = &#123;<br>    <span class="hljs-comment">// keyä¸ºæ¨¡å—è·¯å¾„, å€¼ä¸ºåŒ…å«æ¨¡å—å†…å®¹çš„å‡½æ•°</span><br>    <span class="hljs-string">&quot;./util/format.js&quot;</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">function</span> <span class="hljs-title function_">dateFormat</span>(<span class="hljs-params">date</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2022-09-14&quot;</span>;<br>      &#125;<br><br>      <span class="hljs-keyword">function</span> <span class="hljs-title function_">prizeFormat</span>(<span class="hljs-params">prize</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;100.00&quot;</span>;<br>      &#125;<br><br>      <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>        dateFormat,<br>        prizeFormat,<br>      &#125;;<br>    &#125;,<br>  &#125;;<br>  <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡ç”¨äºç¼“å­˜</span><br>  <span class="hljs-keyword">var</span> __webpack_module_cache__ = &#123;&#125;;<br>  <span class="hljs-comment">// commonjsä¸­requireå‡½æ•°çš„polyfillå®ç°</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) &#123;<br>    <span class="hljs-comment">// æ ¹æ®æ¨¡å—è·¯å¾„è·å–ç¼“å­˜ä¸­çš„æ¨¡å—å†…å®¹</span><br>    <span class="hljs-keyword">var</span> cachedModule = __webpack_module_cache__[moduleId];<br>    <span class="hljs-comment">// å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›</span><br>    <span class="hljs-keyword">if</span> (cachedModule !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-keyword">return</span> cachedModule.<span class="hljs-property">exports</span>;<br>    &#125;<br>    <span class="hljs-comment">// ç¼“å­˜ä¸­ä¸å­˜åœ¨, å°†moduleå˜é‡å’Œåœ¨ç¼“å­˜ä¸­éƒ½åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡, å±æ€§ä¸ºexports</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = (__webpack_module_cache__[moduleId] = &#123;<br>      <span class="hljs-attr">exports</span>: &#123;&#125;,<br>    &#125;);<br>    <span class="hljs-comment">// å°†æ¨¡å—å†…å®¹èµ‹å€¼ç»™module, ä»è€Œå¾—åˆ°module.exports, åç»­èƒ½å¤Ÿä»ç¼“å­˜ä¸­è·å–</span><br>    <span class="hljs-comment">// å®ä¾‹ä¸­è¿˜æ²¡ç”¨åˆ°æ¨¡å—ä¸­å¼•ç”¨å…¶ä»–æ¨¡å—çš„æƒ…å†µ, æš‚ä¸è®²è§£åä¸¤ä¸ªå‚æ•°</span><br>    __webpack_modules__[moduleId](<span class="hljs-variable language_">module</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, __webpack_require__);<br>    <span class="hljs-comment">// è¿”å›æ¨¡å—å†…å®¹</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> __webpack_exports__ = &#123;&#125;;<br><br>  <span class="hljs-comment">// ç«‹å³æ‰§è¡Œå‡½æ•°è¾“å‡ºç»“æœ</span><br>  (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// ä¸‹é¢å¼•ç”¨æ¨¡å—é€»è¾‘å’Œæ‰“åŒ…å‰æºç ç›¸åŒ, ä¸åšè§£é‡Š</span><br>    <span class="hljs-keyword">const</span> &#123; dateFormat, prizeFormat &#125; = <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-string">&quot;./util/format.js&quot;</span>);<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">dateFormat</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">prizeFormat</span>(<span class="hljs-number">100</span>));<br>  &#125;)();<br>&#125;)();<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…åçš„æ‰€æœ‰é€»è¾‘éƒ½æœ‰å¯¹åº”çš„æ³¨é‡Š, å¯ä»¥çœ‹åˆ° webpack é€šè¿‡<code>__webpack_modules__</code>å¯¹è±¡å­˜å‚¨æ¨¡å—è·¯å¾„å’Œå†…å®¹, <code>__webpack_module_cache__</code>å¯¹è±¡ç¼“å­˜æ‰€æœ‰<code>module.exports</code>, <code>__webpack_require__</code>å‡½æ•°ç®€å•å®ç°äº† CommonJS ä¸­<code>require</code></p><h3 id="esm-æ¨¡å—åŒ–å®ç°åŸç†"><a class="markdownIt-Anchor" href="#esm-æ¨¡å—åŒ–å®ç°åŸç†"></a> ESM æ¨¡å—åŒ–å®ç°åŸç†</h3><p>å…¥å£æ–‡ä»¶<code>esm_index.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> math <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./util/math&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">sum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">mul</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>));<br></code></pre></td></tr></table></figure><p>å¼•å…¥æ¨¡å—æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b</span>) &#123;<br>  <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">a, b</span>) &#123;<br>  <span class="hljs-keyword">return</span> a * b;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  sum,<br>  mul,<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…äº§ç‰©:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-string">&quot;use strict&quot;</span>;<br>  <span class="hljs-keyword">var</span> __webpack_modules__ = &#123;<br>    <span class="hljs-string">&quot;./util/math.js&quot;</span>: <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">      __unused_webpack_module,</span></span><br><span class="hljs-params"><span class="hljs-function">      __webpack_exports__,</span></span><br><span class="hljs-params"><span class="hljs-function">      __webpack_require__</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>) =&gt;</span> &#123;<br>      __webpack_require__.<span class="hljs-title function_">r</span>(__webpack_exports__);<br>      __webpack_require__.<span class="hljs-title function_">d</span>(__webpack_exports__, &#123;<br>        <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> __WEBPACK_DEFAULT_EXPORT__,<br>      &#125;);<br>      <span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b</span>) &#123;<br>        <span class="hljs-keyword">return</span> a + b;<br>      &#125;<br><br>      <span class="hljs-keyword">function</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">a, b</span>) &#123;<br>        <span class="hljs-keyword">return</span> a * b;<br>      &#125;<br><br>      <span class="hljs-keyword">const</span> __WEBPACK_DEFAULT_EXPORT__ = &#123;<br>        sum,<br>        mul,<br>      &#125;;<br>    &#125;,<br>  &#125;;<br><br>  <span class="hljs-keyword">var</span> __webpack_module_cache__ = &#123;&#125;;<br>  <span class="hljs-comment">// å’Œcommonjsæ‰“åŒ…ç»“æœç±»ä¼¼, exportsèµ‹å€¼, å†™å…¥ç¼“å­˜, è¿”å›module.exports</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) &#123;<br>    <span class="hljs-keyword">var</span> cachedModule = __webpack_module_cache__[moduleId];<br>    <span class="hljs-keyword">if</span> (cachedModule !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-keyword">return</span> cachedModule.<span class="hljs-property">exports</span>;<br>    &#125;<br>    <span class="hljs-comment">// ç¼“å­˜</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = (__webpack_module_cache__[moduleId] = &#123;<br>      <span class="hljs-attr">exports</span>: &#123;&#125;,<br>    &#125;);<br>    <span class="hljs-comment">// exportså¤åˆ¶</span><br>    __webpack_modules__[moduleId](<span class="hljs-variable language_">module</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, __webpack_require__);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;<br>  &#125;<br><br>  (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// define è¿™é‡Œ</span><br>    __webpack_require__.<span class="hljs-property">d</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">exports</span>, definition</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> definition) &#123;<br>        <span class="hljs-comment">// å¦‚æœdefinition hasOwnProperty, module.exportsæ²¡æœ‰è¯¥å±æ€§, è¿™é‡Œæ˜¯defaultç†Ÿæ‚‰</span><br>        <span class="hljs-keyword">if</span> (<br>          __webpack_require__.<span class="hljs-title function_">o</span>(definition, key) &amp;&amp;<br>          !__webpack_require__.<span class="hljs-title function_">o</span>(<span class="hljs-built_in">exports</span>, key)<br>        ) &#123;<br>          <span class="hljs-comment">// å°†__webpack_modules__ä¸­çš„å±æ€§ä»£ç†åˆ°module.exportsä¸­, å’Œcommonjsä¸åŒ, ä¸æ˜¯ç®€å•çš„å¤åˆ¶</span><br>          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, key, &#123;<br>            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">get</span>: definition[key],<br>          &#125;);<br>        &#125;<br>      &#125;<br>    &#125;;<br>  &#125;)();<br><br>  (<span class="hljs-function">() =&gt;</span> &#123;<br>    __webpack_require__.<span class="hljs-property">o</span> = <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span><br>      <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(obj, prop);<br>  &#125;)();<br><br>  (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// ç»™å½“å‰module.exportsæ·»åŠ æ ‡è¯†ESMå±æ€§</span><br>    __webpack_require__.<span class="hljs-property">r</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">exports</span></span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// å¦‚æœæµè§ˆå™¨æ”¯æŒSymbolæ•°æ®ç±»å‹, è¿˜ä¼šæ·»åŠ ä¸€ä¸ª</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Symbol</span> !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span>) &#123;<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, <span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;Module&quot;</span> &#125;);<br>      &#125;<br>      <span class="hljs-comment">// æ·»åŠ __esModuleå±æ€§</span><br>      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, <span class="hljs-string">&quot;__esModule&quot;</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> &#125;);<br>    &#125;;<br>  &#125;)();<br><br>  <span class="hljs-comment">// ç¼“å­˜å¯¹è±¡</span><br>  <span class="hljs-keyword">var</span> __webpack_exports__ = &#123;&#125;;<br><br>  (<span class="hljs-function">() =&gt;</span> &#123;<br>    __webpack_require__.<span class="hljs-title function_">r</span>(__webpack_exports__);<br>    <span class="hljs-keyword">var</span> _util_math__WEBPACK_IMPORTED_MODULE_0__ =<br>      <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-string">&quot;./util/math.js&quot;</span>);<br>    <span class="hljs-comment">// ä½¿ç”¨exportsæ˜ å°„defaultå¯¹è±¡çš„æ–¹æ³•</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_util_math__WEBPACK_IMPORTED_MODULE_0__[<span class="hljs-string">&quot;default&quot;</span>].<span class="hljs-title function_">sum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>));<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_util_math__WEBPACK_IMPORTED_MODULE_0__[<span class="hljs-string">&quot;default&quot;</span>].<span class="hljs-title function_">mul</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>));<br>  &#125;)();<br>&#125;)();<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶å®å’Œ commonjs æœ€å¤§çš„åŒºåˆ«æ˜¯</p><ol><li>å¢åŠ äº† esmodule å±æ€§æ ‡è¯†</li><li>é€šè¿‡<code>Object.defineProperty</code>ä»£ç† module.exports å±æ€§ä»£æ›¿ç›´æ¥èµ‹å€¼</li><li><s>å¤šäº† default</s></li></ol><h3 id="æ··ç”¨-commonjs-å’Œ-esmodule"><a class="markdownIt-Anchor" href="#æ··ç”¨-commonjs-å’Œ-esmodule"></a> æ··ç”¨ CommonJs å’Œ ESModule</h3><p>åŒæ—¶åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ CommonJS å’Œ ESModule æ‰“åŒ…ç»“æœå’Œä¸Šè¿°å¤§åŒå°å¼‚, å¯ä»¥ç›´æ¥ç¤ºä¾‹ä»£ç ä¸­ esModule æ–‡ä»¶å¤¹ä¸‹çš„æ‰“åŒ…äº§ç‰©, è¿™é‡Œä¸è¿‡å¤šèµ˜è¿°.</p><h2 id="devtool-in-webpack"><a class="markdownIt-Anchor" href="#devtool-in-webpack"></a> devtool in webpack</h2><p>é…ç½® devtool èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åœ¨ç¨‹åºæŠ¥é”™æ›´å¥½åœ°å®šä½é—®é¢˜, webpack ä¸­æä¾›äº† 26 ç§ devtool çš„å€¼, ä¸‹é¢è¯¦ç»†ä»‹ç».</p><p>mode ä¸º<code>development</code>, devtool é»˜è®¤å€¼ä¸º<code>eval</code>;<br />mode ä¸º<code>production</code>, devtool é»˜è®¤å€¼ä¸º(nond), è¿™é‡Œçš„ none ä¸æ˜¯å­—ç¬¦ä¸², è¡¨ç¤ºæ²¡æœ‰è¯¥é¡¹é…ç½®;</p><h3 id="source-map"><a class="markdownIt-Anchor" href="#source-map"></a> source-map</h3><p>devtool è®¾ç½®ä¸º<code>source-map</code>å, æ‰“åŒ…äº§ç‰©ä¼šå¤šå‡ºæ¥ä¸€ä¸ª<code>bundle.js.map</code>æ–‡ä»¶</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663606242302_6243.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¹¶ä¸”åœ¨<code>bundle.js</code>æœ€åä¼šæ·»åŠ  source-map é“¾æ¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-comment"># sourceMappingURL=bundle.js.map</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ mode ä¸º<code>production</code>, devtool è®¾ç½®<code>source-map</code>ç”Ÿæˆçš„<code>bundle.js.map</code>å†…å®¹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bundle.js&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AASgB,IAAIA,SAAQ,CAACC,EAASC,KAAV,IAH1BC,QAAQC,IAFM,eAShBD,QAAQC,IAAIC&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sources&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;webpack:///./src/index.js&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sourcesContent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-comment">/*æºä»£ç å­—ç¬¦ä¸²*/</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;names&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Promise&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;resolve&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;reject&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;console&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;log&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;abc&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sourceRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ¯ä¸ªå­—æ®µå«ä¹‰å¦‚ä¸‹:</p><ul><li>versionï¼šSource map çš„ç‰ˆæœ¬ï¼Œç›®å‰ä¸º 3ã€‚</li><li>fileï¼šè½¬æ¢åçš„æ–‡ä»¶åã€‚</li><li>sourceRootï¼šè½¬æ¢å‰çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœä¸è½¬æ¢å‰çš„æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ï¼Œè¯¥é¡¹ä¸ºç©ºã€‚</li><li>sourcesï¼šè½¬æ¢å‰çš„æ–‡ä»¶ã€‚è¯¥é¡¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå¯èƒ½å­˜åœ¨å¤šä¸ªæ–‡ä»¶åˆå¹¶ã€‚æœ‰æ—¶ä¹Ÿä¼šåŒ…å« webpack åº“ä¸­çš„æ–‡ä»¶</li><li>namesï¼šè½¬æ¢å‰çš„æ‰€æœ‰å˜é‡åå’Œå±æ€§åã€‚mode ä¸º<code>development</code>æ—¶ä»£ç å¹¶æ²¡æœ‰è¿›è¡Œæ··æ·†, å˜é‡åå’Œå±æ€§åéƒ½ä¸å˜, names ä¸ºç©ºæ•°ç»„</li><li>mappingsï¼šè®°å½•ä½ç½®ä¿¡æ¯çš„å­—ç¬¦ä¸²ï¼Œè®°å½•åŸæ–‡ä»¶åˆ°æ‰“åŒ…æ–‡ä»¶çš„æ‰€æœ‰æ˜ å°„, è¯¦æƒ…å¯ä»¥æŸ¥é˜…<a href="https://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html">é˜®ä¸€å³°åšå®¢</a></li></ul><p>é»˜è®¤æµè§ˆå™¨ä¼šå¼€å¯ source-map, é…ç½®å¦‚å›¾:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663847472517_2059.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>åœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ° source-map æ˜ å°„çš„æºæ–‡ä»¶</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663847580783_1435.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="eval"><a class="markdownIt-Anchor" href="#eval"></a> eval</h3><p>JavaScript åŸç”Ÿæ”¯æŒçš„ eval å‡½æ•°å¯ä»¥åœ¨ç»“å°¾æ·»åŠ ç±»ä¼¼ source-map çš„ sourceURL ç”¨äºæ‰“åŒ…å‰çš„æºæ–‡ä»¶, ä»è€Œå®ç°æ˜ å°„, è¿™ä¹Ÿæ˜¯<code>mode: &quot;development&quot;</code>çš„é»˜è®¤ devtool é…ç½®, ä½†æ˜¯è¿™æ ·çš„ä»£ç ä¸æ–¹ä¾¿é˜…è¯»</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-comment"># sourceURL=webpack:///./src/index.js?</span><br></code></pre></td></tr></table></figure><h3 id="inline-source-map"><a class="markdownIt-Anchor" href="#inline-source-map"></a> inline-source-map</h3><p>ä¸ä¼šå† source-map æ–‡ä»¶, è€Œæ˜¯ä»¥ base64 ç¼–ç  inline åœ¨æ‰“åŒ…äº§ç‰© js ä¸­</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-comment"># sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG1EQUFtRDs7QUFFbkQ7O0FBRUEsaUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIG5lY2Vzc2FyeSB3aGlsZSB1c2VCdWlsdEluczogJ2VudHJ5JyAqL1xuLy8gaW1wb3J0ICdjb3JlLWpzL3N0YWJsZSc7XG4vLyBpbXBvcnQgJ3JlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSc7XG5cbmNvbnN0IG1lc3NhZ2UgPSAnSGVsbG8gd29ybGQnO1xuY29uc3QgZm9vID0gKG5hbWUpID0+IHtcbiAgY29uc29sZS5sb2cobmFtZSk7XG59O1xuXG5jb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge30pO1xuXG5mb28obWVzc2FnZSk7XG5cbmNvbnNvbGUubG9nKGFiYyk7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9</span><br></code></pre></td></tr></table></figure><h3 id="eval-source-map"><a class="markdownIt-Anchor" href="#eval-source-map"></a> eval-source-map</h3><p>é¡¾åæ€ä¹‰, ä¼šç”Ÿæˆ eval é“¾æ¥å’Œ sourcep-map é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">//# </span><span class="language-bash">sourceMappingURL=data:application/json;charset=utf-8;<span class="hljs-built_in">base64</span>,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXguanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG1EQUFtRDs7QUFFbkQ7O0FBRUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanM/YjYzNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiogbmVjZXNzYXJ5IHdoaWxlIHVzZUJ1aWx0SW5zOiAnZW50cnknICovXG4vLyBpbXBvcnQgJ2NvcmUtanMvc3RhYmxlJztcbi8vIGltcG9ydCAncmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lJztcblxuY29uc3QgbWVzc2FnZSA9ICdIZWxsbyB3b3JsZCc7XG5jb25zdCBmb28gPSAobmFtZSkgPT4ge1xuICBjb25zb2xlLmxvZyhuYW1lKTtcbn07XG5cbmNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7fSk7XG5cbmZvbyhtZXNzYWdlKTtcblxuY29uc29sZS5sb2coYWJjKTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//<span class="hljs-comment"># sourceURL=webpack-internal:///./src/index.js</span></span><br></code></pre></td></tr></table></figure><h3 id="cheap-source-map"><a class="markdownIt-Anchor" href="#cheap-source-map"></a> cheap-source-map</h3><p>source-map å¯¹äºæŠ¥é”™ä¿¡æ¯ä¼šè¯¦ç»†åˆ°æŸè¡ŒæŸåˆ—, cheap-source-map åªä¼šç²¾ç»†åˆ°è¡Œ**(ç½‘ä¸Šæ˜¯è¿™ä¹ˆè¯´çš„, è™½ç„¶æˆ‘éªŒè¯çš„æ—¶å€™è®¾ç½® source-map æˆ– cheap-source-map å¥½åƒæ²¡ä»€ä¹ˆåŒºåˆ«)**<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663847377810_2941.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="cheap-module-source-map"><a class="markdownIt-Anchor" href="#cheap-module-source-map"></a> cheap-module-source-map</h3><p>å¦‚æœæºç ç»è¿‡ loader ä¾‹å¦‚ babel-loader å¤„ç†å, ä½¿ç”¨ cheap-source-map ä¼šé“¾æ¥åˆ° loader å¤„ç†è¿‡çš„æ–‡ä»¶, å’Œæºç è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„, ä½¿ç”¨ cheap-module-source-map å°±ä¼šæ­£å¸¸æŒ‡å‘æºæ–‡ä»¶äº†.<br />è¿™ä¹Ÿæ˜¯ react å®˜æ–¹è„šæ‰‹æ¶æœ¬åœ°ç¯å¢ƒä¸‹é»˜è®¤çš„ devtool é…ç½®.</p><p><code>cheap-source-map</code>:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663850502293_5513.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p><code>cheap-module-source-map</code>:</p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663850594410_5564.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="hidden-source-map"><a class="markdownIt-Anchor" href="#hidden-source-map"></a> hidden-source-map</h3><p>ä¼šç”Ÿæˆ source-map æ–‡ä»¶, ä½†ä¸ä¼šåœ¨ javascript æ–‡ä»¶ä¸­é“¾æ¥, ä¸€èˆ¬ç”¨äºå‰ç«¯é”™è¯¯ä¿¡æ¯ä¸ŠæŠ¥, åç«¯é€šè¿‡é”™è¯¯ä¸­çš„è¡Œåˆ—ä¿¡æ¯è¿˜åŸå‡ºæºæ–‡ä»¶çš„æŠ¥é”™ä½ç½®.</p><h3 id="nosources-source-map"><a class="markdownIt-Anchor" href="#nosources-source-map"></a> nosources-source-map</h3><p>ä½¿ç”¨ nosources å…³é”®å­—ç”Ÿæˆçš„ source-map æ–‡ä»¶ä¸­ä¸åŒ…å« sourcesContent å†…å®¹, å› æ­¤è°ƒè¯•æ—¶åªèƒ½çœ‹åˆ°æºæ–‡ä»¶çš„è¡Œåˆ—é”™è¯¯ä¿¡æ¯, æ— æ³•çœ‹åˆ°æºç <br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1663851512071_8530.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>ä¸Šé¢ä»‹ç»äº†æ¯”è¾ƒå…¸å‹çš„å‡ ä¸ª devtool é…ç½®, ç†è§£äº†æ¯ä¸ªå…³é”®å­—çš„å«ä¹‰ä¹Ÿå°±çŸ¥é“å¦‚ä½•é…ç½®äº†. æ‰€æœ‰çš„ devtool é…ç½®éƒ½æ˜¯ä»¥ä¸‹å‡ ä¸ªå…³é”®å­—çš„æ’åˆ—ç»„åˆ</p><p><code>[inline-|hidden-|eval][nosources-][cheap-[module-]][source-map]</code></p><p>ä¸‹é¢ç»™å‡ºä¸åŒç¯å¢ƒä¸‹çš„æœ€ä½³é…ç½®:</p><ul><li>å¼€å‘/æµ‹è¯•ç¯å¢ƒ: <code>source-map</code> or <code>cheap-module-source-map</code></li><li>çº¿ä¸Šç¯å¢ƒ: false or æ ¹æ®ä¸ŠæŠ¥éœ€æ±‚ä½¿ç”¨ hidden, nosources</li></ul><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day5">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day5</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><p><a href="https://segmentfault.com/a/1190000003902899">JavaScript ä¸­çš„ç«‹å³æ‰§è¡Œå‡½æ•°</a><br /><a href="https://juejin.cn/post/6960941899616092167">ä¸€æ–‡ææ‡‚ SourceMap ä»¥åŠ webpack devtool</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(4)</title>
    <link href="/2022/09/09/2022-09-09-study-webpack-day4/"/>
    <url>/2022/09/09/2022-09-09-study-webpack-day4/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="plugin"><a class="markdownIt-Anchor" href="#plugin"></a> Plugin</h2><ul><li>Loader æ˜¯ç”¨äºç‰¹å®šçš„æ¨¡å—ç±»å‹è¿›è¡Œè½¬æ¢</li><li>Plugin åˆ™å¯ä»¥ç”¨äºæ‰§è¡Œæ›´åŠ å¹¿æ³›çš„ä»»åŠ¡, æ¯”å¦‚æ‰“åŒ…ä¼˜åŒ–, èµ„æºç®¡ç†, ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰åŠŸèƒ½, ä½ èƒ½æƒ³åˆ°çš„åŠŸèƒ½ plugin åº”è¯¥éƒ½å¯ä»¥å®ç°.</li></ul><p>æ‰€æœ‰ plugin éƒ½ä¼šæš´éœ²å‡ºç±», é€šè¿‡å®ä¾‹åŒ–ä½¿ç”¨ plugin, é…ç½®å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>()],<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„ plugin:</p><h3 id="cleanwebpackplugin"><a class="markdownIt-Anchor" href="#cleanwebpackplugin"></a> <code>CleanWebpackPlugin</code></h3><p>æ¯æ¬¡æ‰“åŒ…å‰å°† output çš„æ–‡ä»¶å¤¹åˆ é™¤, webpack æ‰“åŒ…äº§ç‰©ä¼šåœ¨äº§ç‰©ç›®å½•ä¸‹ç›´æ¥å†™å…¥, å¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤</p><p>å®‰è£…: <code>yarn add -D clean-webpack-plugin</code></p><p>ä½¿ç”¨: <code>const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</code></p><h3 id="htmlwebpackplugin"><a class="markdownIt-Anchor" href="#htmlwebpackplugin"></a> <code>HtmlWebpackPlugin</code></h3><p>ä¹‹å‰æ‰“åŒ…äº§ç‰©å¹¶ä¸åŒ…å« html æ–‡ä»¶, éœ€è¦è‡ªå·±åˆ›å»º html æ–‡ä»¶å¹¶å°†æ‰“åŒ…äº§ç‰© js,css æ–‡ä»¶å¼•å…¥, è´¹æ—¶è´¹åŠ›; è¯¥æ’ä»¶ç”¨äºåœ¨æœ€ç»ˆæ‰“åŒ…äº§ç‰©ç›®å½•ä¸‹ç”Ÿæˆ html æ–‡ä»¶å¹¶è¿›è¡Œèµ„æºçš„å…³è”</p><p>å®‰è£…: <code>yarn add -D html-webpack-plugin</code></p><p>ä½¿ç”¨: <code>const HtmlWebpackPlugin = require('html-webpack-plugin');</code></p><p>è¿™é‡Œæ˜¯å¦éœ€è¦è§£æ„æ ¹æ®ä¸åŒæ’ä»¶å¼€å‘è€…ä¹ æƒ¯è€Œå®š, ä¸å¿…çº ç»“.<br /><code>HtmlWebpackPlugin</code>æ’ä»¶å†…éƒ¨å†…ç½®äº†ä¸€ä¸ª ejs æ¨¡æ¿, æ‰“åŒ…æ—¶æ’ä»¶å°±ä¼šé€šè¿‡ä¼ å…¥çš„å˜é‡å¯¹ ejs render å¾—åˆ°æœ€åçš„ html æ–‡ä»¶å¹¶å†™å…¥æ„å»ºäº§ç‰©ç›®å½•ä¸­, å¯ä»¥ç®€å•çœ‹ä¸‹è¿™ä¸ª ejs æ–‡ä»¶:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„, ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶, vue, react è¿™ç±»æ¡†æ¶çš„è„šæ‰‹æ¶å°±æ˜¯è¿™ä¹ˆå¹²çš„; é€šè¿‡ vue-cli ç”Ÿæˆçš„é¡¹ç›®çš„ html æ¨¡æ¿æ–‡ä»¶åœ¨<code>public/index.html</code>ä¸‹, ä¿®æ”¹è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶é…ç½®:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Mariana Blog&quot;</span>,<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;./public/template.html&quot;</span>,<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;output.html&quot;</span>, <span class="hljs-comment">// æ‰“åŒ…äº§ç‰©ä¸­htmlçš„æ–‡ä»¶å</span><br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="defineplugin"><a class="markdownIt-Anchor" href="#defineplugin"></a> <code>DefinePlugin</code></h3><p>å…è®¸åœ¨ç¼–è¯‘æ—¶åˆ›å»ºé…ç½®çš„å…¨å±€å¸¸é‡, webpack å†…ç½®æ’ä»¶(ä¸éœ€è¦å•ç‹¬å®‰è£…)</p><p>ä½¿ç”¨: <code>const &#123; DefinePlugin &#125; = require('webpack');</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">DefinePlugin</span>(&#123;<br>  <span class="hljs-attr">BASE_URL</span>: <span class="hljs-string">&#x27;&quot;./&quot;&#x27;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœå®šä¹‰å­—ç¬¦ä¸²<strong>ä¸èƒ½çœç•¥å¼•å·</strong>, å¯èƒ½æ˜¯å› ä¸ºæºç åˆè¿›è¡Œ eval ç­‰å¤„ç†, æ²¡å…·ä½“çœ‹è¿‡æºç , åªæ˜¯çŒœæµ‹.</p><h3 id="copywebpackplugin"><a class="markdownIt-Anchor" href="#copywebpackplugin"></a> <code>CopyWebpackPlugin</code></h3><p>å°†æ–‡ä»¶å¤¹ä¸­æŒ‡å®šç›®å½• copy å¸¦æ‰“åŒ…äº§ç‰©ä¸­</p><p>å®‰è£…: <code>yarn add -D copy-webpack-plugin</code></p><p>ä½¿ç”¨: <code>const CopyWebpackPlugin = require('webpack')</code></p><p>ç®€å•é…ç½®å¦‚ä¸‹, æ›´å¤šé…ç½®å¯ä»¥æŸ¥é˜…å®˜ç½‘</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">patterns</span>: [<br>    &#123;<br>      <span class="hljs-attr">from</span>: <span class="hljs-string">&quot;public&quot;</span>,<br>      <span class="hljs-attr">globOptions</span>: &#123;<br>        <span class="hljs-attr">ignore</span>: [<span class="hljs-string">&quot;**/template.html&quot;</span>, <span class="hljs-string">&quot;**/.DS_Store&quot;</span>],<br>      &#125;,<br>    &#125;,<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ globOption é€šè¿‡<code>glob</code>åº“è¿›è¡Œæ–‡ä»¶åŒ¹é…, éœ€è¦æ·»åŠ <code>**</code>, æ›´å¤šè¯­æ³•å‚è€ƒ<a href="https://www.npmjs.com/package/glob">https://www.npmjs.com/package/glob</a></p><p>å¯ä»¥çœ‹åˆ°æ‰“åŒ…äº§ç‰© public/ä¸‹ include çš„æ–‡ä»¶éƒ½å¤åˆ¶åˆ° build ä¸­äº†<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662993074608_764.png&versionDescriptor%5BversionOptions%5D=0&versionDescriptor%5BversionType%5D=0&versionDescriptor%5Bversion%5D=master&resolveLfs=true&%24format=octetStream&api-version=5.0" width="400" /></p><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day4">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day4</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(3)</title>
    <link href="/2022/09/03/2022-09-03-study-webpack-day3/"/>
    <url>/2022/09/03/2022-09-03-study-webpack-day3/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><h2 id="postcss"><a class="markdownIt-Anchor" href="#postcss"></a> postcss</h2><p>postcss æ˜¯é€šè¿‡ JavaScript è½¬æ¢æ ·å¼çš„å·¥å…·, å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ css çš„è½¬æ¢å’Œé€‚é…, æ¯”å¦‚æ·»åŠ æµè§ˆå™¨å‰ç¼€, reset css, ä½†æ˜¯è¦å®ç°è¿™äº›åŠŸèƒ½éœ€è¦ postcss å¯¹åº”çš„æ’ä»¶, å•ç‹¬ä½¿ç”¨ postcss ä¸€èˆ¬ä»€ä¹ˆéƒ½å¹²ä¸äº†<br />æ‰€ä»¥å¦‚æœè¦ä½¿ç”¨ postcss, éœ€è¦ä¸¤æ­¥:</p><ol><li>æŸ¥æ‰¾å¯¹åº”æ’ä»¶, æ¯”å¦‚ webpack ä¸­çš„<code>post-loader</code></li><li>å®‰è£…å¯¹åº”çš„ npm åŒ…</li></ol><p>è¿™é‡Œä»¥é€šè¿‡å‘½ä»¤è¡Œç»ˆç«¯ä½¿ç”¨ postcss å¯¹ css è‡ªåŠ¨åŠ æµè§ˆå™¨å‰ç¼€ä¸¾ä¾‹ ğŸŒ°</p><ol><li><code>yarn add postcss postcss-cli autoprefixer -D</code><br /><code>postcss</code>ä¸ºå·¥å…·, <code>postcss-cli</code>åœ¨ç»ˆç«¯å¯ä»¥ä½¿ç”¨, <code>autoprefixer</code>ä¸ºè‡ªåŠ¨åŠ æµè§ˆå™¨å‰ç¼€çš„æ’ä»¶(å¿…é¡»å®‰è£…)</li><li><code>npx postcss --use autoprefixer -o output.css ./entry.css</code><br />å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„<code>output.css</code>å·²ç»åŠ ä¸Šäº†æµè§ˆå™¨å‰ç¼€, è¿™é‡Œ<code>autoprefixer</code>éœ€è¦å…¼å®¹çš„æµè§ˆå™¨ä¹Ÿæ˜¯è¯»å–<code>browserslistrc</code></li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css">:-webkit-full-screen &#123;<br>&#125;<br><span class="hljs-selector-pseudo">:fullscreen</span> &#123;<br>&#125;<br><span class="hljs-selector-class">.content</span> &#123;<br>  -webkit-user-select: none;<br>  -moz-user-select: none;<br>  user-select: none;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨çº¿æŸ¥çœ‹<code>autoprefixer</code>å¤„ç†çš„ç»“æœ: <a href="https://autoprefixer.github.io/">https://autoprefixer.github.io/</a></p><h3 id="use-in-webpack"><a class="markdownIt-Anchor" href="#use-in-webpack"></a> use in webpack</h3><p>åœ¨ç»ˆç«¯ä½¿ç”¨ postcss éœ€è¦å®‰è£…<code>postcss-cli</code>, åŒæ ·çš„, å¦‚æœè¦åœ¨ webpack ä¸­ä½¿ç”¨ postcss, éœ€è¦å®‰è£…<code>postcss-loader</code>, <code>webpack.config.js</code>åŠ ä¸Šå¦‚ä¸‹é…ç½®: è¿™æ—¶å€™å°±éœ€è¦æŒ‡å®š options äº†ä¸èƒ½ç›´æ¥æŒ‡å®š loader</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// module.rules</span><br>&#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-regexp">/\.s?css$/i</span>,<br>    <span class="hljs-string">&quot;use&quot;</span>: [<br>        <span class="hljs-string">&quot;style-loader&quot;</span>,<br>        <span class="hljs-string">&quot;css-loader&quot;</span>,<br>        &#123;<br>            <span class="hljs-string">&quot;loader&quot;</span>: <span class="hljs-string">&quot;postcss-loader&quot;</span>,<br>            <span class="hljs-string">&quot;options&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;postcssOptions&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;plugins&quot;</span>: [<br>                        <span class="hljs-string">&quot;autoprefixer&quot;</span><br>                    ]<br>                &#125;<br>            &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;sass-loader&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é‡æ–°æ‰“åŒ…åé¡µé¢åŠ ä¸Šäº†æµè§ˆå™¨å‰ç¼€:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662195688318_7948.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="postcss-preset-env"><a class="markdownIt-Anchor" href="#postcss-preset-env"></a> postcss-preset-env</h3><blockquote><p><a href="https://github.com/csstools/postcss-plugins/tree/main/plugin-packs/postcss-preset-env">PostCSS Preset Env</a>Â lets you convert modern CSS into something most browsers can understand</p></blockquote><p>å¯¹äºä¸€äº› css å†™æ³•, æ¯”å¦‚<code>#12345678</code>,æœ‰çš„æµè§ˆå™¨èƒ½å¤Ÿè§£æä¸º rgba, æœ‰äº›æµè§ˆå™¨æ— æ³•è§£æå¯¼è‡´ä¸ç”Ÿæ•ˆ, åªç”¨äºæ·»åŠ æµè§ˆå™¨å‰ç¼€çš„<code>autoprefixer</code>å°±æ— æ³•å¤„ç†è¿™ç§æƒ…å†µ, æ‰€ä»¥éœ€è¦<code>postcss-preset-env</code>æ’ä»¶å°†å…¶è§£æä¸ºå¤§å¤šæ•°æµè§ˆå™¨èƒ½å¤Ÿçœ‹æ‡‚çš„<code>rgba()</code>æ ¼å¼. å€¼å¾—æ³¨æ„çš„æ˜¯<code>postcss-preset-env</code>æ’ä»¶å†…ç½®äº†<code>autoprefixer</code>, æ‰€ä»¥ä½¿ç”¨<code>postcss-loader</code>æ—¶åªéœ€è¦å¼•å…¥<code>postcss-preset-env</code>å³å¯.</p><h3 id="postcssconfigjs"><a class="markdownIt-Anchor" href="#postcssconfigjs"></a> postcss.config.js</h3><p>å¯¹äº css, sass, less, stylus è€Œè¨€, rules ä¸­ resources åŒ¹é…å¦‚æœç¼–å†™é‡å¤çš„ postcss é€»è¾‘çœ‹èµ·æ¥æ˜¯å¤´å¤§çš„, è¿™é‡Œå¯ä»¥åˆ›å»º<code>postcss.config.js</code>ç»Ÿä¸€é…ç½® options. <code>webpack.config.js</code>ä¸­<code>postcss-loader</code>å°±å¯ä»¥ä½¿ç”¨ string äº†.<br />è¿™é‡Œ plugins ä¸­é…ç½®<code>postcss-preset-env</code>æˆ–<code>require('postcss-preset-env')</code>éƒ½æ˜¯å¯ä»¥çš„, é™¤äº†éƒ¨åˆ†æ’ä»¶ç”¨æ³•<code>require('plugin-name')(...args)</code>ä¸èƒ½ä¼ å…¥ string çš„å½¢å¼</p><p>postcss.config.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;postcss-preset-env&quot;</span>)],<br>&#125;;<br></code></pre></td></tr></table></figure><p>webpack.config.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-regexp">/.s?css$/i</span>,<br>    <span class="hljs-string">&quot;use&quot;</span>: [<br>        <span class="hljs-string">&quot;style-loader&quot;</span>,<br>        <span class="hljs-string">&quot;css-loader&quot;</span>,<br>        <span class="hljs-string">&quot;postcss-loader&quot;</span>,<br>        <span class="hljs-string">&quot;sass-loader&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æµè§ˆå™¨å‰ç¼€å’Œ css ç‰¹æ®Šå†™æ³•éƒ½èƒ½å¤Ÿè¢«æ­£å¸¸è§£æäº†:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662198290436_5913.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="importloaders"><a class="markdownIt-Anchor" href="#importloaders"></a> importLoaders</h3><p>å¦‚æœ css æ–‡ä»¶ä¸­<code>@import url(another.css)</code>, import çš„ css æ–‡ä»¶é»˜è®¤æ˜¯ä¸ä¼šè¢«<code>css-loader</code>å‰æ‰§è¡Œçš„, ä¹‹å‰çš„ loader åªå¤„ç†å½“å‰æ–‡ä»¶ä¸­çš„ css æ ·å¼, æ‰€ä»¥è¿™ç§æƒ…å†µéœ€è¦åœ¨<code>css-loader</code>è§£æå®Œåå†è¿”å›è®©ä¹‹å‰ loader è¿›è¡Œå¤„ç†, é…ç½®å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br><span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br><span class="hljs-attr">options</span>: &#123;<br><span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>,<br>&#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="file-loader"><a class="markdownIt-Anchor" href="#file-loader"></a> file-loader</h3><p>å¤„ç† import/require()æ–¹å¼å¼•å…¥çš„æ–‡ä»¶èµ„æº, æ‰“åŒ…æ—¶æ”¾åˆ°è¾“å‡ºçš„æ–‡ä»¶å¤¹ä¸­<br />é¦–å…ˆå®‰è£… loader:<br /><code>yarn add -D file-loader</code><br />ä»¥å›¾ç‰‡èµ„æºä¸¾ä¾‹, é»˜è®¤æ²¡æœ‰ä½¿ç”¨<code>file-loader</code>æ—¶ä½¿ç”¨ import/require()å¼•å…¥èµ„æºä¼šæŠ¥é”™(backgrgound-image å½¢å¼æ˜¯å¯ä»¥æ­£å¸¸å¼•å…¥èµ„æºçš„)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable constant_">ERROR</span> <span class="hljs-keyword">in</span> ./img/girl.<span class="hljs-property">png</span> <span class="hljs-number">1</span>:<span class="hljs-number">0</span><br><span class="hljs-title class_">Module</span> parse <span class="hljs-attr">failed</span>: <span class="hljs-title class_">Unexpected</span> character <span class="hljs-string">&#x27;ï¿½&#x27;</span> (<span class="hljs-number">1</span>:<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œåæ·»åŠ é…ç½®å³å¯æ­£å¸¸æ‰“åŒ…, webpack4 å’Œ webpack5 ä¸‹é…ç½®ç•¥æœ‰åŒºåˆ«, å®˜æ–¹å·²ç»ä¸å»ºè®®åœ¨ webpack5 ä¸‹ä½¿ç”¨<code>file_loader</code>,<code>url-loader</code>, å‚è€ƒ<a href="https://blog.csdn.net/qq_45770253/article/details/123862085">è§£å†³ webpack5 æ‰“åŒ… css èƒŒæ™¯å›¾ç‰‡é—®é¢˜</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å¸¦+çš„ä¸ºwebpack5ä¸‹éœ€è¦æ–°å¢çš„é…ç½®</span><br>&#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-regexp">/.(gif|jpe?g|png)$/i</span>,<br>    <span class="hljs-string">&quot;use&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;loader&quot;</span>: <span class="hljs-string">&quot;file-loader&quot;</span>,<br>+            <span class="hljs-string">&quot;options&quot;</span>: &#123;<br>+                <span class="hljs-string">&quot;esModule&quot;</span>: <span class="hljs-literal">false</span><br>+            &#125;<br>        &#125;<br>    ],<br>+    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;javascript/auto&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é»˜è®¤è¾“å‡ºæ–‡ä»¶åä¸º md4 çš„ hash å€¼, å¯ä»¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶åæ ¼å¼, å¸¸ç”¨ placeholder:</p><ul><li><code>[ext]</code>: åŸæ–‡ä»¶æ‰©å±•å</li><li><code>[name]</code>: æºæ–‡ä»¶å</li><li><code>[hash]</code>: æ–‡ä»¶å†…å®¹, ä½¿ç”¨ md4 æ•£åˆ—å‡½æ•°å¤„ç†, ç”Ÿæˆ 128 ä½ hash å€¼(32 ä¸ª 16 è¿›åˆ¶)</li><li><code>[contentHash]</code>: åœ¨<code>file-loader</code>ä¸­å’Œ<code>[hash]</code>ä¸€è‡´</li><li><code>[hash:&lt;Length&gt;]</code>: æˆªå– hash é•¿åº¦</li><li><code>[path]</code>: æ–‡ä»¶ç›¸å¯¹äº webpack é…ç½®æ–‡ä»¶çš„è·¯å¾„</li></ul><p>ä¹Ÿå¯ä»¥åœ¨è¾“å‡ºæ–‡ä»¶åå‰ç›´æ¥å¸¦ä¸Šæ–‡ä»¶å¤¹è·¯å¾„:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">options</span>: &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;img/[name].[hash:6].[ext]&#x27;</span>,<br><span class="hljs-attr">esModule</span>: <span class="hljs-literal">false</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ‰“åŒ…ç»“æœç¬¦åˆé¢„æœŸ:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662218739257_7112.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="url-loader"><a class="markdownIt-Anchor" href="#url-loader"></a> url-loader</h3><p>require()/import å¼•å…¥çš„èµ„æºä¸å†ç”Ÿæˆå•ç‹¬æ–‡ä»¶, ç›´æ¥æ‰“åŒ…è¿› bundle ä¸­,ä½¿ç”¨<code>url-loader</code>åå°±ä¸éœ€è¦é…ç½®<code>file-loader</code>äº†(loader è¿˜æ˜¯è¦å®‰è£…å“¦)<br />é¦–å…ˆå®‰è£…<code>url-loader</code>:<br /><code>yarn add -D url-loader</code><br />é…ç½®å’Œ<code>file-loader</code>ä¸€ç›´, å°† loader æ”¹ä¸º<code>url-loader</code>, å…ˆçœ‹ä¸‹æ›´æ”¹ä¸º<code>url-loader</code>åçš„æ‰“åŒ…è¾“å‡ºå†…å®¹:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662219838044_7269.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><p>å¯ä»¥çœ‹åˆ°å›¾ç‰‡èµ„æºéƒ½è¢«æ‰“åŒ…è¿› bundle.js é‡Œäº†, ä½†å®é™…é¡¹ç›®ä¸­è¿™å¾ˆæ˜æ˜¾æ˜¯ä¸åˆç†çš„, å…¨éƒ¨æ‰“åŒ…è¿› bundle ä¼šå¢å¤§ js æ–‡ä»¶ä½“ç§¯, ä½†å…¨éƒ¨ä½¿ç”¨<code>file-loader</code>ç”Ÿæˆå•ç‹¬æ–‡ä»¶åˆä¼šå¾’å¢å¤šä¸ª http è¯·æ±‚, æ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªé˜ˆå€¼æ¥æŒ‡å®š<code>&lt; é˜ˆå€¼</code>æ‰“åŒ…è¿› bundle, <code>&gt; é˜ˆå€¼</code>çš„å•ç‹¬ç”Ÿæˆæ–‡ä»¶, é…ç½®å¦‚ä¸‹, è¿™é‡Œä»¥ä¸¤å¼ å›¾ç‰‡(girl.png|7.8M, grassland.png|2.5M)ä¸¾ä¾‹, è®¾ç½®<code>limit</code>ä¸º 3M:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>    <span class="hljs-string">&quot;loader&quot;</span>: <span class="hljs-string">&quot;url-loader&quot;</span>,<br>    <span class="hljs-string">&quot;options&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;img/[name].[hash:6].[ext]&quot;</span>,<br>        <span class="hljs-string">&quot;limit&quot;</span>: <span class="hljs-number">3</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,<br>        <span class="hljs-string">&quot;esModule&quot;</span>: <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ç»“æœ:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662220100265_9387.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h2 id="migrate-to-webpack5"><a class="markdownIt-Anchor" href="#migrate-to-webpack5"></a> migrate to webpack5</h2><p>webpack5 å†…ç½®äº†èµ„æºæ¨¡å—ç±»å‹(asset module type), å·²ç»ä¸å†æ¨èä½¿ç”¨<code>file-loader</code>, <code>url-loader</code>, å¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„æ¨¡å—ç±»å‹æ¥æ›¿æ¢è¿™äº› loader, ä¸éœ€è¦å†å®‰è£…è¿™äº› loader</p><ul><li><code>asset/resource</code>: æ›¿æ¢<code>file-loader</code></li><li><code>asset/inline</code>: æ›¿æ¢<code>url-loader</code></li><li><code>asset/source</code>: æ›¿æ¢<code>raw-loader</code>, ä¸å¸¸ç”¨</li><li><code>asset</code>: æ ¹æ®é…ç½®çš„ maxSize åˆ¤æ–­ä½¿ç”¨ resource è¿˜æ˜¯ inline</li></ul><p>ä»¥ä¸‹æ˜¯ä¸Šè¿° webpack4 é…ç½®çš„ webpack5 ç‰ˆæœ¬:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;/.(gif|jpe?g|png)$/i&quot;</span>,<br>    <span class="hljs-comment">// asset == asset/resource + asset/inline</span><br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;asset&quot;</span>,<br>    <span class="hljs-string">&quot;generator&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;filename&quot;</span>: <span class="hljs-string">&quot;img/[name].[hash:6][ext]&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;parser&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;dataUrlCondition&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;maxSize&quot;</span>: <span class="hljs-number">3</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>webpack5 ä¹Ÿæä¾›äº†æŒ‡å®šå…¨å±€èµ„æºæ‰“åŒ…è·¯å¾„çš„æ–¹å¼, å½“ç„¶, è¿™ç§æ–¹å¼æˆ‘<strong>ä¸æ¨è</strong>.</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs diff">&#123;<br>    &quot;output&quot;: &#123;<br>        &quot;filename&quot;: &quot;bundle.js&quot;,<br>        &quot;path&quot;: path.resolve(__dirname, &#x27;./build&#x27;),<br><span class="hljs-addition">+       &quot;assetModuleFilename&quot;: &quot;img/[name].[hash:6][ext]&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨<strong>generator</strong>å’Œ<strong>parser</strong>ä»£æ›¿äº†åŸæ¥çš„<strong>options</strong>, éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ placeholder <code>[ext]</code>ä¸º<code>.extname</code>, è€Œ webpack5 ä¹‹å‰<code>[ext]</code>ä¸º<code>extname</code>, æ‰€ä»¥è¿™é‡Œä¸éœ€è¦åŠ <code>.</code></p><p>æ‰“åŒ…ç»“æœä¸ webpack4 è¾“å‡ºä¸€è‡´:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662220100265_9387.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h3 id="åˆ«çš„-resource"><a class="markdownIt-Anchor" href="#åˆ«çš„-resource"></a> åˆ«çš„ resource</h3><p>å¯¹äºå­—ä½“, éŸ³é¢‘, è§†é¢‘ç­‰èµ„æºå¤„ç†ä¹Ÿå’Œå›¾ç‰‡èµ„æºå¤§è‡´ä¸€æ ·, è¿™é‡Œä»¥å­—ä½“ä¸¾ä¾‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br><span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(ttf|eot|woff2?)$/i</span>,<br><span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;asset/resource&#x27;</span>,<br><span class="hljs-attr">generator</span>: &#123;<br><span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;font/[name].[hash:6][ext]&#x27;</span>,<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day3">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day3</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(2)</title>
    <link href="/2022/09/02/2022-09-02-study-webpack-day2/"/>
    <url>/2022/09/02/2022-09-02-study-webpack-day2/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><ol><li>webpack é»˜è®¤ config æ–‡ä»¶å<code>webpack.config.js</code>, å¯ä»¥é€šè¿‡<code>webpack --config webpack.config.js</code>æŒ‡å®šé…ç½®æ–‡ä»¶, é»˜è®¤å¯¼å‡ºåˆ°<code>./dist/main.js</code>, ä¸€ä¸ªæœ€åŸºç¡€çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;bundle.js&quot;</span>,<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;./build&quot;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="2"><li><p>webpack é»˜è®¤åªæ”¯æŒ import js æ–‡ä»¶, å¯¹äº css, img è¿™ç±»æ¨¡å—éœ€è¦é¢å¤–çš„ loader è¿›è¡Œè§£æ</p><ol><li><p>loader å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼ä½¿ç”¨</p><ol><li><p>å†…è”æ–¹å¼: import â€œcss-loader!./style.cssâ€</p></li><li><p>cli æ–¹å¼: å·²åºŸå¼ƒ</p></li><li><p>é…ç½®æ–¹å¼: <code>modules.rules</code>ä¸­å…è®¸é…ç½®å¤šä¸ª loader, rules æ˜¯ä¸€ä¸ª[Rule]æ•°ç»„, Rule æ˜¯ä¸€ä¸ªå¯¹è±¡, åŒ…å«å¸¸ç”¨å±æ€§:</p><ol><li><p>test: æ­£åˆ™è¡¨è¾¾å¼, å¯¹ resource è¿›è¡ŒåŒ¹é…</p></li><li><p>loader: åªæœ‰ä¸€ä¸ª loader æ—¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§, å€¼ä¸ºå­—ç¬¦ä¸²</p></li><li><p>use: [UseEntry]æ•°ç»„, useEntry ä¹Ÿæ˜¯ä¸ªå¯¹è±¡åŒ…å«å¸¸ç”¨å±æ€§:</p><ol><li><p>loader: å¿…é¡»æœ‰ loader å±æ€§, å€¼ä¸ºå­—ç¬¦ä¸²</p></li><li><p>options: å¯é€‰å±æ€§, å­—ç¬¦ä¸²æˆ–å¯¹è±¡, å€¼ä¼šä¼ åˆ° loader ä¸­</p></li></ol></li></ol></li><li><p>ç›´æ¥ä½¿ç”¨<code>loader: 'xx-loader'</code>æˆ–è€…<code>use: ['xx-loader']</code>éƒ½æ˜¯<code>use: [&#123;loader: 'xx-loader'&#125;</code>çš„ç®€å†™</p></li></ol></li><li><p>æ™®é€šçš„ css æ–‡ä»¶ä½¿ç”¨<code>css_loader</code><strong>è§£æ</strong>, å®‰è£…: <code>yarn add -D css-loader</code>. <code>css-loader</code>åªæ˜¯è®© webpack èƒ½å¤Ÿæ­£ç¡®è§£æ css æ¨¡å—, è¿˜éœ€è¦ä½¿ç”¨<code>style-loader</code>ç”Ÿæˆ&lt;style&gt;æ’å…¥åˆ°&lt;head&gt;ä¸­, å®‰è£…: <code>yarn add -D style-loader</code>, å¯¹ç›¸åŒ resource çš„ loader, webpack å¤„ç†é¡ºåºæ˜¯ä»å³å¾€å·¦çš„, æ‰€ä»¥å¯¹äºæ™®é€šçš„ css æ–‡ä»¶, é…ç½®åº”è¯¥æ˜¯<code>['style-loader', 'css-loader']</code>, å…ˆè§£æ css æ–‡ä»¶, å†æ’å…¥ html ä¸­.</p><ol><li><p>å¯¹äº sass/less/stylus è¿™ç±»é¢„å¤„ç†å·¥å…·ä¹Ÿæ˜¯åŒæ ·çš„, ä»¥ sass ä¸ºä¾‹, å®‰è£…: <code>yarn add -D sass sass-loader@10</code>(æœ€æ–°ç‰ˆçš„ sass-loader ä¸é€‚é… sass, å®‰è£… version10) é…ç½®: <code>use: ['style-loader', 'css-loader', 'sass-loader']</code></p></li><li><p>å°çŸ¥è¯†: å¯ä»¥ä½¿ç”¨<code>npx sass foo.scss &gt; bar.css</code> å°† scss è½¬æ¢ä¸º css</p></li></ol></li></ol></li><li><p>é’ˆå¯¹ä¸åŒæµè§ˆå™¨å…¼å®¹æ€§, webpack é€šè¿‡ browserslist ç®¡ç†éœ€è¦å…¼å®¹çš„æµè§ˆå™¨, é…ç½®æ–‡ä»¶å<code>.browserslistrc</code>, babel, autoprefixer ç­‰æ’ä»¶å¤„ç†å…¼å®¹æ€§æ—¶éƒ½ä¼šå…ˆæŸ¥è¯¢è¯¥æµè§ˆå™¨é…ç½®,ä¸ä¼šå¯¹ä¸ç¬¦åˆçš„æµè§ˆå™¨åšå…¼å®¹ browserslist ç¼–å†™è§„åˆ™å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">default</span> <span class="hljs-comment">//é»˜è®¤çš„æµè§ˆå™¨, è¯¥è¡Œå¯ä»¥çœç•¥</span><br>&gt; <span class="hljs-number">1</span>% <span class="hljs-comment">//å æœ‰ç‡&gt;1%, å¯ä»¥åœ¨https://caniuse.com/usage-tableæŸ¥è¯¢ä¸ªæµè§ˆå™¨å æœ‰ç‡</span><br>last <span class="hljs-number">2</span> version <span class="hljs-comment">// æ¯ä¸ªæµè§ˆå™¨çš„æœ€è¿‘ä¸¤ä¸ªç‰ˆæœ¬</span><br>not dead <span class="hljs-comment">// ä¸¤å¹´å†…å®˜æ–¹æœ‰æ”¯æŒæˆ–æ›´æ–°çš„æµè§ˆå™¨</span><br></code></pre></td></tr></table></figure><ol><li><p>babel, autoprefixer ä¼šé€šè¿‡<code>caniuse-lite</code>è¿™ä¸ªåŒ…å»è§£æ<code>.browserslistrc</code>é‡Œçš„å†…å®¹, ä¹Ÿå¯ä»¥é€šè¿‡<code>npx browserslist &quot;&gt; 1%, last 2 version, not dead&quot;</code>æŸ¥çœ‹è¾“å‡ºåŒ¹é…çš„æµè§ˆå™¨åˆ—è¡¨</p></li><li><p>æŒ‡å®šå…¼å®¹æµè§ˆå™¨ å¯ä»¥ä½¿ç”¨ä¸Šè¿°åˆ›å»º<code>.browserslistrc</code>, ä¹Ÿå¯ä»¥åœ¨<code>package.json</code>ä¸­æ–°å¢<code>browserslist</code>å­—æ®µ.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;browserslist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;&gt; 1%&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;last 2 version&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;not dead&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœä»€ä¹ˆé…ç½®éƒ½æ²¡æœ‰, ä¼šä½¿ç”¨é»˜è®¤çš„ browser é…ç½®</p></li></ol><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1662051646312_1893.png&versionDescriptor%5BversionOptions%5D=0&versionDescriptor%5BversionType%5D=0&versionDescriptor%5Bversion%5D=master&resolveLfs=true&%24format=octetStream&api-version=5.0" width="300" /><ol start="4"><li><code>or</code>/<code>,</code>å–å¹¶é›†, <code>and</code>å–äº¤é›†, <code>not</code>å–å, ä¸€èˆ¬é»˜è®¤éƒ½æ˜¯å–å¹¶é›†</li></ol></li></ol><h1 id="é…ç½®ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#é…ç½®ç¤ºä¾‹"></a> é…ç½®ç¤ºä¾‹</h1><p>æ”¾ä¸Šæœ€ç»ˆçš„<code>webpack.config.js</code>å’Œ<code>.browserslistrc</code>é…ç½®<br />webpack.config.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;bundle.js&quot;</span>,<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./build&quot;</span>),<br>  &#125;,<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.s?css$/i</span>,<br>        <span class="hljs-attr">use</span>: [<span class="hljs-string">&quot;style-loader&quot;</span>, <span class="hljs-string">&quot;css-loader&quot;</span>, <span class="hljs-string">&quot;sass-loader&quot;</span>],<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>.browserslistrc:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&gt; <span class="hljs-number">1</span>%<br>last <span class="hljs-number">2</span> version<br>not dead<br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day2">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day2</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°(1)</title>
    <link href="/2022/09/01/2022-09-01-study-webpack-day1/"/>
    <url>/2022/09/01/2022-09-01-study-webpack-day1/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1><p>ç³»ç»Ÿå­¦ä¹  webpack5 çš„ç¬¬ä¸€å¤©â€¦ç«‹å¿—æˆä¸ºå‰ç«¯ dalao(å¤§æ¦‚</p><h1 id="å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#å­¦ä¹ ç¬”è®°"></a> å­¦ä¹ ç¬”è®°</h1><ol><li><p>webpack å®‰è£…é€šå¸¸éœ€è¦å®‰è£…<code>webpack</code>å’Œ<code>webpack-cli</code>ä½†åè€…ä¸æ˜¯å¿…é¡»çš„, åœ¨ä¸»æµæ¡†æ¶ vue, react ä¸­éƒ½æ²¡æœ‰ä½¿ç”¨è€Œä¸”ä½¿ç”¨è‡ªå·±çš„ cli</p><ol><li><code>webpack-cli</code>çš„ä½œç”¨æ˜¯åœ¨ä½¿ç”¨<code>webpack --config=webpack.config.js</code>æŒ‡å®š webpack é…ç½®æ–‡ä»¶æˆ–è€…é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯é€šè¿‡<code>webpack-cli</code>æ‰§è¡Œçš„, å½“ç„¶ä¹Ÿå¯ä»¥åƒ vue,react ä¸€æ ·è‡ªå·±ç¼–å†™ cli</li></ol></li><li><p>æ²¡æœ‰å®‰è£…<code>webpack-cli</code>ç›´æ¥æ‰§è¡Œ<code>webpack</code>ä¹Ÿä¼šæç¤ºéœ€è¦å®‰è£…</p></li></ol><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661880098783_9947.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><ol start="3"><li>ç›´æ¥è¿è¡Œ<code>webpack</code>æ²¡æŒ‡å®šæ–‡ä»¶è·¯å¾„ webpack é»˜è®¤ä¼šå¯»æ‰¾ src ç›®å½•, æ²¡æœ‰ä¼šæŠ¥é”™</li></ol><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661952204310_1520.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><ol start="4"><li><p>ä»¥ä»¥å¾€å¼€å‘çš„ç»éªŒ, å»ºè®®éƒ½å±€éƒ¨å®‰è£… webpack</p></li><li><p>webpack é»˜è®¤åªæ”¯æŒå¤„ç†å¯¼å…¥å¯¼å‡ºè¯­æ³•ç¼–è¯‘,ä¸ä¼šæ”¹å˜é™¤æ­¤ä¹‹å¤–çš„éƒ¨åˆ†, esmodule è¯­æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨<code>&lt;script type=&quot;module&quot;&gt;</code>è°ƒç”¨, ä½†æ˜¯å¦‚æœè¦ä½¿ç”¨ cjs è¯­æ³•æˆ–è€…ä¸ä½¿ç”¨<code>type=&quot;module&quot;</code>çš„æ™®é€š script æ ‡ç­¾å¼•å…¥, éƒ½éœ€è¦ä½¿ç”¨ webpack è¿›è¡Œç¼–è¯‘</p></li></ol><h1 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day1">https://github.com/Mariana-Yui/fe-learn-code/tree/main/learn-webpack/day1</a></p>]]></content>
    
    
    <categories>
      
      <category>webpack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lernaä½¿ç”¨è®°å½•</title>
    <link href="/2022/08/25/2022-08-25-lerna-record/"/>
    <url>/2022/08/25/2022-08-25-lerna-record/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1><p>è®°å½•ä¸€ä¸‹å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„ lerna å¸¸ç”¨å‘½ä»¤(å¹¶ä¸å¸¸ç”¨), éƒ¨åˆ†æ˜¯å¯¹<a href="https://juejin.cn/post/6844903911095025678#heading-2">åŸºäº Lerna ç®¡ç† packages çš„ Monorepo é¡¹ç›®æœ€ä½³å®è·µ</a>çš„è®°å½•, éƒ¨åˆ†æ˜¯å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜è®°å½•.</p><h1 id="ç›®å½•ç»“æ„"><a class="markdownIt-Anchor" href="#ç›®å½•ç»“æ„"></a> ç›®å½•ç»“æ„</h1><p>å¯ä»¥é€šè¿‡<code>tree -L 2 --gitignore</code>ç”Ÿæˆ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">â”œâ”€â”€ README<span class="hljs-selector-class">.md</span><br>â”œâ”€â”€ babel<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span><br>â”œâ”€â”€ commitlint<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span><br>â”œâ”€â”€ lerna<span class="hljs-selector-class">.json</span><br>â”œâ”€â”€ package<span class="hljs-selector-class">.json</span><br>â”œâ”€â”€ packages<br>â”‚   â”œâ”€â”€ cli<br>â”‚   â””â”€â”€ cli-shared-utils<br>â””â”€â”€ yarn.lock<br></code></pre></td></tr></table></figure><h1 id="å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#å¸¸ç”¨å‘½ä»¤"></a> å¸¸ç”¨å‘½ä»¤</h1><ol><li><p><code>lerna init</code>: åˆå§‹åŒ–ä¸€ä¸ª monorepo é¡¹ç›®, ç”Ÿæˆ lerna.json, package.json å’Œ packages æ–‡ä»¶å¤¹</p></li><li><p><code>lerna create</code>: åœ¨ packages æ–‡ä»¶å¤¹ä¸‹æ·»åŠ  package, npm åŒ…ç›®å½•ç»“æ„</p></li><li><p><code>lerna add</code>: packages/*å…¨éƒ¨å®‰è£…ä¾èµ–<br />3.1 <code>--scope packageName</code>: æŒ‡å®š package å®‰è£…ä¾èµ–, ä¹Ÿå¯ä»¥<code>lerna add anotherPackageName --scope packageName</code>å°† packages/*ä¸‹ä¸€ä¸ªåŒ…ä½œä¸ºå¦ä¸€ä¸ªåŒ…çš„ä¾èµ–<br />3.2 lerna é»˜è®¤é€šè¿‡ npm å®‰è£…ä¾èµ–, å¯ä»¥æ·»åŠ ä»¥ä¸‹ä½¿ç”¨ yarn å®‰è£…ä¾èµ–</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;npmClient&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yarn&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p><code>lerna version</code>: éœ€è¦ä¿è¯å½“å‰ branch clean</p><ol><li><code>lerna version [major | minor | patch | premajor | preminor | prepatch | prerelease]</code>ç±»ä¼¼<code>npm version</code>ä¸€æ ·, å°† packages ä¸­å˜æ›´çš„ package æ”¹å˜ç‰ˆæœ¬å·</li><li>æ‰“ tag, å¹¶è‡ªåŠ¨å°† tag åŒæ­¥ remote, å¦‚æœå„ç§åŸå› å¯¼è‡´ tag å·²å­˜åœ¨éœ€è¦åˆ é™¤ remote tag</li><li>ç”Ÿæˆ <a href="http://CHANGELOG.md">CHANGELOG.md</a>, å»ºè®®ä½¿ç”¨é…ç½®å‚æ•°<code>--conventional-commits</code>, ä»¥<a href="https://conventionalcommits.org/">ä¼ ç»Ÿçš„æäº¤è§„èŒƒ</a>ç”Ÿæˆ log, å¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è§„èŒƒæäº¤çš„ commit ä¿¡æ¯éƒ½è¢«å†™å…¥äº† CHANGELOG ä¸­<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661445238686_7737.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /><br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661445271386_3522.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /><br /><a href="http://CHANGELOG.md">CHANGELOG.md</a> ä¸­å¯ä»¥çœ‹åˆ°æ ¹æ®æäº¤çš„å‰ç¼€è¿›è¡Œäº†åˆ†ç±»<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661931145247_8800.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></li></ol></li><li><p><code>lerna publish</code>: é€šå¸¸ä¸ä¼šå•ç‹¬ä½¿ç”¨<code>lerna version</code>, å› ä¸º<code>lerna publish</code>å°±åŒ…å«<code>lerna version</code>, ä»¥åŠä¼šå°†æ¶‰åŠç‰ˆæœ¬å·å˜åŠ¨çš„åŒ…<code>npm publish</code>, éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœåŒ…åå¸¦æœ‰<code>@xx/</code>å‰ç¼€, éœ€è¦åœ¨<a href="https://www.npmjs.com/org/create">npm organization</a>æ³¨å†Œè¯¥å‰ç¼€ç»„ç»‡</p><ol><li>è¿™æ˜¯ä¸ªå·¥ä½œä¸­é‡åˆ°çš„å¥‡æ€ªé—®é¢˜: å¦‚æœ package.json scripts ä¸­äº‹å…ˆå®šä¹‰äº†ç±»ä¼¼é…ç½®å¦‚ä¸‹, åªèƒ½ä½¿ç”¨<code>npm run patch/publish</code>æ¥ä½¿ç”¨ lerna, ä¸èƒ½ç›´æ¥åœ¨ terminal æ‰§è¡Œ<code>lerna ...</code>, å¦åˆ™ä¼šä¸€ç›´åœ¨ package.json ä¸­æ·»åŠ  gitHead å¯¼è‡´æäº¤å¤±è´¥</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;patch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lerna version patch --conventional-commits --yes&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;publish&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lerna publish from-package --yes&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p><code>lerna clean</code>: æ¸…é™¤ packages/* ä¸‹å„ package ä¾èµ–, å¦‚æœè¦åˆ é™¤é¡¹ç›®ä¸­æ‰€æœ‰ä¾èµ–å¯ä»¥é€šè¿‡<code>lerna cleanr</code> + <code>rm -r node_modules</code></p></li><li><p><code>lerna bootstrap</code>: å®‰è£…æ‰€æœ‰ packages ä¾èµ–, é»˜è®¤æƒ…å†µä¸‹ä¼šæœ‰ä»¥ä¸‹é—®é¢˜<br />7.1 ä¼šå°†ä¾èµ–éƒ½å®‰è£…åˆ° package ä¸­, æ²¡æœ‰åšä¾èµ–æå‡<br />7.2 <code>--hoist</code>ä¼šåšåˆ°ä¾èµ–æå‡, ä½†æ˜¯å’Œ<code>&quot;npmClient&quot;: &quot;yarn&quot;</code>å†²çª, <strong>â€“hoist is not supported with --npm-client=yarn, use yarn workspaces instead</strong><br />è¿™æ—¶å€™å°±è¦ä½¿ç”¨ yarn workspace é…åˆ lerna ä½¿ç”¨, å‰è€…è´Ÿè´£ä¾èµ–å®‰è£…ç®¡ç†, åè€…è´Ÿè´£ç‰ˆæœ¬ç®¡ç†å‘å¸ƒ, å¯ç”¨ yarn workspace å<code>lerna bootstrap</code>ç­‰åŒäº<code>yarn install</code>, yarn ä¼šå¯¹ä¾èµ–æå‡<br />ç›¸å…³é…ç½®:</p></li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// lerna.json</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;npmClient&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yarn&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;useWorkspaces&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">// package.json</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;workspaces&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;packages/*&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="lernajson"><a class="markdownIt-Anchor" href="#lernajson"></a> lerna.json</h1><ol><li><code>version</code>: å›ºå®šæ¨¡å¼(fixed)æˆ–ç‹¬ç«‹æ¨¡å¼(inpendent)<br />é»˜è®¤æ˜¯å›ºå®šæ¨¡å¼, å³ packages/* ä¸‹æ‰€æœ‰ package éƒ½æ˜¯ç»Ÿä¸€ç‰ˆæœ¬å·, å’Œ lerna.json ä¸­ version é…ç½®ä¸€ç›´, æ¯å›å‘å¸ƒéƒ½ä¼šæ›´æ–° version é…ç½®, ç”Ÿæˆçš„ <a href="http://CHANGELOG.md">CHANGELOG.md</a> åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹, å¦‚æœè¦ä½¿ç”¨ç‹¬ç«‹æ¨¡å¼, é…ç½®<code>&quot;version&quot;: &quot;inpendent&quot;</code>, å„ pacage å•ç‹¬ç®¡ç†ç‰ˆæœ¬å·, <a href="http://CHANGELOG.md">CHANGELOG.md</a> åˆ†å¸ƒåœ¨å„è‡ªæ–‡ä»¶å¤¹ä¸‹</li></ol><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://juejin.cn/post/6844903911095025678">åŸºäº Lerna ç®¡ç† packages çš„ Monorepo é¡¹ç›®æœ€ä½³å®è·µ</a></li><li><a href="https://yrq110.me/post/tool/how-lerna-manage-package-dependencies/">Lerna çš„ä¾èµ–ç®¡ç†åŠ hoisting æµ…æ</a></li><li><a href="https://www.cnblogs.com/ly0612/p/15545803.html">æ–°ç‰ˆæœ¬ husky é…ç½®ä¸ç”Ÿæ•ˆ</a></li><li><a href="https://github.com/typicode/husky/issues/840">Environment variable â€˜HUSKY_GIT_PARAMSâ€™ is not available globally #840</a></li><li><a href="http://www.febeacon.com/lerna-docs-zh-cn/routes/commands/">yarn æŒ‡ä»¤æ€»è§ˆ</a></li><li><a href="https://juejin.cn/post/7012622147726082055">Lerna ç‹¬ç«‹æ¨¡å¼ä¸‹å¦‚ä½•ä¼˜é›…çš„å‘åŒ…</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>lerna</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>koa-static æºç åˆ†æ</title>
    <link href="/2022/08/20/2022-08-20-koa-static/"/>
    <url>/2022/08/20/2022-08-20-koa-static/</url>
    
    <content type="html"><![CDATA[<h1 id="koa-static"><a class="markdownIt-Anchor" href="#koa-static"></a> koa-static</h1><p><code>koa-static</code>æ˜¯ koa çš„é™æ€æ–‡ä»¶æœåŠ¡ä¸­é—´ä»¶</p><h1 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> koaStatic = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-static&#x27;</span>);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaStatic</span>(&#123;<br>path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;../static&#x27;</span>);<br>&#125;, &#123;&#125;));<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ä½ çš„<code>static</code>æ–‡ä»¶ç›®å½•ç»“æ„ä¸º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">â”œâ”€â”€ <span class="hljs-selector-tag">html</span><br>â”‚   â””â”€â”€ upfile<span class="hljs-selector-class">.html</span><br>â””â”€â”€ uploads<br>â”‚   â””â”€â”€ aa.js<br></code></pre></td></tr></table></figure><p>é‚£å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://localhost:8888/html/upfile.html</code>è®¿é—®é™æ€æ–‡ä»¶äº†</p><h1 id="options"><a class="markdownIt-Anchor" href="#options"></a> options</h1><p>æˆªå–è‡ª<code>koa-static</code>github readme çš„å¸¸ç”¨ options</p><ul><li><code>maxage</code>Â Browser cache max-age in milliseconds. defaults to 0</li><li><code>hidden</code>Â Allow transfer of hidden files. defaults to false</li><li><code>index</code>Â Default file name, defaults to â€˜index.htmlâ€™</li><li><code>defer</code>Â If true, serves afterÂ <code>return next()</code>, allowing any downstream middleware to respond first.</li><li><code>gzip</code>Â Try to serve the gzipped version of a file automatically when gzip is supported by a client and if the requested file with .gz extension exists. defaults to true.</li><li>[setHeaders]Â Function to set custom headers on response.</li><li><code>extensions</code>Â Try to match extensions from passed array to search for file when no extension is sufficed in URL. First found is served. (defaults toÂ <code>false</code>)</li></ul><h1 id="æºç åˆ†æ"><a class="markdownIt-Anchor" href="#æºç åˆ†æ"></a> æºç åˆ†æ</h1><p><code>koa-static</code>ä¾èµ–<code>koa-send</code>åŒ…, å¤§éƒ¨åˆ†é€»è¾‘éƒ½æ˜¯<code>koa-send</code>å¤„ç†çš„, <code>koa-static</code>åªå¯¹<code>options.defer</code>åšäº†å¤„ç†.</p><ul><li>defer é¡¾åæ€ä¹‰, å¦‚æœä¸º<code>true</code>, åˆ™å…ˆæ‰§è¡Œ<code>koa-send</code>, æ‰¾åˆ°æ–‡ä»¶ç›´æ¥è¿”å›, å¦åˆ™<code>await next()</code>; <code>false</code>åˆ™ç›¸å, å…ˆ<code>await next()</code>, <code>ctx.body</code>å¦‚æœè¿˜æ˜¯<code>null</code>åˆ™æ‰§è¡Œ<code>koa-send</code></li></ul><p><code>koa-send</code>æ ¸å¿ƒé€»è¾‘é€šè¿‡<code>path.resolvePath(ctx.path)</code>å’Œåˆå§‹åŒ–æ—¶çš„ root è·¯å¾„æ‹¼æ¥å¾—åˆ°æ–‡ä»¶åœ¨æœåŠ¡ç«¯çš„çœŸå®æ–‡ä»¶è·¯å¾„, æœ€åä»¥ readable stream çš„å½¢å¼è¿”å›</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">ctx.<span class="hljs-property">body</span> = fs.<span class="hljs-title function_">createReadStream</span>(path);<br></code></pre></td></tr></table></figure><p>koa ä¸­åŒæ ·å¯¹ stream ç±»å‹çš„æ•°æ®åšäº†å¤„ç†, é€šè¿‡<code>pipe</code>ç®¡é“è¿”å›ç»™æµè§ˆå™¨æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// application.js</span><br><span class="hljs-comment">// responses</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(body)) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">end</span>(body);<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;string&#x27;</span> === <span class="hljs-keyword">typeof</span> body) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">end</span>(body);<br><span class="hljs-keyword">if</span> (body <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Stream</span>) <span class="hljs-keyword">return</span> body.<span class="hljs-title function_">pipe</span>(res);<br></code></pre></td></tr></table></figure><p><code>koa-static</code>ä¹Ÿé€šè¿‡<code>fs.stat</code>è·å–æ–‡ä»¶çš„å…·ä½“ä¿¡æ¯è®¾ç½®å“åº”å¤´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Content-Length&#x27;</span>, stats.<span class="hljs-property">size</span>)<br><br><span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">response</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Last-Modified&#x27;</span>)) ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Last-Modified&#x27;</span>, stats.<span class="hljs-property">mtime</span>.<span class="hljs-title function_">toUTCString</span>())<br>&#125;<br><br><span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">type</span>) ctx.<span class="hljs-property">type</span> = <span class="hljs-title function_">type</span>(path, encodingExt)<br><br></code></pre></td></tr></table></figure><p>å¯¹ option.setHeader çš„å¤„ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (setHeaders) <span class="hljs-title function_">setHeaders</span>(ctx.<span class="hljs-property">res</span>, path, stats);<br></code></pre></td></tr></table></figure><p>å¯¹ option.hidden çš„å¤„ç†, è¿™é‡Œ option.hidden ä¸º true ä»¥åŠæ–‡ä»¶åä»¥<code>.</code>å¼€å¤´éƒ½æ˜¯ä¼šéšè—çš„, <code>isHidden</code>å‡½æ•°åˆ¤æ–­æ–‡ä»¶åæ˜¯å¦ä¸º<code>.xxx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// hidden file support, ignore</span><br><span class="hljs-keyword">if</span> (!hidden &amp;&amp; <span class="hljs-title function_">isHidden</span>(root, path)) <span class="hljs-keyword">return</span>;<br></code></pre></td></tr></table></figure><p>å¯¹ option.extensions çš„å¤„ç†, è®¾ç½®äº† extensions æ•°ç»„åˆ™å…è®¸æµè§ˆå™¨ url ä¸å¸¦ä¸Šåç¼€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (extensions &amp;&amp; !<span class="hljs-regexp">/\./</span>.<span class="hljs-title function_">exec</span>(<span class="hljs-title function_">basename</span>(path))) &#123;<br>  <span class="hljs-keyword">const</span> list = [].<span class="hljs-title function_">concat</span>(extensions);<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">let</span> ext = list[i];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ext !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&#x27;option extensions must be array of strings or false&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^\./</span>.<span class="hljs-title function_">exec</span>(ext)) ext = <span class="hljs-string">`.<span class="hljs-subst">$&#123;ext&#125;</span>`</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">exists</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;path&#125;</span><span class="hljs-subst">$&#123;ext&#125;</span>`</span>)) &#123;<br>      path = <span class="hljs-string">`<span class="hljs-subst">$&#123;path&#125;</span><span class="hljs-subst">$&#123;ext&#125;</span>`</span>;<br><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>koa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>obsidianæ’ä»¶è®°å½•</title>
    <link href="/2022/08/08/2022-08-08-obsidian-plugins/"/>
    <url>/2022/08/08/2022-08-08-obsidian-plugins/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>å‘ç°äº†ä¸ªå¥½ç”¨çš„ note app: <code>obsidian</code>, å†…ç½®æ’ä»¶ä»¥åŠç¬¬ä¸‰æ–¹æ’ä»¶éƒ½èƒ½å¤§å¹…åº¦æå‡å†™ç¬”è®°ä½“éªŒ, äºæ˜¯æŠŠä¹‹å‰ç”¨ jekyll æ­å»ºçš„åšå®¢æ–‡ä»¶å¤¹æŒªåˆ°é‡Œé¢, ä»£ç è™½ç„¶æ˜¯åŒæ­¥ git çš„, ä½†æ˜¯æ’ä»¶è¢«æˆ‘ gitignore æ‰äº†, éƒ½å­˜åœ¨æœ¬åœ°, é¿å…æç«¯æƒ…å†µè¦é‡æ–°è£…ä¸€éè®°å½•ä¸‹ç”¨åˆ°ç¬¬ä¸‰æ–¹çš„æ’ä»¶.</p><h1 id="ç¬¬ä¸‰æ–¹æ’ä»¶"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ–¹æ’ä»¶"></a> ç¬¬ä¸‰æ–¹æ’ä»¶</h1><ol><li>calendar<br />å±•ç¤ºæ—¥å†ç”¨äºè®°å½•æ¯å‘¨çš„æ—¥è®°æƒ…å†µ, ç‚¹å‡»æ—¥æœŸå³å¯ç”Ÿæˆå½“å¤©çš„ md æ–‡ä»¶<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202208082337559.png" width="300" /><br />å¯ä»¥é…åˆå†…ç½®æ’ä»¶<code>æ—¥è®°</code>å’Œ<code>æ¨¡æ¿</code>é£Ÿç”¨<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202208082344111.png" alt="" /></li><li>emoji toolbar<br />æä¾› emoji è¡¨æƒ…æ–¹ä¾¿å†™ç¬”è®°æ—¶æœç´¢</li><li>style settings<br />è‡ªå®šä¹‰å¤–è§‚ä¸»é¢˜çš„æ ·å¼, å¤–è§‚ä¸»é¢˜åœ¨è¿™é‡Œä¸‹è½½ â†“<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202208082353487.png" alt="" /></li><li>sliding panes<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202208082352300.png" alt="" /></li><li>image auto upload plugin<br />ğŸ®ğŸº éœ€è¦é…åˆ<code>picGo</code>é£Ÿç”¨, ç›´æ¥æŠŠå›¾ç‰‡å¤åˆ¶è¿›æ¥å°±å¯ä»¥é€šè¿‡ picGo ä¸Šä¼ åˆ°å›¾åºŠ, å†ä¹Ÿä¸ç”¨æ‰‹åŠ¨ä¸Šä¼ äº†<br />å…¶ä¸­<code>picGo server</code>é…ç½®é»˜è®¤ä¸º<code>http://127.0.0.1:36677/upload</code>, å…·ä½“ç«¯å£å·å¯ä»¥å† picGo app é…ç½®ä¸­æ‰¾åˆ° â†“<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/202208082357506.png" alt="" /></li><li>obsidian git<br />æ¯éš” X åˆ†é’Ÿè‡ªåŠ¨åŒæ­¥ git, å¯¹æˆ‘çš„åœºæ™¯æ²¡å•¥ç”¨, blog æœ‰äº›æœªå†™å®Œçš„æ–‡ä»¶æœ¬æ¥å°±ä¸æƒ³ commit, ä»¥ååˆ«çš„åœºæ™¯å¯èƒ½ä¼šé‡åˆ°</li><li>day planner<br />è®¾ç½®æ¯å¤©çš„æ—¶é—´è½´</li></ol><h1 id="diy"><a class="markdownIt-Anchor" href="#diy"></a> DIY</h1><ol><li>calendar<br />é€šè¿‡æŸ¥æ‰¾æºç å¯ä»¥å‘ç°</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> noteDate = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">moment</span>(file.<span class="hljs-property">basename</span>, format, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p><code>calendar</code>ä¼šå¯¹æ–‡ä»¶å…¨åé€šè¿‡ moment.js å¤„ç†, è¿™å°±å¯¼è‡´ä½ å¦‚æœæ–‡ä»¶åæ˜¯<code>2022-08-10-obsidian-plugins</code>è¿™æ ·å®ƒå°±è¯†åˆ«ä¸å‡ºæ¥, å°±æ— æ³•åœ¨æ—¥å†ä¸Šé€šè¿‡ dot æ ‡è¯†å½“å¤©çš„æ—¥è®°, å•ƒçˆ¹å‘è¿™æ˜¯ ğŸ˜…. çœ‹äº†çœ‹ issue ä¹Ÿæœ‰äººå‘å‡ºäº†ç›¸åŒä¸€é—®, åŠå¹´è¿‡å»äº†ä½œè€…ä¹Ÿæ²¡è§£å†³, é‚£æˆ‘ä»¬å°±è‡ªå·±æä¸ª polyfill, æ—¢ç„¶ä½ å…¨åä¸èƒ½ç”Ÿæˆæ—¥æœŸé‚£æˆ‘å°±æˆªæ–­èƒ½ç”Ÿæˆæ—¥æœŸçš„é‚£éƒ¨åˆ†ä¸å°±å¥½äº†-.-, åšä¸»çš„ç¬”è®°æ–‡ä»¶åéƒ½æ˜¯<code>yyyy-mm-dd-ç¬”è®°æ ‡é¢˜</code>è¿™ç§æ ¼å¼, é€šè¿‡ä»¥ä¸‹æ­£åˆ™å³å¯è®©æ—§ç¬”è®°æ˜¾ç¤ºåœ¨ ğŸ“… ä¸Šäº†~</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> noteDate = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">moment</span>(<br>  file.<span class="hljs-property">basename</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;/g</span>),<br>  format,<br>  <span class="hljs-literal">true</span><br>);<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾:<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1660139613361_5344.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h1 id="å¤šæä¸€å˜´"><a class="markdownIt-Anchor" href="#å¤šæä¸€å˜´"></a> å¤šæä¸€å˜´</h1><p>åœ¨ obsidian ä¸­å†™ markdown æ— æ³•ä½¿ç”¨ prettier å¯¹æºç è¿›è¡Œæ ¼å¼åŒ–, æ‰€ä»¥éœ€è¦ä½¿ç”¨è®¾ç½® pre-commit é’©å­åœ¨ commit å‰æ ¼å¼åŒ– md æ–‡ä»¶, å…·ä½“æ“ä½œå¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npx husky-init <span class="hljs-comment"># add --yarn2 for Yarn 2</span><br>yarn add --dev pretty-quick<br>yarn husky <span class="hljs-built_in">set</span> .husky/pre-commit <span class="hljs-string">&quot;npx pretty-quick --staged&quot;</span><br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://sspai.com/post/67619">Obsidian æ–°æ‰‹ç³»åˆ—ä¹‹ä½ ä¸å¯ä¸çŸ¥çš„æ’ä»¶</a></li><li><a href="https://prettier.io/docs/en/precommit.html">add prettier format before commit</a></li><li><a href="https://zhuanlan.zhihu.com/p/428499423">Obsidian ä¸­ä½¿ç”¨ Calendar æ’ä»¶å¿«æ·å»ºç«‹æ—¥è®°ã€å‘¨è®°</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>obsidian</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå¼€å‘å®è·µè®°å½•</title>
    <link href="/2022/07/15/2022-07-15-webpack-record/"/>
    <url>/2022/07/15/2022-07-15-webpack-record/</url>
    
    <content type="html"><![CDATA[<p>å¼€ä¸ªæ–°å‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ant-design-vue(vue3)ç»„ä»¶äºŒæ¬¡å¼€å‘è®°å½•</title>
    <link href="/2022/07/15/2022-07-26-vue-slot/"/>
    <url>/2022/07/15/2022-07-26-vue-slot/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>react å¦‚æœæƒ³åœ¨ ant-design å°è£…çš„ç»„ä»¶ä¸ŠäºŒæ¬¡å¼€å‘, å› ä¸º jsx çš„ç‰¹æ€§, å¯ä»¥å°† dom ä½œä¸º props, æ‰€ä»¥å¾ˆç®€å•, ä½† vue å°±æœ‰ç‚¹éº»çƒ¦, éœ€è¦ä½¿ç”¨ slot æ’æ§½çš„æ–¹å¼, ä»¥ä¸‹æ˜¯ä¸šåŠ¡å¼€å‘ä¸­æ—¶é—´æˆåŠŸåçš„è®°å½•, æ„Ÿè§‰è¿˜æ˜¯å­¦åˆ°äº†æŒºå¤šä¸œè¥¿.</p><h1 id="attrs-å’Œslots"><a class="markdownIt-Anchor" href="#attrs-å’Œslots"></a> $attrs å’Œ$slots</h1><p>åœ¨å…·ä½“æ—¶é—´ä¹‹å‰éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†, <code>$attrs</code>å’Œ<code>slots</code>éƒ½æ˜¯ç»‘å®šåœ¨ç»„ä»¶ä½œç”¨åŸŸä¸Šçš„ç§æœ‰å±æ€§, ä¸éœ€è¦åœ¨<code>setup</code>ä¸­ return, åŒæ—¶, ä¹Ÿå¯ä»¥åœ¨<code>setup(props, ctx)</code>çš„ ctx ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ° attrs å’Œ slots ä¸¤ä¸ªå±æ€§, è¡¨ç¤ºçš„å«ä¹‰éƒ½æ˜¯ä¸€æ ·çš„.</p><h2 id="attrs"><a class="markdownIt-Anchor" href="#attrs"></a> $attrs</h2><p>å…ˆçœ‹ä¸‹å®˜æ–¹çš„è§£é‡Š:</p><blockquote><p>The $attrs object includes all attributes that are not declared by the componentâ€™s props or emits options (e.g., class, style, v-on listeners, etc.).</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´çˆ¶ç»„ä»¶ä¼ å…¥å­ç»„ä»¶çš„å±æ€§ä¸­æ²¡è¢«å­ç»„ä»¶ props å£°æ˜çš„éƒ½ä¼šåŒ…å«åœ¨<code>$attr</code> ä¸­, åŒ…æ‹¬ class, style, v-on è¿™äº› dom åŸç”Ÿçš„å±æ€§æˆ– vue ç»‘å®šçš„äº‹ä»¶.<br />è¿™å°±å¾ˆé€‚åˆæˆ‘ä»¬éœ€è¦äºŒæ¬¡å¼€å‘ç»„ä»¶çš„åœºæ™¯, ä¿è¯ä¼ å…¥çš„åŸæœ‰å±æ€§ä¸å—å½±å“çš„å‰æä¸‹, ä¼ å…¥æ–°çš„å±æ€§è¿›è¡Œæ”¹é€ </p><h3 id="åœ¨å­ç»„ä»¶ä¸­å¼€å¯attrs"><a class="markdownIt-Anchor" href="#åœ¨å­ç»„ä»¶ä¸­å¼€å¯attrs"></a> åœ¨å­ç»„ä»¶ä¸­å¼€å¯$attrs</h3><p><code>$attr</code>æƒ³åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨éœ€è¦è®¾ç½®<code>inheritAttrs: true</code>, vue3 é»˜è®¤è¯¥è®¾ç½®, æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨</p><h2 id="slots"><a class="markdownIt-Anchor" href="#slots"></a> $slots</h2><p>é¡¾åæ€ä¹‰, <code>$attrs</code>åŒ…å«äº†æ‰€æœ‰ä¼ å…¥çš„é props å±æ€§, é‚£<code>$slots</code>å°±æ˜¯åŒ…å«äº†ä¼ å…¥çš„æ‰€æœ‰æ’æ§½äº†</p><h1 id="v-bind"><a class="markdownIt-Anchor" href="#v-bind"></a> v-bind</h1><p><code>$attrs</code>åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰é props å±æ€§, <code>v-bind=&quot;$attrs&quot;</code>åˆ™å°†æ‰€æœ‰å±æ€§ç»‘å®šåœ¨å¯¹åº”ç»„ä»¶æ ‡ç­¾ä¸Š</p><h1 id="å…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½"><a class="markdownIt-Anchor" href="#å…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½"></a> å…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½</h1><h2 id="å…·åæ’æ§½"><a class="markdownIt-Anchor" href="#å…·åæ’æ§½"></a> å…·åæ’æ§½</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å­ç»„ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">base-layout</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:header</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Here might be a page title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:default</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>A paragraph for the main content.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>And another one.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:footer</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here&#x27;s some contact info<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">base-layout</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Here might be a page title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>A paragraph for the main content.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>And another one.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here&#x27;s some contact info<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ä½œç”¨åŸŸæ’æ§½"><a class="markdownIt-Anchor" href="#ä½œç”¨åŸŸæ’æ§½"></a> ä½œç”¨åŸŸæ’æ§½</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶å±äºå„è‡ªçš„ä½œç”¨åŸŸ, ä½œç”¨åŸŸæ’æ§½åˆ™å¯ä»¥è®©çˆ¶ç»„ä»¶ä½¿ç”¨æ’æ§½æ—¶è®¿é—®å­ç»„ä»¶çš„å˜é‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å­ç»„ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;( item, index ) in items&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:item</span>=<span class="hljs-string">&quot;item&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;index&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:another-attribute</span>=<span class="hljs-string">&quot;anotherAttribute&quot;</span></span><br><span class="hljs-tag">    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">todo-list</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:default</span>=<span class="hljs-string">&quot;slotProps&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fas fa-check&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;green&quot;</span>&gt;</span>&#123;&#123; slotProps.item &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">todo-list</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­, <code>v-slot:default</code>å¯ä»¥ç®€å†™ä¸º<code>#default</code>, <code>slotProps</code>ä¸ºåŒ…å«ç»‘å®šåœ¨<code>&lt;slot&gt;</code>ä¸Šæ‰€æœ‰å±æ€§çš„å¯¹è±¡, å˜é‡åå¯ä»¥è‡ªå®šä¹‰, ä¹Ÿå¯ä»¥ç›´æ¥<code>v-slot:default=&quot;&#123;item, index, anotherAttribute&#125;&quot;</code>è¿™æ ·å†™.<br />ä¸‹é¢è¿™å¼ å›¾å¯ä»¥å¸®åŠ©ç†è§£:<br /><img src="https://v3.cn.vuejs.org/images/scoped-slot.png" alt="" /></p><h1 id="äºŒæ¬¡å¼€å‘-table-ç»„ä»¶"><a class="markdownIt-Anchor" href="#äºŒæ¬¡å¼€å‘-table-ç»„ä»¶"></a> äºŒæ¬¡å¼€å‘ Table ç»„ä»¶</h1><p>ant-design åŸç”Ÿçš„<code>Table</code>ç»„ä»¶ä¸æ”¯æŒå°†æ•´ä¸ªè¡¨æ ¼ disabled, æ¥ä¸‹æ¥å°±è¦å®ç°è¯¥åŠŸèƒ½,(è¿™ä¹Ÿæ˜¯æˆ‘ä¸šåŠ¡ä¸­æ‰€éœ€è¦çš„åŠŸèƒ½)<br />æ”¹é€ å®Œç»„ä»¶ä½¿ç”¨æ–¹å¼å’Œ ant-design åŸç”Ÿçš„<code>Table</code>ç›¸åŒ, åªæ˜¯æ”¯æŒäº†è¡¨æ ¼å…¨å±€ disabled, è¿™é‡Œä½¿ç”¨å®˜æ–¹çš„æ¡ˆä¾‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a-table</span> <span class="hljs-attr">:columns</span>=<span class="hljs-string">&quot;columns&quot;</span> <span class="hljs-attr">:data-source</span>=<span class="hljs-string">&quot;data&quot;</span> <span class="hljs-attr">:disabled</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&#123; text &#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>&#123;&#123; text &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">customTitle</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">smile-outlined</span> /&gt;</span><br>        Name<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">tags</span>=<span class="hljs-string">&quot;&#123; text: tags &#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a-tag</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;tag in tags&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;tag&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">:color</span>=<span class="hljs-string">&quot;tag === &#x27;loser&#x27; ? &#x27;volcano&#x27; : tag.length &gt; 5 ? &#x27;geekblue&#x27; : &#x27;green&#x27;&quot;</span></span><br><span class="hljs-tag">        &gt;</span><br>          &#123;&#123; tag.toUpperCase() &#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">a-tag</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123; record &#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>Invite ä¸€ &#123;&#123; record.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a-divider</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;vertical&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>Delete<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a-divider</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;vertical&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ant-dropdown-link&quot;</span>&gt;</span><br>          More actions<br>          <span class="hljs-tag">&lt;<span class="hljs-name">down-outlined</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>&lt;/a-table<br>&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- a-table.vue --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table-wrap&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;disabled ? &#x27;mask&#x27;: &#x27;&#x27;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æŠŠdisabledä½œä¸ºprops, ant-designè‡ªå¸¦çš„é‚£äº›å±æ€§éƒ½ä½œä¸º$attrsé€ä¼  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">antd-table</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">&quot;$attrs&quot;</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">        important! è¿™é‡Œtemplateæ ¹æ®çˆ¶ç»„ä»¶çš„$lotséå†, slotPropsä¸ºant-designä½œç”¨äºæ’æ§½å‘å¤–æš´éœ²çš„å±æ€§, &lt;slot&gt;åˆ™ä½¿ç”¨v-bindé‡æ–°å°†slotPropsé‡æ–°æš´éœ²ç»™çˆ¶ç»„ä»¶</span><br><span class="hljs-comment">      --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value, key) in $slots&quot;</span> #[<span class="hljs-attr">key</span>]=<span class="hljs-string">&quot;slotProps&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">&quot;key&quot;</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">&quot;slotProps&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">antd-table</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> &#123; defineComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Table</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ant-design-vue&quot;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ATable&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">inheritAttrs</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">props</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">disabled</span>: <span class="hljs-title class_">Boolean</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&quot;antd-table&quot;</span>: <span class="hljs-title class_">Table</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">setup</span>(<span class="hljs-params">props, ctx</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;&#125;;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.table-wrap</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">position</span>: relative;</span><br><span class="language-css">    <span class="hljs-selector-class">.mask</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">position</span>: absolute;</span><br><span class="language-css">      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f570</span>;</span><br><span class="language-css">      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://v3.cn.vuejs.org/api/directives.html#v-bind">v-bind</a></li><li><a href="https://vuejs.org/guide/components/attrs.html">Fallthrough Attributes (attrs ç©¿é€å±æ€§)</a></li><li><a href="https://v3.cn.vuejs.org/guide/component-slots.html">å…·åæ’æ§½</a></li><li><a href="https://vuejs.org/guide/components/slots.html">slot</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue3</tag>
      
      <tag>ant-design-vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue-cliå¼€å‘pluginè®°å½•</title>
    <link href="/2022/07/11/2022-07-11-vue-cli-plugin-trial/"/>
    <url>/2022/07/11/2022-07-11-vue-cli-plugin-trial/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>åˆåŒå’å•æ˜¯å› ä¸ºçœ‹åˆ° vue é¡¹ç›®é‡Œå¤§ä½¬å°†åŸºå»ºä»£ç åŒ…è£…åœ¨äº† vue-cli ä¸­å¹¶é€šè¿‡<code>vue-cli-service command</code>äº¦æˆ–è€…<code>vue invoke command</code>çš„æ–¹å¼æ‰§è¡Œä»£ç , ä¸€ç›´å¯¹ vue-cli ä¸å¤ªç†Ÿæ‚‰èŠ±äº†åŠå¤©æ—¶é—´å¤§æ¦‚äº†è§£ vue-cli plugin çš„å¼€å‘æµç¨‹, è‡³æ­¤è®°å½•.</p><h1 id="vue-add"><a class="markdownIt-Anchor" href="#vue-add"></a> vue add</h1><p>å¦‚æœæƒ³è¦å®‰è£… vue ç¬¬ä¸‰æ–¹æ’ä»¶å¯ä»¥é€šè¿‡<code>vue add eslint</code>æ¥å®‰è£…, vue-cli ä¼šè‡ªåŠ¨åœ¨ eslint å‰åŠ ä¸Š vue-cli-plugin å‰ç¼€, å³å®‰è£… vue-cli-plugin-eslint, å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥å…¨å.</p><blockquote><p>å¦‚æœä¸€ä¸ªæ’ä»¶å·²ç»è¢«å®‰è£…ï¼Œä½ å¯ä»¥ä½¿ç”¨ vue invoke å‘½ä»¤è·³è¿‡å®‰è£…è¿‡ç¨‹ï¼Œåªè°ƒç”¨å®ƒçš„ç”Ÿæˆå™¨ã€‚è¿™ä¸ªå‘½ä»¤ä¼šæ¥å—å’Œ vue add ç›¸åŒçš„å‚æ•°ã€‚</p></blockquote><p>æ‰€ä»¥ vue add åšäº†ä¸¤ä»¶äº‹, 1.å®‰è£…ç»„ä»¶ 2.æ‰§è¡Œ<code>vue invoke</code>å‘½ä»¤</p><h1 id="plugin-çš„ç›®å½•ç»“æ„"><a class="markdownIt-Anchor" href="#plugin-çš„ç›®å½•ç»“æ„"></a> plugin çš„ç›®å½•ç»“æ„</h1><p>é¦–å…ˆæ’ä»¶è‡ªèº«ä¹Ÿæ˜¯ npm åŒ…, ä¸€ä¸ªæ ‡å‡†çš„ç¬¬ä¸‰æ–¹æ’ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹:</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">â”œâ”€â”€ README.md<br>â”œâ”€â”€ generator.<span class="hljs-keyword">js </span> <span class="hljs-comment"># generatorï¼ˆå¯é€‰ï¼‰</span><br>â”œâ”€â”€ index.<span class="hljs-keyword">js </span>     <span class="hljs-comment"># service æ’ä»¶</span><br>â”œâ”€â”€ package.<span class="hljs-keyword">json</span><br><span class="hljs-keyword"></span>â”œâ”€â”€ prompts.<span class="hljs-keyword">js </span>   <span class="hljs-comment"># prompt æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰</span><br>â””â”€â”€ ui.<span class="hljs-keyword">js </span>        <span class="hljs-comment"># Vue UI é›†æˆï¼ˆå¯é€‰ï¼‰</span><br></code></pre></td></tr></table></figure><h1 id="vue-invoke"><a class="markdownIt-Anchor" href="#vue-invoke"></a> vue invoke</h1><p>æˆ‘ç†è§£<code>vue invoke plugin-name</code>ä¼šå…ˆåˆå§‹åŒ–æ’ä»¶å³æ‰§è¡Œæ’ä»¶ä¸­çš„ç”Ÿæˆå™¨(<code>generator.js</code>æˆ–<code>generator/index.js</code>)å’Œç›®å½•ä¸‹çš„<code>index.js</code></p><h2 id="generator-with-promptsjs"><a class="markdownIt-Anchor" href="#generator-with-promptsjs"></a> generator with prompts.js</h2><p>å½“ç›®å½•ä¸­å­˜åœ¨<code>prompts.js</code>æ—¶, <code>vue invoke</code>ä¼šä»¥å¯äº¤äº’å½¢å¼è¾“å…¥å‚æ•°. å†…ç½®çš„<code>inquirer</code>å›å»è§£æ<code>prompts.js</code>, å‚æ•°é…ç½®å‚è€ƒ<a href="https://github.com/SBoudrias/Inquirer.js">inquirer</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// prompts.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = [<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;example&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;confirm&#x27;</span>,<br>    <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;æ˜¯å¦æ·»åŠ ç¤ºä¾‹ç»„ä»¶åˆ°é¡¹ç›®componentsç›®å½•ï¼Ÿ&#x27;</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">filter</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;&#125;,<br>    <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">val, options</span>) =&gt;</span> &#123;&#125;<br>  &#125;<br>];<br></code></pre></td></tr></table></figure><p>äº¤äº’ç»“æŸå, ä¼šæ‰§è¡Œ generator(<code>generator.js</code>æˆ–<code>generator/index.js</code>), ä¸Šè¿°äº¤äº’çš„è¾“å‡ºä¼šä½œä¸º generator çš„ç¬¬äºŒä¸ªå‚æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// generator.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">api, options</span>) &#123;&#125;;<br></code></pre></td></tr></table></figure><h1 id="vue-cli-service"><a class="markdownIt-Anchor" href="#vue-cli-service"></a> vue-cli-service</h1><p>ä½¿ç”¨@vue/cli è„šæ‰‹æ¶æ­å»º vue é¡¹ç›®æ—¶, <code>package.json</code>ä¸­å°±èƒ½å¤Ÿçœ‹åˆ°<code>vue-cli-service serve/build</code>è¿™ç±»å‘½ä»¤, å…¶ä¸­çš„<code>serve</code>, <code>build</code>éƒ½æ˜¯ vue-cli æ³¨å†Œçš„å‘½ä»¤, è¿™ç±»å‘½ä»¤åˆ†ä¸º<br />ç¬¬ä¸‰æ–¹æ’ä»¶æ³¨å†Œçš„å‘½ä»¤å’Œæœ¬åœ°æ³¨å†Œçš„å‘½ä»¤</p><h2 id="å¦‚ä½•æ³¨å†Œå‘½ä»¤"><a class="markdownIt-Anchor" href="#å¦‚ä½•æ³¨å†Œå‘½ä»¤"></a> å¦‚ä½•æ³¨å†Œå‘½ä»¤</h2><p>åœ¨æ’ä»¶ç›®å½•ä¸‹çš„<code>index.js</code>æ–‡ä»¶é€šè¿‡ä¸€ä¸‹æ–¹å¼æ³¨å†Œå‘½ä»¤, <code>api.registerCommand</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å³å‘½ä»¤å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿è¡Œ<code>vue-cli-service å‘½ä»¤å</code>æ‰§è¡Œçš„å›è°ƒ. <code>api</code>çš„æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒ: <a href="https://cli.vuejs.org/dev-guide/plugin-api.html">https://cli.vuejs.org/dev-guide/plugin-api.html</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">api</span>) =&gt;</span> &#123;<br>  api.<span class="hljs-title function_">registerCommand</span>(<br>    <span class="hljs-string">&#x27;greet&#x27;</span>,<br>    &#123;<br>      <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Write a greeting to the console&#x27;</span>,<br>      <span class="hljs-attr">usage</span>: <span class="hljs-string">&#x27;vue-cli-service greet&#x27;</span><br>    &#125;,<br>    <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ‘‹  Hello`</span>);<br>    &#125;<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹æ’ä»¶"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ–¹æ’ä»¶"></a> ç¬¬ä¸‰æ–¹æ’ä»¶</h2><p>ä»¥ vue-cli-plugin-eslint ä¸ºä¾‹, ä»¥ä¸‹æ˜¯æºç ä¸­æ’ä»¶æ ¹ç›®å½•ä¸‹<code>index.js</code>çš„éƒ¨åˆ†æºç :<br />ä½¿ç”¨<code>vue add</code>åœ¨ä¸‹è½½å®Œæ’ä»¶å, æ‰§è¡Œ<code>vue invoke</code>è¿è¡Œ<code>index.js</code>çš„ä»£ç , ä»è€Œæ³¨å†Œ eslint å‘½ä»¤, ä»è€Œå¯ä»¥è¿è¡Œ<code>vue-cli-service eslint</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//...</span><br>api.<span class="hljs-title function_">registerCommand</span>(<br>  <span class="hljs-string">&#x27;lint&#x27;</span>,<br>  &#123;<br>    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;lint and fix source files&#x27;</span>,<br>    <span class="hljs-attr">usage</span>: <span class="hljs-string">&#x27;vue-cli-service lint [options] [...files]&#x27;</span>,<br>    <span class="hljs-attr">options</span>: &#123;<br>      <span class="hljs-string">&#x27;--format [formatter]&#x27;</span>: <span class="hljs-string">&#x27;specify formatter (default: codeframe)&#x27;</span>,<br>      <span class="hljs-string">&#x27;--no-fix&#x27;</span>: <span class="hljs-string">&#x27;do not fix errors or warnings&#x27;</span>,<br>      <span class="hljs-string">&#x27;--no-fix-warnings&#x27;</span>: <span class="hljs-string">&#x27;fix errors, but do not fix warnings&#x27;</span>,<br>      <span class="hljs-string">&#x27;--max-errors [limit]&#x27;</span>: <span class="hljs-string">&#x27;specify number of errors to make build failed (default: 0)&#x27;</span>,<br>      <span class="hljs-string">&#x27;--max-warnings [limit]&#x27;</span>:<br>        <span class="hljs-string">&#x27;specify number of warnings to make build failed (default: Infinity)&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">details</span>:<br>      <span class="hljs-string">&#x27;For more options, see https://eslint.org/docs/user-guide/command-line-interface#options&#x27;</span><br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">args</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./lint&#x27;</span>)(args, api);<br>  &#125;<br>);<br><span class="hljs-comment">//...</span><br></code></pre></td></tr></table></figure><h2 id="æœ¬åœ°æ³¨å†Œå‘½ä»¤"><a class="markdownIt-Anchor" href="#æœ¬åœ°æ³¨å†Œå‘½ä»¤"></a> æœ¬åœ°æ³¨å†Œå‘½ä»¤</h2><p>æœ‰æ—¶å€™å¯èƒ½å¹¶ä¸éœ€è¦å¼€å‘ä¸€ä¸ªå®Œæ•´çš„æ’ä»¶, ä¹Ÿä¸æƒ³å‘å¸ƒ npm åŒ…, åªæƒ³æ³¨å†Œä¸€ä¸ª vue-cli å‘½ä»¤, å¯ä»¥<code>package.json</code>ä¸­æ·»åŠ æœ¬åœ°çš„ js æ–‡ä»¶, è¿™æ · vue-cli å›å»éå†ç›¸åº”æ–‡ä»¶, ä¹Ÿèƒ½å¤ŸæˆåŠŸè¿è¡Œ<code>vue-cli-service test</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// package.json</span><br><span class="hljs-string">&quot;vuePlugins&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;service&quot;</span>: [<br>      <span class="hljs-string">&quot;src/plugins/my-commands.js&quot;</span><br>    ]<br>  &#125;<br><br><span class="hljs-comment">// src/plugins/my-commands.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">api</span>) =&gt;</span> &#123;<br>  api.<span class="hljs-title function_">registerCommand</span>(<span class="hljs-string">&#x27;test&#x27;</span>, &#123;&#125;, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;test&#x27;</span>);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><h1 id="æœ¬åœ°çš„æ’ä»¶"><a class="markdownIt-Anchor" href="#æœ¬åœ°çš„æ’ä»¶"></a> æœ¬åœ°çš„æ’ä»¶</h1><p>æœ¬åœ°å¼€å‘çš„æ’ä»¶åŒ…ä¸æƒ³å‘å¸ƒåˆ° npm å¯ä»¥é€šè¿‡<code>package.json</code>dependency ä¸­çš„<code>file:</code>å¼•å…¥, å¯ä»¥<code>node_module</code>ä¸­çœ‹åˆ°.<br /><strong>æ³¨æ„: file:çš„å¼•å…¥æ–¹å¼ä¸æ˜¯è½¯é“¾çš„æ–¹å¼, å¦‚æœæœ¬åœ°æ’ä»¶æœ‰å˜æ›´, éœ€è¦<code>yarn upgrade vue-cli-plugin-name</code>æ›´æ–°</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;vue-cli-plugin-name&quot;</span>: <span class="hljs-string">&quot;file:./src/plugins/vue-cli-plugin-name&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html">æ’ä»¶å¼€å‘æŒ‡å—</a></li><li><a href="https://juejin.cn/post/6844903988781907975">å¦ˆå¦ˆï¼šæˆ‘ä¼šå†™ Vue-CLI æ’ä»¶äº† ğŸ˜¸</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>vue-cli</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nestjsä½¿ç”¨è®°å½•(ä¸€) - typeormä½¿ç”¨</title>
    <link href="/2022/07/01/2022-07-01-typeorm-apply-to-nestjs/"/>
    <url>/2022/07/01/2022-07-01-typeorm-apply-to-nestjs/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>æœ€è¿‘ç»´æŠ¤çš„è®¸å¤š toB ç³»ç»Ÿéƒ½ä½¿ç”¨ typeorm å¹¶å¤§é‡ä½¿ç”¨å…¶ä¸­çš„è£…é¥°å™¨<code>decorator</code> è¿›è¡Œ db çš„ CRUD, å¿™é‡Œå·é—²ç¨å¾®è®°å½•ä¸€ä¸‹</p><h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1><p>æ–‡ç« ä¼šä½¿ç”¨ çš„ä¾‹å­å¹¶ç»“åˆè‡ªèº«é¡¹ç›®å¼€å‘ä¸­çš„å†…å®¹è®²è§£</p><h1 id="typeorm-in-nestjs"><a class="markdownIt-Anchor" href="#typeorm-in-nestjs"></a> typeorm in nestjs</h1><h2 id="å¼•å…¥-db-é…ç½®"><a class="markdownIt-Anchor" href="#å¼•å…¥-db-é…ç½®"></a> å¼•å…¥ db é…ç½®</h2><h3 id="åŒæ­¥"><a class="markdownIt-Anchor" href="#åŒæ­¥"></a> åŒæ­¥</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">@<span class="hljs-title class_">Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRoot</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;postgres&#x27;</span>,<br>      <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>      <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;postgres&#x27;</span>,<br>      <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;pass&#x27;</span>,<br>      <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,<br>      <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;shop&#x27;</span>,<br>      <span class="hljs-attr">entities</span>: [<span class="hljs-title class_">Product</span>],<br>      <span class="hljs-attr">subscribers</span>: [<span class="hljs-title class_">ProductSubscriber</span>],<br>      <span class="hljs-attr">synchronize</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">autoLoadEntities</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">logger</span>: <span class="hljs-string">&#x27;advanced-console&#x27;</span>,<br>      <span class="hljs-attr">logging</span>: <span class="hljs-string">&#x27;all&#x27;</span><br>    &#125;),<br>    <span class="hljs-title class_">ProductModule</span><br>  ],<br>  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],<br>  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>]<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="å¼‚æ­¥"><a class="markdownIt-Anchor" href="#å¼‚æ­¥"></a> å¼‚æ­¥</h3><p>å¼‚æ­¥éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°, ä¾‹å­ä¸­æ˜¯<code>getTypeORMConfig</code>, å‡½æ•°è¿”å›å€¼å’ŒåŒæ­¥å¼•å…¥ä¸€ç›´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRootAsync</span>(&#123;<br>  <span class="hljs-attr">useFactory</span>: getTypeORMConfig<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="å¼•å…¥-entity-æˆ–-repository"><a class="markdownIt-Anchor" href="#å¼•å…¥-entity-æˆ–-repository"></a> å¼•å…¥ Entity æˆ– Repository</h2><p><code>Entity</code>æ˜¯æè¿°è¡¨ç»“æ„çš„ç±», <code>Repository</code>æ˜¯å¯ä»¥ç†è§£æˆè‡ªå®šä¹‰<code>Entity</code>, å¯ä»¥åœ¨åŸæœ‰<code>Entity</code>åŸºç¡€ä¸Šè‡ªå®šä¹‰æ–¹æ³•</p><h3 id="entity"><a class="markdownIt-Anchor" href="#entity"></a> Entity</h3><p><code>@CreateDateColumn</code>, <code>UpdateDateColumn</code> ç‰¹æ®Šåˆ—ï¼Œè‡ªåŠ¨è®¾ç½®ä¸ºå®ä½“çš„æ’å…¥/æ›´æ–°æ—¶é—´ã€‚ ä¸éœ€è¦åœ¨æ­¤åˆ—ä¸­æ‰‹åŠ¨å†™å…¥å€¼ï¼Œè¯¥å€¼ä¼šè‡ªåŠ¨è®¾ç½®<br /><code>@DeleteDateColumn</code> ä¼šåœ¨<code>soft-delete</code>æ—¶è‡ªåŠ¨è®¾ç½®, æš‚æ—¶æ²¡ç”¨åˆ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">Column</span>,<br>  <span class="hljs-title class_">CreateDateColumn</span>,<br>  <span class="hljs-title class_">DeleteDateColumn</span>,<br>  <span class="hljs-title class_">Entity</span>,<br>  <span class="hljs-title class_">PrimaryGeneratedColumn</span>,<br>  <span class="hljs-title class_">UpdateDateColumn</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;typeorm&#x27;</span>;<br><br>@<span class="hljs-title class_">Entity</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &#123;<br>  @<span class="hljs-title class_">PrimaryGeneratedColumn</span>()<br>  <span class="hljs-attr">id</span>: number;<br><br>  @<span class="hljs-title class_">Column</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;varchar&#x27;</span> &#125;)<br>  <span class="hljs-attr">name</span>: string;<br><br>  @<span class="hljs-title class_">Column</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;numeric&#x27;</span> &#125;)<br>  <span class="hljs-attr">quantity</span>: number;<br><br>  @<span class="hljs-title class_">Column</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;decimal&#x27;</span>, <span class="hljs-attr">precision</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span> &#125;)<br>  <span class="hljs-attr">price</span>: number;<br><br>  @<span class="hljs-title class_">Column</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;boolean&#x27;</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> &#125;)<br>  <span class="hljs-attr">isDeleted</span>: boolean;<br><br>  @<span class="hljs-title class_">CreateDateColumn</span>()<br>  <span class="hljs-attr">createDate</span>: <span class="hljs-title class_">Date</span>;<br><br>  @<span class="hljs-title class_">UpdateDateColumn</span>()<br>  <span class="hljs-attr">updateDate</span>: <span class="hljs-title class_">Date</span>;<br><br>  @<span class="hljs-title class_">DeleteDateColumn</span>()<br>  <span class="hljs-attr">deleteDate</span>: <span class="hljs-title class_">Date</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="repository"><a class="markdownIt-Anchor" href="#repository"></a> Repository</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">@<span class="hljs-title class_">EntityRepository</span>(<span class="hljs-title class_">Product</span>) <span class="hljs-comment">// ä¼ å…¥entity</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Repository</span>&lt;<span class="hljs-title class_">Prository</span>&gt; &#123;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findDocuments</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  <span class="hljs-comment">// ...custom function</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¼•å…¥"><a class="markdownIt-Anchor" href="#å¼•å…¥"></a> å¼•å…¥</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// app.module.ts</span><br>@<span class="hljs-title class_">Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRootAsync</span>(&#123;<br>      <span class="hljs-attr">useFactory</span>: getTypeORMConfig,<br>    &#125;),<br>    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forFeature</span>([  <span class="hljs-comment">// å¯ä»¥ä¼ å…¥entityæˆ–repository</span><br>      <span class="hljs-title class_">DocumentRepository</span>,<br>      <span class="hljs-title class_">HistoryRepository</span>,<br>      <span class="hljs-title class_">SystemRepository</span>,<br>      <span class="hljs-title class_">RetryRepository</span>,<br>    ]),<br>  ],<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="subscribe-listener"><a class="markdownIt-Anchor" href="#subscribe-listener"></a> subscribe listener</h2><p>typeorm æä¾›äº†ä¸€ç³»åˆ—é’©å­ç›‘å¬å„ç§æ“ä½œå¹¶åœ¨æ“ä½œä¹‹å‰/ä¹‹åæ‰§è¡Œé’©å­ä¸­å®šä¹‰çš„æ–¹æ³•, çœ‹å­—é¢æ„æ€éƒ½çŸ¥é“è¿™äº›é’©å­çš„è§¦å‘æ—¶æœº, å°±ä¸ä¸€ä¸€ä»‹ç»</p><ul><li>AfterLoad</li><li>AfterInsert</li><li>BeforeInsert</li><li>AfterUpdate</li><li>BeforeUpdate</li><li>AfterRemove</li><li>BeforeRemove</li></ul><h3 id="å®šä¹‰-subcriber"><a class="markdownIt-Anchor" href="#å®šä¹‰-subcriber"></a> å®šä¹‰ subcriber</h3><p><code>listenTo</code>è®¾ç½®è¡¨ç¤ºç›‘å¬çš„ entity/repository, ä¸è®¾ç½®åˆ™è¡¨ç¤ºç›‘å¬æ‰€æœ‰ entity/repository</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">EntitySubscriberInterface</span>, <span class="hljs-title class_">EventSubscriber</span>, <span class="hljs-title class_">UpdateEvent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;typeorm&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Product</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./product.entity&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Logger</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;<br><br>@<span class="hljs-title class_">EventSubscriber</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductSubscriber</span> implements <span class="hljs-title class_">EntitySubscriberInterface</span>&lt;<span class="hljs-title class_">Product</span>&gt; &#123;<br>  <span class="hljs-title function_">listenTo</span>(): any &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Product</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">afterUpdate</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">UpdateEvent</span>&lt;<span class="hljs-title class_">Product</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;any&gt; | <span class="hljs-keyword">void</span> &#123;<br>    <span class="hljs-keyword">const</span> priceGotUpdated = event.<span class="hljs-property">updatedColumns</span>.<span class="hljs-title function_">find</span>(<br>      <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value.<span class="hljs-property">propertyName</span>,<br>      <span class="hljs-title class_">Product</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">price</span><br>    );<br>    <span class="hljs-keyword">if</span> (priceGotUpdated) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>(event.<span class="hljs-property">databaseEntity</span>.<span class="hljs-property">price</span>) !== event.<span class="hljs-property">entity</span>.<span class="hljs-property">price</span>) &#123;<br>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">log</span>(<br>          <span class="hljs-string">`Price changed from </span><br><span class="hljs-string">        <span class="hljs-subst">$&#123;event.databaseEntity.price&#125;</span> to </span><br><span class="hljs-string">        <span class="hljs-subst">$&#123;event.entity.price&#125;</span>`</span>,<br>          <span class="hljs-string">&#x27;Product Price Updated&#x27;</span><br>        );<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¼•å…¥-2"><a class="markdownIt-Anchor" href="#å¼•å…¥-2"></a> å¼•å…¥</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// app.module.ts</span><br>@<span class="hljs-title class_">Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRootAsync</span>(&#123;<br>      <span class="hljs-attr">useFactory</span>: getTypeORMConfig,<br>    &#125;),<br>    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forFeature</span>([<br>      <span class="hljs-title class_">DocumentRepository</span>,<br>      <span class="hljs-title class_">HistoryRepository</span>,<br>      <span class="hljs-title class_">SystemRepository</span>,<br>      <span class="hljs-title class_">RetryRepository</span>,<br>    ]),<br>  ],<br>  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">DocumentSubscriber</span>],<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="åœ¨-service-ä¸­ä½¿ç”¨-repository"><a class="markdownIt-Anchor" href="#åœ¨-service-ä¸­ä½¿ç”¨-repository"></a> åœ¨ service ä¸­ä½¿ç”¨ repository</h2><ol><li>ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// nestjs</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    @InjectRepository(Template)</span><br><span class="hljs-params">    private readonly templateRepository: Repository&lt;Template&gt;</span><br><span class="hljs-params">  </span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// eggjs</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">ctx: Context</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(ctx);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">repo</span> = <span class="hljs-title function_">getRepository</span>(<span class="hljs-title class_">Template</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>å¯¹æ–¹æ³•ä½¿ç”¨<code>@Transaction</code>, <code>@TransactionRepository</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">@<span class="hljs-title class_">Transaction</span><br>public <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"></span><br><span class="hljs-params">  @TransactionRepository(Template) templateRepository: Repository&lt;Template&gt;</span><br><span class="hljs-params"></span>) &#123;<br>  actRepository.<span class="hljs-title function_">save</span>(...)<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://medium.com/@Semyonic/subscribers-a-k-a-entity-listeners-of-typeorm-on-nestjs-a97ac75acc2d">Subscribers a.k.a Entity Listeners of TypeORM on NestJS</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>nestjs</tag>
      
      <tag>typeorm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼€å‘nodejs cliè¿‡ç¨‹è®°å½•</title>
    <link href="/2022/06/22/2022-06-22-how-to-write-a-node-cli-tool/"/>
    <url>/2022/06/22/2022-06-22-how-to-write-a-node-cli-tool/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>é˜…è¯»ç»„é‡Œå¸¸ç”¨çš„ node ç¼–å†™çš„ cli æºç è®°å½•</p><h1 id="npm-packages"><a class="markdownIt-Anchor" href="#npm-packages"></a> npm packages</h1><p>ä»‹ç»ä¸€äº›å¼€å‘ cli å·¥å…·å¾ˆå®ç”¨çš„ npm åŒ…</p><h2 id="command-exists"><a class="markdownIt-Anchor" href="#command-exists"></a> command-exists</h2><blockquote><p>node module to check if a command-line command exists</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> commandExists = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;command-exists&#x27;</span>);<br><span class="hljs-comment">// å¼‚æ­¥ç”¨æ³•</span><br><span class="hljs-title function_">commandExits</span>(<span class="hljs-string">&#x27;ls&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, commandExists</span>) =&gt;</span> &#123;...&#125;);<br><span class="hljs-comment">// åŒæ­¥ç”¨æ³•</span><br>commandExists.<span class="hljs-title function_">sync</span>(<span class="hljs-string">&#x27;ls&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="fs-extra"><a class="markdownIt-Anchor" href="#fs-extra"></a> fs-extra</h2><blockquote><p>fs-extra adds file system methods that arenâ€™t included in the native fs module and adds promise support to the fs methods. It also uses graceful-fs to prevent EMFILE errors. It should be a drop in replacement for fs.<br />fs-extra æä¾›äº†å¾ˆå¤š fs çš„æ‰©å±•æ“ä½œä¾‹å¦‚å¤åˆ¶, æ¸…ç©ºç­‰æ“ä½œ, ç›¸å½“å¥½ç”¨<br />æ•´ç†ä¸€äº›æ¯”è¾ƒä½¿ç”¨çš„ api:</p></blockquote><ol><li><code>emptyDir</code>: å­—é¢æ„æ€ï¼Œæ¸…ç©ºæ–‡ä»¶å¤¹</li><li><code>readJSON</code>: Reads a JSON file and then parses it into an object.</li><li><code>writeJSON</code>: Write a JSON object stringified into file</li></ol><h2 id="ora"><a class="markdownIt-Anchor" href="#ora"></a> ora</h2><blockquote><p>Elegant terminal spinner</p></blockquote><p>ç”¨äºä¼˜é›…è¾“å‡ºç»ˆç«¯æç¤ºæ–‡æ¡ˆ<br />ä»¥ä¸‹æ˜¯å° demo åŠè¿è¡Œè¾“å‡º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ora = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ora&quot;</span>);<br><span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>(<span class="hljs-string">&quot;default text&quot;</span>).<span class="hljs-title function_">start</span>(<span class="hljs-string">&quot;default text 2&quot;</span>);<br><span class="hljs-comment">// spinner.text = &#x27;Loading rainbows&#x27;;</span><br>spinner.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br>spinner.<span class="hljs-title function_">succeed</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br>spinner.<span class="hljs-title function_">fail</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br>spinner.<span class="hljs-title function_">succeed</span>();<br></code></pre></td></tr></table></figure><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1661877086095_5819.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /><br />å…¶ä¸­<code>ora</code>éœ€è¦å®ä¾‹åŒ–ä¸º<code>spinner</code>ä½¿ç”¨, <code>ora()</code>, <code>start()</code>å‚æ•°ä¸º<code>string</code>æ—¶éƒ½è¡¨ç¤ºé»˜è®¤è¾“å‡ºæ–‡æœ¬, <code>spinner.text</code>åŒç†, åè®¾ç½®çš„ä¼˜å…ˆçº§æ›´é«˜, åœ¨<code>spinner.xxx()</code>æœªä¼ å…¥å‚æ•°æ—¶ä¼šè¾“å‡ºé»˜è®¤æ–‡æœ¬</p><h3 id="tips"><a class="markdownIt-Anchor" href="#tips"></a> tips</h3><p>æœ€æ–°ç‰ˆæœ¬çš„<code>ora</code>åªèƒ½ä½¿ç”¨ ESModule å¼•å…¥, commonjs æ–¹å¼å¼•å…¥è¯·ä½¿ç”¨ v4 ç‰ˆæœ¬</p><h1 id="å®ç”¨æ“ä½œ"><a class="markdownIt-Anchor" href="#å®ç”¨æ“ä½œ"></a> å®ç”¨æ“ä½œ</h1><h2 id="æŸ¥çœ‹åŒ…çš„æœ€æ–°ç‰ˆæœ¬å’Œæ‰€æœ‰ç‰ˆæœ¬"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹åŒ…çš„æœ€æ–°ç‰ˆæœ¬å’Œæ‰€æœ‰ç‰ˆæœ¬"></a> æŸ¥çœ‹åŒ…çš„æœ€æ–°ç‰ˆæœ¬å’Œæ‰€æœ‰ç‰ˆæœ¬</h2><p>æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npm view package-name versions --json<br><span class="hljs-comment">// or</span><br>yarn info package-name versions --json<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npm view package-name version --json<br><span class="hljs-comment">// &quot;1.0.1205&quot;</span><br><span class="hljs-comment">// or</span><br>yarn info package-name version --json<br><span class="hljs-comment">// &#123;&quot;type&quot;:&quot;inspect&quot;,&quot;data&quot;:&quot;1.0.1205&quot;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="processcwdå’Œ__dirname"><a class="markdownIt-Anchor" href="#processcwdå’Œ__dirname"></a> process.cwd()å’Œ__dirname</h2><p>è¿™ä¸¤ä¸ªå‘½ä»¤è¡Œçš„è¾“å‡ºåœ¨å¼€å‘ cli è¿™ç§å…¨å±€åŒ…ä¸­åŒºåˆ«å°¤ä¸ºæ˜æ˜¾</p><p><code>process.cwd()</code>: è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚å¯ä»¥é€šè¿‡<code>process.chdir()</code>æ›´æ”¹.<br /><code>__dirname</code>è¿”å›æºä»£ç æ‰€åœ¨çš„ç›®å½•ã€‚</p><h2 id="spawn"><a class="markdownIt-Anchor" href="#spawn"></a> spawn</h2><p>æˆ‘ä»¬ä½¿ç”¨ spawn æ‰§è¡Œ linux å‘½ä»¤åå¦‚ä½•è·å¾—å¯¹åº”çš„è¾“å‡ºå‘¢? çœ‹æºç æ—¶ä½¿ç”¨äº†ä¸¤ç§æ–¹å¼, ä¸¤ç§éƒ½å¯ä»¥<br />å…ˆçœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ spawn</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;child_process&quot;</span>);<br><span class="hljs-keyword">const</span> ls = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">&quot;ls&quot;</span>, [<span class="hljs-string">&quot;-la&quot;</span>], &#123;&#125;);<br></code></pre></td></tr></table></figure><ol><li>spawn ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­<code>stdio</code>é»˜è®¤å€¼ä¸º <code>pipe</code>, ç›¸å½“äº<code>ç›¸å½“äº ['pipe', 'pipe', 'pipe']</code>, å¯¹åº”<code>stdin</code>, <code>stdout</code>, <code>stderr</code>.<br /><code>pipe</code>ä¼šåœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´åˆ›å»ºç®¡é“ã€‚å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¢«é‡å®šå‘åˆ° ChildProcess å¯¹è±¡ä¸Šç›¸åº”çš„ subprocess.stdinã€subprocess.stdout å’Œ subprocess.stderr æµã€‚é»˜è®¤æƒ…å†µä¸‹å­è¿›ç¨‹çš„è¾“å‡ºçˆ¶è¿›ç¨‹æ˜¯çœ‹ä¸åˆ°çš„, éœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ã€‚è¿™é‡Œ<code>stdio: 'pipe'</code>å¾ˆå®¹æ˜“è¯¯è§£</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">ls.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">setEncoding</span>(<span class="hljs-string">&quot;utf8&quot;</span>);<br>ls.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">pipe</span>(process.<span class="hljs-property">stdout</span>);<br><span class="hljs-comment">// or</span><br>ls.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>  process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(data);<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="2"><li>è®¾ç½®<code>stdio: 'inherit'</code>, é€šè¿‡ç›¸åº”çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµä¼ å…¥/ä¼ å‡ºçˆ¶è¿›ç¨‹, å­è¿›ç¨‹ç›´æ¥ä½¿ç”¨çˆ¶è¿›ç¨‹çš„æµã€‚ åœ¨å‰ä¸‰ä¸ªä½ç½®ï¼Œè¿™åˆ†åˆ«ç›¸å½“äº process.stdinã€process.stdout å’Œ process.stderrã€‚å¯¹äºè¯´æ˜æ€§çš„å†…å®¹å¯ä»¥ç›´æ¥ä½¿ç”¨<code>stdio: 'inherit'</code>, å¯¹äºéœ€è¦å¤„ç†çš„è¾“å‡ºæ•°æ®, é»˜è®¤å³å¯, é€šè¿‡<code>stdout.on('data')</code>å¤„ç†æ•°æ®</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ls = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">&quot;ls&quot;</span>, [<span class="hljs-string">&quot;-la&quot;</span>], &#123; <span class="hljs-attr">stdio</span>: <span class="hljs-string">&quot;inherit&quot;</span> &#125;);<br><span class="hljs-comment">// ä¼šç›´æ¥è¾“å‡ºls -laçš„å†…å®¹, æ— æ³•é€šè¿‡ondataç›‘å¬stdout, stderrè¿˜æ˜¯å¯ä»¥ç›‘å¬</span><br><span class="hljs-comment">// ä½¿ç”¨process.stdoutæ— æ³•ondata, ä½¿ç”¨ls.stdout.ondataä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„</span><br></code></pre></td></tr></table></figure><h2 id="cwd"><a class="markdownIt-Anchor" href="#cwd"></a> cwd</h2><p>spawn ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­æ”¯æŒ cwd è¡¨ç¤ºå­è¿›ç¨‹å‘½ä»¤è¦è¿è¡Œçš„ç›®å½•, ä¾‹å¦‚<code>yarn link</code>å°±éœ€è¦æŒ‡å®šç›®å½•æ‰èƒ½æ­£å¸¸</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">&quot;yarn&quot;</span>, [<span class="hljs-string">&quot;link&quot;</span>], &#123; <span class="hljs-attr">cwd</span>: xx &#125;);<br></code></pre></td></tr></table></figure><h2 id="requireresolve"><a class="markdownIt-Anchor" href="#requireresolve"></a> require.resolve</h2><p>ä¸€èˆ¬ç”¨äºè·å– npm åŒ…çš„ç»å¯¹è·¯å¾„, å¦‚æœå½“å‰æºç è¿è¡Œçš„ç›®å½•<code>node_modules</code>ä¸å­˜åœ¨è¿™ä¸ªåŒ…, ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸, ç”¨æ³•å¦‚ä¸‹:<br />åšä¸»åªç”¨åˆ°äº†æ¨¡å—è·¯å¾„çš„ä½¿ç”¨æ–¹æ³•, <code>require.resolve</code>ä¼šåœ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„ç›®å½•å¼€å§‹é€çº§å¾€å¤–æŸ¥æ‰¾æŸ¥æ‰¾<code>node_modules</code>, æŒ‰ç…§è¿™æ ·çš„æœç´¢é¡ºåº<code>[&quot;/Users/enhanced-resolve/node_modules&quot;, &quot;/Users/node_modules&quot;, &quot;/node_modules&quot;]</code><br />å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://juejin.cn/post/6844904055806885895">node çš„è·¯å¾„è§£æ require.resolve</a><br /><strong><code>require.resolveå’Œprocess.cwd()ä¸åŒ, process.chdir()æ— æ³•æ›´æ”¹æŸ¥æ‰¾è·¯å¾„</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è·å–åŒ…æ‰€åœ¨çš„ç›®å½•ç»å¯¹è·¯å¾„</span><br>path.<span class="hljs-title function_">join</span>(<span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>($&#123;moduleName&#125;/package.<span class="hljs-property">json</span>), <span class="hljs-string">&#x27;..&#x27;</span>)<br><span class="hljs-comment">// ä¸åŠ package.json é»˜è®¤æ‰¾index.js</span><br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="http://nodejs.cn/api/child_process.html#optionsstdio">nodejs å®˜æ–¹æ–‡æ¡£ child_process</a></li><li><a href="https://juejin.cn/post/6844904055806885895">node çš„è·¯å¾„è§£æ require.resolve</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>node</tag>
      
      <tag>cli</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>whistleå®ç”¨æ“ä½œè®°å½•</title>
    <link href="/2022/06/16/2022-06-16-whistle-config-record/"/>
    <url>/2022/06/16/2022-06-16-whistle-config-record/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>èƒŒæ™¯å…¶å®ä¹Ÿæ˜¯å’ŒåŒäº‹é—²èŠ, ç„¶åèŠåˆ°è¿™ä¸ª, å°±å°è¯•äº†ä¸‹, æ€»ç»“äº†ä¸‰ç§æ–¹æ³•</p><h1 id="whistle-éƒ¨åˆ†è¯·æ±‚ä¸èµ°ä»£ç†"><a class="markdownIt-Anchor" href="#whistle-éƒ¨åˆ†è¯·æ±‚ä¸èµ°ä»£ç†"></a> whistle éƒ¨åˆ†è¯·æ±‚ä¸èµ°ä»£ç†</h1><p>è¯•æƒ³ä¸€ä¸ªåœºæ™¯è¦æŠŠåŸŸå<code>www.abc.com</code>ä»£ç†åˆ°æŸå°æœºå™¨ ip, ä½†æ˜¯<code>www.abc.com/api</code>ä¸èµ°ä»£ç†, å¯ä»¥</p><ol><li>ç¬¬ä¸€ç§æœ€ç®€å•çš„, å†™å¯¹åº”åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼, ä½†æ˜¯éœ€è¦æ¯”è¾ƒç†Ÿç»ƒçš„æ­£åˆ™ä½¿ç”¨ç»å†</li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">/www</span>\<span class="hljs-string">.abc</span>\<span class="hljs-string">.com</span>\/?!<span class="hljs-params">(api)</span>/ 127.0.0.1<br></code></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨<code>ignore://host</code>, è¿™é‡Œè¿˜æ”¯æŒ ignore file, sock ä¹‹ç±»çš„, è¿˜éœ€è¦çœ‹ä»£ç†çš„æ˜ å°„</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">www<span class="hljs-selector-class">.abc</span><span class="hljs-selector-class">.com</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>www<span class="hljs-selector-class">.abc</span>.com/api ignore:<span class="hljs-comment">//host</span><br></code></pre></td></tr></table></figure><ol start="3"><li><code>excludeFilter</code>(æˆ‘è¿˜æ²¡è¯•è¿‡, ä¸è¿‡åŒäº‹è¯´å¯ä»¥è¯¶å˜¿)</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">www.abc.com excludeFilter:<span class="hljs-regexp">//</span><span class="hljs-regexp">/(api)/</span><br></code></pre></td></tr></table></figure><p>æ›´å¤šçš„ä¾‹å¦‚è¯·æ±‚å¤´è¿‡æ»¤, <code>includeFilter</code>, å¯ä»¥å‚è€ƒ<a href="https://cloud.tencent.com/edu/learning/course-2605-50298">https://cloud.tencent.com/edu/learning/course-2605-50298</a></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://cloud.tencent.com/edu/learning/course-2605-50298">ignore</a></li><li><a href="https://wproxy.org/whistle/rules/filter.html">filter</a></li><li><a href="https://cloud.tencent.com/edu/learning/course-2605-50298">pipe-è¿‡æ»¤è§„åˆ™</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>whistle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reactè„šæ‰‹æ¶ä¸­ä½¿ç”¨sass/less modules</title>
    <link href="/2022/06/13/2022-06-13-react-css-module/"/>
    <url>/2022/06/13/2022-06-13-react-css-module/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>è¿˜æ˜¯åœ¨çœ‹ react é¡¹ç›®ä»£ç æ—¶å‘ç°å¼•å…¥ css æ—¶å¹¶ä¸æ˜¯ç›´æ¥<code>import 'xx.less'</code>, è€Œæ˜¯é€šè¿‡<code>import style from 'xx.less'</code>çš„æ–¹å¼å¼•å…¥, å‰è€…å¼•å…¥å®é™…ä¸Šæ˜¯å…¨å±€çš„ css é…ç½®, å¯èƒ½ä¼šå…¨å±€æ±¡æŸ“åˆ«çš„ç»„ä»¶, è€Œåè€…åˆ™é€šè¿‡ css module çš„æ–¹å¼ä½¿ css åªä½œç”¨äºå½“å‰ç»„ä»¶</p><h1 id="é…ç½®-css-module"><a class="markdownIt-Anchor" href="#é…ç½®-css-module"></a> é…ç½® css module</h1><p>é…ç½®ä¸­çš„<code>importLoaders</code>å¿…é¡»æ˜¯ 3</p><h2 id="sass"><a class="markdownIt-Anchor" href="#sass"></a> sass</h2><p><code>create-react-app</code>react çš„è„šæ‰‹æ¶é»˜è®¤æ”¯æŒäº† sass, æ‰€ä»¥ä¸éœ€è¦é¢å¤–å®‰è£… sass åŠ sass-loader, åŒæ—¶ä¹Ÿæ”¯æŒäº† sass in css module, é€šè¿‡<code>npm run eject</code>å¯ä»¥çœ‹åˆ° webpack ä¸­å¯¹åº”çš„é…ç½®.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Adds support for CSS Modules, but using SASS</span><br><span class="hljs-comment">// using the extension .module.scss or .module.sass</span><br>&#123;<br>  <span class="hljs-attr">test</span>: sassModuleRegex,<br>  <span class="hljs-attr">use</span>: <span class="hljs-title function_">getStyleLoaders</span>(<br>    &#123;<br>      <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">3</span>,<br>      <span class="hljs-attr">sourceMap</span>: isEnvProduction ? shouldUseSourceMap : isEnvDevelopment,<br>      <span class="hljs-attr">modules</span>: &#123;<br>        <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;local&#x27;</span>,<br>        <span class="hljs-attr">getLocalIdent</span>: getCSSModuleLocalIdent,<br>      &#125;,<br>    &#125;,<br>    <span class="hljs-string">&#x27;sass-loader&#x27;</span>,<br>  ),<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="importloader"><a class="markdownIt-Anchor" href="#importloader"></a> importLoader</h3><p>è¿™é‡Œ<code>importLoader</code>ä½œç”¨äº<code>css-loader</code>, å¿…é¡»æ˜¯ 3 çš„åŸå› æ˜¯, <code>sass-loader</code>å‰é¢è¿˜æœ‰<code>postcss-loader</code>å’Œ<code>css-loader</code>æ­£å¥½ä¸‰ä¸ª loader</p><h2 id="less"><a class="markdownIt-Anchor" href="#less"></a> less</h2><p>è„šæ‰‹æ¶é»˜è®¤ä¸æ”¯æŒ less, å…ˆå®‰è£… less å’Œ less-loader</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yarn add less less-loader<br></code></pre></td></tr></table></figure><p>ç„¶åé…ç½® webpack, å¦‚æœè¦æ”¯æŒ<code>import .. from</code>éœ€è¦è®¾ç½®<code>module: true</code>, éœ€è¦æ³¨æ„çš„æ˜¯,ç›´æ¥ import å’Œ importâ€¦from æ˜¯<strong>äº’æ–¥</strong>çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.less$/</span>,<br>  <span class="hljs-attr">use</span>: <span class="hljs-title function_">getStyleLoaders</span>(<br>    &#123;<br>      <span class="hljs-attr">modules</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">3</span>,<br>      <span class="hljs-attr">sourceMap</span>: isEnvProduction &amp;&amp; shouldUseSourceMap,<br>    &#125;,<br>    <span class="hljs-string">&#x27;less-loader&#x27;</span>,<br>  ),<br>  <span class="hljs-comment">// Don&#x27;t consider CSS imports dead code even if the</span><br>  <span class="hljs-comment">// containing package claims to have no side effects.</span><br>  <span class="hljs-comment">// Remove this when webpack adds a warning or an error for this.</span><br>  <span class="hljs-comment">// See https://github.com/webpack/webpack/issues/6571</span><br>  <span class="hljs-attr">sideEffects</span>: <span class="hljs-literal">true</span>,<br>&#125;,<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-css-modules"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-css-modules"></a> ä½¿ç”¨ css modules</h1><h2 id="sass-2"><a class="markdownIt-Anchor" href="#sass-2"></a> sass</h2><ol><li>æ–°å»º<code>[name].module.scss</code>, æ–‡ä»¶åå¿…é¡»å¸¦æœ‰<em>module</em>, å¦åˆ™ä¸ä¼šè¢«è¯†åˆ«ä¸º css modules</li><li>åœ¨ tsx ä¸­ä½¿ç”¨</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// style.scss</span><br><span class="hljs-selector-class">.hd</span> &#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> style <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./style.module.scss&#x27;</span>;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;style.hd&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;<br></code></pre></td></tr></table></figure><h2 id="less-2"><a class="markdownIt-Anchor" href="#less-2"></a> less</h2><ol><li>éšä¾¿æ–°å»º<code>[name].less</code></li><li>(optional)å¦‚æœä½¿ç”¨çš„æ˜¯ typescript, é»˜è®¤ typescript æ— æ³•è¯†åˆ«<code>import xx from 'xx.less</code>, ä¼šæŠ¥é”™<strong>TS2307: Cannot find module â€˜./style.lessâ€™ or its corresponding type declarations.</strong>, éœ€è¦åœ¨<code>src/</code>ä¸‹æ–°å»º<code>react-app-env.d.ts</code>, æŠŠä¸‹é¢å£°æ˜åŠ åˆ°æ–‡ä»¶ä¸­, é”™è¯¯æ¶ˆå¤±</li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// react-app-env.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;*.less&#x27;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">content</span>: &#123; [<span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> content;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨æ–¹æ³•åŒ sass</li></ol><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://stackoverflow.com/questions/57749719/using-less-files-with-react">Using .less files with React</a></li><li><a href="https://juejin.cn/post/7031528538209681444">react ä¸­ css modules-åŸºæœ¬ä½¿ç”¨</a></li><li><a href="https://zhuanlan.zhihu.com/p/94706976">css-loader ä¸­ importLoaders çš„ç†è§£</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AntDesign, ProComponentä½¿ç”¨è¸©å‘</title>
    <link href="/2022/06/09/2022-06-09-ant-design-in-use/"/>
    <url>/2022/06/09/2022-06-09-ant-design-in-use/</url>
    
    <content type="html"><![CDATA[<p><a href="https://ant.design/">ant-design å®˜ç½‘</a><br /><a href="https://procomponents.ant.design/">ProComponent å®˜ç½‘</a></p><h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚è¿­ä»£è¦ä¿®æ”¹ä¸­å°ç³»ç»Ÿ, è¯¥ç³»ç»Ÿæ˜¯ä½¿ç”¨ react + ant-design + ProComponent æ­å»º#çš„, è®°å½•ä¸‹é‡åˆ°çš„é—®é¢˜</p><h1 id="é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°çš„é—®é¢˜"></a> é‡åˆ°çš„é—®é¢˜</h1><h2 id="1-ant-design-è®¾ç½®è¡¨å•çš„validatorä¸€ç›´æ˜¾ç¤ºxxx-is-not-a-valid-undefined"><a class="markdownIt-Anchor" href="#1-ant-design-è®¾ç½®è¡¨å•çš„validatorä¸€ç›´æ˜¾ç¤ºxxx-is-not-a-valid-undefined"></a> 1. ant-design è®¾ç½®è¡¨å•çš„<code>validator</code>ä¸€ç›´æ˜¾ç¤º<code>xxx is not a valid undefined</code></h2><p>ant-design ä¸­è¡¨å•æ ¡éªŒé»˜è®¤<code>type</code>éƒ½æ˜¯<code>string</code>, æŠ¥é”™æœ¬æ¥æƒ³æ˜¾ç¤ºçš„æ˜¯<code>xxx is not a valid number</code>ä¹‹ç±», å¦‚æœè¦æ£€éªŒåˆ«çš„ç±»å‹æ£€æŸ¥æ˜¯å¦æ²¡æœ‰é…ç½®<code>type</code>, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">min</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">10</span>,<br>  <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> +value,<br>  <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;è¯·è¾“å…¥xx&#x27;</span>,<br>  <span class="hljs-comment">// type: &#x27;number&#x27;,  // éœ€è¦é…ç½®å“¦</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-procomponent-ä¸­-form-è¡¨å•é¡¹è®¾ç½®åˆå§‹å€¼å¤±è´¥"><a class="markdownIt-Anchor" href="#2-procomponent-ä¸­-form-è¡¨å•é¡¹è®¾ç½®åˆå§‹å€¼å¤±è´¥"></a> 2. ProComponent ä¸­ form è¡¨å•é¡¹è®¾ç½®åˆå§‹å€¼å¤±è´¥</h2><p>è¿™ä¸ªé—®é¢˜, å®˜æ–¹æ–‡æ¡£å·²ç»åšäº†è§£é‡Š, æ˜¯æˆ‘ä¸ä¼šçœ‹æ–‡æ¡£(åˆ«éª‚äº†åˆ«éª‚äº†):</p><blockquote><p>ä½ ä¸èƒ½ç”¨æ§ä»¶çš„ value æˆ– defaultValue ç­‰å±æ€§æ¥è®¾ç½®è¡¨å•åŸŸçš„å€¼ï¼Œé»˜è®¤å€¼å¯ä»¥ç”¨ Form é‡Œçš„ initialValues æ¥è®¾ç½®ã€‚æ³¨æ„ initialValues ä¸èƒ½è¢« setState åŠ¨æ€æ›´æ–°ï¼Œä½ éœ€è¦ç”¨ setFieldsValue æ¥æ›´æ–°ã€‚ ä½ ä¸åº”è¯¥ç”¨ setStateï¼Œå¯ä»¥ä½¿ç”¨ form.setFieldsValue æ¥åŠ¨æ€æ”¹å˜è¡¨å•å€¼ã€‚</p></blockquote><p><code>initialValue</code>å¦‚æœä¸€å¼€å§‹å°±åœ¨<code>columns</code>ä¸­å®šä¹‰å¥½æ˜¯ä¼šç”Ÿæ•ˆçš„, ä½†æ˜¯æˆ‘çš„éœ€æ±‚åœºæ™¯æ˜¯é€šè¿‡è¯·æ±‚åŠ¨æ€è·å–<code>initialValue</code>, form ä¸­å†…éƒ¨æ‰˜ç®¡äº†æ•°æ®å¤„ç†, æ‰€ä»¥ä¸‹é¢è¿™æ ·å†™æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = your code;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">columns$</span>: any[] = [...columns];<br>    columns$.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;xxx&#x27;</span>,<br>      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">&#x27;xxx&#x27;</span>,<br>      <span class="hljs-attr">valueType</span>: <span class="hljs-string">&#x27;select&#x27;</span>,<br>      <span class="hljs-attr">valueEnum</span>: your code,<br>      <span class="hljs-attr">initialValue</span>: options,<br>    &#125;);<br>    <span class="hljs-title function_">setColumns</span>(columns$);<br>  &#125;, [xxx]);<br></code></pre></td></tr></table></figure><p>éœ€è¦è¿™æ ·:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ts</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = your code;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">columns$</span>: any[] = [...columns];<br>    columns$.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;xxx&#x27;</span>,<br>      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">&#x27;xxx&#x27;</span>,<br>      <span class="hljs-attr">valueType</span>: <span class="hljs-string">&#x27;select&#x27;</span>,<br>      <span class="hljs-attr">valueEnum</span>: your code,<br>    &#125;);<br>    form.<span class="hljs-title function_">setFieldsValue</span>(&#123; <span class="hljs-attr">templateTitle</span>: options &#125;);<br>    <span class="hljs-title function_">setColumns</span>(columns$);<br>  &#125;, [xxx]);<br><br><span class="hljs-comment">// tsx</span><br><span class="hljs-keyword">const</span> [form] = <span class="hljs-title function_">useForm</span>();<br><span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span> <span class="hljs-attr">form</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">form</span> &#125;&#125; /&gt;</span></span>)<br></code></pre></td></tr></table></figure><h2 id="3-protable-params-å˜åŒ–ä¸è§¦å‘-request"><a class="markdownIt-Anchor" href="#3-protable-params-å˜åŒ–ä¸è§¦å‘-request"></a> 3. ProTable params å˜åŒ–ä¸è§¦å‘ request</h2><p>è¿™ä¸ªé—®é¢˜æˆ‘å®šä½äº†åŠå¤©, ä¸€ç›´ä»¥ä¸ºæ˜¯ params å˜æ›´æ¯”è¾ƒå‡ºäº†é—®é¢˜, äº‹å®ä¸ŠæŸ¥é˜… issue<a href="https://github.com/ant-design/pro-table/issues/174">ğŸ›[BUG] params æ›´æ–°æ— æ³•è§¦å‘ request</a>è¯æ˜ params ç¡®å®ä¹Ÿæ˜¯æµ…æ¯”è¾ƒ, ä½†æ˜¯é—®é¢˜å¹¶ä¸å‡ºåœ¨è¿™â€¦<br />æŸ¥é˜… issue<a href="https://github.com/ant-design/pro-components/issues/2750">ğŸ›[BUG]pro-table ä¸­å¦‚æœ request ä¸­æœ‰ awaitï¼Œå½“ params å˜æ›´åä¸ä¼šå†æ¬¡è§¦å‘ request</a>å‘ç°, <strong>ProTable çš„ request ä¸­å¦‚æœä¸Šä¸€ä¸ªè¯·æ±‚è¿˜æ²¡è¿”å›æ•°æ®, ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ä¼šè¢«æ‹¦æˆªçš„å¹¶ä¸ä¼šè§¦å‘</strong>, ç„¶åæ¥çœ‹ä¸‹ä»£ç ä¸­çš„é€»è¾‘:</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tsx">&lt;<span class="hljs-title class_">ProTable</span>&lt;<span class="hljs-title class_">TableListItem</span>&gt;<br>  &#123;...your other config&#125;<br>  params=&#123;&#123; templateList, systemId, status &#125;&#125;<br>  request=&#123;<span class="hljs-function">(<span class="hljs-params">params, sorter, filter</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// if (templateList?.length) &#123;</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryDocuments</span>(&#123;...params&#125;);<br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">data</span>: [],<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;&#125;<br>  form=&#123;&#123; form &#125;&#125;<br>/&gt;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>systemId</code>å’Œ<code>templateList</code>å˜åŒ–éƒ½ä¼šè§¦å‘<code>request</code>, å¹¶ä¸”æ›´æ–°æ—¶é—´å·®ä¸å¤š,è¿™å°±å¯¼è‡´<code>systemId</code>è§¦å‘çš„ request è¿˜æ²¡è¿”å›æ•°æ®, <code>templateList</code>è§¦å‘çš„ request è¢«æˆªæ–­äº†, ç”šè‡³ä¸æ˜¯é˜»å¡â€¦issue ä¸­å¤§å®¶éƒ½è§‰å¾—è¿™æ˜¯ä¸åˆç†çš„, æ˜¯ä¸ª bug, ä½†æ˜¯ä½œè€…è§‰å¾—æ²¡å•¥é—®é¢˜â€¦(è¡Œ â‘§)</p><p>æ‰€ä»¥ è¿™é‡Œéœ€è¦åŠ ä¸ª<code>if</code>åˆ¤æ–­åªè§¦å‘<code>templateList</code>æ›´æ–°æ—¶çš„è¯·æ±‚</p><h2 id="åœ¨-typeorm-ä¸­ä½¿ç”¨-in"><a class="markdownIt-Anchor" href="#åœ¨-typeorm-ä¸­ä½¿ç”¨-in"></a> åœ¨ typeorm ä¸­ä½¿ç”¨ in</h2><p>éœ€æ±‚åœºæ™¯è¿˜éœ€è¦æ”¯æŒå¤šé€‰æœç´¢, æ‰€ä»¥åŸå…ˆ sql ä¸­çš„<code>=</code>éœ€è¦å˜æ›´ä¸º<code>in</code>, é¡ºä¾¿è®°å½•ä¸‹ typeorm ä¸‹çš„ sql è¦æ€ä¹ˆå†™</p><h3 id=""><a class="markdownIt-Anchor" href="#"></a> =</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts">query.<span class="hljs-title function_">andWhere</span>(<span class="hljs-string">&#x27;xxx.templateId = :templateId&#x27;</span>, &#123; templateId &#125;);<br><span class="hljs-comment">// æˆ–</span><br>query.<span class="hljs-title function_">andWhere</span>(<span class="hljs-string">`xxx.templateId = <span class="hljs-subst">$&#123;templateId&#125;</span>`</span>);<br></code></pre></td></tr></table></figure><h3 id="in"><a class="markdownIt-Anchor" href="#in"></a> in</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts">query.<span class="hljs-title function_">andWhere</span>(<span class="hljs-string">&#x27;xxx.templateTitle in (:templateTitle)&#x27;</span>, &#123; templateTitle &#125;); <span class="hljs-comment">// templateTitleæ˜¯æ•°ç»„</span><br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://github.com/ant-design/pro-components/issues/2750">ğŸ›[BUG]pro-table ä¸­å¦‚æœ request ä¸­æœ‰ awaitï¼Œå½“ params å˜æ›´åä¸ä¼šå†æ¬¡è§¦å‘ request</a></li><li><a href="https://github.com/ant-design/pro-table/issues/174">ğŸ›[BUG] params æ›´æ–°æ— æ³•è§¦å‘ request</a></li><li><a href="https://procomponents.ant.design/components/table?current=1&amp;pageSize=5#protable">ProComponent</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>ant-design</tag>
      
      <tag>react</tag>
      
      <tag>ProComponent</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…ætsconfig.jsonä¸­module, moduleResolution, target, libçš„ä½œç”¨</title>
    <link href="/2022/05/15/2022-05-15-tsconfig-confused-field-explain/"/>
    <url>/2022/05/15/2022-05-15-tsconfig-confused-field-explain/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><ol><li>ä¸šåŠ¡éƒ¨é—¨è¿™ä¸€å¹´å…¨é¢æ‹¥æŠ± typescript, å†ä¹Ÿä¸ç›´æ¥ä½¿ç”¨ js ç¼–å†™ä»£ç ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ ts å®é™…ä¸Šè¿˜æ˜¯ä¼šè¢«ç¼–è¯‘æˆ js çš„ï¼Œ<code>tsconfig.json</code>åˆ™èµ·åˆ°é‡è¦ä½œç”¨, å…¶ä¸­<code>module</code>, <code>moduleResolution</code>, <code>target</code>, <code>lib</code>è¿™äº› field åŠå…¶ value é•¿å¾—å¥½åƒéƒ½å·®ä¸å¤š, æ‰€ä»¥ä¸€ç›´æ²¡ææ¸…æ¥šè¿™äº› field æ˜¯åšä»€ä¹ˆçš„</li></ol><h1 id="module"><a class="markdownIt-Anchor" href="#module"></a> module</h1><p>å®šä¹‰<strong>æ¨¡å—è§£å†³æ–¹æ¡ˆ</strong>, typescript ä¸­éƒ½æ˜¯é€šè¿‡<code>import/export</code>å¤„ç†æ¨¡å—, ä½†ç¼–è¯‘æˆ js å­˜åœ¨<code>AMD</code>, <code>CMD</code>, <code>ES20XX</code>, <code>commonjs</code>ç­‰å¤šé‡æ¨¡å—è§£å†³æ–¹æ¡ˆ, è¿™é‡Œçš„å»ºè®®æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨çš„é¡¹ç›®ä½¿ç”¨<code>ES20XX</code>, å› ä¸ºç°ä»£æµè§ˆå™¨å¤§å¤šå·²ç»åŸç”Ÿæ”¯æŒ<code>import/export</code>; è¿è¡Œåœ¨ node.js çš„é¡¹ç›®ä½¿ç”¨<code>commonjs</code>, é«˜ç‰ˆæœ¬çš„ node ç‰ˆæœ¬æ‰å¼€å§‹æ”¯æŒ<code>import/export</code>, <code>commonjs</code>ä¼šä½¿ç”¨<code>module.export/require</code>å¼•å…¥æ¨¡å—, å…¶ä½™å€¼å¾ˆå°‘ç”¨åˆ°.</p><h2 id="ä¸åŒ-module-ç¼–è¯‘å‡ºçš„ä»£ç "><a class="markdownIt-Anchor" href="#ä¸åŒ-module-ç¼–è¯‘å‡ºçš„ä»£ç "></a> ä¸åŒ module ç¼–è¯‘å‡ºçš„ä»£ç </h2><h3 id="commonjs"><a class="markdownIt-Anchor" href="#commonjs"></a> <strong>commonjs</strong></h3><p><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220524-exp4.png" alt="" /></p><h3 id="es20xx"><a class="markdownIt-Anchor" href="#es20xx"></a> <strong>es20xx</strong></h3><p><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220524-exp3.png" alt="" /></p><p><strong>å¦‚æœæ˜ç¡®é¡¹ç›®æ˜¯è¿è¡Œåœ¨é«˜ç‰ˆæœ¬ node, å¯ä»¥å°è¯•ä½¿ç”¨<code>ES20XX</code>, ä½†æ˜¯ä¹Ÿéœ€è¦æ³¨æ„å¼•å…¥çš„ç¬¬ä¸‰æ–¹ npm åŒ…æ˜¯å¦æ”¯æŒ, åœ¨ nestjs ä¸­å°è¯•ä½¿ç”¨<code>ES20XX</code>å°±ä¼šæœ‰æŠ¥é”™, äºæ˜¯è€è€å®å®çš„ä½¿ç”¨<code>commonjs</code></strong><br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220524-exp1.png" alt="" /></p><h1 id="moduleresolution"><a class="markdownIt-Anchor" href="#moduleresolution"></a> moduleResolution</h1><p>å®šä¹‰ç¼–è¯‘å™¨å¦‚ä½•<strong>æ‰¾åˆ°(å¤„ç†)å¼•å…¥çš„åŒ…æ–‡ä»¶</strong>, å…±æœ‰ä¸¤ç§å¯ç”¨çš„æ¨¡å—è§£æç­–ç•¥: <code>node</code>å’Œ<code>classic</code>, <code>node</code>æ˜¯ typescript ç°åœ¨é»˜è®¤çš„è§£æç­–ç•¥, <code>classic</code>æ›´å¤šæ˜¯ç”¨äºå‘ä¸‹å…¼å®¹, å¾ˆå°‘å›å»é…ç½®æ”¹ field, ä¿æŒé»˜è®¤å³å¯</p><h1 id="target"><a class="markdownIt-Anchor" href="#target"></a> target</h1><p>å®šä¹‰<strong>ç¼–è¯‘ä¸ºä»€ä¹ˆç‰ˆæœ¬çš„ä»£ç </strong>, æˆ‘ä»¬éƒ½çŸ¥é“,es2015~es20xx æ¯å¹´éƒ½ä¼šæ–°å¢æ–°çš„ api å’Œæ–°çš„è¯­æ³•, ä¾‹å¦‚ es2017 ä¹‹åå¯ä»¥ä½¿ç”¨<code>async/await</code>, target è®¾ç½®ä¸º<code>es2017</code>ç¼–è¯‘æ—¶<code>tsc</code>å°±ä¸ä¼šå¯¹è¯¥è¯­æ³•åš polyfill, è®¾ç½®ä¸º<code>es2015</code>å°±ä¼šè¿›è¡Œ polyfill</p><h2 id="ä¸åŒ-target-ç¼–è¯‘å‡ºçš„ä»£ç "><a class="markdownIt-Anchor" href="#ä¸åŒ-target-ç¼–è¯‘å‡ºçš„ä»£ç "></a> ä¸åŒ target ç¼–è¯‘å‡ºçš„ä»£ç </h2><p>å¯ä»¥çœ‹åˆ°å½“è®¾ç½® es2015 æ—¶ä¼šå¯¹<code>async/await</code>åš polyfill</p><h3 id="es2017"><a class="markdownIt-Anchor" href="#es2017"></a> <strong>es2017</strong></h3><p><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220524-exp5.png" alt="" /></p><h3 id="es2015"><a class="markdownIt-Anchor" href="#es2015"></a> <strong>es2015</strong></h3><p><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220524-exp6.png" alt="" /></p><h1 id="lib"><a class="markdownIt-Anchor" href="#lib"></a> lib</h1><p>å®šä¹‰æ”¯æŒçš„<strong>ç±»å‹å£°æ˜</strong>, å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å’Œ target ä¸€è‡´, é™¤äº†ä¸€äº›ç‰¹æ®Šåœºæ™¯, æ¯”å¦‚: 1. target è®¾ç½®äº† es5 ä½†æ˜¯å­˜åœ¨å¯¹ Promise çš„ polyfill å¤„ç† 2. è¿è¡Œåœ¨æµè§ˆå™¨ä¸­éœ€è¦ BOM/DOM å¯¹è±¡ç±»å‹å£°æ˜, å¯ä»¥è®¾ç½®æ•°ç»„</p><h1 id="ts-or-babel"><a class="markdownIt-Anchor" href="#ts-or-babel"></a> ts or babel</h1><p>å¦å¤– typescript æ˜¯å¯ä»¥ç›´æ¥ä»£ç ç¼–è¯‘ä¸º es5 çš„, ä½†æ˜¯ç›®å‰ä¸šç•Œå‰ç«¯æ‰“åŒ…æ–¹æ¡ˆè¿˜æ˜¯æ„¿æ„å°† babel å’Œ typescript ç»“åˆä½¿ç”¨, åæ­£æ˜¯æœ‰å¥½å¤„=ã€‚=</p><blockquote><p>babel å’Œ ts éƒ½ä¼šè½¬æ¢è¯­æ³•ï¼Œä¸¤è€…æ˜¯å†²çªçš„ï¼Œä¸€èˆ¬ä¸ä¼šåŒæ—¶å‡ºç°ã€‚ç„¶å Promise æ˜¯ apiï¼ŒSymbol æ˜¯å†…ç½®ç±»å‹ï¼Œapi å¯ä»¥é€šè¿‡ polyfill åœ¨ä¸æ”¯æŒçš„ç¯å¢ƒä¸Šè·å¾—æ”¯æŒï¼Œä½†ç±»å‹ä¸æ”¯æŒå°±æ˜¯ä¸æ”¯æŒï¼Œæ²¡æœ‰ polyfillã€‚è€Œä¸”ç°ä»£æµè§ˆå™¨åŸºæœ¬éƒ½æ”¯æŒ promise å’Œ symbolï¼Œæ²¡ä»€ä¹ˆå¥½æ‹…å¿§çš„</p></blockquote><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://medium.com/@tommedema/typescript-confusion-tsconfig-json-module-moduleresolution-target-lib-explained-65db2c44b491#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6ImIxYTgyNTllYjA3NjYwZWYyMzc4MWM4NWI3ODQ5YmZhMGExYzgwNmMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2NTI2MTEyMzgsImF1ZCI6IjIxNjI5NjAzNTgzNC1rMWs2cWUwNjBzMnRwMmEyamFtNGxqZGNtczAwc3R0Zy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjExMTAxMjUzOTgwMTUwNjQxNDg5MCIsImVtYWlsIjoiaGVhbG1zbGluQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhenAiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJuYW1lIjoibGluIExpbiIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS0vQU9oMTRHaVVuUWdGYkZTV1FLdUo3NG1LazNTeXpTUFVoa3h6Q0lPWUc1X3E9czk2LWMiLCJnaXZlbl9uYW1lIjoibGluIiwiZmFtaWx5X25hbWUiOiJMaW4iLCJpYXQiOjE2NTI2MTE1MzgsImV4cCI6MTY1MjYxNTEzOCwianRpIjoiZDcyM2IyNjU0M2QzZmI1YTk1NmRjOGNiOTNjYjQyM2RhNDQ1ZGYzNiJ9.bDAxv4MZqbrpvHVDjD0xu-738zVDWW7HF0GHndJg5LmCOA47NuXvsB7uLKsvtvwm6262qHwhMyDWzem4lGKjHjJfu_fDLMrr73zZP6Zn2yI-apfM_-PgIyaUCd5uUXZTsZ7JrdTDs-UvyGUM3MSzVCSrmSEgGBHX6HFPpyemEAVkSu0L5Fch5-0XEoH4NgNaapuVPDzpdbSDqH-RCkMh76Y1qW9kmajJKUNL6VL6OpJpGJfrK01L9kifeD4JjKgGXtpKJoW0K2ICfec_mFDp9GfRrFq-0b2-WnfoBVc8PeQ25zfYRBTQcQWcB6eeJLDO0I1Nrk83Clc89ixWzkX-vg">Typescript confusion: tsconfig.json module, moduleResolution, target &amp; lib explained</a></li><li><a href="https://lq782655835.github.io/blogs/project/ts-tsconfig.html">Typescript tsconfig.json å…¨è§£æ</a></li><li><a href="https://www.typescriptlang.org/tsconfig#lib">Intro to the TSConfig Reference</a></li><li><a href="https://www.zhihu.com/question/322722786">ç”¨äº† typescript è¿˜éœ€è¦ babel æˆ–è€… polyfill å—ï¼Ÿ</a></li><li><a href="https://juejin.cn/post/6968636129239105549">ä¸ºä»€ä¹ˆè¯´ç”¨ babel ç¼–è¯‘ typescript æ˜¯æ›´å¥½çš„é€‰æ‹©</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¢æˆ·ç«¯è¯·æ±‚ç»è¿‡nginxè·å–è¯·æ±‚å¤´Host</title>
    <link href="/2022/05/15/2022-05-27-get-host-forward-nginx/"/>
    <url>/2022/05/15/2022-05-27-get-host-forward-nginx/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>ç›®å‰é¡¹ç›®éƒ¨ç½²æ­£å¼ç¯å¢ƒå‰ç«¯è¯·æ±‚ä¼šèµ° nginx, åå‘ä»£ç†åˆ°çœŸæ­£çš„åå°æœåŠ¡æœºå™¨. æœ€è¿‘åˆšå¼„å®Œ node çš„é‰´æƒä¸­é—´ä»¶, å…¶ä¸­é‡åˆ°è·å–è¯·æ±‚å¤´<code>host</code>ä¿¡æ¯æ˜¯<code>127.0.0.1:xxxx</code>æ— æ³•è·å–çœŸå®è¯·æ±‚ ip æˆ–åŸŸåçš„æƒ…å†µ, è§£å†³ååšä¸ªè®°å½•.</p><h1 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•"></a> è§£å†³æ–¹æ³•</h1><p>å…ˆè¯´è§£å†³æ–¹æ³•, å› ä¸º nginx é»˜è®¤æ˜¯ä¸ä¼šé€ä¼ å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¿¡æ¯çš„, æ‰€ä»¥éœ€è¦è‡ªå·±åœ¨ nginx çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸‹, æ‰¾åˆ°å¯¹åº”åŒ¹é…çš„ location, ä»¥ä¸‹æ˜¯å®ä¾‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /api/ &#123;<br>    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>    <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:10200/;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="è¡ç”Ÿæ“ä½œ"><a class="markdownIt-Anchor" href="#è¡ç”Ÿæ“ä½œ"></a> è¡ç”Ÿæ“ä½œ</h1><h2 id="å¦‚æœç”¨æˆ·è¯·æ±‚ç›´è¾¾æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„-ip-è¯¥æ€ä¹ˆåšå‘¢"><a class="markdownIt-Anchor" href="#å¦‚æœç”¨æˆ·è¯·æ±‚ç›´è¾¾æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„-ip-è¯¥æ€ä¹ˆåšå‘¢"></a> å¦‚æœç”¨æˆ·è¯·æ±‚ç›´è¾¾æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„ ip è¯¥æ€ä¹ˆåšå‘¢?</h2><p>æ˜å¤©è¯•ä¸€è¯•, to be continued;</p><h2 id="å¦‚æœé€šè¿‡-nginx-è½¬å‘çš„æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„-ip-è¯¥æ€ä¹ˆåšå‘¢"><a class="markdownIt-Anchor" href="#å¦‚æœé€šè¿‡-nginx-è½¬å‘çš„æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„-ip-è¯¥æ€ä¹ˆåšå‘¢"></a> å¦‚æœé€šè¿‡ nginx è½¬å‘çš„æœåŠ¡æƒ³è·å–ç”¨æˆ·çš„ ip è¯¥æ€ä¹ˆåšå‘¢?</h2><p>ç›®å‰ nginx ä»£ç†æœåŠ¡å™¨éƒ½æ”¯æŒè½¬å‘è¯·æ±‚å¤´<code>X-Real-IP</code>å’Œ<code>X-Forwarded-For</code>,</p><h1 id="å°æŠ€å·§"><a class="markdownIt-Anchor" href="#å°æŠ€å·§"></a> å°æŠ€å·§</h1><p>æˆ‘ä¸çŸ¥é“æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·æ­»æ´»è®°ä¸ä½ nginx.conf çš„è·¯å¾„ ğŸ¤¦ğŸ»â€â™€ï¸mac å’Œ linux ä¸Šçš„è·¯å¾„è¿˜ä¸ä¸€æ · ğŸ¤¦ğŸ»â€â™€ï¸ å¯ä»¥é€šè¿‡<code>nginx -V</code>æŸ¥çœ‹ nginx ç›¸å…³çš„æ–‡ä»¶è·¯å¾„, å…¶ä¸­æœ€å¸¸ç”¨çš„<code>--conf-path</code>å°±æ˜¯ nginx çš„é…ç½®æ–‡ä»¶, <code>--http-log-path</code>æ˜¯ nginx æ‰€æœ‰çš„æ—¥å¿—, <code>--error-log</code>æ˜¯ nginx çš„é”™è¯¯æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">// çœç•¥éƒ¨åˆ†ä¿¡æ¯<br>âœ  ~ nginx -V<br>nginx version: nginx/1.21.6<br>built by clang 13.0.0 (clang-1300.0.29.3)<br>built with OpenSSL 1.1.1m  14 Dec 2021<br>TLS SNI support enabled<br>configure arguments: --prefix=/usr/local/Cellar/nginx/1.21.6 --sbin-path=/usr/local/Cellar/nginx/1.21.6/bin/nginx --conf-path=/usr/local/etc/nginx/nginx.conf --http-log-path=/usr/local/var/log/nginx/access.log --error-log-path=/usr/local/var/log/nginx/error.log<br></code></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://imququ.com/post/x-forwarded-for-header-in-http.html">HTTP è¯·æ±‚å¤´ä¸­çš„ X-Forwarded-For</a></li><li><a href="https://blog.csdn.net/xixingzhe2/article/details/118582055">nginx ä»£ç†è·å– ip ä¸º 127.0.0.1 è§£å†³æ–¹æ³•</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lottie æ›¿æ¢æ–‡å­—</title>
    <link href="/2022/05/02/2022-05-02-mod-text-in-lottie/"/>
    <url>/2022/05/02/2022-05-02-mod-text-in-lottie/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>èƒŒæ™¯æ˜¯æœ‰ä¸ªéœ€æ±‚è¦åœ¨ä¸€ä¸ªä»»åŠ¡é¡µé¢åœ¨ç”¨æˆ·ä»»åŠ¡å®Œæˆåå±•ç¤ºä¸€ä¸ª lottie åŠ¨ç”»å¼¹çª—, äº§å“æ¥é…ç½®å¼¹çª—çš„æ–‡æ¡ˆã€‚é‚£å°±éœ€è¦åŠ¨æ€ä¿®æ”¹ lottie json æ–‡ä»¶ä¸­çš„æ–‡æ¡ˆäº†ã€‚</p><h1 id="æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#æ–¹æ¡ˆ"></a> æ–¹æ¡ˆ</h1><ol><li>å…ˆåŠ è½½ json æ–‡ä»¶, æ›¿æ¢ json ä¸­çš„æ–‡æ¡ˆ, ç„¶åå†ä½¿ç”¨<code>loadAnimation</code>åŠ è½½</li><li>ä½¿ç”¨åŸå§‹çš„ json æ–‡ä»¶<code>loadAnimation</code>åŠ è½½åˆ° DOM ä¸­å, æ‰¾åˆ°éœ€è¦æ›¿æ¢çš„æ–‡æ¡ˆæ‰€åœ¨çš„èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹</li><li>ä½¿ç”¨ lottie å®˜æ–¹æä¾›çš„<code>lottie-api</code>åº“ä¿®æ”¹ lottie çš„å±æ€§</li></ol><p>è¿™é‡Œä¸å¯¹å“ªç§æ–¹æ¡ˆæ›´å¥½åšè¯„ä»·, åªæ˜¯å‰ä¸¤ç§æœ‰æ‰‹å°±è¡Œ, è¿™é‡Œåªä»‹ç»ç¬¬ä¸‰ç§</p><h1 id="æ¥-è¯•è¯•çœ‹"><a class="markdownIt-Anchor" href="#æ¥-è¯•è¯•çœ‹"></a> æ¥, è¯•è¯•çœ‹</h1><p>å…¶å®<code>lottie</code>å®˜æ–¹æœ‰æåŠå¦‚ä½•æ›´æ–°æ–‡æœ¬æ•°æ®<a href="https://github.com/airbnb/lottie-web/wiki/TextLayer.updateDocumentData">æˆ³è¿™é‡Œ</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">anim.<span class="hljs-property">renderer</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">updateDocumentData</span>(&#123; <span class="hljs-attr">t</span>: <span class="hljs-string">&#x27;new text&#x27;</span>, <span class="hljs-attr">s</span>: <span class="hljs-number">20</span> &#125;, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ç¬”è€…ä½¿ç”¨<code>anim.renderer.elements[0]</code>å§‹ç»ˆæ— æ³•æ‰¾åˆ°å¯¹åº”çš„é‚£æ®µæ–‡æœ¬, å¥½åœ¨å®˜æ–¹æä¾›äº†(lottie-api)[<a href="https://github.com/bodymovin/lottie-api">https://github.com/bodymovin/lottie-api</a>]åº“çœå»äº†äººå·¥æŸ¥æ‰¾æ–‡æœ¬çš„è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">anim.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMLoaded&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> api = lottie_api.<span class="hljs-title function_">createAnimationApi</span>(anim);<br>  <span class="hljs-keyword">const</span> elements = api.<span class="hljs-title function_">getKeyPath</span>(<span class="hljs-string">&#x27;ä»»åŠ¡å®Œæˆå¼¹çª—æ ·å¼,åŠ¨æ•ˆ,å¡ç‰‡,å¡ç‰‡,ç§¯åˆ†å¥–åŠ±&#x27;</span>); <span class="hljs-comment">// æŸ¥æ‰¾å¯¹è±¡</span><br>  elements.<span class="hljs-title function_">getElements</span>()[<span class="hljs-number">0</span>].<span class="hljs-title function_">setText</span>(<span class="hljs-string">&#x27;ä½ ä¸æ‹¿æªæŒ‡ç€ä»–æ‹¿æªæŒ‡ç€æˆ‘?&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ€å…³é”®çš„å°±æ˜¯<code>getKeyPath</code>è¿™ä¸ª api, é€šè¿‡å›¾å±‚æ¥å®šä½åŒ…å«æ–‡æœ¬çš„å…ƒç´ , å‚æ•°å°±æ˜¯æ¯ä¸ªå›¾å±‚åæ‹¼æˆçš„å­—ç¬¦ä¸², è¿™é‡Œæˆ‘ä»¬å®šä½åˆ°è¿™ä¸ªæ–‡æœ¬å›¾å±‚, è¿›è¡Œ<code>setText</code>ä¿®æ”¹æ–‡æ¡ˆå³å¯ã€‚<br /><img src="https://raw.githubusercontent.com/Mariana-Yui/images/master/blog-imgs/20220503-blog.png" alt="" /></p><h1 id="éœ€è¦æ³¨æ„"><a class="markdownIt-Anchor" href="#éœ€è¦æ³¨æ„"></a> éœ€è¦æ³¨æ„</h1><p>å¦‚æœæ¶‰åŠä¿®æ”¹æ–‡æ¡ˆ, è®¾è®¡å¸ˆåœ¨ AE ä¸­å¯¼å‡º lottie æ—¶, <strong>ä¸è¦å‹¾é€‰</strong>è¿™ä¸ªé€‰é¡¹, è¿™ä¸ªé€‰é¡¹ä¼šå°†æ–‡æœ¬è½¬ä¸ºè·¯å¾„å³å¾ˆå¤šçº¿æ¡, è·¯å¾„æ˜¯æ— æ³•æ­£å¸¸æ›¿æ¢æ–‡æ¡ˆçš„, è¿™ä¸ªäº‹å…ˆéœ€è¦å’Œè®¾è®¡å¸ˆæ²Ÿé€šå¥½</p><p><img src="https://img-blog.csdnimg.cn/img_convert/13d8db436966923fbcc2e98da754947c.png" alt="" /></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><ol><li><a href="https://zhuanlan.zhihu.com/p/102334701">Aha Lottie|åŠ¨æ€ä¿®æ”¹ Lottie ä¸­çš„æ–‡æœ¬</a></li><li><a href="https://blog.csdn.net/weixin_39984201/article/details/111268504">lottie æ’ä»¶_Lottie åŠ¨æ•ˆè½åœ°è¸©å‘ï¼ˆç¬¬ä¸€å¼¹ï¼‰</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>lottie</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>koa-routeræºç è§£æ</title>
    <link href="/2021/11/16/2021-11-16-koa-router/"/>
    <url>/2021/11/16/2021-11-16-koa-router/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>ä¸Šç­æ‘¸é±¼äº‹ä»¶ç ”ç©¶ koa åŠå…¶å‘¨è¾¹ä¸­é—´ä»¶çš„ç¬¬ä¸€å¼¹ - <code>koa-router</code>, ä¸ªäººç†è§£éƒ½å†™åœ¨æ³¨é‡Šä¸­äº†, koa åŠ koa-xx æºç çªå‡ºä¸€ä¸ªçŸ­å°ç²¾æ‚, å¾ˆé€‚åˆè¿›é˜¶é˜…è¯»ã€‚</p><h1 id="æºç è§£è¯»"><a class="markdownIt-Anchor" href="#æºç è§£è¯»"></a> æºç è§£è¯»</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;koa-router&#x27;</span>); <span class="hljs-comment">// logger</span><br><span class="hljs-keyword">const</span> compose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-compose&#x27;</span>); <span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶åˆ—è¡¨</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">HttpError</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-errors&#x27;</span>); <span class="hljs-comment">// å°è£…çš„httpé”™è¯¯åº“</span><br><span class="hljs-keyword">const</span> methods = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;methods&#x27;</span>); <span class="hljs-comment">// è¿”å›http.METHODS</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Layer</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./layer&#x27;</span>);<br><span class="hljs-keyword">const</span> &#123; pathToRegexp &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path-to-regexp&#x27;</span>); <span class="hljs-comment">// å¯¹è·¯ç”±pathæ­£åˆ™è§£æ</span><br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Router</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Create a new router.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Basic usage:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const Koa = require(&#x27;koa&#x27;);</span><br><span class="hljs-comment"> * const Router = require(&#x27;<span class="hljs-doctag">@koa</span>/router&#x27;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * const app = new Koa();</span><br><span class="hljs-comment"> * const router = new Router();</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.get(&#x27;/&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *   // ctx.router available</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * app</span><br><span class="hljs-comment"> *   .use(router.routes())</span><br><span class="hljs-comment"> *   .use(router.allowedMethods());</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@alias</span> module:koa-router</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object=</span>&#125; <span class="hljs-variable">opts</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String=</span>&#125; opts.prefix prefix router paths</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@constructor</span></span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Router</span>(<span class="hljs-params">opts</span>) &#123;<br>  <span class="hljs-comment">// å¦‚æœæ²¡ç”¨newå®ä¾‹åˆ™è¿”å›newå®ä¾‹, å³åˆ›å»ºè·¯ç”±æ—¶å¯ä»¥ä½¿ç”¨new Router()æˆ–Router()</span><br>  <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Router</span>)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(opts);<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span> = opts || &#123;&#125;;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">methods</span> || [<span class="hljs-string">&#x27;HEAD&#x27;</span>, <span class="hljs-string">&#x27;OPTIONS&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;PUT&#x27;</span>, <span class="hljs-string">&#x27;PATCH&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;DELETE&#x27;</span>];<br>  <span class="hljs-comment">// å­˜å‚¨router.param()æŒ‡å®šçš„å‚æ•°, é”®ä¸ºå‚æ•°åç§°, å€¼ä¸ºä¸­é—´ä»¶</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span> = &#123;&#125;;<br>  <span class="hljs-comment">// æ¯æ¬¡router.verb()éƒ½ä¼šåˆ›å»ºä¸€ä¸ªlayer, å­˜å‚¨è¿™äº›layer</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span> = [];<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Create `router.verb()` methods, where *verb* is one of the HTTP verbs such</span><br><span class="hljs-comment"> * as `router.get()` or `router.post()`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Match URL patterns to callback functions or controller actions using `router.verb()`,</span><br><span class="hljs-comment"> * where **verb** is one of the HTTP verbs such as `router.get()` or `router.post()`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Additionaly, `router.all()` can be used to match against all methods.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router</span><br><span class="hljs-comment"> *   .get(&#x27;/&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     ctx.body = &#x27;Hello World!&#x27;;</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .post(&#x27;/users&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     // ...</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .put(&#x27;/users/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     // ...</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .del(&#x27;/users/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     // ...</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .all(&#x27;/users/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     // ...</span><br><span class="hljs-comment"> *   &#125;);</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * When a route is matched, its path is available at `ctx._matchedRoute` and if named,</span><br><span class="hljs-comment"> * the name is available at `ctx._matchedRouteName`</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Route paths will be translated to regular expressions using</span><br><span class="hljs-comment"> * [path-to-regexp](https://github.com/pillarjs/path-to-regexp).</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Query strings will not be considered when matching requests.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * #### Named routes</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Routes can optionally have names. This allows generation of URLs and easy</span><br><span class="hljs-comment"> * renaming of URLs during development.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.get(&#x27;user&#x27;, &#x27;/users/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *  // ...</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.url(&#x27;user&#x27;, 3);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/3&quot;</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * #### Multiple middleware</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Multiple middleware may be given:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.get(</span><br><span class="hljs-comment"> *   &#x27;/users/:id&#x27;,</span><br><span class="hljs-comment"> *   (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     return User.findOne(ctx.params.id).then(function(user) &#123;</span><br><span class="hljs-comment"> *       ctx.user = user;</span><br><span class="hljs-comment"> *       next();</span><br><span class="hljs-comment"> *     &#125;);</span><br><span class="hljs-comment"> *   &#125;,</span><br><span class="hljs-comment"> *   ctx =&gt; &#123;</span><br><span class="hljs-comment"> *     console.log(ctx.user);</span><br><span class="hljs-comment"> *     // =&gt; &#123; id: 17, name: &quot;Alex&quot; &#125;</span><br><span class="hljs-comment"> *   &#125;</span><br><span class="hljs-comment"> * );</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ### Nested routers</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Nesting routers is supported:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const forums = new Router();</span><br><span class="hljs-comment"> * const posts = new Router();</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * posts.get(&#x27;/&#x27;, (ctx, next) =&gt; &#123;...&#125;);</span><br><span class="hljs-comment"> * posts.get(&#x27;/:pid&#x27;, (ctx, next) =&gt; &#123;...&#125;);</span><br><span class="hljs-comment"> * forums.use(&#x27;/forums/:fid/posts&#x27;, posts.routes(), posts.allowedMethods());</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * // responds to &quot;/forums/123/posts&quot; and &quot;/forums/123/posts/123&quot;</span><br><span class="hljs-comment"> * app.use(forums.routes());</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * #### Router prefixes</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Route paths can be prefixed at the router level:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const router = new Router(&#123;</span><br><span class="hljs-comment"> *   prefix: &#x27;/users&#x27;</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.get(&#x27;/&#x27;, ...); // responds to &quot;/users&quot;</span><br><span class="hljs-comment"> * router.get(&#x27;/:id&#x27;, ...); // responds to &quot;/users/:id&quot;</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * #### URL parameters</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Named route parameters are captured and added to `ctx.params`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.get(&#x27;/:category/:title&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *   console.log(ctx.params);</span><br><span class="hljs-comment"> *   // =&gt; &#123; category: &#x27;programming&#x27;, title: &#x27;how-to-node&#x27; &#125;</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The [path-to-regexp](https://github.com/pillarjs/path-to-regexp) module is</span><br><span class="hljs-comment"> * used to convert paths to regular expressions.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@name</span> get|put|post|patch|delete|del</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@memberof</span> module:koa-router.prototype</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">path</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function=</span>&#125; middleware route middleware(s)</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function</span>&#125; callback route callback</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * methodsåº“å°±ä¸¤è¡Œä»£ç , è¯»å–http.METHODSè¿”å›å°å†™åˆ—è¡¨</span><br><span class="hljs-comment"> * éå†æ‰€æœ‰httpæ–¹æ³•, èµ‹å€¼å®ä¾‹æ–¹æ³•ä¾‹å¦‚router.get/router.postç­‰</span><br><span class="hljs-comment"> * å¹¶é€šè¿‡router.registeræ–¹æ³•å°†æ¯ä¸ªé€šè¿‡è¯¥å®ä¾‹æ–¹æ³•åˆ›å»ºçš„è·¯ç”±æ³¨å†ŒæˆLayer</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; methods.<span class="hljs-property">length</span>; i++) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">setMethodVerb</span>(<span class="hljs-params">method</span>) &#123;<br>    <span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[method] = <span class="hljs-keyword">function</span> (<span class="hljs-params">name, path, middleware</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path === <span class="hljs-string">&#x27;string&#x27;</span> || path <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) &#123;<br>        middleware = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">2</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        middleware = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">1</span>);<br>        path = name;<br>        name = <span class="hljs-literal">null</span>;<br>      &#125;<br><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>(path, [method], middleware, &#123;<br>        <span class="hljs-attr">name</span>: name<br>      &#125;);<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">setMethodVerb</span>(methods[i]);<br>&#125;<br><br><span class="hljs-comment">// Alias for `router.delete()` because delete is a reserved word</span><br><span class="hljs-comment">// è®¾ç½®router.deleteçš„åˆ«å</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">del</span> = <span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-string">&#x27;delete&#x27;</span>];<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Use given middleware.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Middleware run in the order they are defined by `.use()`. They are invoked</span><br><span class="hljs-comment"> * sequentially, requests start at the first middleware and work their way</span><br><span class="hljs-comment"> * &quot;down&quot; the middleware stack.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * // session middleware will run before authorize</span><br><span class="hljs-comment"> * router</span><br><span class="hljs-comment"> *   .use(session())</span><br><span class="hljs-comment"> *   .use(authorize());</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * // use middleware only with given path</span><br><span class="hljs-comment"> * router.use(&#x27;/users&#x27;, userAuth());</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * // or with an array of paths</span><br><span class="hljs-comment"> * router.use([&#x27;/users&#x27;, &#x27;/admin&#x27;], userAuth());</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * app.use(router.routes());</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String=</span>&#125; <span class="hljs-variable">path</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function</span>&#125; <span class="hljs-variable">middleware</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function=</span>&#125; ...</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">use</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> router = <span class="hljs-variable language_">this</span>;<br>  <span class="hljs-keyword">const</span> middleware = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);<br>  <span class="hljs-keyword">let</span> path;<br><br>  <span class="hljs-comment">// support array of paths</span><br>  <span class="hljs-comment">// å’Œrouter.registerç±»ä¼¼, useçš„pathå‚æ•°ä¹Ÿæ”¯æŒæ•°ç»„, å¦‚æœæ˜¯æ•°ç»„åˆ™åšä¸€å±‚é€’å½’, [p].concat(middleware.slice(1))å³path+middleware</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(middleware[<span class="hljs-number">0</span>]) &amp;&amp; <span class="hljs-keyword">typeof</span> middleware[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    <span class="hljs-keyword">let</span> arrPaths = middleware[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arrPaths.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> p = arrPaths[i];<br>      router.<span class="hljs-property">use</span>.<span class="hljs-title function_">apply</span>(router, [p].<span class="hljs-title function_">concat</span>(middleware.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)));<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// useå¯ä»¥è®¾ç½®å…¨å±€ä¸­é—´ä»¶, å¯ä»¥ä¸éœ€è¦path</span><br>  <span class="hljs-keyword">const</span> hasPath = <span class="hljs-keyword">typeof</span> middleware[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;string&#x27;</span>;<br>  <span class="hljs-comment">// å–å‡ºpath, æ­¤æ—¶middlewareå‚æ•°å°±æ˜¯ä¸­é—´ä»¶æ•°ç»„</span><br>  <span class="hljs-keyword">if</span> (hasPath) path = middleware.<span class="hljs-title function_">shift</span>();<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; middleware.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> m = middleware[i];<br>    <span class="hljs-comment">// routerè¿˜æ”¯æŒä¸€ç§åµŒå¥—è·¯ç”±ä¾‹å¦‚, router.use(&#x27;/user&#x27;, userRouter.routes())</span><br>    <span class="hljs-comment">// ä»routes()ä¸­å·²ç»çŸ¥é“äº†ä¼šå¯¹dispatchæ·»åŠ routerå±æ€§æŒ‡å‘è‡ªèº«this</span><br>    <span class="hljs-comment">// æ‰€ä»¥è¯¥åˆ†æ”¯ç”¨äºå¤„ç†åµŒå¥—è·¯ç”±, æ­¤æ—¶ç¬¬ä¸€ä¸ªå‚æ•°pathå¦‚æœå­˜åœ¨åˆ™ä¼šä½œä¸ºprefix</span><br>    <span class="hljs-keyword">if</span> (m.<span class="hljs-property">router</span>) &#123;<br>      <span class="hljs-comment">// å…‹éš†router</span><br>      <span class="hljs-keyword">const</span> cloneRouter = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>), m.<span class="hljs-property">router</span>, &#123;<br>        <span class="hljs-comment">// stackå³åµŒå¥—è·¯ç”±å«æœ‰çš„layer</span><br>        <span class="hljs-attr">stack</span>: m.<span class="hljs-property">router</span>.<span class="hljs-property">stack</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>)<br>      &#125;);<br><br>      <span class="hljs-comment">// å…‹éš†layer</span><br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; cloneRouter.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span>; j++) &#123;<br>        <span class="hljs-keyword">const</span> nestedLayer = cloneRouter.<span class="hljs-property">stack</span>[j];<br>        <span class="hljs-keyword">const</span> cloneLayer = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Layer</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>), nestedLayer);<br><br>        <span class="hljs-comment">// è®¾ç½®prefix</span><br>        <span class="hljs-keyword">if</span> (path) cloneLayer.<span class="hljs-title function_">setPrefix</span>(path);<br>        <span class="hljs-keyword">if</span> (router.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span>) cloneLayer.<span class="hljs-title function_">setPrefix</span>(router.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span>);<br>        <span class="hljs-comment">// å°†åµŒå¥—è·¯ç”±ä¸­å…‹éš†çš„ä¸­é—´ä»¶æŠ½ç¦»å‡ºæ¥, èµ‹å€¼ç»™è‡ªèº«è·¯ç”±</span><br>        router.<span class="hljs-property">stack</span>.<span class="hljs-title function_">push</span>(cloneLayer);<br>        cloneRouter.<span class="hljs-property">stack</span>[j] = cloneLayer;<br>      &#125;<br><br>      <span class="hljs-comment">// å¦‚æœè‡ªèº«è·¯ç”±å¯¹param()åšè¿‡è®¾ç½®, è¿™é‡Œä¹Ÿè¦å¯¹åµŒå¥—è·¯ç”±ä¸­æå–çš„ä¸­é—´ä»¶èµ‹å€¼</span><br>      <span class="hljs-keyword">if</span> (router.<span class="hljs-property">params</span>) &#123;<br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">setRouterParams</span>(<span class="hljs-params">paramArr</span>) &#123;<br>          <span class="hljs-keyword">const</span> routerParams = paramArr;<br>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; routerParams.<span class="hljs-property">length</span>; j++) &#123;<br>            <span class="hljs-keyword">const</span> key = routerParams[j];<br>            cloneRouter.<span class="hljs-title function_">param</span>(key, router.<span class="hljs-property">params</span>[key]);<br>          &#125;<br>        &#125;<br>        <span class="hljs-title function_">setRouterParams</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(router.<span class="hljs-property">params</span>));<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å•çº¯ä¸­é—´ä»¶, åˆ™å’Œrouter.verbä¸€æ ·registerä¸­é—´ä»¶</span><br>      <span class="hljs-keyword">const</span> keys = [];<br>      <span class="hljs-title function_">pathToRegexp</span>(router.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span> || <span class="hljs-string">&#x27;&#x27;</span>, keys);<br>      <span class="hljs-keyword">const</span> routerPrefixHasParam = router.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span> &amp;&amp; keys.<span class="hljs-property">length</span>;<br>      router.<span class="hljs-title function_">register</span>(path || <span class="hljs-string">&#x27;([^/]*)&#x27;</span>, [], m, &#123;<br>        <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">ignoreCaptures</span>: !hasPath &amp;&amp; !routerPrefixHasParam<br>      &#125;);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Set the path prefix for a Router instance that was already initialized.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.prefix(&#x27;/things/:thing_id&#x27;)</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">prefix</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// ç»™å·²åˆ›å»ºLayerç»Ÿä¸€è®¾ç½®è·¯ç”±å‰ç¼€</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">prefix</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">prefix</span>) &#123;<br>  prefix = prefix.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/$/</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span> = prefix;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> route = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>[i];<br>    route.<span class="hljs-title function_">setPrefix</span>(prefix);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Returns router middleware which dispatches a route matching the request.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Function</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// router.routes()å®šä¹‰dispatchå‡½æ•°ç”¨äºæ‰§è¡Œä¸­é—´ä»¶, è¿”å›dispatchå‡½æ•°</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">routes</span> = <span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">middleware</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> router = <span class="hljs-variable language_">this</span>;<br><br>  <span class="hljs-keyword">let</span> dispatch = <span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-params">ctx, next</span>) &#123;<br>    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;%s %s&#x27;</span>, ctx.<span class="hljs-property">method</span>, ctx.<span class="hljs-property">path</span>);<br>    <span class="hljs-comment">// è§£æè¯·æ±‚ä¸Šä¸‹æ–‡çš„pathå’Œmethod</span><br>    <span class="hljs-keyword">const</span> path = router.<span class="hljs-property">opts</span>.<span class="hljs-property">routerPath</span> || ctx.<span class="hljs-property">routerPath</span> || ctx.<span class="hljs-property">path</span>;<br>    <span class="hljs-comment">// è¿”å›åŒ¹é…çš„layer</span><br>    <span class="hljs-keyword">const</span> matched = router.<span class="hljs-title function_">match</span>(path, ctx.<span class="hljs-property">method</span>);<br>    <span class="hljs-keyword">let</span> layerChain;<br><br>    <span class="hljs-comment">// æ‰¾äº†koaå’Œkoa-routerçš„ctx.matched, è²Œä¼¼ä¸ä¼šè¿›å…¥ifåˆ†æ”¯</span><br>    <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">matched</span>) &#123;<br>      ctx.<span class="hljs-property">matched</span>.<span class="hljs-property">push</span>.<span class="hljs-title function_">apply</span>(ctx.<span class="hljs-property">matched</span>, matched.<span class="hljs-property">path</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å°†åŒ¹é…åˆ°çš„layerèµ‹å€¼ç»™ä¸Šä¸‹æ–‡</span><br>      ctx.<span class="hljs-property">matched</span> = matched.<span class="hljs-property">path</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// å°†koa-routerå®ä¾‹èµ‹å€¼ä¸Šä¸‹æ–‡</span><br>    ctx.<span class="hljs-property">router</span> = router;<br><br>    <span class="hljs-comment">// åŒ¹é…åˆ°çš„methodsåˆ—è¡¨ä¸ºç©ºçš„è¯ç›´æ¥next()</span><br>    <span class="hljs-keyword">if</span> (!matched.<span class="hljs-property">route</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();<br><br>    <span class="hljs-comment">// åŒ¹é…pathå’Œmethodçš„layeråˆ—è¡¨</span><br>    <span class="hljs-keyword">const</span> matchedLayers = matched.<span class="hljs-property">pathAndMethod</span>;<br>    <span class="hljs-keyword">const</span> mostSpecificLayer = matchedLayers[matchedLayers.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>    <span class="hljs-comment">// å»æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸ºctx._matchedRoute</span><br>    ctx.<span class="hljs-property">_matchedRoute</span> = mostSpecificLayer.<span class="hljs-property">path</span>;<br>    <span class="hljs-keyword">if</span> (mostSpecificLayer.<span class="hljs-property">name</span>) &#123;<br>      ctx.<span class="hljs-property">_matchedRouteName</span> = mostSpecificLayer.<span class="hljs-property">name</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™é‡Œé€šè¿‡reduceåšäº†ä¸¤ä»¶äº‹</span><br><span class="hljs-comment">     * 1. å°†æ‰€æœ‰layerçš„ä¸­é—´ä»¶å³layer.stackæ•´åˆåˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­</span><br><span class="hljs-comment">     * 2. åœ¨å¤„ç†æ¯ä¸ªlayerçš„ä¸­é—´ä»¶å‰pushä¸€ä¸ªåˆå§‹åŒ–å½“å‰ctxä¸Šä¸‹æ–‡çš„ä¸­é—´ä»¶, é¿å…ä¸åŒlayerä¹‹é—´ç›¸äº’å½±å“</span><br><span class="hljs-comment">     * layer.captures(path)è°ƒç”¨path.match(this.regexp)åŒ¹é…ctx.pathä¸­çš„params</span><br><span class="hljs-comment">     * layer.params()ä¼šdecode paramsçš„å€¼å¹¶å¤åˆ¶ç»™ctx.params</span><br><span class="hljs-comment">     */</span><br>    layerChain = matchedLayers.<span class="hljs-title function_">reduce</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">memo, layer</span>) &#123;<br>      memo.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">ctx, next</span>) &#123;<br>        ctx.<span class="hljs-property">captures</span> = layer.<span class="hljs-title function_">captures</span>(path, ctx.<span class="hljs-property">captures</span>);<br>        ctx.<span class="hljs-property">params</span> = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">params</span> = layer.<span class="hljs-title function_">params</span>(path, ctx.<span class="hljs-property">captures</span>, ctx.<span class="hljs-property">params</span>);<br>        ctx.<span class="hljs-property">routerPath</span> = layer.<span class="hljs-property">path</span>;<br>        ctx.<span class="hljs-property">routerName</span> = layer.<span class="hljs-property">name</span>;<br>        ctx.<span class="hljs-property">_matchedRoute</span> = layer.<span class="hljs-property">path</span>;<br>        <span class="hljs-keyword">if</span> (layer.<span class="hljs-property">name</span>) &#123;<br>          ctx.<span class="hljs-property">_matchedRouteName</span> = layer.<span class="hljs-property">name</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();<br>      &#125;);<br>      <span class="hljs-keyword">return</span> memo.<span class="hljs-title function_">concat</span>(layer.<span class="hljs-property">stack</span>);<br>    &#125;, []);<br><br>    <span class="hljs-comment">// koa-composeæ‰§è¡Œä¸­é—´ä»¶</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">compose</span>(layerChain)(ctx, next);<br>  &#125;;<br><br>  dispatch.<span class="hljs-property">router</span> = <span class="hljs-variable language_">this</span>;<br><br>  <span class="hljs-keyword">return</span> dispatch;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Returns separate middleware for responding to `OPTIONS` requests with</span><br><span class="hljs-comment"> * an `Allow` header containing the allowed methods, as well as responding</span><br><span class="hljs-comment"> * with `405 Method Not Allowed` and `501 Not Implemented` as appropriate.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const Koa = require(&#x27;koa&#x27;);</span><br><span class="hljs-comment"> * const Router = require(&#x27;<span class="hljs-doctag">@koa</span>/router&#x27;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * const app = new Koa();</span><br><span class="hljs-comment"> * const router = new Router();</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * app.use(router.routes());</span><br><span class="hljs-comment"> * app.use(router.allowedMethods());</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * **Example with [Boom](https://github.com/hapijs/boom)**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const Koa = require(&#x27;koa&#x27;);</span><br><span class="hljs-comment"> * const Router = require(&#x27;<span class="hljs-doctag">@koa</span>/router&#x27;);</span><br><span class="hljs-comment"> * const Boom = require(&#x27;boom&#x27;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * const app = new Koa();</span><br><span class="hljs-comment"> * const router = new Router();</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * app.use(router.routes());</span><br><span class="hljs-comment"> * app.use(router.allowedMethods(&#123;</span><br><span class="hljs-comment"> *   throw: true,</span><br><span class="hljs-comment"> *   notImplemented: () =&gt; new Boom.notImplemented(),</span><br><span class="hljs-comment"> *   methodNotAllowed: () =&gt; new Boom.methodNotAllowed()</span><br><span class="hljs-comment"> * &#125;));</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object=</span>&#125; <span class="hljs-variable">options</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Boolean=</span>&#125; options.throw throw error instead of setting status and header</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function=</span>&#125; options.notImplemented throw the returned value in place of the default NotImplemented error</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function=</span>&#125; options.methodNotAllowed throw the returned value in place of the default MethodNotAllowed error</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Function</span>&#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">allowedMethods</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) &#123;<br>  options = options || &#123;&#125;;<br>  <span class="hljs-keyword">const</span> implemented = <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span>;<br><br>  <span class="hljs-comment">// koa-composeå¯¹next()çš„è¿”å›æ˜¯Promiseçš„å½¢å¼, allowedMethodsåˆ™æ˜¯ç”¨äºå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">allowedMethods</span>(<span class="hljs-params">ctx, next</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> allowed = &#123;&#125;;<br><br>      <span class="hljs-comment">// è¿™é‡Œå¯ä»¥çœ‹å‡ºè¯¥æ–¹æ³•åªé’ˆå¯¹statusä¸ºç©ºæˆ–404çš„æƒ…å†µ</span><br>      <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">status</span> || ctx.<span class="hljs-property">status</span> === <span class="hljs-number">404</span>) &#123;<br>        <span class="hljs-comment">// éå†åŒ¹é…çš„æ‰€æœ‰layer, è¯»å–æ‰€æœ‰method</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; ctx.<span class="hljs-property">matched</span>.<span class="hljs-property">length</span>; i++) &#123;<br>          <span class="hljs-keyword">const</span> route = ctx.<span class="hljs-property">matched</span>[i];<br>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; route.<span class="hljs-property">methods</span>.<span class="hljs-property">length</span>; j++) &#123;<br>            <span class="hljs-keyword">const</span> method = route.<span class="hljs-property">methods</span>[j];<br>            allowed[method] = method;<br>          &#125;<br>        &#125;<br>        <span class="hljs-comment">// æ‰€æœ‰å…è®¸çš„è¯·æ±‚method</span><br>        <span class="hljs-keyword">const</span> allowedArr = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(allowed);<br><br>        <span class="hljs-comment">// å¦‚æœè¯·æ±‚æ–¹æ³•ä¸è¢«å…è®¸, this.methodsä¸ºåˆå§‹åŒ–Routeræ—¶è®¾ç½®çš„å…è®¸æ–¹æ³•åˆ—è¡¨</span><br>        <span class="hljs-keyword">if</span> (!~implemented.<span class="hljs-title function_">indexOf</span>(ctx.<span class="hljs-property">method</span>)) &#123;<br>          <span class="hljs-comment">// æ˜¯å¦éœ€è¦æŠ›å‡ºé”™è¯¯, ä»¥åŠæ˜¯å¦è‡ªå®šä¹‰é”™è¯¯</span><br>          <span class="hljs-keyword">if</span> (options.<span class="hljs-property">throw</span>) &#123;<br>            <span class="hljs-keyword">let</span> notImplementedThrowable =<br>              <span class="hljs-keyword">typeof</span> options.<span class="hljs-property">notImplemented</span> === <span class="hljs-string">&#x27;function&#x27;</span><br>                ? options.<span class="hljs-title function_">notImplemented</span>() <span class="hljs-comment">// set whatever the user returns from their function</span><br>                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>.<span class="hljs-title class_">NotImplemented</span>();<br><br>            <span class="hljs-keyword">throw</span> notImplementedThrowable;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// è®¾ç½®501 not implemented çŠ¶æ€ç å’Œå“åº”å¤´</span><br>            ctx.<span class="hljs-property">status</span> = <span class="hljs-number">501</span>;<br>            ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Allow&#x27;</span>, allowedArr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>));<br>          &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (allowedArr.<span class="hljs-property">length</span>) &#123;<br>          <span class="hljs-comment">// èµ°åˆ°è¿™ä¸€æ­¥è¡¨ç¤ºè¯·æ±‚æ–¹æ³•æ˜¯è¢«å…è®¸çš„, ä½†æ˜¯å¯èƒ½æ˜¯OPTIONSé¢„è¯·æ±‚, å¾€å¾€ä¸ä¼šå¯¹é¢„è¯·æ±‚åšå¤„ç†</span><br>          <span class="hljs-comment">// è¿™é‡Œç›´æ¥æ­£å¸¸è¿”å›</span><br>          <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">method</span> === <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) &#123;<br>            ctx.<span class="hljs-property">status</span> = <span class="hljs-number">200</span>;<br>            ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>            ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Allow&#x27;</span>, allowedArr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>));<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!allowed[ctx.<span class="hljs-property">method</span>]) &#123;<br>            <span class="hljs-comment">// èµ°åˆ°è¿™é‡Œè¡¨ç¤º, è¯·æ±‚æ˜¯è¢«å…è®¸çš„ä½†æ˜¯æ²¡æœ‰ç›¸åº”çš„layerå¤„ç†è¿™ä¸ªè·¯ç”±, ç±»ä¼¼çš„</span><br>            <span class="hljs-comment">// å¦‚æœæœ‰è‡ªå®šä¹‰é”™è¯¯åˆ™æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-keyword">if</span> (options.<span class="hljs-property">throw</span>) &#123;<br>              <span class="hljs-keyword">let</span> notAllowedThrowable =<br>                <span class="hljs-keyword">typeof</span> options.<span class="hljs-property">methodNotAllowed</span> === <span class="hljs-string">&#x27;function&#x27;</span><br>                  ? options.<span class="hljs-title function_">methodNotAllowed</span>() <span class="hljs-comment">// set whatever the user returns from their function</span><br>                  : <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>.<span class="hljs-title class_">MethodNotAllowed</span>();<br><br>              <span class="hljs-keyword">throw</span> notAllowedThrowable;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-comment">// å¦åˆ™æŠ›å‡º405 method not allowçŠ¶æ€ç å¹¶è®¾ç½®å“åº”å¤´</span><br>              ctx.<span class="hljs-property">status</span> = <span class="hljs-number">405</span>;<br>              ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Allow&#x27;</span>, allowedArr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>));<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;);<br>  &#125;;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Register route with all methods.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; name Optional.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">path</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function=</span>&#125; middleware You may also pass multiple middleware.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function</span>&#125; <span class="hljs-variable">callback</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@private</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// å’Œrouter.verbä¸€æ ·, åªä¸è¿‡ç¬¬äºŒä¸ªå‚æ•°ä¸å†æ˜¯å•ä¸ªverb,è€Œæ˜¯æ‰€æœ‰http.METHODS</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">all</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">name, path, middleware</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path === <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    middleware = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">2</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    middleware = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">1</span>);<br>    path = name;<br>    name = <span class="hljs-literal">null</span>;<br>  &#125;<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>(path, methods, middleware, &#123; name &#125;);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Redirect `source` to `destination` URL with optional 30x status `code`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Both `source` and `destination` can be route names.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.redirect(&#x27;/login&#x27;, &#x27;sign-in&#x27;);</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * This is equivalent to:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.all(&#x27;/login&#x27;, ctx =&gt; &#123;</span><br><span class="hljs-comment"> *   ctx.redirect(&#x27;/sign-in&#x27;);</span><br><span class="hljs-comment"> *   ctx.status = 301;</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; source URL or route name.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; destination URL or route name.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Number=</span>&#125; code HTTP status code (default: 301).</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">redirect</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">source, destination, code</span>) &#123;<br>  <span class="hljs-comment">// lookup source route by name</span><br>  <span class="hljs-keyword">if</span> (source[<span class="hljs-number">0</span>] !== <span class="hljs-string">&#x27;/&#x27;</span>) source = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">url</span>(source);<br><br>  <span class="hljs-comment">// lookup destination route by name</span><br>  <span class="hljs-keyword">if</span> (destination[<span class="hljs-number">0</span>] !== <span class="hljs-string">&#x27;/&#x27;</span> &amp;&amp; !destination.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;://&#x27;</span>)) destination = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">url</span>(destination);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">all</span>(source, <span class="hljs-function">(<span class="hljs-params">ctx</span>) =&gt;</span> &#123;<br>    ctx.<span class="hljs-title function_">redirect</span>(destination);<br>    ctx.<span class="hljs-property">status</span> = code || <span class="hljs-number">301</span>;<br>  &#125;);<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Create and register a route.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; path Path string.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Array.&lt;String&gt;</span>&#125; methods Array of HTTP verbs.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function</span>&#125; middleware Multiple middleware also accepted.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Layer</span>&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@private</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// è¿™é‡Œçš„methodså’Œmiddlewareéƒ½æ˜¯æ•°ç»„</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">register</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">path, methods, middleware, opts</span>) &#123;<br>  opts = opts || &#123;&#125;;<br><br>  <span class="hljs-keyword">const</span> router = <span class="hljs-variable language_">this</span>;<br>  <span class="hljs-keyword">const</span> stack = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>;<br><br>  <span class="hljs-comment">// support array of paths</span><br>  <span class="hljs-comment">// å› ä¸ºregisterçš„pathä¹Ÿæ”¯æŒæ•°ç»„, æ‰€ä»¥è¿™é‡Œåšä¸€ä¸ªé€’å½’</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(path)) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; path.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> curPath = path[i];<br>      router.<span class="hljs-property">register</span>.<span class="hljs-title function_">call</span>(router, curPath, methods, middleware, opts);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// create route</span><br>  <span class="hljs-comment">// åˆ›å»ºè·¯ç”±, æœ€åä¸€ä¸ªå‚æ•°ç”¨ä½œpath-to-regexpåº“çš„è§£æé…ç½®</span><br>  <span class="hljs-keyword">const</span> route = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Layer</span>(path, methods, middleware, &#123;<br>    <span class="hljs-attr">end</span>: opts.<span class="hljs-property">end</span> === <span class="hljs-literal">false</span> ? opts.<span class="hljs-property">end</span> : <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">name</span>: opts.<span class="hljs-property">name</span>,<br>    <span class="hljs-attr">sensitive</span>: opts.<span class="hljs-property">sensitive</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">sensitive</span> || <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">strict</span>: opts.<span class="hljs-property">strict</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">strict</span> || <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">prefix</span>: opts.<span class="hljs-property">prefix</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span> || <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">ignoreCaptures</span>: opts.<span class="hljs-property">ignoreCaptures</span><br>  &#125;);<br><br>  <span class="hljs-comment">// è®¾ç½®å‰ç¼€</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span>) &#123;<br>    route.<span class="hljs-title function_">setPrefix</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-property">prefix</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// add parameter middleware</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è¿™æ®µä»£ç è€äººå¯»å‘³, é¦–å…ˆrouter.param()çš„æœºåˆ¶æ˜¯ä¸ºå‚æ•°è®¾ç½®çš„ä¸­é—´ä»¶ä¼šåœ¨æ‰€æœ‰ç›¸å…³ä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œ</span><br><span class="hljs-comment">   * æ‰€ä»¥ä¼šåœ¨æ¯åˆ›å»ºä¸€ä¸ªlayeréƒ½ä¼šéå†å­˜å‚¨router.paramså¦‚æœæœ‰åŒ¹é…çš„ä¸­é—´ä»¶, åˆ™æŠŠä¸­é—´ä»¶åŠ åˆ°layerçš„ä¸­é—´ä»¶åˆ—è¡¨çš„æœ€å‰é¢</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>).<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> param = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>)[i];<br>    route.<span class="hljs-title function_">param</span>(param, <span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>[param]);<br>  &#125;<br><br>  <span class="hljs-comment">// å­˜å‚¨layer</span><br>  stack.<span class="hljs-title function_">push</span>(route);<br><br>  <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;defined route %s %s&#x27;</span>, route.<span class="hljs-property">methods</span>, route.<span class="hljs-property">path</span>);<br><br>  <span class="hljs-keyword">return</span> route;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Lookup route with given `name`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">name</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Layer|false</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// è¿”å›layer.nameå’Œå‚æ•°åŒ¹é…çš„ç¬¬ä¸€ä¸ªlayer</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">route</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-keyword">const</span> routes = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> len = routes.<span class="hljs-property">length</span>, i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>    <span class="hljs-keyword">if</span> (routes[i].<span class="hljs-property">name</span> &amp;&amp; routes[i].<span class="hljs-property">name</span> === name) <span class="hljs-keyword">return</span> routes[i];<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Generate URL for route. Takes a route name and map of named `params`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router.get(&#x27;user&#x27;, &#x27;/users/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *   // ...</span><br><span class="hljs-comment"> * &#125;);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.url(&#x27;user&#x27;, 3);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/3&quot;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.url(&#x27;user&#x27;, &#123; id: 3 &#125;);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/3&quot;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.use((ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *   // redirect to named route</span><br><span class="hljs-comment"> *   ctx.redirect(ctx.router.url(&#x27;sign-in&#x27;));</span><br><span class="hljs-comment"> * &#125;)</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.url(&#x27;user&#x27;, &#123; id: 3 &#125;, &#123; query: &#123; limit: 1 &#125; &#125;);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/3?limit=1&quot;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * router.url(&#x27;user&#x27;, &#123; id: 3 &#125;, &#123; query: &quot;limit=1&quot; &#125;);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/3?limit=1&quot;</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; name route name</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object</span>&#125; params url parameters</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object</span>&#125; [options] options parameter</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object|String</span>&#125; [options.query] query options</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">String|Error</span>&#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">url</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">name, params</span>) &#123;<br>  <span class="hljs-keyword">const</span> route = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">route</span>(name);<br><br>  <span class="hljs-keyword">if</span> (route) &#123;<br>    <span class="hljs-keyword">const</span> args = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> route.<span class="hljs-property">url</span>.<span class="hljs-title function_">apply</span>(route, args);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`No route found for name: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Match given `path` and return corresponding routes.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">path</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">method</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Object.&lt;path, pathAndMethod&gt;</span>&#125; returns layers that matched path and</span><br><span class="hljs-comment"> * path and method.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@private</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// matched.path ä¸ºåŒ¹é…åˆ°pathçš„layer</span><br><span class="hljs-comment">// matched.pathAndMethodä¸ºåŒ¹é…åˆ°pathå’Œmethodçš„layer</span><br><span class="hljs-comment">// matched.routeä¸ºæ˜¯å¦åŒ¹é…ä¸Šçš„method</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">match</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">path, method</span>) &#123;<br>  <span class="hljs-keyword">const</span> layers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>;<br>  <span class="hljs-keyword">let</span> layer;<br>  <span class="hljs-keyword">const</span> matched = &#123;<br>    <span class="hljs-attr">path</span>: [],<br>    <span class="hljs-attr">pathAndMethod</span>: [],<br>    <span class="hljs-attr">route</span>: <span class="hljs-literal">false</span><br>  &#125;;<br><br>  <span class="hljs-comment">// éå†layerè¿”å›å’Œå½“å‰è¯·æ±‚è·¯ç”±åŒ¹é…çš„layer</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> len = layers.<span class="hljs-property">length</span>, i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>    layer = layers[i];<br><br>    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;test %s %s&#x27;</span>, layer.<span class="hljs-property">path</span>, layer.<span class="hljs-property">regexp</span>);<br><br>    <span class="hljs-comment">// layer.matchè°ƒç”¨layer.regexp.test(path), åŒ¹é…è·¯å¾„</span><br>    <span class="hljs-keyword">if</span> (layer.<span class="hljs-title function_">match</span>(path)) &#123;<br>      matched.<span class="hljs-property">path</span>.<span class="hljs-title function_">push</span>(layer);<br>      <span class="hljs-comment">// åŒ¹é…æ–¹æ³•, å¦‚æœmethodsé•¿åº¦ä¸º0æˆ–æœ‰åŒ¹é…åˆ°çš„æ–¹æ³•, ~æ“ä½œç¬¦æ˜¯æŒ‰ä½é</span><br>      <span class="hljs-keyword">if</span> (layer.<span class="hljs-property">methods</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span> || ~layer.<span class="hljs-property">methods</span>.<span class="hljs-title function_">indexOf</span>(method)) &#123;<br>        matched.<span class="hljs-property">pathAndMethod</span>.<span class="hljs-title function_">push</span>(layer);<br>        <span class="hljs-keyword">if</span> (layer.<span class="hljs-property">methods</span>.<span class="hljs-property">length</span>) matched.<span class="hljs-property">route</span> = <span class="hljs-literal">true</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> matched;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Run middleware for named route parameters. Useful for auto-loading or</span><br><span class="hljs-comment"> * validation.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * router</span><br><span class="hljs-comment"> *   .param(&#x27;user&#x27;, (id, ctx, next) =&gt; &#123;</span><br><span class="hljs-comment"> *     ctx.user = users[id];</span><br><span class="hljs-comment"> *     if (!ctx.user) return ctx.status = 404;</span><br><span class="hljs-comment"> *     return next();</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .get(&#x27;/users/:user&#x27;, ctx =&gt; &#123;</span><br><span class="hljs-comment"> *     ctx.body = ctx.user;</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   .get(&#x27;/users/:user/friends&#x27;, ctx =&gt; &#123;</span><br><span class="hljs-comment"> *     return ctx.user.getFriends().then(function(friends) &#123;</span><br><span class="hljs-comment"> *       ctx.body = friends;</span><br><span class="hljs-comment"> *     &#125;);</span><br><span class="hljs-comment"> *   &#125;)</span><br><span class="hljs-comment"> *   // /users/3 =&gt; &#123;&quot;id&quot;: 3, &quot;name&quot;: &quot;Alex&quot;&#125;</span><br><span class="hljs-comment"> *   // /users/3/friends =&gt; [&#123;&quot;id&quot;: 4, &quot;name&quot;: &quot;TJ&quot;&#125;]</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; <span class="hljs-variable">param</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Function</span>&#125; <span class="hljs-variable">middleware</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Router</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// å’Œregisteræ–°å»ºlayerçš„é€»è¾‘ç±»ä¼¼, registeræ˜¯æ–°å»ºlayer, éå†router.params, æŠŠparamsåŒ¹é…åˆ°çš„ä¸­é—´ä»¶æ’åˆ°layer.stackæœ€å‰é¢</span><br><span class="hljs-comment">// paramåˆ™æ˜¯éå†layer, ç„¶åæŠŠparamè®¾ç½®çš„ä¸­é—´ä»¶æ’åˆ°layer.stackæœ€å‰é¢(pathå¤šä¸ªå‚æ•°æƒ…å†µä¸‹å¯èƒ½ä¸æ˜¯æœ€å‰é¢, è¿™é‡Œå…ˆè¿™æ ·å½¢å®¹)</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">param</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">param, middleware</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>[param] = middleware;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> route = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>[i];<br>    route.<span class="hljs-title function_">param</span>(param, middleware);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Generate URL from url pattern and given `params`.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span></span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ```javascript</span><br><span class="hljs-comment"> * const url = Router.url(&#x27;/users/:id&#x27;, &#123;id: 1&#125;);</span><br><span class="hljs-comment"> * // =&gt; &quot;/users/1&quot;</span><br><span class="hljs-comment"> * ```</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">String</span>&#125; path url pattern</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Object</span>&#125; params url parameters</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">String</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// è°ƒç”¨layerçš„å®ä¾‹æ–¹æ³•, å¡«å……å‚æ•°, æ³¨æ„åˆ°ä¸€ç‚¹, è¿™é‡Œè°ƒç”¨çš„æ˜¯layerçš„å®ä¾‹æ–¹æ³•, å†…éƒ¨ä¼šå¼•ç”¨this.path, æ‰€ä»¥æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡&#123;path&#125;æ¥åˆ›å»ºä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">// å†…éƒ¨è°ƒç”¨äº†path-to-regexpçš„compile/toPathæ–¹æ³•æ¥å®ç°</span><br><span class="hljs-title class_">Router</span>.<span class="hljs-property">url</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) &#123;<br>  <span class="hljs-keyword">const</span> args = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Layer</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">url</span>.<span class="hljs-title function_">apply</span>(&#123; path &#125;, args);<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>canvaså®ç°åˆ®åˆ®å¡</title>
    <link href="/2021/06/30/2021-06-30-canvas-scratch-card/"/>
    <url>/2021/06/30/2021-06-30-canvas-scratch-card/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>çœ‹äº†ä¸€æ®µæ—¶é—´ canvas, é‡æ‹¾å½“åˆå­¦å‰ç«¯çš„é‚£ç§çƒ­æƒ…, ğŸ‘± å°±æ˜¯å–œæ¬¢æ•´ç‚¹èŠ±é‡Œèƒ¡å“¨çš„ã€‚æ­£å¥½åœ¨æ˜é‡‘ä¸Šçœ‹åˆ°ä¸å°‘ canvas å¥½æ–‡ç« ï¼Œç»“åˆç†è®ºè¿›è¡Œå®æˆ˜ï¼Œ è®°å½•ä¸€ä¸‹è¿‡ç¨‹ä¸­çš„çŸ¥è¯†ç‚¹ã€‚</p><h1 id="1-éœ€æ±‚åˆ†æ"><a class="markdownIt-Anchor" href="#1-éœ€æ±‚åˆ†æ"></a> 1 éœ€æ±‚åˆ†æ</h1><p>è®¾è®¡å¯é…ç½®é¡¹, è¿™é‡Œåˆ†ä¸ºäº§å“åŒå­¦çœ‹å¾—æ‡‚çš„é…ç½®é¡¹å’ŒæŠ€æœ¯ä¸Šçš„é…ç½®é¡¹<br />æ‰€æœ‰é…ç½®é¡¹åŒ…æ‹¬:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ScratchCardConfig</span> &#123;<br>  <span class="hljs-attr">canvas</span>: <span class="hljs-title class_">HTMLCanvasElement</span>; <span class="hljs-comment">// canvaså…ƒç´ </span><br>  showAllPercent?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// ç›´æ¥å…¨éƒ¨åˆ®å¼€ç™¾åˆ†æ¯”</span><br>  coverImg?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å›¾ç‰‡å›¾å±‚</span><br>  coverColor?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// çº¯è‰²å›¾å±‚</span><br>  doneCallback?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// å…¨éƒ¨åˆ®å¼€å›è°ƒå‡½æ•°</span><br>  radius?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">//æ“¦é™¤åŠå¾„</span><br>  <span class="hljs-attr">pixelRatio</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// å±å¹•å€ç‡, é€‚åº”retinaå±</span><br>  fadeOut?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// å…¨éƒ¨åˆ®å¼€æ·¡å‡ºæ•ˆæœæ—¶é—´(ms)</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2-é¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#2-é¡¹ç›®ç»“æ„"></a> 2 é¡¹ç›®ç»“æ„</h1><p>å› ä¸º canvas æœ‰å¾ˆå¤šæ–¹æ³•å’Œå±æ€§,js æ— æ³•æ­£ç¡®è¿›è¡Œä»£ç æç¤º, æ‰€ä»¥ä½¿ç”¨ ts è¿›è¡Œå¼€å‘</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">|- index.html<br>|- award.jpg  <span class="hljs-regexp">//</span> åº•éƒ¨ç»“æœå›¾ç‰‡<br>|- index.js<br>|- index.ts <span class="hljs-regexp">//</span> å®é™…ç¼–å†™çš„é€»è¾‘<br>|- scratch-<span class="hljs-number">2</span>x.png <span class="hljs-regexp">//</span> ä¸Šå±‚é®ç½©çš„å›¾ç‰‡<br></code></pre></td></tr></table></figure><h1 id="3-å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#3-å…·ä½“å®ç°"></a> 3 å…·ä½“å®ç°</h1><h2 id="é¡µé¢ç»“æ„"><a class="markdownIt-Anchor" href="#é¡µé¢ç»“æ„"></a> é¡µé¢ç»“æ„</h2><p>å‰ç½®çŸ¥è¯†: canva è®¾ç½® width/height æ”¹å˜çš„æ˜¯ç»˜å›¾åŒºåŸŸçš„å®½é«˜, è®¾ç½® style.width/height æ”¹å˜çš„æ˜¯å…ƒç´ çš„å®½é«˜, ç»˜å›¾åŒºåŸŸæ²¡æœ‰å‘ç”Ÿæ”¹å˜, ç»˜å›¾åŒºåŸŸä¼šæ ¹æ®å…ƒç´ å®½é«˜ç­‰æ¯”ä¾‹ç¼©æ”¾.<br />è€Œå¯¹äº retina å±å¹•(è¿™é‡ŒæŒ‡å®š 2 å€ç‰©ç†åƒç´ , å®é™…é¡¹ç›®å¯ä»¥ä½¿ç”¨ window.devicePixelRatio åˆ¤æ–­), ä¸€ä¸ªé€»è¾‘åƒç´  = 2 ç‰©ç†åƒç´ , ç›¸å½“äºå›¾ç‰‡æ”¾å¤§äº†ä¸€å€, æ‰€ä»¥è¿™é‡ŒæŒ‡å®š canvas å±æ€§ width/height ä¸º 750/280, style.width/height ä¸º 350/140. ç›¸å½“äºå›¾ç‰‡ç¼©å°ä¸€å€. è¿™æ ·å›¾ç‰‡å°±å˜æ¸…æ™°äº†.<br /><strong>ä¸è¦é—®ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠ canvas style width/height ç›´æ¥è®¾ä¸º 750/280, è¿™æ ·å›¾ç‰‡å°±æ— æ³•ç»˜åˆ¶å®Œå…¨</strong><br />award.jpg ä¹Ÿæ˜¯ä¸€æ ·, ç¼©å°ä¸€å€è¿›è¡Œæ˜¾ç¤º</p><p>HTML ä»£ç :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;canvas&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;750&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;280&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>CSS ä»£ç :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.card</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">375px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">140px</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;./award.jpg&#x27;</span>);<br>  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">375px</span> <span class="hljs-number">140px</span>;<br>&#125;<br><span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">canvas</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">375px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">140px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–"></a> åˆå§‹åŒ–</h2><h3 id="æ„é€ å‡½æ•°"><a class="markdownIt-Anchor" href="#æ„é€ å‡½æ•°"></a> æ„é€ å‡½æ•°</h3><p>è®¾ç½®é€‰å¡«çš„é…ç½®é»˜è®¤å€¼, ç›´æ¥å…¨éƒ¨åˆ®å¼€çš„ç™¾åˆ†æ¯”, åˆ®å¼€æ—¶ç»˜åˆ¶çš„åœ†åŠå¾„, çº¯è‰²é®ç½©å›¾å±‚çš„é¢œè‰², å…¨éƒ¨åˆ®å¼€çš„æ·¡å‡ºæ—¶é—´</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ScratchCard</span> &#123;<br>  <span class="hljs-attr">config</span>: <span class="hljs-title class_">ScratchCardConfig</span>;<br>  <span class="hljs-attr">ctx</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span>;<br>  <span class="hljs-attr">canvas</span>: <span class="hljs-title class_">HTMLCanvasElement</span>;<br>  <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">done</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-attr">isDown</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config: ScratchCardConfig</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = &#123;<br>      <span class="hljs-attr">showAllPercent</span>: <span class="hljs-number">45</span>,<br>      <span class="hljs-attr">radius</span>: <span class="hljs-number">20</span>,<br>      <span class="hljs-attr">coverColor</span>: <span class="hljs-string">&#x27;#999&#x27;</span>,<br>      <span class="hljs-attr">fadeOut</span>: <span class="hljs-number">2000</span>,<br>      ...config<br>    &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é®ç½©å›¾å±‚"><a class="markdownIt-Anchor" href="#é®ç½©å›¾å±‚"></a> é®ç½©å›¾å±‚</h3><p>è¿™é‡Œé€»è¾‘å¾ˆç®€å•, æ²¡æœ‰å›¾ç‰‡å›¾å±‚æ—¶è®¾ç½®çº¯è‰²å›¾å±‚, éœ€è¦ä»‹ç»çš„æ˜¯<code>globalCompositeOperation</code>å±æ€§, ç”¨äºè®¾ç½®ä¸¤ä¸ªç»˜å›¾è·¯å¾„äº¤å‰æ—¶çš„æ¸²æŸ“æ–¹å¼, <code>destination-out</code>æŒ‡åœ¨æºå›¾åƒå¤–æ˜¾ç¤ºç›®æ ‡å›¾åƒ, æºå›¾åƒé€æ˜, è¿™é‡Œ coverImg æ˜¯ç›®æ ‡å›¾åƒ, åˆ®å¼€æ—¶ç»˜åˆ¶çš„åœ†æ˜¯æºå›¾åƒ, è¿™æ ·æºå›¾åƒåŒºåŸŸå°±ä¼šå±•ç¤ºæœ€åº•éƒ¨çš„ç»“æœå›¾ç‰‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ScratchCard</span> &#123;<br>  ...<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config: ScratchCardConfig</span>) &#123;<br>    ...<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_init</span>();<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_init</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">canvas</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">offsetLeft</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">offsetTop</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addEvent</span>();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">coverImg</span>) &#123;<br>      <span class="hljs-comment">// è®¾ç½®çš„æ˜¯å›¾ç‰‡å›¾å±‚</span><br>      <span class="hljs-keyword">const</span> coverImg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();<br>      coverImg.<span class="hljs-property">src</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">coverImg</span>;<br>      coverImg.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">drawImage</span>(coverImg, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-string">&#x27;destination-out&#x27;</span>;<br>      &#125;;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// çº¯è‰²å›¾å±‚</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">coverColor</span>;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-string">&#x27;destination-out&#x27;</span>;<br>    &#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»‘å®šäº‹ä»¶"><a class="markdownIt-Anchor" href="#ç»‘å®šäº‹ä»¶"></a> ç»‘å®šäº‹ä»¶</h2><p>åˆ®å¥–æ•ˆæœå…¶å®å°±æ˜¯é€šè¿‡ç»‘å®š<code>touchstart</code>, <code>touchmove</code>, <code>touchend</code>äº‹ä»¶æ¥ç»˜åˆ¶æºå›¾åƒ, è¿™é‡ŒæŠŠ mouse äº‹ä»¶ä¹ŸåŠ ä¸Š<br />è¿™é‡Œé€šè¿‡ç›‘å¬<code>touchmove</code>æ¥ç»˜åˆ¶å›¾åƒ, <code>touchstart</code>å’Œ<code>touchend</code>æ¥æ§åˆ¶å¼€å§‹åœæ­¢<br />è™½ç„¶é»˜è®¤ addEventListener ç¬¬ä¸‰ä¸ªå‚æ•°çš„å±æ€§ passive ç”¨äºæ§åˆ¶æ˜¯å¦ç¦ç”¨ preventDefault, é»˜è®¤æ˜¯ false, ä½†æ˜¯è¿˜æ˜¯è¦æ˜¾å¼æŒ‡å®š{passive: false}, å› ä¸º<code>touchstart</code>å’Œ<code>touchend</code>passive é»˜è®¤å€¼è¿˜æ˜¯ true<br />isDown è¡¨ç¤ºæ˜¯å¦è§¦æ‘¸å±å¹•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ScratchCard</span> &#123;<br>  ...<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_addEvent</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchstart&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_eventDown</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchend&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_eventUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchmove&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_scratch</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousedown&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_eventDown</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mouseup&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_eventUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_scratch</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), &#123; <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> &#125;);<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_eventDown</span>(<span class="hljs-params">e: MouseEvent | TouchEvent</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDown</span> = <span class="hljs-literal">true</span>;<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_eventUp</span>(<span class="hljs-params">e: MouseEvent | TouchEvent</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDown</span> = <span class="hljs-literal">false</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ“¦é™¤æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ“¦é™¤æ•ˆæœ"></a> æ“¦é™¤æ•ˆæœ</h2><p>é€»è¾‘å¤§è‡´å¦‚ä¸‹:</p><ol><li>åˆ¤æ–­åˆ®åˆ®å¡è¿˜æ²¡æŒ‚å®Œ this.done ä¸º false, ä¸”å¤„äºæŒ‰ä¸‹çŠ¶æ€ this.isDown ä¸º true</li><li>å¦‚æœå­˜åœ¨å¤šä¸ªè§¦ç‚¹, åˆ™ä½¿ç”¨æœ€åä¸€ä¸ªè§¦ç‚¹, ä½¿ç”¨ e.changedTouches è·å–æœ€åä¸€ä¸ªè§¦ç‚¹</li><li>è·å–å½“å‰ç‚¹å‡»çš„åæ ‡ x, y, è¿™é‡Œ ev.clientX + document.body.scrollLeft ç›¸å½“äº ev.pageX</li><li>ç»˜å›¾</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä¸èƒ½ç”¨è§£æ„èµ‹å€¼<code>const &#123; beginPath, arc, fill &#125; = this.ctx;</code>,ä¼šä½¿ç»˜å›¾æ–¹æ³•çš„ä¸Šä¸‹æ–‡å¤±æ•ˆ, å¯ä»¥ç”¨ <code>with(this.ctx)</code>, ä½†ä¸æ¨è</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title function_">_scratch</span>(<span class="hljs-params">e: MouseEvent | TouchEvent</span>) &#123;<br>  e.<span class="hljs-title function_">preventDefault</span>();<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">ev</span>: <span class="hljs-title class_">MouseEvent</span> | <span class="hljs-title class_">Touch</span> = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">MouseEvent</span>;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">done</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDown</span>) &#123;<br>    <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">TouchEvent</span> &amp;&amp; e.<span class="hljs-property">changedTouches</span>) &#123;<br>      ev = e.<span class="hljs-property">changedTouches</span>[e.<span class="hljs-property">changedTouches</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-comment">// (ev.clientX + document.body.scrollLeft) || ev.pageX</span><br>    <span class="hljs-keyword">const</span> x = (ev.<span class="hljs-property">clientX</span> + <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollLeft</span> || ev.<span class="hljs-property">pageX</span>) - <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> || <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">const</span> y = (ev.<span class="hljs-property">clientY</span> + <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> || ev.<span class="hljs-property">pageY</span>) - <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> || <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// const &#123; beginPath, arc, fill &#125; = this.ctx;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">beginPath</span>();<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">arc</span>(<br>      x * <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">pixelRatio</span>,<br>      y * <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">pixelRatio</span>,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">radius</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">pixelRatio</span>,<br>      <span class="hljs-number">0</span>,<br>      <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span><br>    );<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">fill</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¨éƒ¨åˆ®å¼€"><a class="markdownIt-Anchor" href="#å…¨éƒ¨åˆ®å¼€"></a> å…¨éƒ¨åˆ®å¼€</h2><p>è¿™é‡Œå°±æ˜¯åˆ¤æ–­åˆ®å¼€çš„åŒºåŸŸç™¾åˆ†æ¯”æ˜¯å¦è¶…è¿‡åˆå§‹åŒ–æ—¶è®¾ç½®çš„é˜ˆå€¼, å¦‚æœæœ‰æ·¡å‡ºæ•ˆæœåˆ™è®¾ç½® canvas çš„ style.transition, æ²¡æœ‰å°±ç›´æ¥æ¸…é™¤ç”»å¸ƒ.<br />è¿™é‡Œåˆ¤æ–­åˆ®å¼€åŒºåŸŸæ‰€å ç™¾åˆ†æ¯”çš„æ–¹æ³•<code>_getFilledPercentage()</code>å…·ä½“é€»è¾‘å¦‚ä¸‹:</p><ol><li>é¦–å…ˆè¦çŸ¥é“ imgData.data è·å¾—çš„æ˜¯ä¸€ä¸ª Uint8Array ç‚¹é˜µæ•°ç»„, å…¶ä¸­ 4 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªåƒç´ , æ¯ä¸ªå­—èŠ‚åˆ†åˆ«ä»£è¡¨ rgba</li><li>æ‰€ä»¥è¿™é‡Œéœ€è¦ä» i=3 å¼€å§‹ç´¯åŠ  4 è®¡ç®— alpha=0(ä¹Ÿå¯ä»¥ä¸æ˜¯ 0,é€šè¿‡è®¾ç½®èƒ½å¤Ÿè¡¨ç¤ºé€æ˜çš„é˜ˆå€¼)çš„ä¸ªæ•°, æœ€åé™¤ä»¥åƒç´ æ•°å°±èƒ½å¤Ÿå¾—åˆ°åˆ®å¼€åŒºåŸŸçš„ç™¾åˆ†æ¯”</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title function_">_scratch</span>(<span class="hljs-params">e: MouseEvent | TouchEvent</span>) &#123;<br>    ...<br>      <span class="hljs-comment">// åˆ¤æ–­åˆ®ç™¾åˆ†æ¯”</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getFilledPercentage</span>() &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">showAllPercent</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_scratchAll</span>();<br>      &#125;<br>    &#125;<br>  &#125;<br><span class="hljs-title function_">_scratchAll</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">fadeOut</span> &gt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">`all <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.config.fadeOut&#125;</span>ms linear`</span>;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clear</span>();<br>      &#125;, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">fadeOut</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clear</span>();<br>    &#125;<br>    <span class="hljs-comment">// æ‰§è¡Œå›è°ƒ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>?.<span class="hljs-title function_">doneCallback</span>();<br>  &#125;<br>  <span class="hljs-title function_">_clear</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);<br>  &#125;<br>  <span class="hljs-comment">// è®¡ç®—åˆ®å¼€åŒºåŸŸç™¾åˆ†æ¯”, å³è®¡ç®—ç”»å¸ƒé€æ˜åŒºåŸŸç™¾åˆ†æ¯”</span><br>  <span class="hljs-title function_">_getFilledPercentage</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> imgData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);<br>    <span class="hljs-comment">// ç‚¹é˜µæ•°ç»„, 4ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªåƒç´ , æ¯ä¸ªå­—èŠ‚åˆ†åˆ«ä»£è¡¨rgba</span><br>    <span class="hljs-keyword">const</span> pixels = imgData.<span class="hljs-property">data</span>;<br>    <span class="hljs-keyword">let</span> threshold = <span class="hljs-number">0</span>; <span class="hljs-comment">// è¿™é‡Œå¯ä»¥è®¾ç½®é˜ˆå€¼è¡¨ç¤ºä»£è¡¨é€æ˜çš„åˆ†ç•Œçº¿</span><br>    <span class="hljs-keyword">let</span> transparentPixelCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">3</span>; i &lt; pixels.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) &#123;<br>      <span class="hljs-keyword">if</span> (pixels[i] &lt;= threshold) &#123;<br>        transparentPixelCount++;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Number</span>(((transparentPixelCount / (pixels.<span class="hljs-property">length</span> / <span class="hljs-number">4</span>)) * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>));<br>  &#125;<br></code></pre></td></tr></table></figure><p>ç”±äº ImageData çš„è·¨åŸŸé—®é¢˜, ä¸è¦åœ¨æœ¬åœ°ç›´æ¥æ‰“å¼€, å¯ä»¥å¯åŠ¨ä¸€ä¸ªé™æ€æœåŠ¡å™¨ä»¥ http å½¢å¼æ‰“å¼€<br />å®Œæ•´ä»£ç å·²ä¸Šä¼ åˆ° github<a href="https://github.com/Mariana-Yui/scratchcard">æŸ¥çœ‹æºç </a></p><h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://juejin.cn/post/6844903952157245447">ä¸€å¼ åˆ®åˆ®å¡ç«ŸåŒ…å«è¿™ä¹ˆå¤šå‰ç«¯çŸ¥è¯†ç‚¹</a></li><li><a href="https://segmentfault.com/a/1190000021232132">ä¸€å¼ å›¾æå®šåŸå‹é“¾</a></li><li><a href="https://cloud.tencent.com/developer/article/1501018">è§£å†³ canvas åœ¨é«˜æ¸…å±ä¸­ç»˜åˆ¶æ¨¡ç³Šçš„é—®é¢˜</a></li><li><a href="https://www.itread01.com/content/1550405736.html">js ä¸­çš„ scrollleftã€style.leftã€clientLeftã€offsetLeft</a></li><li><a href="https://stackoverflow.com/questions/58820279/how-to-calculate-transparent-area-of-canvas-in-percentage">è®¡ç®— canvas é€æ˜åŒºåŸŸç™¾åˆ†æ¯”</a></li><li><a href="https://segmentfault.com/a/1190000002405897">é¼ æ ‡ç‚¹å‡»ä½ç½®åæ ‡</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£å†³git pushæ—¶the requested upstream branch &#39;origin/main&#39; does not exist</title>
    <link href="/2021/06/29/2021-06-29-git-branch-set-up-stream/"/>
    <url>/2021/06/29/2021-06-29-git-branch-set-up-stream/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>æœ¬åœ°æ–‡ä»¶å¤¹æœªå…³è”è¿œç¨‹ä»“åº“, åœ¨ github æ–°å»ºä»“åº“å,è¿œç¨‹ä»“åº“ä¹Ÿæœ‰æ–‡ä»¶<br />æœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“<br /><code>git branch --set-upstream-to=origin/main master</code><br />ä¼šå‡ºç°<br /><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1624955303018_9856.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="" /></p><h1 id="è§£å†³æµç¨‹"><a class="markdownIt-Anchor" href="#è§£å†³æµç¨‹"></a> è§£å†³æµç¨‹</h1><ol><li><code>git remote add origin è¿œç¨‹ä»“åº“åœ°å€</code></li><li><code>git pull origin master --allow-unrelated-histories</code></li><li><code>git branch --set-upstream-to=origin/main master</code></li><li><code>git push</code></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3åˆä½“éªŒ</title>
    <link href="/2021/06/25/2021-06-08-vue3-learning-note/"/>
    <url>/2021/06/25/2021-06-08-vue3-learning-note/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å­¦å•Šâ€¦å­¦ä¸åŠ¨ä¹Ÿå¾—å­¦å•Šâ€¦<br />â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ ---- å¯¼è¯­</p></blockquote><br><h1 id="vue3-ä¸-typescript"><a class="markdownIt-Anchor" href="#vue3-ä¸-typescript"></a> Vue3 ä¸ Typescript</h1><p><strong>2021-06-08updated</strong> å¿˜è®°å•¥æ—¶å€™å†™çš„ç¬”è®°â€¦ä¹‹å‰å­˜åœ¨æœ¬åœ°, ç°åœ¨ push åˆ°åšå®¢ä¸Š, æ–¹ä¾¿ä»¥åæŸ¥é˜…<s>é»‘å†å²</s> ä¸å®šæœŸæ›´æ–°</p><h2 id="æ˜¯å¦è¿˜éœ€è¦-babel"><a class="markdownIt-Anchor" href="#æ˜¯å¦è¿˜éœ€è¦-babel"></a> æ˜¯å¦è¿˜éœ€è¦ babel?</h2><p>ç­”æ¡ˆæ˜¯éœ€è¦çš„, tsc åªè´Ÿè´£äº†è½¬ä¹‰è¯­æ³•, æ²¡æœ‰å¯¹ Map,Set ç­‰æ–°å¢æ•°æ®ç»“æ„å’Œ react çš„ jsx è¯­æ³•åšå®ç°, æ‰€ä»¥è¿˜æ˜¯éœ€è¦ babel(tmd æ‰¾äº†åŠå¤©æ˜¯å¦è¿˜éœ€è¦ babel å…¨éƒ½ç­”éæ‰€é—®)<br />å¯ä»¥å‚è€ƒ: â€ƒ <a href="https://juejin.cn/post/6955430382485553166">1. webpack5 æ­å»º Vue3+TS é¡¹ç›®</a><br />ä¹Ÿå¯ä»¥çœ‹çœ‹è¯¥åšä¸»çš„â€ƒ <a href="https://juejin.cn/post/6844903663408775176">2. webpack4 æ­å»º Vue é¡¹ç›®</a></p><h2 id="setup"><a class="markdownIt-Anchor" href="#setup"></a> setup</h2><p><code>setup</code>ä¸­æ— æ³•è®¿é—® this, <code>return</code>çš„å±æ€§å¿…é¡»éƒ½æ˜¯ Ref å“åº”å¼çš„<br /><code>setup</code>å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°<code>props</code>å’Œ<code>emits</code>, è¡¨ç¤ºå¤–éƒ¨ä¼ å…¥çš„å‚æ•°<code>props</code>å’Œå‘å¤–éƒ¨å‘é€çš„äº‹ä»¶<code>emits</code></p><h2 id="reactive"><a class="markdownIt-Anchor" href="#reactive"></a> reactive</h2><p><code>reactive</code>æ–¹æ³•æ„å»º Proxy, å¦‚æœè¦å¯¹ data ä¸­çš„å±æ€§åšå“åº”å¼è¦åš<code>toRefs</code>æˆ–è€…<code>toRef</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span>&lt;T&gt; = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">double</span>: <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>),<br>  <span class="hljs-attr">increase</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    data.<span class="hljs-property">count</span>++;<br>  &#125;,<br>&#125;);<br><span class="hljs-keyword">const</span> refData = <span class="hljs-title function_">toRefs</span>(data);<br><span class="hljs-keyword">return</span> &#123;<br>  ...refData,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="watch"><a class="markdownIt-Anchor" href="#watch"></a> watch</h2><p>å‚æ•°å¯ä»¥æ˜¯<code>ref</code>, <code>reactive</code>, <code>getterå‡½æ•°</code>å’ŒåŒ…å«å‰é¢ä¸‰ä¸ªçš„æ•°ç»„<br />å¦‚æœæƒ³è¦ç›‘å¬<code>reactive</code>ä¸­çš„å±æ€§éœ€è¦ä½¿ç”¨<code>getter</code>çš„æ–¹å¼, å¦‚<code>watch(() =&gt; data.count)</code>, è€Œä¸èƒ½ç›´æ¥ä½¿ç”¨<code>watch(data.count)</code></p><h2 id="props"><a class="markdownIt-Anchor" href="#props"></a> props</h2><p>å’Œ vue2 ç”¨æ³•ä¸€æ ·, è¡¨ç¤ºå¤–éƒ¨ä¼ å…¥å‚æ•°</p><h2 id="emits"><a class="markdownIt-Anchor" href="#emits"></a> emits</h2><p><code>emits</code>ç”¨äºå£°æ˜éœ€è¦å‘å¤–éƒ¨æš´éœ²çš„äº‹ä»¶å, å¯ä»¥æ˜¯æ•°ç»„å’Œå¯¹è±¡, å¯¹è±¡ key æ˜¯äº‹ä»¶å, å€¼å¯ä»¥æ˜¯å‡½æ•°å’Œ null, å‡½æ•°å¿…é¡»æœ‰å¸ƒå°”ç±»å‹è¿”å›å€¼, <strong>è¿™é‡Œçš„å‡½æ•°ä¸ä»…ä½œä¸ºæ‹¦æˆªå™¨, ä¹Ÿä½œä¸º typescript çš„ç±»å‹å®šä¹‰</strong> <code>setup</code>è°ƒç”¨ä½¿ç”¨<code>context.emit</code>, ç”¨æ³•å’Œ vue2 ä¸€æ ·, vue3 ä¼šå…ˆæ‰§è¡Œ<code>emits</code>ä¸­å¯¹åº”çš„å›è°ƒå†è¿”å›ç»™çˆ¶ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">emits</span>: &#123;<br>  <span class="hljs-string">&#x27;close-model&#x27;</span>: <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> boolean | <span class="hljs-literal">null</span><br>&#125;,<br><span class="hljs-comment">// emits: [&#x27;close-model&#x27;],</span><br><span class="hljs-title function_">setup</span>(<span class="hljs-params">props, context</span>) &#123;<br>  context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;close-model&#x27;</span>, &#123;<br>    <span class="hljs-attr">signal</span>: <span class="hljs-string">&#x27;close&#x27;</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="teleport"><a class="markdownIt-Anchor" href="#teleport"></a> teleport</h2><p><s><code>TPæ˜¯è‹±é›„è”ç›Ÿçš„ä¸€é¡¹å¬å”¤å¸ˆæŠ€èƒ½</code></s> æœ‰çš„ç»„ä»¶ä¾‹å¦‚å¯¹è¯æ¡†æ”¾åœ¨<code>#app</code>å†…æ˜¯ä¸åˆé€‚çš„, <code>teleport</code>å¯ä»¥å°†ç»„ä»¶ä¸€é”®ä¼ é€åˆ° html ä¸­çš„å¦å¤–ä¸€ä¸ª DOM ç»“æ„ä¸‹, ç”¨æ³•å¦‚ä¸‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- ç»„ä»¶å†… --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">teleport</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;#model&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>This is a dialog.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">teleport</span>&gt;</span><br><span class="hljs-comment">&lt;!-- teleportä¸­å†…å®¹ä¼šè¢«æ¸²æŸ“åˆ°id=modelçš„DOMèŠ‚ç‚¹ä¸‹ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;#app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;model&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="suspense"><a class="markdownIt-Anchor" href="#suspense"></a> Suspense</h2><p>vue ä» react å€Ÿé‰´æ¥çš„å¼‚æ­¥ç»„ä»¶, åœ¨<code>&lt;Suspense&gt;</code>ä¸­åŒ…å«ä¸¤ä¸ª<code>template</code>æ’æ§½, <code>default</code>æ’æ§½æ”¾ç½®å¼‚æ­¥ç»„ä»¶, åœ¨å¼‚æ­¥ç»„ä»¶æ•°æ®æœªå®Œå…¨è¿”å›æ—¶å…ˆæ¸²æŸ“<code>fallback</code>æ’æ§½å†…å®¹, æ•°æ®å®Œå…¨è¿”å›åå†æ¸²æŸ“å¼‚æ­¥ç»„ä»¶å†…å®¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dog-show</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dog-show</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span> Loading... <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="props-2"><a class="markdownIt-Anchor" href="#props-2"></a> props</h2><ol><li>ç”¨æ³•å’Œ vue2 ä¸€æ ·</li><li>åœ¨ vue2 åŸºç¡€ä¸Šæ·»åŠ ä¸Šå¯¹<code>typescript</code>çš„æ”¯æŒ, ç»†åŒ–äº†ç±»å‹å£°æ˜, å¦‚<code>Object as PropType&lt;UserProps&gt;</code>, <code>PropType&lt;T&gt;</code>ä¸º<code>props</code>çš„æ³›å‹, <code>T</code>å³<code>type</code></li><li>è®°å¾—åœ¨ vue ä¸­å¼•å…¥<code>import &#123; PropType &#125; from 'vue'</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">props</span>: &#123;<br>  <span class="hljs-attr">user</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">PropType</span>&lt;<span class="hljs-title class_">UserProps</span>&gt;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ref"><a class="markdownIt-Anchor" href="#ref"></a> ref</h2><p>vue2 ä¸­<code>ref</code>ç”¨äºè·å– DOM èŠ‚ç‚¹æˆ–è€…ç»„ä»¶å®ä¾‹, åœ¨ vue3 ä¸­ç”¨æ³•ç±»ä¼¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> dropdownRef = ref&lt;<span class="hljs-literal">null</span> | <span class="hljs-title class_">HTMLElement</span>&gt;(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> &#123;<br>    dropdownRef<br>  &#125;<br>&#125;<br><br>&lt;div ref=<span class="hljs-string">&quot;dropdownRef&quot;</span>&gt;&lt;/div&gt;<br></code></pre></td></tr></table></figure><h2 id="ç¦ç”¨-attribute-ç»§æ‰¿"><a class="markdownIt-Anchor" href="#ç¦ç”¨-attribute-ç»§æ‰¿"></a> ç¦ç”¨ Attribute ç»§æ‰¿</h2><ol><li>é»˜è®¤åœ°, vue ä¼šå°†ä¼ å‘ä¸€ä¸ªç»„ä»¶çš„é prop çš„<code>attribute</code>è‡ªåŠ¨æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹çš„<code>attribute</code>ä¸­, å¯ä»¥é€šè¿‡<code>inheritAttrs: false</code>æ¥ç¦æ­¢è¿™ç§è¡Œä¸º</li><li>å¦‚æœè¦å°†ä¸Šè¿°<code>attribute</code>å…¨éƒ¨å¤åˆ¶ç»™ç»„ä»¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹, å¯ä»¥ä½¿ç”¨<code>v-bind=&quot;$attrs&quot;</code>, ä¾‹å¦‚<code>&lt;input v-bind=&quot;$attrs&quot;&gt;</code></li></ol><h2 id="slot"><a class="markdownIt-Anchor" href="#slot"></a> slot</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å­ç»„ä»¶</span><br>&lt;slot name=<span class="hljs-string">&quot;default&quot;</span>&gt;&lt;/slot&gt;<br><span class="hljs-comment">// çˆ¶ç»„ä»¶</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h1 id="vuex"><a class="markdownIt-Anchor" href="#vuex"></a> Vuex</h1><h2 id="vue3-ä¸­çš„-vuex"><a class="markdownIt-Anchor" href="#vue3-ä¸­çš„-vuex"></a> vue3 ä¸­çš„ vuex</h2><p>vue3 ä¸­<code>vuex</code>é€šè¿‡<code>createStore</code>åˆ›å»º<code>store</code>, <code>useStore</code>ä½¿ç”¨<code>store</code>, ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯æ³›å‹, éƒ½å¯ä»¥é€šè¿‡<code>xxStore&lt;GlobalProps&gt;</code>çš„æ–¹å¼æŒ‡å®š<code>storeä¸­state</code>çš„ç»“æ„</p><h2 id="getter"><a class="markdownIt-Anchor" href="#getter"></a> getter</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">getter</span>: &#123;<br>  <span class="hljs-comment">// è¿”å›å€¼</span><br>  <span class="hljs-attr">propertyName</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">propertyValue</span>;<br>  &#125;,<br>  <span class="hljs-comment">// è¿”å›æ–¹æ³•</span><br>  <span class="hljs-attr">propertyName</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">propertyValue</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é¡¹ç›®ä¸­çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#é¡¹ç›®ä¸­çŸ¥è¯†ç‚¹"></a> é¡¹ç›®ä¸­çŸ¥è¯†ç‚¹</h1><h2 id="ç»„ä»¶ä¼ å‚"><a class="markdownIt-Anchor" href="#ç»„ä»¶ä¼ å‚"></a> ç»„ä»¶ä¼ å‚</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;dropdown-item disabled&gt;&lt;/dropdown-item&gt;<br><span class="hljs-comment">// ç›¸å½“äº</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dropdown-item</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dropdown-item</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="å­å…ƒç´ é«˜åº¦-100"><a class="markdownIt-Anchor" href="#å­å…ƒç´ é«˜åº¦-100"></a> å­å…ƒç´ é«˜åº¦ 100%</h2><p>é«˜åº¦%ç™¾åˆ†æ¯”è®¡ç®—æ˜¯æ ¹æ®çˆ¶å…ƒç´ çš„é«˜åº¦è®¡ç®—çš„, æ‰€ä»¥å¦‚æœåªæœ‰çˆ¶å…ƒç´ è®¾ç½®äº†<code>height: 100%</code>, æµè§ˆå™¨å¹¶ä¸çŸ¥é“çˆ¶å…ƒç´ å…·ä½“ height æ˜¯å¤šå°‘, ä½†æ˜¯ç»™<code>html</code>è®¾ç½®<code>height: 100%</code>åˆ™æ˜¯æœ‰æ•ˆçš„, æµè§ˆå™¨ä¼šçŸ¥é“<code>html</code>çš„é«˜åº¦ä¸ºæµè§ˆå™¨å¯è§†åŒºåŸŸçš„é«˜åº¦, æ‰€ä»¥ css ä»£ç åº”è¯¥å¯¹éœ€è¦å­å…ƒç´ çš„ç¥–å…ˆå…ƒç´ éƒ½è®¾ç½®<code>height: 100%</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* ç¥–å…ˆå…ƒç´  */</span><br><span class="hljs-selector-tag">html</span>,<br><span class="hljs-selector-tag">body</span>,<br><span class="hljs-selector-id">#app</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><span class="hljs-comment">/* å­å…ƒç´  */</span><br><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100%</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°çš„é—®é¢˜"></a> é‡åˆ°çš„é—®é¢˜</h1><blockquote><p>Q: Already included file name â€¦ â€¦ only in casing.Vetur(1261)<br />A: æ·»åŠ <code>&quot;forceConsistentCasingInFileNames&quot;: false</code>åˆ°<code>tsconfig.json</code>çš„<code>compilerOptions</code></p></blockquote><br><blockquote><p>Q: typescript ä¸­å…¨å±€å˜é‡å£°æ˜å¦‚ä½•é…ç½®?<br />A: <code>tsconfig.json</code>çš„<code>compilerOptions</code>ä¸­<code>typeRoots</code>å±æ€§æ•°ç»„åŠ å…¥å…¨å±€å£°æ˜æ–‡ä»¶è·¯å¾„</p></blockquote><br><blockquote><p>Q: vue-devtools åœ¨ Vue3 ä¸­ä¸æ˜¾ç¤º<br />A: Chrome å•†åº—ä¸‹è½½ beta ç‰ˆ vue-devtools</p></blockquote><br><blockquote><p>Q: F12 æ§åˆ¶å° vue panel ä¸æ˜¾ç¤º<br />A: æ›´å¤šå·¥å…· &gt; æ‰©å±•ç¨‹åº &gt; vue-devtools å¼€å¯å…è®¸è®¿é—®æ–‡ä»¶ç½‘å€</p></blockquote><br>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackä¸­path/publicPath/contentBaseå‚»å‚»åˆ†ä¸æ¸…æ¥š</title>
    <link href="/2021/06/25/2021-06-25-path-publicPath-contentBase/"/>
    <url>/2021/06/25/2021-06-25-path-publicPath-contentBase/</url>
    
    <content type="html"><![CDATA[<p><strong>2022.10.01 æ›´æ–°: æ—¶éš”ä¸€å¹´å¤šåœ¨ webpack5 ä¸‹çš„å…¨æ–°è®¤çŸ¥. <s>å…¶å®æ˜¯å¿˜å¾—å·®ä¸å¤šé‡æ–°å­¦ä¹ äº†ä¸‹</s> å½“ç„¶ä¸‹é¢çš„çŸ¥è¯†å¹¶æ²¡æœ‰è¿‡æ—¶~</strong><br />[[2022-09-30-study-webpack-day7#publicPath path contentBase in webpack5]]</p><h1 id="path-vs-publicpath-vs-contentbase"><a class="markdownIt-Anchor" href="#path-vs-publicpath-vs-contentbase"></a> path vs. publicPath vs. contentBase</h1><h2 id="outputpath"><a class="markdownIt-Anchor" href="#outputpath"></a> output.path</h2><p>ç»å¯¹è·¯å¾„, ä»£è¡¨æ‰“åŒ…åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„ç‰©ç†ä½ç½®.<br />æ¯”å¦‚:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].js&#x27;</span>,<br>  <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;../dist&#x27;</span>),<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/dev/&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®é¡¹åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æ˜¯å¿…é¡»çš„, å› ä¸ºä½ æ€»è¦æŒ‡å®šæ‰“åŒ…ç”Ÿæˆçš„æœ€ç»ˆè·¯å¾„. ä½†æ˜¯åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸æ˜¯å¿…é¡»çš„, å› ä¸º<code>webpackDevServer</code>æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶éƒ½åœ¨å†…å­˜ä¸­è€Œæ²¡æœ‰æ‰“åŒ…åˆ°ç£ç›˜ä¸­.<br /><code>path</code>å±æ€§å®¹æ˜“ç†è§£, ç»å¸¸å®¹æ˜“å¼„æ··çš„æ˜¯<code>publicPath</code>å’Œ<code>contentBase</code>å±æ€§</p><h2 id="outputpublicpath"><a class="markdownIt-Anchor" href="#outputpublicpath"></a> output.publicPath</h2><p>æ‰“åŒ…å‡ºæ¥çš„èµ„æºçš„ URL å‰ç¼€(è¿™é‡Œæ‰“åŒ…åœ¨ç”Ÿäº§æ¨¡å¼å’Œå¼€å‘æ¨¡å¼éƒ½å¾ˆé‡è¦, åŒºåˆ«åœ¨äºå‰è€…æ‰“åŒ…åœ¨ç¡¬ç›˜, åè€…æ‰“åŒ…åœ¨å†…å­˜), å³åœ¨æµè§ˆå™¨ä¸­è®¿é—®çš„è·¯å¾„å‰ç¼€,å¯ä»¥å¡«å†™ä¸ºç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„:</p><ul><li>ç›¸å¯¹è·¯å¾„ä¼šè¢«è§£æä¸ºç›¸å¯¹ HTML çš„è·¯å¾„</li><li>ç»å¯¹è·¯å¾„, æ¯”å¦‚ CDN è·¯å¾„</li></ul><p>äº‹å®ä¸Šåœ¨å®é™…å¼€å‘ä¸­ä¼šé€šè¿‡å½“å‰çš„ç¯å¢ƒè®¾ç½®<code>publicPath</code>ä¸º CDN è·¯å¾„è¿˜æ˜¯æ™®é€šç»å¯¹è·¯å¾„, è¿™ä¸ªé…ç½®é¡¹ä¼šè¢«åŠ å…¥æ¯ä¸€ä¸ª runtime æˆ–è€… loader äº§ç”Ÿçš„ URL ä¸­, æ‰€ä»¥è¿™ä¸ªé…ç½®é¡¹æœ€å¥½æ˜¯ä»¥ <code>/</code> ç»“å°¾<br /><img src="https://camo.githubusercontent.com/2c9930b2b20dd0576ffd37c83f893f751833feefdffceb00c8f446c2ac306084/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f312a614f4d355a4638616c574c723442433043665a6530772e706e67" alt="ç¤ºä¾‹å›¾" /></p><h2 id="devserverpublicpath"><a class="markdownIt-Anchor" href="#devserverpublicpath"></a> devServer.publicPath</h2><p>å¼€å¯<code>webpackDevServer</code>æ—¶æµè§ˆå™¨å¯ä»¥é€šè¿‡<code>devServer.publicPath</code>ä¸­è®¾ç½®çš„è·¯å¾„æ¥è®¿é—®<strong>bundled è¢«æ‰“åŒ…</strong>çš„æ–‡ä»¶, é€šè¿‡è®¿é—®<code>http://localhost:8080/webpack-dev-server</code>å¯ä»¥å¾—åˆ° devServer å¯åŠ¨åçš„æ‰“åŒ…èµ„æºè®¿é—®è·¯å¾„, ç‚¹å‡»èµ„æºå¯ä»¥çœ‹åˆ°æ‰“åŒ…èµ„æºçš„è®¿é—®è·¯å¾„ä¸º<code>http://localhost:8080$&#123;publicPath&#125;main.js</code>, å¦‚å›¾æ‰€ç¤º:<br /><img src="https://user-gold-cdn.xitu.io/2018/5/2/16320c647d8b1594?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="" /><br />æ²¡æœ‰è®¾ç½®<code>devServer.publicPath</code>æ—¶, é»˜è®¤å€¼ä¸º<code>output.publicPath</code>, å’Œ<code>output.publicPath</code>éå¸¸ç›¸ä¼¼, éƒ½æ˜¯ä¸ºæµè§ˆå™¨æŒ‡å®šè®¿é—®è·¯å¾„çš„å‰ç¼€, ä¸€èˆ¬æ¥è¯´å¼€å‘ç¯å¢ƒä¸‹<code>devServer.publicPath</code>éƒ½éœ€è¦å’Œ<code>output.publicPath</code>ä¿æŒä¸€è‡´.ä¸¾ä¸ªå ğŸŒ°</p><ol><li>output.publicPath è®¾ç½®äº†<code>/mb/v5/</code></li><li>devServer.publicPath è®¾ç½®äº†<code>/mb/v4</code></li><li>æ‰“åŒ…å‡ºæ¥ js æ–‡ä»¶ä¸º<code>/mb/v5/js/vendor~12345678.js</code></li><li>å®é™…ä¸Šé€šè¿‡<code>http://localhost:8080/webpack-dev-server</code>æŸ¥è¯¢è®¿é—®çš„è·¯å¾„å®é™…æ˜¯<code>/mb/v4/js/vendor~12345678.js</code></li><li>404 æŠ¥é”™</li></ol><p>æ€»ç»“æ¥è¯´, output.publicPath æŒ‡å®šè·¯å¾„(ä»…ä»…æ˜¯å¯¹æ‰“åŒ…è·¯å¾„å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹), devServer.publicPath åˆ™æ˜¯å¯¹è¯¥è·¯å¾„è®¾ç½®äº†ä¸€ä¸ªç±»ä¼¼ express.static çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨, æœåŠ¡å™¨è·¯å¾„å’Œè®¾ç½®è·¯å¾„å¯¹ä¸ä¸Šè‡ªç„¶å°±æ— æ³•è®¿é—®äº†</p><h2 id="devservercontentbase"><a class="markdownIt-Anchor" href="#devservercontentbase"></a> devServer.contentBase</h2><p>å†³å®šäº† <code>webpackDevServer</code> å¯åŠ¨æ˜¯æœåŠ¡å™¨<strong>é™æ€èµ„æº</strong>çš„æ ¹ç›®å½•, é»˜è®¤æ˜¯é¡¹ç›®æ ¹ç›®å½•<br />è¿™é‡Œçš„é™æ€èµ„æºæŒ‡å›¾ç‰‡, å­—ä½“ç­‰èµ„æº, è€Œä¸æ˜¯æŒ‡ bundled è¢«æ‰“åŒ…çš„èµ„æº, åœ¨æœ‰é™æ€èµ„æºçš„æ—¶å€™å¿…å¡«, <code>contentBase</code>ä¸ä¼šå½±å“<code>path</code>å’Œ<code>publicPath</code>, ä»–å”¯ä¸€ä½œç”¨æ˜¯æŒ‡å®šæœåŠ¡å™¨é™æ€èµ„æºæ ¹ç›®å½•æ¥å¼•ç”¨é™æ€æ–‡ä»¶.<br /><code>devServer.contentBase</code>å’Œ<code>devServer.publicPath</code>çš„å…³ç³»: <code>contentBase</code>æ˜¯æœåŠ¡äºé™æ€èµ„æºæ–‡ä»¶çš„è·¯å¾„, <code>publicPath</code>æ˜¯æœåŠ¡äºæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶è®¿é—®çš„è·¯å¾„, ä¸¤è€…äº’ä¸å½±å“ã€‚</p><h2 id="htmlwebpackplugin"><a class="markdownIt-Anchor" href="#htmlwebpackplugin"></a> htmlWebpackPlugin</h2><p><code>htmlWebpackPlugin</code>ç”¨äºå‘ html ä¸­æ’å…¥æ‰“åŒ…å¥½çš„ js æ–‡ä»¶, è€Œè¿™ä¸ªè·¯å¾„æ˜¯æ ¹æ®<code>output.publicPath</code>å†³å®šçš„.å®˜ç½‘æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯:</p><blockquote><p>If youâ€™ve set a publicPath in your webpack config this will be reflected correctly in this assets hash.<br />It is recommended that <code>devServer.publicPath</code> is the same as <code>output.publicPath</code>.</p></blockquote><p>æ‰€ä»¥å°±åƒä»–è¯´çš„, æŠŠ<code>output.publicPath</code>å’Œ<code>devServer.publicPath</code>è®¾ç½®æˆä¸€æ ·å§ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://github.com/fi3ework/blog/issues/39">Webpack ä¸­ path/publicPath/contenBase çš„å…³ç³»</a></li><li><a href="https://juejin.cn/post/6844903601060446221">Webpack ä¸­ publicPath è¯¦è§£</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå­¦ä¹ è®°å½•</title>
    <link href="/2021/06/07/2021-06-07-docker-learning-note/"/>
    <url>/2021/06/07/2021-06-07-docker-learning-note/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¦‚æœä¸æ˜¯çœŸçš„èœ ğŸ”, è°åˆæ„¿æ„å½“éŸ­èœå‘¢</p></blockquote><h2 id="docker-çš„åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#docker-çš„åŸºæœ¬æ¦‚å¿µ"></a> docker çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="docker-å’Œ-k8"><a class="markdownIt-Anchor" href="#docker-å’Œ-k8"></a> docker å’Œ k8</h3><h3 id="ä»€ä¹ˆæ˜¯é•œåƒ-image"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯é•œåƒ-image"></a> ä»€ä¹ˆæ˜¯é•œåƒ image?</h3><blockquote><p>æ“ä½œç³»ç»Ÿåˆ†ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚å¯¹äº Linux è€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½ root æ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€Œ Docker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚<br />Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚ é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯å®¹å™¨-container"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯å®¹å™¨-container"></a> ä»€ä¹ˆæ˜¯å®¹å™¨ container?</h3><blockquote><p>é•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ ç±» å’Œ å®ä¾‹ ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ ã€‚</p></blockquote><h3 id="å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"></a> å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«</h3><ul><li>å®¹å™¨æ˜¯ APP å±‚é¢çš„éš”ç¦»</li><li>è™šæ‹ŸåŒ–æ˜¯ç‰©ç†èµ„æºå±‚é¢çš„éš”ç¦»</li></ul><p>çœ‹ä¸¤å¼ å›¾å¸®åŠ©ç†è§£</p><details><summary>ç‚¹æˆ‘!ç‚¹æˆ‘!</summary><p><b>å®¹å™¨</b><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1623078548626_3123.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="å®¹å™¨æ¶æ„" /></p><p><b>è™šæ‹ŸåŒ–</b></p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1623078579393_5295.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="è™šæ‹ŸåŒ–æ¶æ„" /></p></p></details><h3 id="vagrant"><a class="markdownIt-Anchor" href="#vagrant"></a> vagrant</h3><p>vagrant æ˜¯ç”¨äºæ„å»ºåŠé…ç½®è™šæ‹Ÿå¼€å‘ç¯å¢ƒçš„è½¯ä»¶, éœ€è¦å€ŸåŠ© virtualbox/vm æ‰èƒ½ä½¿ç”¨, å¦åˆ™ä½¿ç”¨ vagrant æŠ¥é”™<br />virtualbox éœ€è¦äº‹å…ˆå®‰è£…, vagrant çš„å®‰è£…å¯ä»¥é€šè¿‡å®˜ç½‘ä¸‹è½½ pkg æ–‡ä»¶è¿›è¡Œå®‰è£…</p><h4 id="vagrant-å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#vagrant-å¸¸ç”¨å‘½ä»¤"></a> vagrant å¸¸ç”¨å‘½ä»¤</h4><ul><li><code>vagrant init ç³»ç»Ÿç‰ˆæœ¬</code>: åˆå§‹åŒ–éœ€è¦å®‰è£…çš„ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶, ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åä¸º vagrantfile. å¯ä»¥é€šè¿‡åœ¨<a href="https://app.vagrantup.com/boxes/search">å®˜ç½‘</a>ä¸Šç›´æ¥æŸ¥è¯¢ vagrantfile é…ç½®</li><li><code>vagrant up</code>: ä¸‹è½½ vagrantfile ä¸­é…ç½®çš„ç³»ç»Ÿ, ç»“æŸåå¯åŠ¨ç³»ç»Ÿ, å¦‚æœå·²ç»ä¸‹è½½è¿‡äº†ç³»ç»Ÿåˆ™ç›´æ¥å¯åŠ¨</li><li><code>vagrant ssh</code>: æœ¬åœ°è¿æ¥ç™»å½•è™šæ‹Ÿæœº</li><li><code>vagrant halt</code>: å…³é—­ç³»ç»Ÿ</li><li><code>vagrant status</code>: æŸ¥çœ‹å½“å‰è™šæ‹ŸæœºçŠ¶æ€</li></ul><h2 id="å®‰è£…-docker"><a class="markdownIt-Anchor" href="#å®‰è£…-docker"></a> å®‰è£… docker</h2><p>åšä¸»æ˜¯é€šè¿‡ vagrant å®‰è£… centos çš„æ–¹å¼åœ¨ linux ä¸Šå®‰è£… docker, ä¸ºäº†å’Œæœ¬æœºç³»ç»Ÿéš”ç¦». å‚è€ƒ<a href="https://docs.docker.com/engine/install/centos/">centos å®‰è£… docker</a><br />window å’Œ mac éƒ½å¯ä»¥åœ¨å®˜ç½‘æœç´¢ç›¸åº”å®‰è£…åŒ…ä¸‹è½½</p><p><strong>tips</strong> centos ä¸‹ docker å‘½ä»¤éƒ½éœ€è¦ sudo æ‰§è¡Œ, å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é¿å…è¾“å…¥ sudo, <strong>è®°å¾—é‡æ–°ç™»å…¥ shell</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">sudo groupadd docker<br>sudo gpasswd -<span class="hljs-selector-tag">a</span> vagrant docker<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="docker-é•œåƒ"><a class="markdownIt-Anchor" href="#docker-é•œåƒ"></a> docker é•œåƒ</h3><p>docker å®˜æ–¹è‡ªå¸¦çš„é•œåƒéå¸¸æ…¢, å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æˆ–è€…ä¸­ç§‘å¤§ç­‰æä¾›çš„é•œåƒ, mac å¯ä»¥ç›´æ¥é€šè¿‡å›¾åƒåŒ–ç®¡ç†å·¥å…·è®¾ç½®é•œåƒæº, <code>perforence -&gt; Docker Engine</code>, æŠŠä¸‹é¢çš„é…ç½®æ·»åŠ åˆ° json ä¸­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>  <span class="hljs-string">&quot;https://n3znd2n8.mirror.aliyuncs.com&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><h4 id="centos7-æ›´æ¢é•œåƒæº"><a class="markdownIt-Anchor" href="#centos7-æ›´æ¢é•œåƒæº"></a> centos7 æ›´æ¢é•œåƒæº</h4><ol><li>å†™å…¥é•œåƒæº<code>sudo vi /etc/docker/daemon.json</code></li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>é‡æ–°å¯åŠ¨ docker</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br>sudo systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><details><summary>macé…ç½®é•œåƒ</summary><p><p><img src="https://dev.azure.com/HealMSlin/8544be09-1224-4eb0-824b-90c4ec9d49ee/_apis/git/repositories/7a27a721-4c93-4ecf-8258-d5422217b60a/items?path=%2F1623151731192_4260.png&amp;versionDescriptor%5BversionOptions%5D=0&amp;versionDescriptor%5BversionType%5D=0&amp;versionDescriptor%5Bversion%5D=master&amp;resolveLfs=true&amp;%24format=octetStream&amp;api-version=5.0" alt="é…ç½®é•œåƒ" /></p></p></details><h2 id="docker-machine"><a class="markdownIt-Anchor" href="#docker-machine"></a> docker-machine</h2><p><code>docker-machine</code>ä¹Ÿå¯ä»¥åƒ<code>vagrant</code>ä¸€æ ·åˆ›å»ºå¹¶ç®¡ç†å¤šå°è™šæœº</p><h3 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h3><h4 id="macos-å®‰è£…"><a class="markdownIt-Anchor" href="#macos-å®‰è£…"></a> MacOS å®‰è£…</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ base=https://github.com/docker/machine/releases/download/v0.16.0 &amp;&amp;<br>  curl -L <span class="hljs-variable">$base</span>/docker-machine-$(<span class="hljs-built_in">uname</span> -s)-$(<span class="hljs-built_in">uname</span> -m) &gt;/usr/local/bin/docker-machine &amp;&amp;<br>  <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-machine<br></code></pre></td></tr></table></figure><h4 id="æ£€æŸ¥å®‰è£…æˆåŠŸ"><a class="markdownIt-Anchor" href="#æ£€æŸ¥å®‰è£…æˆåŠŸ"></a> æ£€æŸ¥å®‰è£…æˆåŠŸ</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ docker-machine <span class="hljs-built_in">version</span><br>docker-machine <span class="hljs-built_in">version</span> <span class="hljs-number">0.16</span><span class="hljs-number">.0</span>, build <span class="hljs-number">702</span>c267f<br></code></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#å¸¸ç”¨å‘½ä»¤"></a> å¸¸ç”¨å‘½ä»¤</h3><ul><li><code>docker-machine create [name]</code>: åˆ›å»ºä¸€å°å®‰è£…å¥½ docker çš„ linux è™šæœº, <code>[name]</code>ä¸ºè‡ªå®šä¹‰è™šæœºåç§°</li><li><code>docker-machine ls</code>: æŸ¥çœ‹åˆ›å»ºçš„è™šæœºåˆ—è¡¨</li><li><code>docker-machine stop [name]</code>: å…³é—­[name]è™šæœº</li><li><code>docker-machine start [name]</code>: å¼€å¯[name]è™šæœº</li><li><code>docker-machine ssh [name]</code>: ç™»å½•[name]è™šæœº</li><li><code>docker-machine rm [name]</code>: åˆ é™¤[name]è™šæœº</li></ul><p><strong>ä»¥ä¸‹å†…å®¹æœªé¢å¤–è¯´æ˜éƒ½æ˜¯åœ¨ vagrant åˆ›å»ºçš„ centos è™šæœºä¸Šè¿›è¡Œæ¼”ç¤º</strong></p><h2 id="image-container"><a class="markdownIt-Anchor" href="#image-container"></a> image &amp; container</h2><p>ä¸Šé¢è¯´è¿‡äº† image æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿ, container æ˜¯ä¸åŒ image åœ¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šçš„å åŠ ç”Ÿæˆçš„å®ä¾‹</p><h3 id="hub"><a class="markdownIt-Anchor" href="#hub"></a> Hub</h3><p>docker ä¹Ÿæä¾›äº†åƒ github ä¸€æ ·çš„æ‰˜ç®¡å¹³å°, å­˜æ”¾å¸¸ç”¨çš„ä¸€ç³»åˆ—è½¯ä»¶çš„ image é•œåƒ. <a href="https://hub.docker.com/">ç‚¹å‡»è®¿é—®</a><br />å¯ä»¥é€šè¿‡<code>docker pull [IMAGE NAME]</code>çš„æ–¹å¼ä¸‹è½½ image</p><h3 id="äº²æ‰‹å†™ä¸€ä¸ª-image-demo"><a class="markdownIt-Anchor" href="#äº²æ‰‹å†™ä¸€ä¸ª-image-demo"></a> äº²æ‰‹å†™ä¸€ä¸ª image demo</h3><ol><li>å†™ä¸€ä¸ªç®€å•çš„ C è¯­è¨€æ–‡ä»¶<code>hello.c</code></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶<code>hello</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å¦‚æœå®‰è£…äº†è·³è¿‡è¿™ä¸€æ­¥</span><br>$ yum install gcc<br>$ gcc -static hello.c -o hello<br></code></pre></td></tr></table></figure><ol start="3"><li>ç¼–å†™<code>Dockerfile</code>æ–‡ä»¶</li></ol><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-comment"># è¡¨ç¤ºæ²¡æœ‰åŸºäºä»»ä½•é•œåƒ</span><br><span class="hljs-keyword">FROM</span> scratch<br><span class="hljs-comment"># å°†å®¿ä¸»æœº(è¿™é‡Œæ˜¯è™šæœº)å½“å‰è·¯å¾„çš„helloæ–‡ä»¶æ·»åŠ åˆ°imageæ–‡ä»¶ç³»ç»Ÿçš„æ ¹è·¯å¾„</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> hello /</span><br><span class="hljs-comment"># è¿è¡Œimageä¸­çš„helloæ–‡ä»¶(å¿…é¡»æ˜¯double quote)</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/hello&quot;</span>]</span><br></code></pre></td></tr></table></figure><ol start="4"><li>ç”Ÿæˆ image</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># denis/helloä¸ºimageåç§°, .ä¸ºåœ¨å½“å‰è·¯å¾„æŸ¥æ‰¾hello</span><br>$ docker build -t denis/hello .<br><span class="hljs-comment"># æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„image</span><br>$ docker image <span class="hljs-built_in">ls</span><br>REPOSITORY          TAG       IMAGE ID       CREATED         SIZE<br>denis/hello-world   latest    70714e52769a   9 seconds ago   861kB<br></code></pre></td></tr></table></figure><ol start="5"><li>è¿è¡Œ image</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ docker run denis/hello<br>hello world<br><span class="hljs-comment"># æŸ¥çœ‹imageä¸­åŒ…å«çš„æ“ä½œ</span><br>$ docker <span class="hljs-built_in">history</span> [IMAGE ID]<br>IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT<br>70714e52769a   49 seconds ago   /bin/sh -c <span class="hljs-comment">#(nop)  CMD [&quot;/hello&quot;]               0B</span><br>00ae1da5637b   3 minutes ago    /bin/sh -c <span class="hljs-comment">#(nop) ADD file:f0bbccfa3092098e8â€¦   861kB</span><br></code></pre></td></tr></table></figure><p>å¯¹äº<code>docker run</code>çš„ container è¿è¡Œåä¼šç›´æ¥é€€å‡º, å¦‚æœæƒ³è¿›è¡Œäº¤äº’å¯ä»¥åŠ ä¸Šæ ‡è¯†ç¬¦<code>-it</code>, ä¾‹å¦‚<code>docker run -it ubuntu:14.04</code>, å¯ä»¥é€šè¿‡<code>docker container ls</code>æŸ¥çœ‹æ­£åœ¨è¿è¡Œä¸­çš„ container, <code>docker container ls -a</code>æŸ¥çœ‹è¿è¡Œç»“æŸå·²ç»é€€å‡ºçš„ container</p><h3 id="å¸¸è§å‘½ä»¤"><a class="markdownIt-Anchor" href="#å¸¸è§å‘½ä»¤"></a> å¸¸è§å‘½ä»¤</h3><p>æ‰€æœ‰å‘½ä»¤å¯ä»¥é€šè¿‡<code>docker --help</code>æŸ¥çœ‹</p><ul><li><code>docker container ls</code>: æŸ¥çœ‹æ­£åœ¨è¿è¡Œä¸­çš„ container, ç®€å†™<code>docker ps</code></li><li><code>docker container ls -a</code>: æŸ¥çœ‹å·²é€€å‡ºçš„ container, ç®€å†™<code>docker ps -a</code></li><li><code>docker image ls</code>: æŸ¥çœ‹æ‰€æœ‰é•œåƒ, ç®€å†™<code>docker images</code></li><li><code>docker rm [CONTAINER ID]</code>: åˆ é™¤ container</li><li><code>docker rmi [IMAGE ID]</code>: åˆ é™¤ image, éœ€è¦å…ˆæŠŠ image å¯¹åº”çš„ container éƒ½åˆ é™¤</li><li><code>docker rm $(docker container ls -f &quot;status=exited&quot; -q)</code>: åˆ é™¤ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„ container, <code>-f --filter</code>filter output based on conditions provided, <code>-q --quiet</code>only display container IDs</li></ul><h2 id="dockerfile"><a class="markdownIt-Anchor" href="#dockerfile"></a> Dockerfile</h2><p>ç”Ÿæˆ image çš„æè¿°æ–‡ä»¶</p><h3 id="å¸¸è§æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#å¸¸è§æŒ‡ä»¤"></a> å¸¸è§æŒ‡ä»¤</h3><h4 id="from"><a class="markdownIt-Anchor" href="#from"></a> FROM</h4><p>åŸºäºçš„é•œåƒ, <code>FROM scratch</code>æ²¡æœ‰åŸºäºçš„é•œåƒ, <code>FROM centos</code>åŸºäºæœ€æ–°å‘è¡Œç‰ˆçš„ centos é•œåƒ</p><h4 id="run"><a class="markdownIt-Anchor" href="#run"></a> RUN</h4><p>åœ¨ docker build æ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­æ‰§è¡Œ, æ¯å¤šä¸€ä¸ª<code>RUN</code>,image å°±ä¼šå¤šä¸€å±‚ layer</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> centos<br><span class="hljs-keyword">RUN</span><span class="language-bash"> yum install -y vim</span><br></code></pre></td></tr></table></figure><h4 id="workdir"><a class="markdownIt-Anchor" href="#workdir"></a> WORKDIR</h4><p>ç±»ä¼¼ linux ä¸­çš„ cd, å¯¹äºä¸å­˜åœ¨çš„ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»º, ä¸åŒäº image çš„ layer éƒ½æ˜¯æ–°å»ºçš„ä¸€å±‚, workdir åˆ›å»ºçš„ç›®å½•ä¼šä¸€ç›´å­˜åœ¨. <strong>ä½¿ç”¨ WORKDIR, ä¸è¦ä½¿ç”¨ RUN cd</strong> <strong>ä½¿ç”¨ç»å¯¹è·¯å¾„</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /test</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /foo</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">pwd</span></span><br><span class="hljs-comment"># æ­¤æ—¶ä¼šè¾“å‡º /test/foo</span><br></code></pre></td></tr></table></figure><h4 id="add-or-copy"><a class="markdownIt-Anchor" href="#add-or-copy"></a> ADD or COPY</h4><p>å°†ä¸Šä¸‹æ–‡ç›®å½•èµ„æºå¤åˆ¶åˆ°å®¹å™¨ä¸­çš„æŒ‡å®šä½ç½®, ADD å’Œ COPY çš„åŠŸèƒ½å·®ä¸å¤š, å®˜æ–¹æ¨èä½¿ç”¨ COPY. å› ä¸º ADD å¤åˆ¶å‹ç¼©æ–‡ä»¶æ—¶ä¼šåŒæ—¶å°†æ–‡ä»¶è§£å‹ç¼©.<br />å¯¹äºè¿œç¨‹èµ„æºè¿˜æ˜¯è¦ä½¿ç”¨ curl æˆ–è€… wget</p><h4 id="env"><a class="markdownIt-Anchor" href="#env"></a> ENV</h4><p>å®šä¹‰å¸¸é‡, æ¨èç»å¸¸ä½¿ç”¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> NODE_VERSION <span class="hljs-number">7.2</span>.<span class="hljs-number">0</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span><br><span class="language-bash">  &amp;&amp; curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span><br></code></pre></td></tr></table></figure><h4 id="cmd"><a class="markdownIt-Anchor" href="#cmd"></a> CMD</h4><p>å’Œ RUN æŒ‡ä»¤ç±»ä¼¼, RUN åœ¨ docker build æ—¶è¿è¡Œ, CMD åœ¨ docker run æ—¶è¿è¡Œ. <strong>ä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šé»˜è®¤è¦è¿è¡Œçš„ç¨‹åº</strong>, CMD æŒ‡ä»¤ä¼šè¢« docker run å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šçš„æŒ‡ä»¤æ‰€æ›¿æ¢, å¦‚æœ dockerfile ä¸­å­˜åœ¨å¤šæ¡ CMD æŒ‡ä»¤æ—¶, åªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œ</p><h4 id="entrypoint"><a class="markdownIt-Anchor" href="#entrypoint"></a> ENTRYPOINT</h4><p>å’Œ CMD ç±»ä¼¼, ä½†æ˜¯ä¸ä¼šè¢« docker run å‘½ä»¤è¡ŒæŒ‡å®šçš„æŒ‡ä»¤æ‰€æ›¿æ¢, è€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“æˆå‚æ•°ä¼ ç»™ ENTRYPOINT, å¦‚æœè¿è¡Œ docker run æ—¶ä½¿ç”¨äº†<code>--entrypoint</code>, å°†è¦†ç›– CMD æŒ‡ä»¤, å¦‚æœ dockerfile ä¸­å­˜åœ¨å¤šæ¡ ENTRYPOINT æŒ‡ä»¤, åªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œ</p><p>æ›´å¤šçš„æŒ‡ä»¤å‚è€ƒ<a href="https://docs.docker.com/engine/reference/builder/">å®˜ç½‘ dockerfile</a></p><h2 id="å‘å¸ƒ-image"><a class="markdownIt-Anchor" href="#å‘å¸ƒ-image"></a> å‘å¸ƒ image</h2><ol><li>é¦–å…ˆè¦åœ¨ docker hub ä¸Šæ³¨å†Œè´¦å·, æ³¨å†ŒæˆåŠŸåè®°ä½è‡ªå·±çš„ç”¨æˆ·å</li><li><code>docker login</code>å‘½ä»¤è¡Œä¸­ç™»å½•</li><li><code>docker tag [IMAGE NAME] ä½ çš„ç”¨æˆ·å/imageåç§°</code>: ç»™å½“å‰éœ€è¦ä¸Šä¼ çš„é•œåƒæ‰“ä¸Šæ ‡ç­¾, è¿™é‡Œå¿…é¡»ç”¨è‡ªå·±çš„ç”¨æˆ·åå¦åˆ™ä¼šæç¤º permission denied</li><li><code>docker images</code>å°±å¯ä»¥çœ‹åˆ°åä¸º<code>ä½ çš„ç”¨æˆ·å/imageåç§°</code>çš„é•œåƒäº†</li><li><code>docker push ä½ çš„ç”¨æˆ·å/imageåç§°</code>ä¸Šä¼ åˆ° docker hub</li></ol><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><p><a href="https://www.jianshu.com/p/7636ab2a29d6">å¯èƒ½æ˜¯æŠŠ docker å¥–çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç« äº†</a><br /><a href="https://juejin.cn/post/6844903815729119245#comment">30 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ Docker æ•™ç¨‹</a><br /><a href="https://www.zhihu.com/question/28300645">é€šä¿—ç†è§£ Docker æ˜¯ä»€ä¹ˆ</a><br /><a href="https://ithelp.ithome.com.tw/articles/10191139">Day6ï¼šæŠŠ Docker Image Push åˆ° Docker Hub</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠHTML5 Canvasæ ¸å¿ƒæŠ€æœ¯å›¾å½¢ã€åŠ¨ç”»ä¸æ¸¸æˆå¼€å‘ã€‹ç¬”è®°</title>
    <link href="/2021/06/01/2021-06-01-canvas-learning-note/"/>
    <url>/2021/06/01/2021-06-01-canvas-learning-note/</url>
    
    <content type="html"><![CDATA[<ul><li>Chapter1</li></ul><ol><li>é»˜è®¤æƒ…å†µä¸‹, canvas å…ƒç´ çš„èƒŒæ™¯è‰²ä¸å…¶çˆ¶å…ƒç´ çš„èƒŒæ™¯è‰²ä¸€è‡´.</li><li>é»˜è®¤ canvas å¤§å°æ˜¯ 300*150, åæ ‡å·¦ä¸Šè§’(0,0), å‘ x è½´æ­£æ–¹å‘, y è½´è´Ÿæ–¹å‘è¡ç”Ÿ(åæ ‡æ˜¯æ­£çš„), canvas å­˜åœ¨ä¸¤å¥—å°ºå¯¸, ä¸€ä¸ªæ˜¯å…ƒç´ æœ¬èº«çš„å¤§å°, ä¸€ä¸ªæ˜¯å…ƒç´ ç»˜å›¾åŒºåŸŸçš„å¤§å°, å¦‚æœæ˜¯ä¿®æ”¹ canvas çš„å±æ€§ width/heigth, åˆ™ä¸¤è€…éƒ½å‘ç”Ÿæ”¹å˜,; å¦‚æœæ˜¯ä¿®æ”¹ canvas çš„ css å±æ€§ width/height, åˆ™åªæœ‰å…ƒç´ æœ¬èº«å¤§å°å‘ç”Ÿæ”¹å˜, ç»˜å›¾åŒºåŸŸä»ç„¶ä¸º 300*150, è€Œä¸ºäº†é€‚åº”å…ƒç´ æœ¬èº«å¤§å°, ç»˜å›¾åŒºåŸŸä¼šè¿›è¡Œç­‰æ¯”ä¾‹çš„æ”¾å¤§/ç¼©æ”¾.</li><li>å¯ä»¥é€šè¿‡<code>document.getElementById</code>è·å– canvas å¼•ç”¨, canvas çš„å±æ€§ width, height(ä¸èƒ½åŠ  px), æ–¹æ³•: <code>getContext</code>è·å¾— canvas çš„ç»˜å›¾ç¯å¢ƒå˜é‡, <code>toDataUrl(type, quatity)</code>å’Œ<code>toBlob(type, quatity)</code>ç”¨äºç”Ÿæˆ base64 çš„ dataurl å’Œ canvas å›¾åƒæ–‡ä»¶çš„ bloburl, <code>type</code>é»˜è®¤ä¸º<code>image/png</code>, <code>quatity</code>è¡¨ç¤ºç”Ÿæˆå›¾ç‰‡çš„è´¨é‡, åŒºé—´ä¸º<code>0.0~1.0</code></li><li><code>CanvasRnderingContext2D.save()</code> å’Œ <code>CanvasRenderingContext2D.restore()</code></li><li>canvas ç»‘å®šé¼ æ ‡äº‹ä»¶, <code>canvas.addEventListener('mousedown', callback)</code>, äº‹ä»¶è¿”å›çš„åæ ‡æ˜¯ç›¸å¯¹æµè§ˆå™¨çª—å£, éœ€è¦è½¬æ¢æˆ canvas å†…éƒ¨åæ ‡. <code>canvas.width/bbox.width</code>ç”¨äºå¤„ç† canvas å°ºå¯¸å’Œç»˜å›¾å°ºå¯¸ä¸ä¸€è‡´æ—¶çš„è®¡ç®—.</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">windowToCanvas</span>(<span class="hljs-params">canvas, x, y</span>) &#123;<br>  <span class="hljs-keyword">const</span> bbox = canvas.<span class="hljs-title function_">getBoundingClientRect</span>();<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">x</span>: x - canvas.<span class="hljs-property">width</span> / bbox.<span class="hljs-property">width</span>,<br>    <span class="hljs-attr">y</span>: y - canvas.<span class="hljs-property">height</span> / canvas.<span class="hljs-property">height</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="6"><li>canvas æ˜¯ä¸€ä¸ª<strong>ä¸å¯è·å–ç„¦ç‚¹</strong>çš„æ ‡ç­¾, æ‰€ä»¥å¦‚æœè¦ç»‘å®šé”®ç›˜äº‹ä»¶, ç»‘å®šåœ¨ document æˆ– window ä¸Š</li><li>canvas å¯¹è±¡éƒ½æ˜¯ä½å›¾, åƒ<code>context.getImageData(canvas, 0,0)</code>è·å¾—çš„ä¹Ÿéƒ½æ˜¯ä½å›¾çš„ç‚¹é˜µæ•°ç»„æ•°æ®, ä¸èƒ½ç›´æ¥ç»™ img ä½¿ç”¨, éœ€è¦ä½¿ç”¨<code>canvas.toDataURL()</code>æˆ–<code>canvas.toBlob()</code></li><li>canvas è§’åº¦, ä»¥åŠ Math çš„ä¸‰è§’å‡½æ•°å‚æ•°éƒ½æ˜¯å¼§åº¦å•ä½</li></ol><ul><li>Chapter2</li></ul><ol><li>ç»˜åˆ¶ç®€å•çŸ©å½¢ <a href="https://codepen.io/healms/pen/poeweor">åœ¨çº¿æŸ¥çœ‹</a> <code>clearRect</code>æ¸…é™¤æŒ‡å®šåŒºåŸŸå†…ç»˜å›¾å†…å®¹, <code>strokeRect</code>å¯¹çŸ©å½¢æè¾¹, æ­é…<code>lineWidth</code>è¾¹è·å®½åº¦, <code>lineJoin</code>åœ†è§’ç­‰å±æ€§ç»˜åˆ¶, <code>strokeStyle</code>ç§’å˜é¢œè‰², <code>fillRect</code>å¡«å……çŸ©å½¢, <code>fillStyle</code>å¡«å……é¢œè‰², ä¸‰ä¸ªæ–¹æ³•å‚æ•°éƒ½æ˜¯<code>(æ¨ªåæ ‡, çºµåæ ‡, å®½, é«˜)</code></li><li>ä¸Šè¿°æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡<code>rect()</code>+<code>stroke()/fill()</code>å®ç°</li><li>é€šè¿‡<code>context.createRadiaGradient()</code>,<code>context.createLineGradient()</code>åˆ›å»ºæ¸å˜è‰², å¯ä»¥ä½œä¸ºé¢œè‰²èµ‹å€¼ç»™<code>fillStyle</code>ç­‰</li><li>canvas ä¹Ÿå¯ä»¥é€šè¿‡å›¾æ¡ˆè¿›è¡Œ stroke æè¾¹, è¿™é‡Œå›¢å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§: image å…ƒç´ , canvas å…ƒç´ , video å…ƒç´ . ä½¿ç”¨<code>context.createPattern(image, repeat)</code>, ç»˜åˆ¶å›¾ç‰‡èƒŒæ™¯<a href="https://codepen.io/healms/pen/GRWEGmM">åœ¨çº¿æŸ¥çœ‹</a></li><li>é˜´å½± <code>shadowColor</code>é¢œè‰²(é»˜è®¤#000000), <code>shadowOffsetX</code>x è½´åç§»é‡(é»˜è®¤ 0), <code>shadowOffsetY</code>y è½´åç§»é‡(é»˜è®¤ 0), <code>shadowBlur</code>é«˜æ–¯æ¨¡ç³Š(é»˜è®¤ 0.0, double å€¼)</li><li>canvas ç»˜åˆ¶çš„è·¯å¾„æ— è®ºæ˜¯å¼€æ”¾è¿˜æ˜¯é—­åˆçš„éƒ½æ˜¯å¯ä»¥è¿›è¡Œ fill å¡«å……çš„, å¼€æ”¾çš„è·¯å¾„æµè§ˆå™¨ä¼šé»˜è®¤å°†èµ·å§‹å’Œç»ˆç‚¹ç›¸è¿è¿›è¡Œå¡«å……, stroke åˆ™åªä¼šæè¾¹è·¯å¾„</li><li><code>beginPath()</code>å’Œ<code>closePath</code>, ä¸¤è€…å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³», <code>beginPath()</code>ç”¨äºé‡å¯ä¸€æ¡è·¯å¾„, å¦åˆ™ä¸€ç›´éƒ½æ˜¯æœ€å¼€å§‹çš„ä¸€æ¡è·¯å¾„, <code>closePath()</code>æ˜¯é—­åˆè·¯å¾„, å¹¶ä¸æ˜¯ç»“æŸè·¯å¾„! å‚è€ƒ<a href="https://blog.csdn.net/jearbilove/article/details/38340141">beginPath çš„é‡è¦æ€§</a></li><li><code>arc</code>ä¸ºåœ¨<strong>å½“å‰è·¯å¾„</strong>ä¸­å¢åŠ ä¸€æ®µè¡¨ç¤ºåœ†å¼§æˆ–è€…åœ†å½¢çš„å­è·¯å¾„, ä¸<code>rect</code>æ€»æ˜¯é€†æ—¶é’ˆç»˜åˆ¶ä¸åŒ, <code>arc</code>å¯ä»¥é€‰æ‹©ç»˜åˆ¶çš„æ–¹å‘(æœ€åä¸€ä¸ªå‚æ•° true é¡ºæ—¶é’ˆ, false é€†æ—¶é’ˆ), å¦‚æœç»˜åˆ¶æ—¶å­˜åœ¨å…¶ä»–çš„å­è·¯å¾„, ä¼šå°†å…¶ä»–å­è·¯å¾„çš„ç»“æŸå’Œ<code>arc</code>çš„å¼€å¤´è¿æ¥</li><li><code>fill(fillRule)</code>å¯ä»¥é€‰æ‹©å¡«å……è§„åˆ™, <code>nonzero(éé›¶ç¯ç»•åŸåˆ™)</code>å’Œ<code>evenodd(å¥‡å¶ç¯ç»•åŸåˆ™)</code>, é»˜è®¤å¡«å……éµå¾ª<strong>éé›¶ç¯ç»•åŸåˆ™</strong>. <a href="https://codesandbox.io/s/dreamy-faraday-tbd32">fill&amp;stroke</a> <a href="https://codesandbox.io/s/cool-lake-n3nvo">åœ¨çº¿æŸ¥çœ‹ fill è§„åˆ™</a></li><li>å¦‚æœéœ€è¦é€†æ—¶é’ˆçš„çŸ©å½¢å¯ä»¥ä½¿ç”¨<code>lineTo</code></li><li>1px lineWidth ç»˜åˆ¶æˆ 2px lineWidth é—®é¢˜</li><li><a href="https://codesandbox.io/s/quizzical-liskov-iklz5">æ©¡çš®ç­‹æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a> <a href="https://codesandbox.io/s/vigorous-banzai-5vjwm">ç”»åœ†æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a> é¼ æ ‡æ‹–åŠ¨è¿‡ç¨‹ä¸­ä¸€ç›´åšä¸‰ä»¶äº‹ 1. æ¢å¤ mousedown ç»˜åˆ¶è¡¨é¢ 2. æ›´æ–° rubberband 3. ç»˜åˆ¶èµ·ç‚¹åˆ°å½“å‰é¼ æ ‡çš„çº¿</li><li>è™šçº¿, <code>setLineDash([])</code>è®¾ç½®è™šçº¿, <code>lineDashOffset</code>å±æ€§è®¾ç½®è™šçº¿åç§»é‡, èš‚èšçº¿</li><li><code>lineCap</code>çº¿æ®µç«¯ç‚¹å¦‚ä½•ç»˜åˆ¶,(butt, round, squre), é»˜è®¤ butt; <code>lineJoin</code>çº¿æ®µè¿æ¥ç‚¹å¦‚ä½•ç»˜åˆ¶,(round, bevel, miter), é»˜è®¤ bevel, <code>miterLimit</code>, æ–œæ¥çº¿é•¿åº¦ä¸ 1/2 çº¿å®½çš„æ¯”å€¼, å¦‚æœæ–œæ¥çº¿é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼, å°±ä¼šä»¥ bevel ç»˜åˆ¶çº¿æ®µè¿æ¥ç‚¹</li><li><a href="https://codesandbox.io/s/peaceful-dawn-45rnp">ä»ªè¡¨ç›˜æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a></li><li>è´å¡å°”æ›²çº¿, <code>quadraticCurveTo(x1, y1, x2, y2)</code>äºŒæ¬¡è´å¡å°”æ›²çº¿å­˜åœ¨ä¸‰ä¸ªç‚¹, èµ·å§‹ç‚¹ D0, ç»ˆç‚¹ D2, ä»¥åŠæ§åˆ¶ç‚¹ D1, å‚æ•°ä¸º D1, D2, D0 å³ä½¿å½“å‰å­è·¯å¾„çš„ç»ˆç‚¹, å¸¸å¸¸æ˜¯<code>moveTo</code>çš„é‚£ä¸ªç‚¹, <code>bezierCurveTo(x1, y1, x2, y2, x3, y3)</code>ä¸‰æ¬¡è´å¡å°”æ›²çº¿, å‰ä¸¤ä¸ªæ˜¯æ§åˆ¶ç‚¹, æœ€åä¸€ä¸ªæ˜¯ç»ˆç‚¹</li><li><a href="https://codesandbox.io/s/sharp-cherry-do3tr">å¤šè¾¹å½¢æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a></li><li><a href="https://codesandbox.io/s/unruffled-darkness-8lpb9">å¤šè¾¹å½¢å¯æ‹–æ‹½æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a><br />æ‹–æ‹½å®ç°æ˜¯é€šè¿‡è®°å½•å½“å‰ç”»å¸ƒæ‰€æœ‰å¤šè¾¹å½¢æ•°æ®, å¹¶ä¸”è®¡ç®—æ‹–æ‹½çš„å¤šè¾¹å½¢æ•°æ®, æ¸…ç©ºç”»å¸ƒé‡æ–°ç»˜åˆ¶å®ç°, åˆ¤æ–­å½“å‰æ‹–æ‹½çš„å¤šè¾¹å½¢é€šè¿‡éå†æ‰€æœ‰å¤šè¾¹å½¢å¹¶é‡æ–°<code>beginPath</code>ç„¶åç»˜åˆ¶è·¯å¾„, å†é€šè¿‡<code>isPointInPath()</code>åˆ¤æ–­å½“å‰é¼ æ ‡åæ ‡æ˜¯å¦åœ¨è·¯å¾„ä¸­</li><li><a href="https://codesandbox.io/s/zealous-chebyshev-iz0ro">è´å¡å°”æ›²çº¿å¯æ‹–æ‹½æ¡ˆä¾‹åœ¨çº¿æ¼”ç¤º</a></li><li>å°†åæ ‡ç³»å¹³ç§»åˆ°ç»™å®š X,Y åæ ‡å¤„<code>translate(x, y)</code>, æŒ‰ç…§ç»™å®šè§’åº¦æ—‹è½¬åæ ‡ç³»<code>rotate(angleInRadians)</code>, åœ¨ X ä¸ Y æ–¹å‘ä¸Šåˆ†åˆ«æŒ‰ç…§ç»™å®šçš„æ•°å€¼ç¼©æ”¾åæ ‡ç³»<code>scale(x, y)</code>, éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œéƒ½æ˜¯å¯¹åæ ‡ç³»è¿›è¡Œå¤„ç†, <code>transform(sx, rx, ry, sx, tx, ty)</code>, å‚æ•°åŠé»˜è®¤å€¼ä¸º: æ°´å¹³ç¼©æ”¾(1), æ°´å¹³å€¾æ–œ(0), å‚ç›´å€¾æ–œ(0), å‚ç›´ç¼©æ”¾(1), æ°´å¹³ç§»åŠ¨(0), å‚ç›´ç§»åŠ¨(0). å¯ä»¥é€šè¿‡æ”¹å˜è¿™äº›å‚æ•°å®ç°ä¸Šè¿°ä¸‰ä¸ªå‡½æ•°, å¯¹äºäºŒç»´æ“ä½œ, çº¿æ€§ä»£æ•°ä¸­éƒ½å¯ä»¥é€šè¿‡<code>x' = ax+cy+e; y' = bx+dy+f;</code>è¡¨ç¤ºå˜åŒ–åçš„åæ ‡ <a href="https://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%e7%9f%a9%e9%98%b5/">å…·ä½“å‚è€ƒå¼ å¤§ç¥åšå®¢</a></li><li><code>scale(-1)</code> å‚æ•°å¦‚æœæ˜¯è´Ÿæ•°åˆ™æ˜¯ä¸­å¿ƒå¯¹ç§°åè¿›è¡Œç¼©æ”¾</li><li><code>transform</code>, <code>setTransform</code>å¯ä»¥å®ç°æ—‹è½¬å¹³ç§»ç¼©æ”¾ä¸èƒ½å®ç°çš„æ•ˆæœä¾‹å¦‚é”™åˆ‡, ç¼ºç‚¹æ˜¯ä¸å¤ªç›´è§‚.</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°</title>
    <link href="/2021/05/19/2021-05-19-Webpack-learning-note/"/>
    <url>/2021/05/19/2021-05-19-Webpack-learning-note/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å†…å·, å†…å·å®³äº†æ‰€æœ‰äºº</p></blockquote><p><strong>2021-06-06 updated</strong>: æ›´å¤šé…ç½®æ¡ˆä¾‹å¯ä»¥å‚è€ƒ<a href="https://github.com/webpack/webpack/tree/master/examples">å®˜æ–¹ä¾‹å­</a></p><p>å¯¹ webpack çš„é…ç½®åšä¸ªç¬”è®°,åç»­ä¸å®šæœŸè¡¥å……, ä¹Ÿä¼šè¡¥å……çš„ webpack æºç çš„å­¦ä¹ </p><h2 id="mode"><a class="markdownIt-Anchor" href="#mode"></a> mode</h2><p>mode åˆ†ä¸º<code>development</code>,<code>production</code>,<code>none</code>, ä¸é…ç½®é»˜è®¤ä¸º<code>production</code>, æ„å»ºæ—¶æŠ›å‡ºè­¦å‘Š âš ï¸</p><h2 id="performance"><a class="markdownIt-Anchor" href="#performance"></a> performance</h2><p>webpack ä¼šæŠ›å‡ºå¿…è¦çš„å½±å“æ€§èƒ½çš„è­¦å‘Š, å¯ä»¥é€šè¿‡ç½®ä¸º<code>false</code>å±è”½è­¦å‘Š</p><h2 id="entry"><a class="markdownIt-Anchor" href="#entry"></a> entry</h2><p>å¯ä»¥æ˜¯å•æ–‡ä»¶å…¥å£å’Œå¤šæ–‡ä»¶, æœ‰å¤šå°‘å…¥å£æ–‡ä»¶å°±ä¼šæ„å»ºå‡ºå¤šå°‘æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å•æ–‡ä»¶å…¥å£, æœªæŒ‡å®šnameæ—¶nameä¸ºmain</span><br><span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;/your/entry/file/path&quot;</span>,<br><span class="hljs-comment">// å¤šæ–‡ä»¶å…¥å£</span><br><span class="hljs-attr">entry</span>: &#123;<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;/your/entry/file/path1&quot;</span>,<br>  <span class="hljs-string">&quot;app&quot;</span>: <span class="hljs-string">&quot;/your/entry/file/path2&quot;</span>,<br>&#125;,<br><span class="hljs-comment">// æ•°ç»„å½¢å¼, ç›¸å½“äºåœ¨å…¥å£æ–‡ä»¶æœ€å‰é¢import @babel/polyfill, ç”¨äºå¼•å…¥ä¸€äº›å¿…è¦çš„åŒ…</span><br><span class="hljs-attr">entry</span>: [<span class="hljs-string">&quot;@babel/polyfill&quot;</span>, <span class="hljs-string">&quot;/your/entry/file/path&quot;</span>]<br></code></pre></td></tr></table></figure><h2 id="output"><a class="markdownIt-Anchor" href="#output"></a> output</h2><p><code>filename</code> ä¸­ name ä¸ºå…¥å£æ–‡ä»¶çš„<code>key</code>, å­—ç¬¦ä¸²å½¢å¼æ—¶ name ä¸º main, hash,chunkhash,contenthash åŒºåˆ«è§<a href="#hash,chunkhash,contenthash">hash, chunkhash, contenthash åŒºåˆ«</a><br /><code>chunkFilename</code>é’ˆå¯¹çš„æ˜¯é‚£äº›é—´æ¥å¼•å…¥çš„æ–‡ä»¶,å³é entry æŒ‡å®šçš„æ–‡ä»¶, å‘½åä»¥<code>chunkFilename</code>ä¸ºå‡†, <code>[name]</code>ä¸º<code>splitChunks</code>å½’ç±»çš„æ–‡ä»¶å,<br /><code>publicPath</code>html å¼•å…¥ output çš„ js æ˜¯çš„å‰ç¼€è·¯å¾„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].[hash:8].js&#x27;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/your/output/directory&#x27;</span>,<br>  <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&#x27;[name].chunk.js&#x27;</span>,<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/assets&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="loader"><a class="markdownIt-Anchor" href="#loader"></a> loader</h2><p>webpack é»˜è®¤åªæ”¯æŒè§£æ js å’Œ json æ–‡ä»¶, loader ç”¨äºè§£æä¸åŒåç¼€åçš„æ–‡ä»¶, å¯¹äºåŒä¸€ç§æ–‡ä»¶ç±»å‹ä½¿ç”¨å¤šä¸ª loader æ—¶éµä»ä»æ•°ç»„å³å‘å·¦è§£æåŸåˆ™, å†™åœ¨<code>module.rules</code>ä¸­, è¿™é‡Œçœ‹å‡ ä¸ªå¸¸ç”¨çš„ loader</p><h3 id="babel"><a class="markdownIt-Anchor" href="#babel"></a> babel</h3><p>ç”¨äºå°† ES6+æ–°è¯­æ³•è½¬åŒ–æˆ ES5 è¯­æ³•, éœ€è¦é…åˆ<code>@babel/preset-env</code>å’Œ<code>@babel/core</code>ä½¿ç”¨. å¯¹äº Promise, Map,Set ç­‰æ–°çš„ api è¿˜éœ€å®‰è£…<code>@babel/polyfill</code>, ç„¶ååœ¨å…¥å£æ–‡ä»¶å¼€å§‹å¼•å…¥, ä¹Ÿå¯ä»¥é€šè¿‡ entry æ•°ç»„å½¢å¼å¼•å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js(x)$/</span>,<br>  <span class="hljs-attr">use</span>: [<br>    &#123;<br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>      <span class="hljs-attr">options</span>: &#123;<br>        <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;@babel/preset-env&#x27;</span>]<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="css"><a class="markdownIt-Anchor" href="#css"></a> css</h3><p>ä¸€èˆ¬æ­é…è¿™äº› loader ä¸€èµ·ä½¿ç”¨,</p><ol><li><code>sass-loader</code>(optional)è§£æ sass æˆ css,ç›¸åº”çš„æœ‰(â€˜less-loaderâ€™, â€˜stylus-loaderâ€™),</li><li><code>postcss-loader</code>ä¸º css åŠ ä¸Šäº§å•†å‰ç¼€, å¢å¼ºå…¼å®¹æ€§,</li><li><code>css-loader</code>è§£æ css,</li><li>è¿˜æœ‰ä¸‰ä¸ªæ ¹æ®ç¯å¢ƒåŠæ¡†æ¶é€‰ä¸€ä¸ªä½¿ç”¨, <code>style-loader</code>å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨, å°† css é€šè¿‡<code>&lt;style&gt;</code>æ ‡ç­¾çš„æ–¹å¼å¼•å…¥ html, <code>vue-style-loader</code>è§£æ vue æ¨¡æ¿ä¸­çš„ css, <code>MiniCssExtractPlugin.loader</code>ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨, ä¼šå°† css æ–‡ä»¶å•ç‹¬æ‰“åŒ…,é˜²æ­¢ html æ–‡ä»¶è¿‡å¤§</li></ol><p><code>postcss-loader</code>éœ€è¦é…åˆ<code>autoprefixer</code>ä½¿ç”¨, åœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º<code>postcss.config.js</code>å¼•å…¥<code>autoprefixer</code>, åŒæ—¶åœ¨<code>package.json</code>æ·»åŠ <code>browserslist</code>å­—æ®µæŒ‡å®šè¦†ç›–çš„æµè§ˆå™¨, æ–°ç‰ˆæœ¬ä¸æ”¯æŒç›´æ¥å†…è”åœ¨ webpack.config.js ä¸­çš„å†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// postcss.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;autoprefixer&#x27;</span>)]<br>&#125;;<br><br><span class="hljs-comment">// package.json</span><br><span class="hljs-string">&quot;browserslist&quot;</span>: [<br>  <span class="hljs-string">&quot;defaults&quot;</span>,<br>  <span class="hljs-string">&quot;not ie &lt; 11&quot;</span>,<br>  <span class="hljs-string">&quot;last 2 versions&quot;</span>,<br>  <span class="hljs-string">&quot;&gt; 1%&quot;</span>,<br>  <span class="hljs-string">&quot;iOS 7&quot;</span>,<br>  <span class="hljs-string">&quot;last 3 iOS versions&quot;</span><br>]<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(s)?css$/</span>,<br>  <span class="hljs-attr">use</span>: [process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-title class_">MinCssExtractPlugin</span>.<span class="hljs-property">loader</span> : <span class="hljs-string">&#x27;style-loader&#x27;</span>, <span class="hljs-string">&#x27;css-loade&#x27;</span>, <span class="hljs-string">&#x27;postcss-loader&#x27;</span>, <span class="hljs-string">&#x27;sass-loader&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨ <code>MinCssExtractPlugin</code> éœ€è¦ä¸‹è½½æ’ä»¶å¹¶é…ç½®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mini-css-extract-plugin&quot;</span>);<br><br><span class="hljs-comment">// ...çœç•¥ä¸Šé¢çš„é…ç½®</span><br><span class="hljs-attr">plugin</span>: &#123;<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>(&#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].[hash].css&quot;</span>,<br>    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&quot;[id].css&quot;</span>,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å›¾ç‰‡å¤šåª’ä½“"><a class="markdownIt-Anchor" href="#å›¾ç‰‡å¤šåª’ä½“"></a> å›¾ç‰‡&amp;å¤šåª’ä½“</h3><p>ä½¿ç”¨<code>url-loader</code>å’Œ<code>file-loader</code>, ä¸¤ä¸ª loader åŒºåˆ«åœ¨äº<code>url-loader</code>åœ¨æ–‡ä»¶å¤§å°æœªè¶…è¿‡è®¾ç½®çš„é˜ˆå€¼æ—¶ä¼šå°†æ–‡ä»¶è½¬åŒ–æˆ base64 ç¼–ç , å¯ä»¥ä½¿ç”¨<code>url-loader</code>, è¶…è¿‡é˜ˆå€¼å†ä½¿ç”¨<code>file-loader</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(jpe?g|png|gif)$/i</span>,<br>  <span class="hljs-attr">use</span>: [<br>    &#123;<br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;url-loader&#x27;</span>,<br>      <span class="hljs-attr">options</span>: &#123;<br>        <span class="hljs-attr">limit</span>: <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>,<br>        <span class="hljs-attr">fallback</span>: &#123;<br>          <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;file-loader&#x27;</span>,<br>          <span class="hljs-attr">options</span>: &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;img/[name].[hash:8].[ext]&#x27;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="vue"><a class="markdownIt-Anchor" href="#vue"></a> vue</h3><p><code>vue-loader</code>ä¸“é—¨ç”¨äºå¤„ç† vue æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>;<br>  <span class="hljs-attr">use</span>: [<span class="hljs-string">&quot;vue-loader&quot;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="typescript"><a class="markdownIt-Anchor" href="#typescript"></a> typescript</h3><p><code>ts-loader</code>ä¸“é—¨ç”¨äºå¤„ç† typescript æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.tsx?$/</span>,<br>  <span class="hljs-attr">use</span>: [<span class="hljs-string">&#x27;ts-loader&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="optimization"><a class="markdownIt-Anchor" href="#optimization"></a> optimization</h2><p>è¿™ä¸ªå­—æ®µå¯ä»¥é…ç½®ä¸€ä¸ªå¯¹è±¡, è¿™é‡Œä»‹ç»å‡ ä¸ªé‡è¦å±æ€§(åç»­è¡¥å……)</p><h3 id="usedexports"><a class="markdownIt-Anchor" href="#usedexports"></a> usedExports</h3><p>å¼€å¯ tree shaking, å»é™¤æœªè¢« import çš„é€»è¾‘.<br />å¯¹äºä¾‹å¦‚.css è¿™ç±»æ–‡ä»¶, ä¸å­˜åœ¨å…·ä½“ import å†…å®¹, webpack é»˜è®¤ä¹Ÿä¼šæŠŠå®ƒ shake æ‰, éœ€è¦é…åˆ<code>package.json</code>é…ç½®çš„<code>sideEffects</code>ä½¿ç”¨, <code>sideEffects</code>ç»´æŠ¤ä¸€ä¸ªæ•°ç»„å‘Šè¯‰ webpack ä¸è¦å¯¹å…¶ä¸­çš„æ–‡ä»¶è¿›è¡Œ shake<br /><strong>åœ¨å¼€å‘ç¯å¢ƒä¸‹(mode: â€˜developmentâ€™)ä¸‹, å³ä½¿å¼€å¯äº† tree shaking</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-comment">// package.json</span><br>&#123;<br>  <span class="hljs-string">&quot;sideEffects&quot;</span>: [<span class="hljs-string">&quot;*.css&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="splitchunks"><a class="markdownIt-Anchor" href="#splitchunks"></a> splitChunks</h3><ul><li>type: <code>boolean</code></li></ul><p>å¼€å¯ code splitting ä»£ç åˆ†éš”, è®¾æƒ³ä»¥ä¸‹åœºæ™¯, æ–‡ä»¶ä¸­å¼•å…¥ lodash(å‡è®¾ 1MB), ä¸šåŠ¡é€»è¾‘(å‡è®¾ 1MB), å¦‚æœä¸è¿›è¡Œä»£ç åˆ†éš”, æ¯å›ä¸šåŠ¡é€»è¾‘å‘ç”Ÿæ”¹åŠ¨éƒ½ä¼šæ„å»ºå‡º 2MB çš„æ–‡ä»¶, ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½è¦è¯·æ±‚ 2MB, ä½†å®é™…ä¸Š lodash é€»è¾‘å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜, è¿™å°±äº§ç”Ÿäº†ä¸å¿…è¦çš„å¼€é”€, æ‰€ä»¥å¯ä»¥é€šè¿‡ä»£ç åˆ†éš”å°†æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ä¸ºä¸¤ä¸ªæ–‡ä»¶(åº“æ–‡ä»¶+ä¸šåŠ¡é€»è¾‘æ–‡ä»¶)<br /><em>tips:</em><br /><strong>é­”æ³•æ³¨é‡Š</strong>: å¼‚æ­¥ import æ˜¯å¯ä½¿ç”¨, å¯ä»¥è®¾å®š preload/prefetch, chunkname ç­‰é…ç½®, å‚è€ƒ<a href="https://medium.com/the-song-of-silence/%E4%BD%BF%E7%94%A8-webpack-%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2-%E5%92%8C-%E9%AD%94%E6%9C%AF%E6%B3%A8%E9%87%8A-%E6%8F%90%E5%8D%87%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD-f9e45aeb08c9">é­”æ³•æ³¨é‡Š</a></p><p>ä¸‹é¢ä»‹ç»ä¸€äº›é‡è¦å±æ€§(å¾…æ·»åŠ )</p><h4 id="chunks"><a class="markdownIt-Anchor" href="#chunks"></a> chunks</h4><ul><li>value: â€˜allâ€™ | â€˜asyncâ€™ | false<br /><code>all</code>å¯¹åŒæ­¥å¼‚æ­¥çš„ import éƒ½è¿›è¡Œä»£ç åˆ†éš”, <code>async</code>åˆ™åªå¯¹å¼‚æ­¥ import è¿›è¡Œä»£ç åˆ†éš”.<br />ä½†æ˜¯å¦‚æœ<code>cacheGroup</code>ç»„ä¸­æœªåŒ¹é…ä¸”<code>default</code>ä¸º<code>false</code>, åˆ™ <code>chunks</code>ä¸ä¼šå¯¹è¯¥æ–‡ä»¶è¿›è¡Œä»£ç åˆ†éš”</li></ul><h4 id="minsize"><a class="markdownIt-Anchor" href="#minsize"></a> minSize</h4><ul><li>value: number<br />è¿›è¡Œä»£ç åˆ†éš”çš„ import åŒ…å¤§å°, å•ä½ Kb</li></ul><h4 id="maxsize"><a class="markdownIt-Anchor" href="#maxsize"></a> maxSize</h4><ul><li>value: number<br />ä¸€èˆ¬ä¸é…, æ˜¯å¯¹ä»£ç åˆ†éš”çš„åŒ…è¿›è¡ŒäºŒæ¬¡æ‹†åˆ†çš„é˜ˆå€¼(å¦‚æœå¯ä»¥), å•ä½ Kb</li></ul><h4 id="minchunks"><a class="markdownIt-Anchor" href="#minchunks"></a> minChunks</h4><ul><li>value: number<br />æœ€å°å¼•å…¥æ¬¡æ•°, å³ å¦‚æœ lodash åˆ¶å¤‡å¼•å…¥äº†ä¸€æ¬¡åˆ™ä¸è¿›è¡Œä»£ç åˆ†éš”, 2 æ¬¡+å°±ä¼šè¿›è¡Œä»£ç åˆ†éš”</li></ul><h4 id="maxasyncrequest"><a class="markdownIt-Anchor" href="#maxasyncrequest"></a> maxAsyncRequest</h4><ul><li>value: number<br />ä¸€èˆ¬ä¹Ÿä¸é…, æœ€å¤šå¯¹ X ä¸ª import åŒ…è¿›è¡Œä»£ç åˆ†éš”, å‡è®¾å¼•å…¥äº† 10 ä¸ªåŒ…, åªä¼šå¯¹å‰ 5 ä¸ªåŒ…è¿›è¡Œä»£ç åˆ†éš”</li></ul><h4 id="automaticnamedelimiter"><a class="markdownIt-Anchor" href="#automaticnamedelimiter"></a> automaticNameDelimiter</h4><ul><li>value: string<br /><strong>å½“æœªæŒ‡å®š<code>cacheGroup</code>ç»„ä¸­<code>filename</code>æ—¶</strong>ä½œä¸ºä»£ç åˆ†éš”ç”Ÿæˆæ–‡ä»¶åä¸­é—´çš„è¿æ¥ç¬¦, æ–‡ä»¶åå‘½åè§„èŒƒä¸º<code>$&#123;cacheGroupsåŒ¹é…ç»„çš„key(æœªåŒ¹é…é»˜è®¤ä¸ºdefault)&#125;$&#123;automaticNameDelimiterè¿æ¥ç¬¦(é»˜è®¤ä¸º~)&#125;$&#123;å½“å‰æ–‡ä»¶æ‰€åœ¨entryçš„key&#125;.js</code>(ç–‘æƒ‘: å¦‚æœç›¸åŒçš„åº“è¢«ä¸åŒ entry å¼•ç”¨?)</li></ul><h4 id="cachegroup"><a class="markdownIt-Anchor" href="#cachegroup"></a> cacheGroup</h4><p><code>cacheGroup</code>çš„æ¯ä¸€ä¸ªå±æ€§éƒ½ä½œä¸ºä¸€ä¸ªç»„, å¯¹äºæ¯ä¸ªç»„ä¸­<code>test</code>åŒ¹é…åˆ°ç›¸åŒæ­£åˆ™çš„ import åŒ…ä¼šæ‰“åŒ…åˆ°ç›¸åŒçš„ç»„.<br />å¯¹äºæ²¡æœ‰åŒ¹é…åˆ°çš„åŒ…, é»˜è®¤å…œåº•åˆ° default ç»„ä¸­, ä¸é…ç½®<code>cacheGroup</code>æ—¶é»˜è®¤ä¼šå­˜åœ¨ä¸€ä¸ªåŒ¹é… node_modules çš„ <code>vendors</code> ç»„.<br /><code>reuseExistingChunk</code>åˆ™æ˜¯é…ç½®æ˜¯å¦æœç”¨ä¹‹å‰å·²ç»ç¼“å­˜çš„ç›¸åŒåŒ…å†…å®¹.<br />å¯¹äºåŒ¹é…åˆ°å¤šä¸ªç»„çš„åŒ…, ä¼šæ ¹æ® <code>priority</code>ä¼˜å…ˆçº§å¤§å°åˆ†åˆ°ä¼˜å…ˆçº§æœ€é«˜çš„ç»„.<br /><strong>éœ€è¦æ³¨æ„çš„æ˜¯, cacheGroups ä¸­é…ç½®çš„å­—æ®µä¼˜å…ˆçº§å¤§äºå¤–å±‚ splitChunks ç›¸åŒå­—æ®µçš„å€¼~</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">cacheGroups</span>: &#123;<br>  <span class="hljs-attr">defaultVendors</span>: &#123;<br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,<br>    <span class="hljs-attr">priority</span>: -<span class="hljs-number">10</span>,<br>    <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;vendors.js&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">default</span>: &#123;<br>    <span class="hljs-attr">priority</span>: -<span class="hljs-number">20</span>,<br>    <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;common.js&#x27;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="resolve"><a class="markdownIt-Anchor" href="#resolve"></a> resolve</h2><h3 id="alias"><a class="markdownIt-Anchor" href="#alias"></a> alias</h3><p>import from è·¯å¾„çš„åˆ«å, ä¾‹å¦‚<code>import Cmp from '@/components/home.vue</code>ä¼šè¢«è§£æä¸º<code>import Cmp from '/your/project/root/path/src/components/home.vue</code>.<br />å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº† typescript, è¦ä½¿ç”¨ alias åˆ«å, éœ€è¦åŒæ—¶åœ¨<code>webpacké…ç½®æ–‡ä»¶</code>å’Œ<code>tsconfig.json</code>é…ç½®åˆ«å, æ—¨åœ¨<code>tsconfig.json</code>é…ç½®æ˜¯ä¸ç”Ÿæ•ˆçš„.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">alias</span>: &#123;<br>  <span class="hljs-attr">vue$</span>: <span class="hljs-string">&#x27;vue/dist/vue.runtime.esm.js&#x27;</span>,<br>  <span class="hljs-string">&#x27;@&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;../src&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="extensions"><a class="markdownIt-Anchor" href="#extensions"></a> extensions</h3><p>ç¼ºçœåç¼€, import from è·¯å¾„ç¼ºå°‘åç¼€æ—¶, webpack ä¼šåœ¨è¯¥ç›®å½•ä¸‹ä»å·¦å‘å³å¯»æ‰¾ç¬¦åˆçš„æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;.js&#x27;</span>, <span class="hljs-string">&#x27;.json&#x27;</span>, <span class="hljs-string">&#x27;.vue&#x27;</span>],<br></code></pre></td></tr></table></figure><h3 id="mainfiles"><a class="markdownIt-Anchor" href="#mainfiles"></a> mainFiles</h3><p>ç¼ºçœæ–‡ä»¶å, è¿™å›æ–‡ä»¶éƒ½ä¸ç”¨å†™äº†â€¦ import from è·¯å¾„æœ€åä¸€çº§ä¸ºç›®å½•æ—¶, webpack ä¼šå¯»æ‰¾ç›®å½•ä¸‹å’Œ <code>mainFiles</code>åŒ¹é…çš„æ–‡ä»¶å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">mainFiles</span>: [<span class="hljs-string">&quot;index&quot;</span>, <span class="hljs-string">&quot;main&quot;</span>];<br></code></pre></td></tr></table></figure><h3 id="devserver"><a class="markdownIt-Anchor" href="#devserver"></a> devServer</h3><p>æš‚æ—¶ç”¨çš„ä¸å¤š, å¯ä»¥å‚è€ƒ<a href="https://webpack.docschina.org/configuration/dev-server/#devservercontentbase">webpack å¼€å‘æœåŠ¡å™¨ devServer</a></p><h2 id="plugin"><a class="markdownIt-Anchor" href="#plugin"></a> Plugin</h2><h3 id="htmlwebpackplugin"><a class="markdownIt-Anchor" href="#htmlwebpackplugin"></a> HtmlWebpackPlugin</h3><p>å…¥å£æ–‡ä»¶è¦æŒ‚è½½çš„ html è·¯å¾„, é…ç½®<code>new HtmlWebpackPlugin</code>é»˜è®¤ä¼šå°† entry æ‰€æœ‰å…¥å£æ–‡ä»¶éƒ½å¼•å…¥ html, ç”Ÿæˆå•é¡µé¢, å¦‚æœè¦ç”Ÿæˆå¤šé¡µé¢åªéœ€é…ç½®å¤šä¸ª<code>new HtmlWebpackPlugin</code>å¹¶ä¸”é…ç½®å¯¹åº”çš„ chunk å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ...çœç•¥å…¶ä»–é…ç½®</span><br>[<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>    <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;/your/template/html/file/path&quot;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;index.html&quot;</span>,<br>    <span class="hljs-comment">// å¿½ç•¥æ­¤é¡¹åˆ™å…¨éƒ¨å¼•å…¥</span><br>    <span class="hljs-attr">chunks</span>: [<span class="hljs-string">&quot;app&quot;</span>],<br>  &#125;),<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>    <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;your/template/html/file/path&quot;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;main.html&quot;</span>,<br>    <span class="hljs-attr">chunks</span>: [<span class="hljs-string">&quot;main&quot;</span>],<br>  &#125;),<br>];<br></code></pre></td></tr></table></figure><h3 id="cleanwebpackplugin"><a class="markdownIt-Anchor" href="#cleanwebpackplugin"></a> CleanWebpackPlugin</h3><p>æ¯æ¬¡æ„å»ºæ—¶å…ˆæ¸…ç©º output ç›®å½•ä¸Šæ¬¡æ„å»ºçš„äº§ç‰©, ä¿è¯ output ç›®å½•æ„å»ºäº§ç‰©éƒ½æ˜¯æœ€æ–°çš„<br /><code>const &#123;CleanWebpackPlugin&#125; = require('clean-webpack-plugin')</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>();<br></code></pre></td></tr></table></figure><h3 id="minicssextractplugin"><a class="markdownIt-Anchor" href="#minicssextractplugin"></a> MiniCssExtractPlugin</h3><p>ä¸Šé¢å·²ç»æè¿°è¿‡äº†, ç”¨äºç”Ÿäº§ç¯å¢ƒä¸‹å‰¥ç¦» css æ–‡ä»¶, é™ä½è€¦åˆ<br /><code>const MiniCssExtractPlugin = require('mini-css-extract-plugin')</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>(&#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].[hash].css&quot;</span>, <span class="hljs-comment">// æœ‰æŒ‡å®šentryçš„outputæ–‡ä»¶å</span><br>  <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&quot;[id].css&quot;</span>, <span class="hljs-comment">// æœªæŒ‡å®šentryçš„outputæ–‡ä»¶å</span><br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="vueloaderplugin"><a class="markdownIt-Anchor" href="#vueloaderplugin"></a> VueLoaderPlugin</h3><p><code>const &#123;VueLoaderPlugin&#125; = require('vue-loader')</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>();<br></code></pre></td></tr></table></figure><h3 id="hotmodulereplacementplugin"><a class="markdownIt-Anchor" href="#hotmodulereplacementplugin"></a> HotModuleReplacementPlugin</h3><p>å†…ç½®æ’ä»¶, çƒ­æ›´æ–°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>();<br></code></pre></td></tr></table></figure><h3 id="provideplugin"><a class="markdownIt-Anchor" href="#provideplugin"></a> ProvidePlugin</h3><p>å½“åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨äº†æ’ä»¶ä¸­é…ç½®çš„åº“æˆ–è€…åº“å‡½æ•°æ—¶, webpack ä¼šè‡ªåŠ¨å¼•å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">ProvidePlugin</span>(&#123;<br>  <span class="hljs-comment">// è‡ªåŠ¨å¼•å…¥jquery</span><br>  <span class="hljs-attr">$</span>: <span class="hljs-string">&quot;jquery&quot;</span>,<br>  <span class="hljs-comment">// è‡ªåŠ¨å¼•å…¥lodashåº“ä¸­joinæ–¹æ³•</span><br>  <span class="hljs-attr">_join</span>: [<span class="hljs-string">&quot;lodash&quot;</span>, <span class="hljs-string">&quot;join&quot;</span>],<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="dllreferenceplugin-dllpluginå·²è¢«-vue-å’Œ-react-åºŸå¼ƒ"><a class="markdownIt-Anchor" href="#dllreferenceplugin-dllpluginå·²è¢«-vue-å’Œ-react-åºŸå¼ƒ"></a> DllReferencePlugin &amp; DllPlugin(å·²è¢« vue å’Œ react åºŸå¼ƒ)</h3><p><strong>è™½ç„¶è¢«åºŸå¼ƒäº†, ä½†è¿˜æ˜¯å†™ä¸€ä¸‹ orz, æ¨èä½¿ç”¨ HardSourceWebpackPlugin</strong></p><p>ä¸Šé¢è¯´åˆ° code splitting å¯ä»¥é€šè¿‡<code>splitChunks</code>å®ç°, ä½†å¯¹äºåº“æ–‡ä»¶, å¤§éƒ¨åˆ†æ—¶å€™æ˜¯ ä¸ä¼šæ›´æ”¹çš„, è€Œ webpack æ¯æ¬¡æ‰“åŒ…æ—¶éƒ½ä¼šæ ¹æ®<code>splitChunks</code>é…ç½®æ‰“åŒ…åº“æ–‡ä»¶, è¿™å…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„, æ‰€ä»¥å¯ä»¥å•ç‹¬é…ç½®<code>webpack.dll.js</code>æ–‡ä»¶, ç”¨äºæ‰“åŒ…åº“æ–‡ä»¶, è¿™æ ·ç¬¬ä¸€æ¬¡æ‰“åŒ…ååç»­æ‰“åŒ…å°±ä¸ä¼šå†æ¬¡æ‰“åŒ…åº“æ–‡ä»¶äº†</p><p><strong>DllPlugin ä½œç”¨äº dll æ–‡ä»¶</strong>, ç”¨äºç”Ÿæˆ manifest æ–‡ä»¶ä½œä¸ºæ‰“åŒ…å‰ååº“æ–‡ä»¶çš„æ˜ å°„, åç»­æ‰“åŒ…æ—¶ webpack æ£€æµ‹<br /><code>webpack.dll.js</code>å…¶å®å°±æ˜¯ä¸€ä¸ª webpack é…ç½®æ–‡ä»¶, åªä¸è¿‡é’ˆå¯¹çš„å¯¹è±¡ä¸åŒ. è¿™é‡Œç»™å‡ºä¸€ä¸ª<code>webpack.dll.js</code>çš„é…ç½® demo.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;production&quot;</span>,<br>  <span class="hljs-comment">// entryä¸ºéœ€è¦æ‰“åŒ…çš„åº“æ–‡ä»¶å</span><br>  <span class="hljs-attr">entry</span>: [<span class="hljs-string">&quot;react&quot;</span>, <span class="hljs-string">&quot;react-dom&quot;</span>, <span class="hljs-string">&quot;lodash&quot;</span>],<br>  <span class="hljs-comment">// outputçš„libraryæ˜¯æ‰“åŒ…ååº“çš„åç§°</span><br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].dll.js&quot;</span>,<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./dll&quot;</span>),<br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&quot;[name]&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DllPlugin</span>(&#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;[name].manifest.json&quot;</span>,<br>      <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./dll&quot;</span>),<br>    &#125;),<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>DllReferencePlugin ä½œç”¨äº webpack.config.js</strong>, é€šè¿‡æ¯”å¯¹ manifest.json æ˜ å°„æ–‡ä»¶ä¸è¿›è¡Œæ‰“åŒ…å‘½ä¸­çš„åº“æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DllReferencePlugin</span>(&#123;<br>  <span class="hljs-comment">// ä¼ å…¥æ˜ å°„æ–‡ä»¶</span><br>  <span class="hljs-attr">manifest</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../dll/vendors.manifest.json&quot;</span>),<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="addassethtmlwebpackplugin"><a class="markdownIt-Anchor" href="#addassethtmlwebpackplugin"></a> AddAssetHtmlWebpackPlugin</h3><p>å°†èµ„æºæ–‡ä»¶æ’å…¥ html ä¸­, ä½œç”¨äº<code>HtmlWebpackPlugin</code>ä¹‹å, ä¸Šé¢è¯´çš„ dll æ‰“åŒ…çš„åº“æ–‡ä»¶å°±å¯ä»¥è¿™æ ·å¼•å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">AddAssetHtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">filepath</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../bundle.dll.js&quot;</span>),<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="scriptexthtmlwebpackplugin"><a class="markdownIt-Anchor" href="#scriptexthtmlwebpackplugin"></a> ScriptExtHtmlWebpackPlugin</h3><p><strong>ä¸æ”¯æŒ webpack5</strong>, é…åˆ<code>html-webpack-plugin</code>ä½¿ç”¨, æ”¯æŒå¼‚æ­¥åŠ è½½ JavaScript æ–‡ä»¶</p><h2 id="webpack-æ‰“åŒ…-npm-åŒ…"><a class="markdownIt-Anchor" href="#webpack-æ‰“åŒ…-npm-åŒ…"></a> webpack æ‰“åŒ… npm åŒ…</h2><p>webpack æ‰“åŒ…åº“æ–‡ä»¶éœ€è¦åœ¨<code>output</code>é¢å¤–åŠ ä¸Š<code>library</code>å’Œ<code>libraryTarget</code>å±æ€§, å¹¶ä¸”å°†<code>package.json</code>çš„<code>main</code>å…¥å£æ–‡ä»¶ä¿®æ”¹ä¸º webpack è¾“å‡ºçš„<code>output</code>fileanem æ–‡ä»¶<br />ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„ npm åŒ…çš„ webpack é…ç½®, æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p><ol><li><code>libraryTarget</code>è¡¨ç¤ºä½¿ç”¨çš„åœºæ™¯, <code>umd</code>è¡¨ç¤ºé€šç”¨ç‰ˆæœ¬, å¯ä»¥ <code>import(esmodule)</code> å¼•å…¥, å¯ä»¥ <code>require(CommonJS)</code> å¼•å…¥, ä¹Ÿå¯ä»¥é€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾å¼•å…¥</li><li>å¦‚æœè¦ç›´æ¥åœ¨ html ä¸­é€šè¿‡ script å¼•å…¥éœ€è¦æŒ‡å®š<code>library</code>, æ¯”å¦‚ç¤ºä¾‹ä¸­æŒ‡å®š<code>library: 'library'</code>, webpack å°±ä¼šå°† export å†…å®¹ç»‘å®šåˆ°<code>window.library</code>ä¸Š</li><li>å¦‚æœ npm åŒ…ä¸­ä½¿ç”¨äº†å…¶ä»–çš„åº“,æ¯”å¦‚ lodash, ä¸šåŠ¡åœºæ™¯ä¸­ä¹Ÿä½¿ç”¨äº† lodash, å°±ä¼šæ‰“åŒ…å‡ºä¸¤ä»½ lodash, è¿™ä¸åˆç†, å¯ä»¥æŒ‡å®š<code>externals</code>ä¸è®© webpck æ‰“åŒ… npm åŒ…æ—¶æ‰“åŒ… lodash</li><li>åœ¨ node ä¸­å¯¼å…¥æ—¶å¯èƒ½ä¼šé‡åˆ°<code>self is not defined</code>æŠ¥é”™, éœ€è¦è®¾ç½®<code>globalObject</code>å±æ€§</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;production&quot;</span>,<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./src/index.js&quot;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./dist&quot;</span>),<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;library.js&quot;</span>,<br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&quot;library&quot;</span>,<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&quot;umd&quot;</span>,<br>    <span class="hljs-attr">globalObject</span>: <span class="hljs-string">&quot;this&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">externals</span>: [<span class="hljs-string">&quot;lodash&quot;</span>],<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="common-development-production"><a class="markdownIt-Anchor" href="#common-development-production"></a> common development production</h2><p>å¯ä»¥æ–°å»º<code>webpack.dev.js</code>å’Œ<code>webpack.prod.js</code>åˆ†åˆ«å­˜å‚¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®, æœ€åé€šè¿‡<code>webpack.common.js</code>å­˜å‚¨é€šç”¨é…ç½®å¹¶ä¸”é€šè¿‡åˆ¤æ–­å½“å‰ç¯å¢ƒè¾“å‡ºæœ€ç»ˆé…ç½®.<br />webpack é™¤äº†å¯ä»¥è¾“å‡ºå¯¹è±¡, ä¹Ÿå¯ä»¥è¾“å‡ºå‡½æ•°, å‚æ•°ä¸ºç¯å¢ƒå˜é‡, å‡½æ•°è¿”å›é…ç½®å¯¹è±¡<br /><a href="https://webpack.docschina.org/api/cli/#env">env åŠ¨æ€é…ç½®ç¯å¢ƒ</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-merge&quot;</span>);<br><span class="hljs-comment">// çœç•¥å…¶ä»–é…ç½®</span><br><span class="hljs-comment">// webpack --env.production --config webpack.config.js</span><br><span class="hljs-comment">// æ­¤æ—¶envå°±å­˜åœ¨productionå±æ€§, ä¹Ÿå¯ä»¥æŒ‡å®šproductionçš„å€¼(--env production=xxx)</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (env &amp;&amp; env.<span class="hljs-property">production</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonCfg, prodCfg);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonCfg, devCfg);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="hashchunkhashcontenthash"><a class="markdownIt-Anchor" href="#hashchunkhashcontenthash"></a> hash,chunkhash,contenthash</h2><p><code>hash</code>è¡¨ç¤ºæ•´ä¸ªæ„å»ºäº§ç‰©çš„ hash å€¼, å¤šæ–‡ä»¶å…¥å£ä¸­å³ä½¿åªä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶, å¦ä¸€ä¸ªæ–‡ä»¶æœªä½œä¿®æ”¹, hash å€¼ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜, å¤šæ–‡ä»¶æ„å»ºäº§ç‰©çš„ hash å€¼éƒ½æ˜¯ä¸€æ ·çš„</p><p><code>chunkhash</code>é¡¾åæ€ä¹‰,è¡¨ç¤ºå—çš„ hash å€¼,å³å•ç‹¬å…¥å£æ–‡ä»¶æ„å»ºäº§ç‰© hash å€¼, äº’ç›¸ä¸å½±å“, ä½†æ˜¯å¦‚æœä¸€ä¸ª js æ–‡ä»¶ä¸­å¼•å…¥äº† css æ–‡ä»¶, å½“ css æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶, è¯¥ js æ–‡ä»¶çš„ hash å€¼ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜, å¤šæ–‡ä»¶æ„å»ºäº§ç‰©çš„ hash å€¼ä¸å½±å“</p><p><code>contenthash</code>åˆ™æ˜¯åœ¨<code>chunkhash</code>çš„åŸºç¡€ä¸Šå¿½ç•¥æ–‡ä»¶ä¸­å¼•å…¥ css æ–‡ä»¶äº§ç”Ÿçš„å˜åŒ–, ä»…åœ¨è‡ªèº«å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶æ”¹å˜ hash å€¼<br />è¯¦æƒ…å‚è€ƒ<a href="https://segmentfault.com/a/1190000020104777">segmentfault</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="æ¨èé˜…è¯»"><a class="markdownIt-Anchor" href="#æ¨èé˜…è¯»"></a> æ¨èé˜…è¯»</h2><h3 id="webpack-4-å’Œå•é¡µåº”ç”¨å…¥é—¨"><a class="markdownIt-Anchor" href="#webpack-4-å’Œå•é¡µåº”ç”¨å…¥é—¨"></a> <a href="https://github.com/wallstreetcn/webpack-and-spa-guide">Webpack 4 å’Œå•é¡µåº”ç”¨å…¥é—¨</a></h3><h3 id="æ‰‹æ‘¸æ‰‹å¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨-webpack4ä¸Š"><a class="markdownIt-Anchor" href="#æ‰‹æ‘¸æ‰‹å¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨-webpack4ä¸Š"></a> <a href="https://segmentfault.com/a/1190000015919863">æ‰‹æ‘¸æ‰‹ï¼Œå¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨ webpack4ï¼ˆä¸Šï¼‰</a></h3><h3 id="æ‰‹æ‘¸æ‰‹å¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨-webpack4ä¸‹"><a class="markdownIt-Anchor" href="#æ‰‹æ‘¸æ‰‹å¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨-webpack4ä¸‹"></a> <a href="https://juejin.cn/post/6844903661441646605">æ‰‹æ‘¸æ‰‹ï¼Œå¸¦ä½ ç”¨åˆç†çš„å§¿åŠ¿ä½¿ç”¨ webpack4ï¼ˆä¸‹ï¼‰</a></h3><h3 id="ä½ çš„-tree-shaking-å¹¶æ²¡ä»€ä¹ˆåµç”¨"><a class="markdownIt-Anchor" href="#ä½ çš„-tree-shaking-å¹¶æ²¡ä»€ä¹ˆåµç”¨"></a> <a href="https://zhuanlan.zhihu.com/p/32831172">ä½ çš„ Tree-Shaking å¹¶æ²¡ä»€ä¹ˆåµç”¨</a></h3>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è´­ä¹°åŸŸååŠæœ¬åœ°è°ƒè¯•åšå®¢</title>
    <link href="/2020/03/24/2020-03-24-buy-domain/"/>
    <url>/2020/03/24/2020-03-24-buy-domain/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>äº‹æƒ…å¤§æ¦‚æ˜¯è¿™æ ·, åšæ¯•è®¾éœ€è¦ç”¨åˆ°å›¾åºŠ, äºæ˜¯ç”¨äº†ä¸ƒç‰›äº‘å›¾åºŠ, ç„¶åå‘ç°å¯ä»¥è‡ªå®šä¹‰çš„åŠ é€ŸåŸŸå, äºæ˜¯å°±æ‰“ç®—æ•´ä¸ªåŸŸåç©ç©. ç„¶åå‘ç°ä¸èƒ½å¤‡æ¡ˆ, å†ç„¶å emmm å†³å®šæ›²çº¿æ•‘å›½ç»™åšå®¢å®‰ä¸ªåŸŸå.</p><h1 id="ç»‘å®šåŸŸå"><a class="markdownIt-Anchor" href="#ç»‘å®šåŸŸå"></a> ç»‘å®šåŸŸå</h1><h2 id="è´­ä¹°åŸŸå"><a class="markdownIt-Anchor" href="#è´­ä¹°åŸŸå"></a> è´­ä¹°åŸŸå</h2><p>æˆ‘æ˜¯åœ¨é˜¿é‡Œäº‘çš„ä¸‡ç½‘ä¸Šè´­ä¹°çš„,æœç´¢è‡ªå·±å–œæ¬¢çš„åŸŸå,ç‚¹å‡»ç»“ç®—.<br /><img src="/img/2020-03-24-buy-domain/buy-domain-process1.png" alt="ç»“ç®—" /><br />å¦‚æœæ˜¯åˆæ¬¡è´­ä¹°éœ€è¦å¡«å†™ä¸€ä¸‹é»˜è®¤çš„ä¸ªäººä¿¡æ¯æ¨¡æ¿,å¤§æ¦‚è¿‡åŠå¤©é˜¿é‡Œä¼šå®¡æ ¸å®Œæˆ,æˆ‘è¿™é‡Œå·²ç»å®¡æ ¸å®Œæˆé€šè¿‡äº†.<br /><img src="/img/2020-03-24-buy-domain/buy-domain-process2.png" alt="æ¨¡æ¿" /></p><h2 id="åŸŸåè§£æ"><a class="markdownIt-Anchor" href="#åŸŸåè§£æ"></a> åŸŸåè§£æ</h2><p>ä¹°å®ŒåŸŸååå°±è¦æŠŠåŸŸåæ˜ å°„åˆ°åšå®¢çš„åŸŸå,æˆ‘è¿™é‡Œæ˜¯æ˜ å°„åˆ° <a href="http://mariana-yui.github.io">mariana-yui.github.io</a><br />ç‚¹å‡»è§£æ<br /><img src="/img/2020-03-24-buy-domain/buy-domain-process3.png" alt="è§£æ" /><br />ç‚¹å‡»æ·»åŠ è®°å½•, è®°å½•ç±»å‹é€‰æ‹© CNAME(åŸŸåæ˜ å°„åŸŸå), ç„¶åè¾“å…¥è‡ªå®šä¹‰äºŒçº§åŸŸå, è®°å½•å€¼è¾“å…¥æŒ‡å‘çš„åšå®¢åŸŸå, ç‚¹å‡»ç¡®å®š.<br /><img src="/img/2020-03-24-buy-domain/buy-domain-process4.png" alt="è®°å½•" /></p><h2 id="åšå®¢é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#åšå®¢é…ç½®æ–‡ä»¶"></a> åšå®¢é…ç½®æ–‡ä»¶</h2><p>åŸŸåæ˜ å°„è¿˜æ²¡å®Œ, è¿˜éœ€è¦åœ¨ <a href="http://mariana-yui.github.io">mariana-yui.github.io</a> æ–°å»º<code>CNAME</code>é…ç½®æ–‡ä»¶, æ·»åŠ åŸŸå <code>blog.mariana.fun</code></p><p><img src="/img/2020-03-24-buy-domain/buy-domain-process5.png" alt="é…ç½®" /></p><p>ç„¶ååœ¨ <code>Setting</code> ä¸­çœ‹åˆ° <code>GitHub Pages</code> å¦‚å›¾è¯´æ˜æˆåŠŸäº†.</p><p><img src="/img/2020-03-24-buy-domain/buy-domain-process6.png" alt="git pages" /></p><p>å¤§æ¦‚è¿˜éœ€è¦è¿‡ä¸ª 10 æ¥åˆ†é’Ÿå°±èƒ½é€šè¿‡è‡ªå®šä¹‰çš„åŸŸåæ¥è®¿é—®åšå®¢äº†~</p><p><img src="/img/2020-03-24-buy-domain/buy-domain-process7.png" alt="blog" /></p><h1 id="æœ¬åœ°æŸ¥çœ‹åšå®¢"><a class="markdownIt-Anchor" href="#æœ¬åœ°æŸ¥çœ‹åšå®¢"></a> æœ¬åœ°æŸ¥çœ‹åšå®¢</h1><p>æ›¾ç»ä¹Ÿæ˜¯æœ¬åœ°æ”¹æ”¹ push ä¸Šå»çœ‹æ•ˆæœä¸æ–­ loop, ç°åœ¨çœ‹çœ‹çœŸæ˜¯ nt è¡Œä¸º(ç¬‘)<br />åšå®¢æ˜¯<code>Ruby</code>ç³»<code>jekyll</code>æ­å»ºçš„, æ‰€ä»¥ä»¥ä¸‹æ“ä½œé€‚ç”¨äº(<strong>linux ç³»ç»Ÿ</strong>)<code>jekyll</code>:</p><ol><li>å®‰è£… ruby ä¾èµ–: <code>sudo apt install ruby-full ruby-bundler</code></li><li>å®‰è£… jekyll, å®‰è£…æ—¶é—´å¯èƒ½æ¯”è¾ƒé•¿: <code>sudo gem install jekyll</code></li><li>å®‰è£…å®ŒæˆåæŸ¥çœ‹æ˜¯å¦æˆåŠŸ: <code>jekyll -v</code></li><li>å¯åŠ¨æœ¬åœ°æœåŠ¡: <code>jekyll serve</code></li></ol><h2 id="æŠ¥é”™è§£å†³"><a class="markdownIt-Anchor" href="#æŠ¥é”™è§£å†³"></a> æŠ¥é”™è§£å†³</h2><p><strong>Q</strong>: <code>Deprecation: You appear to have pagination turned on, but you haven't included the</code>jekyll-paginate<code>gem. Ensure you have</code>plugins: [jekyll-paginate]<code>in your configuration file.</code><br /><strong>A</strong>:</p><ol><li><code>sudo gem install jekyll-paginate</code></li><li>åœ¨<code>_config.yml</code>æ·»åŠ :<br /><img src="/img/2020-03-24-buy-domain/solve-error.png" alt="è§£å†³æŠ¥é”™" /></li></ol><p><strong>Q</strong>: <code>Liquid Warning: Liquid syntax error (line 38): Unexpected character &#123; in &quot;tag[1].size &gt; &#123;&#123;site.featured-condition-size&#125;&#125;&quot; in /_layouts/page.html</code><br /><strong>A</strong>: Liquidæ¨¡æ¿è¯­æ³•çš„é—®é¢˜,å°†<code>tag[1].size &gt; &#123;&#123;site.featured-condition-size&#125;&#125;</code> ä¿®æ”¹ä¸º <code>tag[1].size &gt; site.featured-condition-size</code>å°±okäº†</p><p>ç„¶åå°±æ­£å¸¸å•¦~<br /><img src="/img/2020-03-24-buy-domain/buy-domain-process8.png" alt="blog" /></p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><p><a href="https://blog.csdn.net/Maple_ROSI/article/details/79629531">åŸŸåç»‘å®šåšå®¢</a></p><p><a href="https://blog.csdn.net/yaakire/article/details/78932528?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task">jekyll æœ¬åœ°è°ƒè¯•åšå®¢</a></p><p><a href="https://github.com/ValchanOficial/valchan/issues/1">è§£å†³æŠ¥é”™1</a></p><p><a href="https://github.com/Huxpro/huxpro.github.io/issues/105">è§£å†³æŠ¥é”™2</a></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åšå®¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fetchè·å–çº¿ä¸Šå›¾ç‰‡å¼•å‘çš„æ€è€ƒ</title>
    <link href="/2020/03/16/2020-03-16-fetch-and-ajax/"/>
    <url>/2020/03/16/2020-03-16-fetch-and-ajax/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>èµ·å› æ˜¯æƒ³ä¸‹è½½ä¸€ä¸ªå¥—å›¾ä½†æ˜¯è²Œä¼¼è¦ VIP ä¼šå‘˜æ‰èƒ½ä¸‹è½½çš„æ ·å­,äºæ˜¯æŠ±ç€ä¾¥å¹¸çš„å¿ƒç†ç‚¹å¼€ F12 çœ‹äº†ä¸€çœ¼,å‘ç°å±…ç„¶ src å°±æ˜¯å›¾ç‰‡çš„çœŸå® uri,å¹¶ä¸”æ•´ä¸ªå¥—å›¾æ–‡ä»¶åæ•°å­—æ˜¯ç´¯åŠ çš„, å˜´è§’ç–¯ç‹‚ä¸Šæ‰¬çš„åŒæ—¶å†³å®šå†™ä¸ªè„šæœ¬ç™½å«–ä¸€ä¸‹.</p><h1 id="å®ç°è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å®ç°è¿‡ç¨‹"></a> å®ç°è¿‡ç¨‹</h1><p>è¯¥è¿‡ç¨‹ä¸»è¦è¿˜æ˜¯å¯¹ <code>fetch</code> è¿™ä¸ª api çš„æ¢ç©¶, ä½¿ç”¨äº†èƒ½å¤Ÿè¿è¡Œåœ¨ node ä¸­çš„<code>node-fetch</code>, ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯¹å›¾ç‰‡éŸ³é¢‘è¿›è¡Œä¸‹è½½æµ‹è¯•å‡æ­£å¸¸</p><h2 id="stream"><a class="markdownIt-Anchor" href="#stream"></a> stream</h2><p>ä½¿ç”¨<code>fetch</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ä¸”<code>resolve</code>çŠ¶æ€ä¸‹çš„<code>res.body</code>æ˜¯ä¸€ä¸ª<code>readablestream</code>å¯è¯»æµ,å¯ä»¥ç›´æ¥åˆ©ç”¨ç®¡é“æ¥åˆ°åˆ›å»ºçš„å¯å†™æµä¸­.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> dest = fs.<span class="hljs-title function_">createWriteStream</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./images&quot;</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;no&#125;</span>-0<span class="hljs-subst">$&#123;num&#125;</span>.jpg`</span>))<br>    res.<span class="hljs-property">body</span>.<span class="hljs-title function_">pipe</span>(dest)<br>    res.<span class="hljs-property">body</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;end&quot;</span>, resolve)<br>    res.<span class="hljs-property">body</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;error&quot;</span>, reject)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="buffer"><a class="markdownIt-Anchor" href="#buffer"></a> buffer()</h2><p>åˆ©ç”¨<code>node-fetch</code>ç›¸è¾ƒæµè§ˆå™¨<code>fetch</code>ç‰¹æœ‰çš„ buffer()æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">buffer</span>())<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">image</span> =&gt;</span> &#123;<br>    fs.<span class="hljs-title function_">writeFile</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./images&quot;</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;no&#125;</span>-0<span class="hljs-subst">$&#123;num&#125;</span>.jpg`</span>), image, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>    &#125;)<br>  &#125;)<br></code></pre></td></tr></table></figure><h2 id="arraybuffer"><a class="markdownIt-Anchor" href="#arraybuffer"></a> arrayBuffer()</h2><p>æˆ‘ä»¬çŸ¥é“ node ä¸­ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®éœ€è¦é€šè¿‡<code>buffer</code>è¿›è¡Œå­˜å‚¨, è€Œ fetch åªæä¾›äº†<code>res.arrayBuffer()</code>çš„æ–¹æ³•, æ‰€ä»¥åœ¨ä½¿ç”¨<code>arrayBuffer()</code>åè¿˜éœ€è¦ä½¿ç”¨<code>Buffer.from</code>å°†<code>arrayBuffer</code>è½¬åŒ–ä¸º<code>buffer</code>,è¿™ä¹Ÿæ˜¯ç¬¬äºŒç§æ–¹æ³•ç®€åŒ–çš„æ“ä½œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">arrayBuffer</span>())<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">image</span> =&gt;</span> &#123;<br>    fs.<span class="hljs-title function_">writeFile</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./images&quot;</span>, <span class="hljs-string">`test-<span class="hljs-subst">$&#123;no&#125;</span>-0<span class="hljs-subst">$&#123;num&#125;</span>.jpg`</span>), <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(image), <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>    &#125;)<br>  &#125;)<br></code></pre></td></tr></table></figure><p><strong>åˆ°è¿™é‡Œå·²ç»å¯¹äºè·å–è¿œç¨‹æ–‡ä»¶çš„æ–¹æ³•å·²ç»è®²å®Œäº†,ä¸‹é¢æ˜¯ä¸ªäººå¯¹å…¶ä¸­ä¸ç†è§£çš„éƒ¨åˆ†çš„ç¬”è®°</strong></p><h1 id="fetch-å¯¹æ¯”-ajax"><a class="markdownIt-Anchor" href="#fetch-å¯¹æ¯”-ajax"></a> <code>fetch</code> å¯¹æ¯” <code>ajax</code></h1><p>ä¹‹å‰ä¸€ç›´è§‰å¾— fetch ä¸ $.ajax,axios ä¸€æ ·,å¯¹ä¸Šé¢æ¡ˆä¾‹å®è·µåå‘ç°è¿˜æ˜¯è‡ªå·±èœäº†.<br />æ ¹æ® MDN ä¸Šçš„æè¿°:</p><blockquote><p>Fetch API æä¾›äº†ä¸€ä¸ª JavaScript æ¥å£ï¼Œç”¨äºè®¿é—®å’Œæ“çºµ HTTP ç®¡é“çš„ä¸€äº›å…·ä½“éƒ¨åˆ†ï¼Œä¾‹å¦‚è¯·æ±‚å’Œå“åº”ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªå…¨å±€ fetch() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æä¾›äº†ä¸€ç§ç®€å•ï¼Œåˆç†çš„æ–¹å¼æ¥è·¨ç½‘ç»œå¼‚æ­¥è·å–èµ„æºã€‚è¿™ç§åŠŸèƒ½ä»¥å‰æ˜¯ä½¿ç”¨ XMLHttpRequest å®ç°çš„ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ fetch å®é™…ä¸Šæ˜¯åœ¨<code>Promise</code>å‡ºç°æ¥è§£å†³<code>callback hell</code>å‰æä¸‹çš„ä¸€ä¸ªæ–°çš„å¼‚æ­¥è·å–èµ„æºçš„æ–¹æ¡ˆ.<br />è€Œ <code>fetch</code>ä¸ä¼ ç»Ÿ ajax çš„åŒºåˆ«æ˜¯</p><ul><li>é™¤éå‡ºç°ç½‘ç»œæ•…éšœæˆ–è¯·æ±‚è¢«é˜»æ­¢çš„æƒ…å†µä¸‹, <code>fetch</code>ä¼šå°†<code>Promise</code>çŠ¶æ€ç½®ä¸º<code>reject</code>,å…¶ä½™åƒå“åº”çŠ¶æ€ç <code>404</code>,<code>500</code>, <code>fetch</code>éƒ½ä¼šå°†çŠ¶æ€æ ‡è®°ä¸º<code>resolve</code>,ä½†ä¼šå°†<code>resolve</code>çš„å“åº”å¯¹è±¡çš„<code>ok</code>å±æ€§ç½®ä¸º<code>false</code></li><li><code>fetch</code>ä¸ä¼šæ¥æ”¶è·¨åŸŸçš„<code>cookie</code>,å³è·¨åŸŸå“åº”å¤´ä¸­çš„<code>set-cookie</code>å°†è¢«å¿½ç•¥</li><li><code>fetch</code>é»˜è®¤ä¸ä¼šè·¨åŸŸæ—¶å‘é€<code>cookie</code>,(ajax ä¹Ÿæ˜¯ä¸€æ ·çš„), é»˜è®¤<code>fetch</code>çš„<code>credentials</code>ä¸º<code>same-origin</code></li></ul><h2 id="fetch-è·¨åŸŸ"><a class="markdownIt-Anchor" href="#fetch-è·¨åŸŸ"></a> <code>fetch</code> è·¨åŸŸ</h2><p>fetch è·¨åŸŸéœ€è¦åç«¯é…åˆ<code>CORS</code>,åç«¯éœ€è¦å¯¹ä»¥ä¸‹å“åº”å¤´å­—æ®µè¿›è¡Œè®¾ç½®,å¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Koaæ¡†æ¶è®¾ç½®å“åº”å¤´</span><br>ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>)<br>ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;Origin, X-Requested-With, Content-Type, Accept&quot;</span>)<br>ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;POST, GET, PUT, DELETE, OPTIONS&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¹‹å,<code>fetch</code>è®¾ç½®<code>fetch(url, &#123;mode: 'cors'&#125;)</code>å³å¯è¿›è¡Œè·¨åŸŸ<br />è‹¥è®¾ç½®ä¸º<code>&#123;mode: 'no-cors'&#125;</code>, <code>fetch</code>ä¸ä¼šè¿›è¡ŒæŠ¥é”™,ä½†ä¼šæŠŠ<code>Promise</code>çš„<code>resolve</code>ä¼šè¿”å›<code>ok: false, type: 'opaque'</code>è¡¨æ˜ä½ æ²¡æœ‰æƒé™è®¿é—®<br /><img src="https://pic1.zhimg.com/80/v2-5bbd2fc2f90d8c5b3755616e5dd449bb_720w.jpg" alt="resolveå†…å®¹" /></p><ul><li>Q: æé—®! åç«¯æ²¡æœ‰æä¾›<code>CORS</code>, <code>fetch</code>éœ€è¦æ€ä¹ˆè·¨åŸŸ?</li><li>A: é‚£å°±ä¸è¦ä½¿ç”¨<code>fetch api</code>, å»ºè®®<code>JSONP</code>.</li></ul><h1 id="arraybuffer-buffer-typedarray"><a class="markdownIt-Anchor" href="#arraybuffer-buffer-typedarray"></a> arrayBuffer, Buffer, typedArray</h1><p>å¯¹äº<code>arrayBuffer</code>ä¸<code>typedArray</code>éƒ½å±äºäºŒè¿›åˆ¶æ•°ç»„,å¯¹äºè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæ˜é‡‘çš„è¿™ç¯‡æ–‡ç« :<br /><a href="https://juejin.im/post/5cde6dae6fb9a07eda02e5f1">æ˜é‡‘æ–‡ç« </a><br />è¿™é‡Œåšç®€è¿°:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> a1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">4</span>)<br><span class="hljs-comment">// è¿™é‡Œåˆ›å»ºäº†å››ä¸ªæ ¼å­, ä¸€ä¸ªæ ¼å­ä¸€ä¸ªå­—èŠ‚</span><br><span class="hljs-keyword">let</span> u1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(a1)<br><span class="hljs-comment">// è¿™é‡Œå°±åˆ©ç”¨arraybufferåˆ›å»ºäº†ä¸€ä¸ªtypedArray, ç”±äºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åŒæ ·æ˜¯8bit1ä¸ªå­—èŠ‚, æ‰€ä»¥è¾“å‡ºä¸º[0,0,0,0]</span><br>u1.<span class="hljs-property">buffer</span> === a1<br><span class="hljs-comment">// true</span><br><span class="hljs-comment">// è€Œé€šè¿‡typedArray.bufferæ–¹æ³•åˆèƒ½å¤Ÿçš„åˆ°ArrayBuffer</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™å¼ å›¾ä¹Ÿèƒ½çœ‹å‡ºä¸¤è€…çš„å…³ç³»:<br /><img src="/img/2020-03-16-fetch-and-ajax/arraybuffer.png" alt="arrayBuffer" /></p><h2 id="buffer-ä¸-typedarray"><a class="markdownIt-Anchor" href="#buffer-ä¸-typedarray"></a> Buffer ä¸ TypedArray</h2><p>ç¼–å†™è„šæœ¬æ—¶ä¾¿æœ‰ä¸€ä¸ªå›°æ‰°,<code>Buffer</code>ä¸<code>arrayBuffer</code>æœ‰å•¥å…³ç³»? è¿™é‡Œè®°å½•ä¸€ä¸‹.</p><ul><li><code>Buffer</code>æ˜¯å¯¹<code>Uint8Array</code>çš„å®ç°<br /><code>Buffer</code>å¯¹<code>Uint8Array</code>çš„ç›¸å…³ API è¿›è¡Œäº†å®ç°,ä½† node å¯¹<code>Buffer</code>ç±»è¿›è¡Œäº†ä¼˜åŒ–,ä½¿ä¹‹æ›´é€‚åˆåœ¨ node ä¸‹è¿è¡Œ</li><li><code>Buffer</code>å¹¶ä¸æ˜¯å®Œå…¨å…¼å®¹<code>TypedArray</code>å®ç°<br /><code>Buffer</code>åŒæ ·æ˜¯ä¸€ä¸ª<code>Uint8Array</code>ç±»å‹æ•°ç»„å®ä¾‹ã€‚ä½†å®ƒä¸ ES6 ä¸­çš„ç±»å‹æ•°ç»„è§„èŒƒå¹¶ä¸å®Œå…¨å…¼å®¹ï¼Œå¦‚ï¼š<code>ArrayBuffer#slice()</code>ä¼šåˆ›å»ºä¸€ä¸ªåˆ†éš”éƒ¨åˆ†æ•°æ®çš„æ‹·è´ï¼Œè€Œ <code>Buffer#slice()</code>ä¼šåˆ›å»ºä¸€ä¸ªä» Buffer ä¸­æ‹·è´æ•°æ®çš„è§†å›¾ï¼Œç›¸å¯¹æ¥è¯´ <code>Buffer#slice()</code>æ›´é«˜æ•ˆã€‚</li><li><code>Buffer</code>å¯ä»¥ä¸ç±»å‹æ•°ç»„å…±äº«å†…å­˜åŒº<br />å¯ä»¥ä»<code>TypedArray</code>çš„<code>.buffer</code>å±æ€§æˆ–<code>new ArrayBuffer()</code>åˆ›å»ºä¸€ä¸ª Buffer å¯¹è±¡ã€‚è¯¥å¯¹è±¡ä¼šä¸ç±»å‹æ•°ç»„å…±äº«å†…å­˜åŒºï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>(<span class="hljs-number">2</span>)<br>arr[<span class="hljs-number">0</span>] = <span class="hljs-number">5000</span><br>arr[<span class="hljs-number">1</span>] = <span class="hljs-number">4000</span><br><br><span class="hljs-keyword">const</span> buf1 = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(arr) <span class="hljs-comment">// å¤åˆ¶ buffer, å¼€è¾Ÿæ–°å†…å­˜åŒº</span><br><span class="hljs-keyword">const</span> buf2 = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(arr.<span class="hljs-property">buffer</span>) <span class="hljs-comment">// ä¸ arr å…±äº«å†…å­˜ç©ºé—´</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(buf1) <span class="hljs-comment">// &lt;Buffer 88 a0&gt;ï¼Œç”±äºBuffer&#x27;ç­‰åŒäº&#x27;Uint8Arrayæ‰€ä»¥å¯¹äº16bitçš„ç±»å‹æ•°ç»„,ä¼šæˆªå–8bit</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(buf2) <span class="hljs-comment">// &lt;Buffer 88 13 a0 0f&gt;</span><br></code></pre></td></tr></table></figure><p>å›åˆ°å¼€å¤´é‚£ä¸ªå›°æ‰°, é™¤äº†åº•å±‚è§„èŒƒä¸å®Œå…¨å…¼å®¹, æˆ‘ä»¬å¯ä»¥ä»¥<code>Uint8Array</code>æ¥çœ‹å¾…<code>Buffer</code>,å¹¶å¯ä»¥é€šè¿‡<code>Buffer.buffer</code>çš„æ–¹å¼è·å¾—<code>ArrayBuffer</code>.</p><h1 id="å»¶ä¼¸çš„å®è·µ"><a class="markdownIt-Anchor" href="#å»¶ä¼¸çš„å®è·µ"></a> å»¶ä¼¸çš„å®è·µ</h1><p>è°ˆäº†é‚£ä¹ˆå¤šå…³äºäºŒè¿›åˆ¶æ•°æ®çš„è¯é¢˜,ç°åœ¨å¯¹æ˜é‡‘æ–‡ç« ä¸­çš„ä¸€äº›å°æ¡ˆä¾‹è¿›è¡Œä¸€ä¸‹å®è·µ</p><h2 id="è·å–è¿œç¨‹å›¾ç‰‡å¹¶è½¬æ¢ä¸º-base64-æ ¼å¼"><a class="markdownIt-Anchor" href="#è·å–è¿œç¨‹å›¾ç‰‡å¹¶è½¬æ¢ä¸º-base64-æ ¼å¼"></a> è·å–è¿œç¨‹å›¾ç‰‡å¹¶è½¬æ¢ä¸º base64 æ ¼å¼</h2><p>to be continueâ€¦</p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h1><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">MDN fetch</a></p><p><a href="https://www.zhihu.com/question/47029864">çŸ¥ä¹ fetch å¦‚ä½•è·¨åŸŸ</a></p><p><a href="https://stackoom.com/question/3TrAt/%E4%BB%8EURL%E6%8F%90%E5%8F%96Blob%E5%B9%B6%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6">fetch ä» URL æå– Blob å¹¶å†™å…¥æ–‡ä»¶</a></p><p><a href="https://itbilu.com/nodejs/core/NyIjmp0wZ.html">Node.js Buffer ä¸ JavaScript TypeArray ç±»å‹æ•°ç»„çš„å¼‚åŒ</a></p><p><a href="https://juejin.im/post/5c98ed7cf265da610e5ed862#heading-9">å‰ç«¯å¤„ç†åç«¯æ¥å£ä¼ é€’è¿‡æ¥çš„å›¾ç‰‡æ–‡ä»¶</a></p>]]></content>
    
    
    <categories>
      
      <category>ajax</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>ajax</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…è°ˆscriptä¸­çš„deferä¸asyncå±æ€§</title>
    <link href="/2020/03/14/2020-03-13-async-vs-defer/"/>
    <url>/2020/03/14/2020-03-13-async-vs-defer/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h2><p>ä¸ªäººå­¦ä¹ ç®€å•è®°å½•, ä¸å–œè¯¯å–·, æœ‰é”™è¯¯éº»çƒ¦æŒ‡æ­£, å…·ä½“ç»†èŠ‚ç›´æ¥åº•éƒ¨ reference, æ„Ÿè°¢.</p><h2 id="script"><a class="markdownIt-Anchor" href="#script"></a> script</h2><ol><li>å æ®ä¸»çº¿ç¨‹, html parser å¤„äºé˜»å¡çŠ¶æ€</li><li>å¹¶è¡Œä¸‹è½½å¤šä¸ª js æ–‡ä»¶</li><li>ä¸‹è½½å®Œæˆåé¡ºåºæ‰§è¡Œ</li></ol><p><img src="https://www.growingwiththeweb.com/images/2014/02/26/script.svg" alt="script" /></p><h2 id="script-with-defer"><a class="markdownIt-Anchor" href="#script-with-defer"></a> script with defer</h2><ol><li>ä¸ html parser åŒæ—¶è¿›è¡Œ</li><li>å¹¶è¡Œä¸‹è½½å¤šä¸ª js æ–‡ä»¶</li><li><code>DOMContentLoaded</code>äº‹ä»¶è§¦å‘å‰é¡ºåºæ‰§è¡Œ</li></ol><p><img src="https://www.growingwiththeweb.com/images/2014/02/26/script-defer.svg" alt="defer" /></p><h3 id="domcontentloaded"><a class="markdownIt-Anchor" href="#domcontentloaded"></a> DOMContentLoaded</h3><p>MDN ä¸­æ˜¯è¿™ä¹ˆè§£é‡Šçš„:</p><blockquote><p>The <code>load</code> event is fired when the whole page has loaded, including all dependent resources such as stylesheets and images. This is in contrast to <code>DOMContentLoaded</code>, which is fired as soon as the page DOM has been loaded, without waiting for resources to finish loading.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´<code>DOMContentLoaded</code>åªè¦ DOM æ ‘è§£æå®Œæˆå°±ä¼šè§¦å‘, è€Œ<code>load</code>äº‹ä»¶ä¼šç»§ç»­ç­‰å¾…æ ·å¼,å›¾ç‰‡ç­‰èµ„æºè§£æå®Œæ¯•åè§¦å‘.</p><h2 id="script-with-async"><a class="markdownIt-Anchor" href="#script-with-async"></a> script with async</h2><ol><li>ä¸ html parser åŒæ—¶è¿›è¡Œ</li><li>å¹¶è¡Œä¸‹è½½å¤šä¸ª js æ–‡ä»¶</li><li>ä¸‹è½½å®Œæˆåé˜»å¡ html parser, å¼€å§‹æ‰§è¡Œ</li><li>æ‰§è¡Œä¸ä¸€å®šæ˜¯é¡ºåºçš„,æ‰€ä»¥ç¦æ­¢è„šæœ¬é—´å­˜åœ¨ä¾èµ–</li></ol><p><img src="https://www.growingwiththeweb.com/images/2014/02/26/script-async.svg" alt="async" /></p><h2 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h2><ol><li>å­˜åœ¨å¤šä¸ª js æ–‡ä»¶æ—¶éƒ½ä¼šå¹¶è¡Œä¸‹è½½</li><li>defer ä¸ async ä¸‹è½½ js ä¸è§£æ html åŒæ—¶è¿›è¡Œ</li><li>defer åœ¨<code>DOMContentLoaded</code>è§¦å‘å‰æ‰§è¡Œ js, async åˆ™åœ¨ä¸‹è½½ç»“æŸåç«‹å³æ‰§è¡Œ</li><li>defer é¡ºåºæ‰§è¡Œ js æ–‡ä»¶, async åˆ™å…ˆä¸‹è½½å®Œçš„å…ˆæ‰§è¡Œ</li></ol><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> reference</h2><p><a href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html">async vs defer attributes</a><br /><a href="https://www.cnblogs.com/wuguanglin/p/JSAndImgLoadOrder.html">æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“</a></p><h2 id="negative-example"><a class="markdownIt-Anchor" href="#negative-example"></a> negative example</h2><p>è´´ä¸€ä¸‹ google ä¸­æ‰¾åˆ°çš„åé¢æ•™æ<br /><strong>async æ˜¯ä¼šå½±å“åˆ°é¡µé¢è§£æçš„</strong><br /><a href="https://github.com/xiaoyu2er/blog/issues/8">å½»åº•ææ‡‚ async &amp; defer</a></p>]]></content>
    
    
    <categories>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VScodeä»£ç è§„èŒƒ</title>
    <link href="/2020/01/20/2020-01-16-EditorConfig/"/>
    <url>/2020/01/20/2020-01-16-EditorConfig/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h2><p>é©¬ä¸Šå°±è¦å¤§å­¦æ¯•ä¸šå·¥ä½œäº†ï¼Œå®ä¹ è¿‡ç¨‹ä¸­æ„è¯†åˆ°è‡ªå·±ä»¥å‰ä¸€ç›´ä¸åœ¨æ„çš„å›¢é˜Ÿåä½œä¸­çš„ä»£ç è§„èŒƒé‡è¦æ€§ã€‚ç°åœ¨æ•´ç†ä¸€ä¸‹ä¾›ä»¥åæ¸©ä¹ ï¼Œå†™çš„å¾ˆéšæ„ï¼Œä»…ä¾›å‚è€ƒã€‚</p><h2 id="vscode-ä¸­çš„-editorconfig-prettier-eslint"><a class="markdownIt-Anchor" href="#vscode-ä¸­çš„-editorconfig-prettier-eslint"></a> vscode ä¸­çš„ editorconfig, prettier, eslint</h2><p>ä¸‰è€…æ˜¯æ¸è¿›çš„è¿‡ç¨‹ã€‚<br />editorconfig é…ç½®ç¼–ç æ—¶çš„ä»£ç é£æ ¼ï¼Œprettier é…ç½®ç¼–ç åçš„ä¿å­˜æ—¶çš„è§„èŒƒï¼Œeslint å’Œ prettier ç±»ä¼¼ï¼Œä½† prettier ä¸ä¼šä»…ä»…æ˜¯å®šä¹‰è§„èŒƒï¼Œä¸ä¼šå¯¹ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç æŠ›å‡ºé”™è¯¯æˆ–è­¦å‘Šï¼Œeslint åˆ™ä¼šæ£€æŸ¥è¯­æ³•ï¼Œåœ¨ä¾‹å¦‚å˜é‡æœªå®šä¹‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚</p><h2 id="editorconfig-é…ç½®"><a class="markdownIt-Anchor" href="#editorconfig-é…ç½®"></a> editorconfig é…ç½®</h2><ol><li>å®‰è£… editorconfig åŒ… <code>npm install -g editorconfig</code></li><li>å®‰è£… vscode æ‰©å±• <code>ext install EditorConfig</code></li><li>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º.editorconfig æ–‡ä»¶</li></ol><p>é…ç½®å‚è€ƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># This is the top-most .editorconfig file (do not search in parent directories)</span><br>root = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">### All files</span><br>[*]<br><span class="hljs-comment"># Force charset utf-8</span><br>charset = utf-8<br><span class="hljs-comment"># Indentation</span><br>indent_style = tab<br>indent_size = 4<br><span class="hljs-comment"># line breaks and whitespace</span><br>insert_final_newline = <span class="hljs-literal">true</span><br>trim_trailing_whitespace = <span class="hljs-literal">true</span><br><span class="hljs-comment"># end_of_line = lf</span><br><br><span class="hljs-comment">### Frontend files</span><br>[*.&#123;css,scss,less,js,json,ts,sass,php,html,hbs,mustache,phtml,html.twig&#125;]<br><br><span class="hljs-comment">### Markdown</span><br>[*.md]<br>indent_style = space<br>indent_size = 4<br>trim_trailing_whitespace = <span class="hljs-literal">false</span><br><br><span class="hljs-comment">### YAML</span><br>[*.yml]<br>indent_style = space<br>indent_size = 2<br><br><span class="hljs-comment">### Specific files</span><br>[&#123;package,bower&#125;.json]<br>indent_style = space<br>indent_size = 2<br></code></pre></td></tr></table></figure><h2 id="prettier-é…ç½®"><a class="markdownIt-Anchor" href="#prettier-é…ç½®"></a> prettier é…ç½®</h2><ol><li>å®‰è£… prettier åŒ… <code>npm install -g prettier</code></li><li>å®‰è£… prettier for vscode æ’ä»¶</li><li>æ–°å»º.prettierrc.js æ–‡ä»¶</li></ol><p>é…ç½®å‚è€ƒï¼šå…¨éƒ¨å‚æ•°<a href="https://prettier.io/docs/en/configuration.html">here</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// prettier.config.js or .prettierrc.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// ä¸€è¡Œæœ€å¤š 100 å­—ç¬¦</span><br>  <span class="hljs-attr">printWidth</span>: <span class="hljs-number">100</span>,<br>  <span class="hljs-comment">// ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ç¼©è¿›</span><br>  <span class="hljs-attr">tabWidth</span>: <span class="hljs-number">4</span>,<br>  <span class="hljs-comment">// ä¸ä½¿ç”¨ç¼©è¿›ç¬¦ï¼Œè€Œä½¿ç”¨ç©ºæ ¼</span><br>  <span class="hljs-attr">useTabs</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// è¡Œå°¾éœ€è¦æœ‰åˆ†å·</span><br>  <span class="hljs-attr">semi</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// ä½¿ç”¨å•å¼•å·</span><br>  <span class="hljs-attr">singleQuote</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// å¯¹è±¡çš„ key ä»…åœ¨å¿…è¦æ—¶ç”¨å¼•å·</span><br>  <span class="hljs-attr">quoteProps</span>: <span class="hljs-string">&quot;as-needed&quot;</span>,<br>  <span class="hljs-comment">// jsx ä¸ä½¿ç”¨å•å¼•å·ï¼Œè€Œä½¿ç”¨åŒå¼•å·</span><br>  <span class="hljs-attr">jsxSingleQuote</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// æœ«å°¾ä¸éœ€è¦é€—å·</span><br>  <span class="hljs-attr">trailingComma</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>  <span class="hljs-comment">// å¤§æ‹¬å·å†…çš„é¦–å°¾éœ€è¦ç©ºæ ¼</span><br>  <span class="hljs-attr">bracketSpacing</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// jsx æ ‡ç­¾çš„åå°–æ‹¬å·éœ€è¦æ¢è¡Œ</span><br>  <span class="hljs-attr">jsxBracketSameLine</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// ç®­å¤´å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ‹¬å·</span><br>  <span class="hljs-attr">arrowParens</span>: <span class="hljs-string">&quot;always&quot;</span>,<br>  <span class="hljs-comment">// æ¯ä¸ªæ–‡ä»¶æ ¼å¼åŒ–çš„èŒƒå›´æ˜¯æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹</span><br>  <span class="hljs-attr">rangeStart</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">rangeEnd</span>: <span class="hljs-title class_">Infinity</span>,<br>  <span class="hljs-comment">// ä¸éœ€è¦å†™æ–‡ä»¶å¼€å¤´çš„ @prettier</span><br>  <span class="hljs-attr">requirePragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// ä¸éœ€è¦è‡ªåŠ¨åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥ @prettier</span><br>  <span class="hljs-attr">insertPragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// ä½¿ç”¨é»˜è®¤çš„æŠ˜è¡Œæ ‡å‡†</span><br>  <span class="hljs-attr">proseWrap</span>: <span class="hljs-string">&quot;preserve&quot;</span>,<br>  <span class="hljs-comment">// æ ¹æ®æ˜¾ç¤ºæ ·å¼å†³å®š html è¦ä¸è¦æŠ˜è¡Œ</span><br>  <span class="hljs-attr">htmlWhitespaceSensitivity</span>: <span class="hljs-string">&quot;css&quot;</span>,<br>  <span class="hljs-comment">// æ¢è¡Œç¬¦ä½¿ç”¨ lf</span><br>  <span class="hljs-attr">endOfLine</span>: <span class="hljs-string">&quot;lf&quot;</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="vscode-ä¸­é›†æˆ-prettier"><a class="markdownIt-Anchor" href="#vscode-ä¸­é›†æˆ-prettier"></a> vscode ä¸­é›†æˆ prettier</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;files.eol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\n&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;editor.tabSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// ä¸files.autoSave: &quot;afterDelay&quot;å†²çª</span><br>  <span class="hljs-attr">&quot;editor.formatOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;editor.defaultFormatter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esbenp.prettier-vscode&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="update"><a class="markdownIt-Anchor" href="#update"></a> update</h3><ul><li>2020-03-28 ä½¿ç”¨é…ç½®æ–‡ä»¶çš„åœºåˆå°†vscodeçš„é»˜è®¤é€‰é¡¹å±è”½ä¸€ä¸‹,å¦åˆ™å¯èƒ½æœ‰å†²çª, å…·ä½“: åœ¨<code>setting.json</code>æœ«å°¾åŠ ä¸Š<code>&quot;prettier.requireConfig&quot;: true</code>(ä½¿ç”¨é…ç½®æ–‡ä»¶æ ¼å¼åŒ–)</li></ul><h2 id="js-ä¸­-eslint-é…ç½®"><a class="markdownIt-Anchor" href="#js-ä¸­-eslint-é…ç½®"></a> js ä¸­ eslint é…ç½®</h2><ol><li>å®‰è£… eslint åŒ… <code>npm install -g eslint</code> æˆ– <code>npm install --save-dev prettier</code></li><li>åˆå§‹åŒ– eslint æ–‡ä»¶ <code>eslint --init</code>, è¿™é‡Œæˆ‘é€‰æ‹© json æ–‡ä»¶ eslint ä¸ç”Ÿæ•ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ¢æˆ js æ–‡ä»¶å°±å¥½äº†ã€‚</li><li>é…ç½® .eslintrc.js æ–‡ä»¶</li></ol><p>é…ç½®å‚è€ƒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">env</span>: &#123;<br>    <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">commonjs</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;eslint:recommended&quot;</span>],<br>  <span class="hljs-attr">parserOptions</span>: &#123;<br>    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-attr">indent</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;tab&quot;</span>],<br>    <span class="hljs-string">&quot;linebreak-style&quot;</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;unix&quot;</span>],<br>    <span class="hljs-attr">quotes</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;single&quot;</span>],<br>    <span class="hljs-attr">semi</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;never&quot;</span>]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="typescript-ä¸­-eslint-é…ç½®"><a class="markdownIt-Anchor" href="#typescript-ä¸­-eslint-é…ç½®"></a> Typescript ä¸­ eslint é…ç½®</h2><h3 id="20191-å¼€å§‹-ts-å®˜æ–¹ä¸å†ä½¿ç”¨-tslintå»ºè®®ä½¿ç”¨-eslint-è¿›è¡Œä»£ç è§„èŒƒ"><a class="markdownIt-Anchor" href="#20191-å¼€å§‹-ts-å®˜æ–¹ä¸å†ä½¿ç”¨-tslintå»ºè®®ä½¿ç”¨-eslint-è¿›è¡Œä»£ç è§„èŒƒ"></a> 2019.1 å¼€å§‹ TS å®˜æ–¹ä¸å†ä½¿ç”¨ tslintï¼Œå»ºè®®ä½¿ç”¨ eslint è¿›è¡Œä»£ç è§„èŒƒ</h3><ol><li>åœ¨é¡¹ç›®ä¸­å®‰è£… eslint <code>npm install --save-dev eslint</code></li><li>eslint æ— æ³•è¯†åˆ« ts çš„éƒ¨åˆ†è¯­æ³•ï¼Œå®‰è£… ts çš„è§£æå™¨æ›¿æ¢é»˜è®¤è§£æå™¨ <code>npm install --save-dev typescript @typescript-eslint/parser</code></li><li>å®‰è£…å¯¹ eslint é»˜è®¤è§„åˆ™è¡¥å……çš„åŒ… <code>npm install --save-dev @typescript-eslint/eslint-plugin</code></li><li>æ–°å»º.eslintrc.js æ–‡ä»¶(ä¸çŸ¥é“ä¸ºå•¥ json æ–‡ä»¶æ²¡æ•ˆæœ)<br />é…ç½®å¦‚ä¸‹:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">parser</span>: <span class="hljs-string">&quot;@typescript-eslint/parser&quot;</span>,<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&quot;@typescript-eslint&quot;</span>],<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// ç¦æ­¢ä½¿ç”¨ var</span><br>    <span class="hljs-string">&quot;no-var&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-comment">// ä¼˜å…ˆä½¿ç”¨ interface è€Œä¸æ˜¯ type</span><br>    <span class="hljs-string">&quot;@typescript-eslint/consistent-type-definitions&quot;</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;interface&quot;</span>]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="é‡åˆ°importdeclaration-should-appear-when-the-mode-is-es6-and-in-the-module-contextæŠ¥é”™åœ¨eslintrcjs-ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®"><a class="markdownIt-Anchor" href="#é‡åˆ°importdeclaration-should-appear-when-the-mode-is-es6-and-in-the-module-contextæŠ¥é”™åœ¨eslintrcjs-ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®"></a> é‡åˆ°<code>ImportDeclaration should appear when the mode is ES6 and in the module context</code>æŠ¥é”™ï¼Œåœ¨.eslintrc.js ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">parserOptions</span>: &#123;<br>    <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">6</span>,<br>    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&#x27;module&#x27;</span>,<br>    <span class="hljs-attr">ecmaFeatures</span>: &#123;<br>        <span class="hljs-attr">modules</span>: <span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="vscode-ä¸­é›†æˆ-eslint-æ£€æŸ¥å¹¶åœ¨ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤"><a class="markdownIt-Anchor" href="#vscode-ä¸­é›†æˆ-eslint-æ£€æŸ¥å¹¶åœ¨ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤"></a> vscode ä¸­é›†æˆ eslint æ£€æŸ¥å¹¶åœ¨ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤</h3><p>åœ¨<code>setting.json</code>æ–‡ä»¶ä¸­åŠ å…¥å¯¹ ts çš„æ£€æŸ¥</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">// instead of &quot;eslint.autoFixOnSave&quot;: true</span><br>  <span class="hljs-attr">&quot;editor.codeActionsOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;source.fixAll.eslint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// autoFixé»˜è®¤å¼€å¯</span><br>  <span class="hljs-attr">&quot;eslint.validate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;javascript&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;javascriptreact&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;typescript&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;typescript.tsdk&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node_modules/typescript/lib&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ç²¾ä½¿ç”¨-alloyteam-çš„-eslint-é…ç½®"><a class="markdownIt-Anchor" href="#ç²¾ä½¿ç”¨-alloyteam-çš„-eslint-é…ç½®"></a> (ç²¾)ä½¿ç”¨ AlloyTeam çš„ ESLint é…ç½®</h3><p>alloy å›¢é˜Ÿçš„ eslint é…ç½®å»æ‰äº†ç³Ÿç²•ï¼Œå¹¶ä¸”ä¸å†åŒ…å«ä»£ç æ ¼å¼çš„è§„åˆ™ï¼ŒæŠŠå…¶äº¤ç»™æ›´ä¸“ä¸šçš„ prettier</p><ol><li>å®‰è£…<code>npm install --save-dev eslint typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-config-alloy</code></li><li>æ·»åŠ é…ç½®å¦‚ä¸‹ï¼š(å¯ä»¥å°† parser å’Œ plugin å»æ‰äº†)</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;alloy&quot;</span>, <span class="hljs-string">&quot;alloy/typescript&quot;</span>],<br>  <span class="hljs-attr">env</span>: &#123;<br>    <span class="hljs-comment">// æ‚¨çš„ç¯å¢ƒå˜é‡ï¼ˆåŒ…å«å¤šä¸ªé¢„å®šä¹‰çš„å…¨å±€å˜é‡ï¼‰</span><br>    <span class="hljs-comment">// Your environments (which contains several predefined global variables)</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// browser: true,</span><br>    <span class="hljs-comment">// node: true,</span><br>    <span class="hljs-comment">// mocha: true,</span><br>    <span class="hljs-comment">// jest: true,</span><br>    <span class="hljs-comment">// jquery: true</span><br>  &#125;,<br>  <span class="hljs-attr">globals</span>: &#123;<br>    <span class="hljs-comment">// æ‚¨çš„å…¨å±€å˜é‡ï¼ˆè®¾ç½®ä¸º false è¡¨ç¤ºå®ƒä¸å…è®¸è¢«é‡æ–°èµ‹å€¼ï¼‰</span><br>    <span class="hljs-comment">// Your global variables (setting to false means it&#x27;s not allowed to be reassigned)</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// myGlobal: false</span><br>  &#125;,<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// è‡ªå®šä¹‰æ‚¨çš„è§„åˆ™</span><br>    <span class="hljs-comment">// Customize your rules</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="vue-with-typescript"><a class="markdownIt-Anchor" href="#vue-with-typescript"></a> Vue with Typescript</h2><p>å»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„è„šæ‰‹æ¶, å¼•ç”¨å®˜ç½‘çš„ä¸€å¥è¯:</p><blockquote><p>The most rules of eslint-plugin-vue require vue-eslint-parser to check <code>&lt;template&gt;</code> ASTs.</p></blockquote><p>ç”±äºvueæ˜¯html+tsçš„ç‰¹æ®Šæ¨¡æ¿æ–‡ä»¶æ€§è´¨,ä½¿ä¸Šè¿°çš„<code>ts</code>æ‰©å±•æ— æ³•å¯¹<code>.vue</code>è¿›è¡Œè§£æ, æˆ‘å°è¯•é…ç½®å‘ç°å„ç§å„æ ·çš„é—®é¢˜,è¿˜æ˜¯å®˜æ–¹è„šæ‰‹æ¶ä¸€é”®æ“ä½œç®€å•,åªèƒ½è¯´â€¦çœŸé¦™</p><ol><li>å®‰è£…è„šæ‰‹æ¶<code>vue-cli</code></li></ol><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">npm install -g <span class="hljs-symbol">@vue</span>/cli <span class="hljs-symbol">@vue</span>/cli-service-<span class="hljs-keyword">global</span><br><span class="hljs-meta"># or</span><br>yarn <span class="hljs-keyword">global</span> add <span class="hljs-symbol">@vue</span>/cli <span class="hljs-symbol">@vue</span>/cli-service-<span class="hljs-keyword">global</span><br></code></pre></td></tr></table></figure><ol start="2"><li>æ–°å»ºé¡¹ç›®<code>vue create your-project-name</code>, æ”¾ä¸ªé…ç½®ä¾‹å­<br /><img src="/img/2020-01-16/1.png" alt="1" /><br /><img src="/img/2020-01-16/2.png" alt="2" /></li><li>åŠ å…¥ä¸Šè¿°çš„<code>.editorconfig</code>å’Œ<code>.prettierrc.js</code>æ–‡ä»¶, å°±å¯ä»¥æ„‰å¿«åœ°ç”¨<code>ts</code>å¼€å‘<code>vue</code>äº†.</li></ol><h3 id="node-sass-dart-sass"><a class="markdownIt-Anchor" href="#node-sass-dart-sass"></a> node-sass ?? dart-sass ??</h3><p>ç”±äº<code>node-sass</code>ä½¿ç”¨C++å¼€å‘, å®‰è£…<code>node-sass</code>å¯èƒ½ä¼šé‡åˆ°å¡æ­»/ä¸‹è½½å¤±è´¥ç­‰é—®é¢˜(åšä¸»ä¹Ÿé‡åˆ°äº†), å®˜æ–¹ç°åœ¨ä¹Ÿæ¨èä½¿ç”¨<code>dart-sass</code></p><p>å‚è€ƒèµ„æ–™ï¼š<br /><a href="https://stackoverflow.com/questions/48363647/editorconfig-vs-eslint-vs-prettier-is-it-worthwhile-to-use-them-all">editorconfig vs prettier vs eslint</a><br /><a href="https://stackoverflow.com/questions/46846128/editorconfig-for-vs-code-not-working">editorconfig é…ç½®</a><br /><a href="https://www.robinwieruch.de/how-to-use-prettier-vscode">prettier é…ç½®</a><br /><a href="https://segmentfault.com/a/1190000009077086">eslint é…ç½®</a><br /><a href="https://juejin.im/post/5cd3f035e51d456e6479b538#heading-4">eslint ä¸­ js è§„èŒƒé…ç½®å‚è€ƒ</a><br /><a href="https://github.com/eslint/eslint/issues/4344">ImportDeclaration should appear when the mode is ES6 and in the module context æŠ¥é”™è§£å†³</a><br /><a href="https://ts.xcatliu.com/engineering/lint">typescript é…ç½®ä»£ç è§„èŒƒ</a></p>]]></content>
    
    
    <categories>
      
      <category>vscode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
